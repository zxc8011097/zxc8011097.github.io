<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="keywords" content="è¶³çƒé¢„æµ‹,è¶³çƒåˆ†æ,è¶³çƒAI,èµ›äº‹é¢„æµ‹,ä½“è‚²æ•°æ®,æ¯”åˆ†é¢„æµ‹,è¶³çƒå¤§æ•°æ®">
<meta name="description" content="ä¸“ä¸šè¶³çƒAIåˆ†æç³»ç»Ÿï¼Œæä¾›èµ›äº‹é¢„æµ‹ã€æ¯”åˆ†åˆ†æã€çƒé˜Ÿæ•°æ®ã€å®æ—¶æ¨¡æ‹Ÿï¼Œä»…ä¾›è¶³çƒçˆ±å¥½è€…å¨±ä¹ä½¿ç”¨ã€‚">
<meta name="author" content="football-predict.top">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<title>è¶³çƒAIå¤§æ•°æ®é¢„æµ‹ Â· ç»ˆææ——èˆ°ç‰ˆ</title>
<!-- å¼•å…¥ Chart.js å’Œ html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"PingFang SC","Microsoft YaHei",sans-serif}
html,body{background:#070b1d;color:#ECECEC;overflow:visible!important;height:auto!important;position:relative!important;touch-action:auto!important;-webkit-overflow-scrolling:touch!important;transition:background 0.3s,color 0.3s}
.container{max-width:480px;margin:0 auto;padding:12px}
.header{text-align:center;padding:16px 0 10px;position:relative}
.header h1{font-size:22px;color:#FFD700;font-weight:600}
.header p{font-size:12px;color:#aab}
#themeToggle,#langToggle{margin-top:8px;padding:8px 16px;border-radius:20px;border:none;background:#165DFF;color:#fff;font-size:13px;cursor:pointer;display:inline-block;margin:4px}
.season-tab{display:flex;gap:8px;margin:10px 0;overflow-x:auto;padding:4px 0}
.season{background:#10182a;color:#ccd;padding:8px 12px;border-radius:10px;font-size:13px;white-space:nowrap;transition:0.2s}
.season.active{background:#165DFF;color:#fff}
.league-scroll{display:flex;gap:8px;overflow-x:auto;padding:6px 0;margin-bottom:12px}
.league-item{background:#131b2e;color:#ccd;padding:10px 14px;border-radius:12px;font-size:14px;white-space:nowrap;transition:0.2s}
.league-item.active{background:#165DFF;color:#fff}
.custom-input{display:flex;gap:8px;margin:10px 0}
.custom-input input{flex:1;background:#151d30;border:none;border-radius:10px;padding:12px 14px;color:#fff;font-size:15px}
.use-custom{background:#2DCE89;color:white;border:none;border-radius:10px;padding:12px 14px;font-size:14px;margin-top:4px;width:100%}
.match-select{margin-bottom:12px}
.match-select select{width:100%;background:#151d30;border:none;border-radius:12px;padding:14px;color:#fff;font-size:15px;margin-bottom:8px}
.match-select select:disabled{opacity:.6}
.data-card{background:#0F1628;border-radius:16px;padding:16px;margin-bottom:12px}
.data-card .title{font-size:14px;color:#aab;margin-bottom:10px}
.ai-score{text-align:center;font-size:40px;color:#FFD700;font-weight:bold;margin:10px 0}
.score-group{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
.score-item{background:#131b2e;border-radius:10px;padding:10px;text-align:center}
.score-item .num{font-size:16px;color:#FFD700}
.score-item .tag{font-size:11px;color:#aab}
.prob-group{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.prob-item{background:#131b2e;border-radius:10px;padding:14px;text-align:center}
.prob-item .num{font-size:18px;color:#fff}
.prob-item .text{font-size:11px;color:#aab}
.btn-group{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:16px 0}
.btn{padding:16px;border-radius:14px;border:none;font-size:15px}
.btn-blue{background:#165DFF;color:#fff}
.btn-green{background:#00B42A;color:#fff}
.btn-orange{background:#FF8C00;color:#fff}
.sim-box{background:#0C1322;border-radius:16px;padding:18px;margin-top:12px;text-align:center}
.sim-time{color:#4096FF;font-size:14px;margin-bottom:8px}
.sim-score{font-size:34px;color:#fff;margin:8px 0}
.sim-event{color:#c0c8d;font-size:13px;min-height:36px;line-height:1.4}
.sim-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:12px;font-size:12px;color:#ccc}
.sim-stats .stat-item{background:#131b2e;padding:6px;border-radius:6px}
.power-bar{height:6px;background:#151d30;border-radius:3px;overflow:hidden;margin-top:6px}
.power-bar .bar{height:100%;background:#165DFF;transition:width 0.8s}
.match-info{background:#131b2e;border-radius:12px;padding:10px 14px;margin-bottom:10px;font-size:13px;color:#c0c8d}
.recent-box{background:#131b2e;border-radius:10px;padding:10px;margin-top:8px;font-size:12px;color:#aab}
.record{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;font-size:12px;}
.record span{padding:3px 6px;border-radius:4px;background:#151d30;color:#fff;}
.record .win{background:#00B42A;}
.record .draw{background:#FFA500;}
.record .lose{background:#FF4D4F;}
.vs-record{font-size:12px;color:#ccc;background:#131b2e;padding:10px;border-radius:10px;margin-top:8px;line-height:1.5}
.hot-box{display:flex;justify-content:space-between;font-size:12px;color:#ccc;margin-top:8px}
.accuracy-box{background:#131b2e;border-radius:12px;padding:12px 14px;margin-top:12px;text-align:center;font-size:13px;color:#ccc;border-left:3px solid #165DFF;}
.ai-confidence{background:#131b2e;border-radius:12px;padding:10px 14px;margin-top:8px;text-align:center;font-size:14px;font-weight:bold;color:#FFD700;}
.league-note{background:#151d30;border-radius:10px;padding:8px 12px;margin-top:8px;font-size:12px;color:#ccc;text-align:center;}
.home-away-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;font-size:12px;color:#ccc;}
.home-away-stats .stat-item{background:#131b2e;padding:10px;border-radius:10px;text-align:center;}
.pro-detail{background:#131b2e;border-radius:12px;padding:12px;margin-top:12px;font-size:12px;color:#ddd;line-height:1.6}
.pro-detail .item{display:flex;justify-content:space-between;margin-bottom:4px}
.pro-detail .label{color:#aab}
.pro-detail .value{color:#FFD700;font-weight:bold}
.real-data{background:#0f1628;border-radius:12px;padding:12px;margin-top:12px}
.real-data .title{font-size:13px;color:#FFD700;margin-bottom:8px}
.real-data .table{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;font-size:11px}
.real-data .table-item{background:#131b2e;padding:6px;border-radius:6px;text-align:center}
.injury-info{background:#151d30;border-radius:10px;padding:10px;margin-top:8px;font-size:12px;color:#f88}
.schedule-box{background:#0c1322;border-radius:10px;padding:8px;margin-top:10px;font-size:11px;max-height:120px;overflow-y:auto}
.schedule-item{display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid #222e40}
.lineup-box{background:#0c1322;border-radius:10px;padding:8px;margin-top:10px;font-size:11px;display:flex;justify-content:space-between}
.lineup-box div{width:48%}
.lineup-box .home-lineup{color:#4096FF}
.lineup-box .away-lineup{color:#FF4D4F}
.rating-box{background:#0c1322;border-radius:10px;padding:8px;margin-top:8px;font-size:11px;display:flex;flex-direction:column;gap:4px}
.rating-box .home-rating{color:#4096FF}
.rating-box .away-rating{color:#FF4D4F}
.toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#165DFF;color:#fff;padding:12px 20px;border-radius:10px;font-size:14px;display:none;z-index:999}
.loading-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:1000}
.loading-modal.active{display:flex}
.loading-spin{width:40px;height:40px;border:3px solid #151d30;border-top:3px solid #165DFF;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.slider-group{background:#131b2e;border-radius:10px;padding:10px;margin-top:10px}
.slider-item{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.slider-item input{width:60%;background:#151d30;accent-color:#165DFF}
.slider-item span{color:#FFD700}
.chart-container{height:200px;margin-top:10px}
.news-ticker{background:#0c1322;border-radius:8px;padding:8px;font-size:12px;white-space:nowrap;overflow:hidden;animation:scroll 15s linear infinite;margin-bottom:10px}
@keyframes scroll{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
.odds-table{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:4px;font-size:12px;text-align:center}
.odds-table div{padding:4px;background:#151d30;border-radius:4px}
.hot-matches{display:flex;gap:6px;overflow-x:auto;padding:6px 0;margin-bottom:12px}
.hot-match{background:#131b2e;border-radius:10px;padding:8px 12px;font-size:12px;white-space:nowrap;cursor:pointer;transition:0.2s}
.hot-match:hover{background:#165DFF}
.team-badge{display:inline-block;width:24px;height:24px;border-radius:50%;text-align:center;line-height:24px;font-size:12px;font-weight:bold;margin-right:6px}
.history-box{display:flex;gap:6px;margin-top:8px;overflow-x:auto}
.history-item{background:#151d30;border-radius:8px;padding:6px 10px;font-size:11px;white-space:nowrap;cursor:pointer}
.history-item:hover{background:#2a3444}
.transfer-ticker{background:#0c1322;border-radius:8px;padding:6px;font-size:12px;white-space:nowrap;overflow:hidden;animation:scroll 15s linear infinite;margin-bottom:6px}
.value-badge{display:inline-block;padding:2px 6px;border-radius:10px;font-size:10px;margin-left:4px}
.value-high{background:#2DCE89;color:#fff}
.value-neutral{background:#FFA500;color:#fff}
.value-low{background:#FF4D4F;color:#fff}
.modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#1a2538;padding:20px;border-radius:16px;z-index:1001;max-width:90%;width:350px;display:none;border:1px solid #4096FF}
.modal.active{display:block}
.modal-title{color:#FFD700;margin-bottom:10px;font-size:16px}
.modal-content{color:#ccc;font-size:14px;line-height:1.6}
.modal-close{position:absolute;top:10px;right:10px;color:#fff;background:none;border:none;font-size:18px;cursor:pointer}
/* ç”¨æˆ·ç³»ç»Ÿæ ·å¼ */
.user-section{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.user-info{display:flex;align-items:center;gap:8px}
.user-btn{padding:6px 12px;border-radius:16px;background:#165DFF;color:#fff;border:none;font-size:12px;cursor:pointer}
.community-predict{background:#131b2e;border-radius:10px;padding:10px;margin-top:10px}
.predict-item{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid #222e40;font-size:12px}
body.light{background:#f5f7fa;color:#1a1a1a}
body.light .container{background:#fff;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.05)}
body.light .header h1{color:#165DFF}
body.light .season{background:#e8f0fe;color:#165DFF}
body.light .season.active{background:#165DFF;color:#fff}
body.light .league-item{background:#e8f0fe;color:#165DFF}
body.light .league-item.active{background:#165DFF;color:#fff}
body.light .custom-input input{background:#f0f2f5;color:#1a1a1a}
body.light .match-select select{background:#f0f2f5;color:#1a1a1a}
body.light .data-card{background:#fff;border:1px solid #e8e8e8}
body.light .data-card .title{color:#666}
body.light .score-item,body.light .prob-item{background:#f5f7fa;color:#1a1a1a}
body.light .sim-box{background:#fff;border:1px solid #e8e8e8}
body.light .match-info,body.light .recent-box,body.light .vs-record{background:#f5f7fa;color:#1a1a1a}
body.light .accuracy-box,body.light .ai-confidence,body.light .league-note,body.light .home-away-stats .stat-item{background:#f5f7fa;color:#1a1a1a}
body.light .sim-stats .stat-item{background:#f5f7fa;color:#1a1a1a}
body.light .pro-detail{background:#f5f7fa;color:#1a1a1a}
body.light .real-data{background:#fff;border:1px solid #e8e8e8}
body.light .real-data .table-item{background:#f5f7fa}
body.light .schedule-box{background:#f5f7fa;color:#333}
body.light .slider-group{background:#f5f7fa}
body.light .news-ticker{background:#e8f0fe;color:#165DFF}
body.light .hot-match{background:#e8f0fe;color:#165DFF}
body.light .history-item{background:#e8f0fe;color:#165DFF}
body.light .modal{background:#fff;border:1px solid #165DFF}
body.light .modal-title{color:#165DFF}
body.light .modal-content{color:#333}
body.light .community-predict{background:#f5f7fa;color:#1a1a1a}
</style>
</head>
<body>
<div class="toast" id="toast"></div>
<div class="loading-modal" id="loadingModal"><div class="loading-spin"></div></div>
<div class="container">

<!-- ç”¨æˆ·ç™»å½•/æ³¨å†ŒåŒºåŸŸ -->
<div class="user-section">
  <div class="user-info" id="userInfo">
    <span id="userName">æœªç™»å½•</span>
  </div>
  <div>
    <button class="user-btn" onclick="showLoginModal()" id="loginBtn">ç™»å½•</button>
    <button class="user-btn" onclick="logout()" id="logoutBtn" style="display:none;">ç™»å‡º</button>
  </div>
</div>

<!-- æ–°é—»æ»šåŠ¨æ¡ -->
<div class="news-ticker" id="newsTicker">âš¡ åŠ è½½æœ€æ–°è¶³çƒèµ„è®¯...</div>
<!-- è½¬ä¼šä¼ é—»æ»šåŠ¨æ¡ -->
<div class="transfer-ticker" id="transferTicker">ğŸ“¢ è½¬ä¼šæµè¨€: çš‡é©¬æœ‰æ„å§†å·´ä½© Â· æ›¼è”è¿½å¥¥æ–¯æ¢…æ© Â· å·´è¨å…³æ³¨å“ˆå…°å¾·</div>

<!-- çƒ­é—¨æ¯”èµ›å¿«é€Ÿå…¥å£ -->
<div class="hot-matches" id="hotMatches"></div>

<div class="header">
<h1 id="siteTitle">âš½ è¶³çƒAIå¤§æ•°æ®é¢„æµ‹Â·ç»ˆææ——èˆ°ç‰ˆ</h1>
<div>
  <button id="themeToggle">ğŸŒ™ åˆ‡æ¢æµ…è‰²æ¨¡å¼</button>
  <button id="langToggle">ğŸŒ English</button>
</div>
<p id="headerSub">å…¨çƒè”èµ›Â·èµ”ç‡Â·xGÂ·å¤©æ°”Â·ä¼¤åœÂ·è£åˆ¤Â·æˆ˜æœ¯Â·ä»·å€¼Â·å¤ç›˜Â·VARÂ·è¯„åˆ†Â·MLÂ·ç¤¾åŒºÂ·æ•™ç»ƒÂ·åŠ¨æ€æ§çƒÂ·èµ›åæ–°é—»</p>
</div>

<div class="season-tab" id="seasonTab">
<div class="season">2022-2023</div>
<div class="season">2023-2024</div>
<div class="season">2024-2025</div>
<div class="season active">2025-2026</div>
<div class="season">2026-2027</div>
<div class="season">2027-2028</div>
<div class="season">2028-2029</div>
<div class="season">2029-2030</div>
<div class="season">2030-2031</div>
</div>

<div class="league-scroll" id="leagueList">
<!-- åŸæœ‰è”èµ› -->
<div class="league-item active">è‹±è¶…</div>
<div class="league-item">è¥¿ç”²</div>
<div class="league-item">å¾·ç”²</div>
<div class="league-item">æ„ç”²</div>
<div class="league-item">æ³•ç”²</div>
<div class="league-item">ä¸­è¶…</div>
<div class="league-item">æ¬§å† </div>
<div class="league-item">è‘¡è¶…</div>
<div class="league-item">è·ç”²</div>
<div class="league-item">è‹è¶…</div>
<div class="league-item">å·´ç”²</div>
<div class="league-item">é˜¿ç”²</div>
<div class="league-item">Jè”èµ›</div>
<div class="league-item">Kè”èµ›</div>
<!-- æ–°å¢è”èµ› -->
<div class="league-item">è‹±å† </div>
<div class="league-item">è‹±ç”²</div>
<div class="league-item">è¥¿ä¹™</div>
<div class="league-item">æ„ä¹™</div>
<div class="league-item">å¾·ä¹™</div>
<div class="league-item">æ³•ä¹™</div>
<div class="league-item">è‘¡ç”²</div>
<div class="league-item">è·ä¹™</div>
<div class="league-item">ä¿„è¶…</div>
<div class="league-item">åœŸè¶…</div>
<div class="league-item">ç¾èŒè”</div>
</div>

<div class="custom-input">
<input type="text" id="customHome" placeholder="æ‰‹å†™ä¸»é˜Ÿ">
<input type="text" id="customAway" placeholder="æ‰‹å†™å®¢é˜Ÿ">
</div>
<button class="use-custom" onclick="useCustomTeam()">âœ… ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</button>

<!-- æ¯”èµ›å€’è®¡æ—¶ -->
<div id="countdown" style="font-size:12px; color:#FFD700; text-align:center; margin:4px 0;"></div>

<div class="match-info" id="matchInfo">æœªé€‰æ‹©çƒé˜Ÿ</div>
<div class="league-note" id="leagueNote">è‹±è¶…ï¼šèŠ‚å¥å¿«ï¼Œå¤§çƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾</div>
<div class="ai-confidence" id="aiConfidence">AIä¿¡å¿ƒæŒ‡æ•°ï¼š--</div>

<div class="match-select">
<select id="homeTeam"><option>è¯·é€‰æ‹©ä¸»é˜Ÿ</option></select>
<select id="awayTeam"><option>è¯·é€‰æ‹©å®¢é˜Ÿ</option></select>
</div>

<!-- å®æ—¶ç§¯åˆ†æ¦œ & æœªæ¥3å¤©èµ›ç¨‹ï¼ˆå¸¦ç¼“å­˜ï¼‰ -->
<div class="real-data" id="realTimeData" style="display:none;">
  <div class="title" id="standingTitle">ğŸ“‹ å®æ—¶ç§¯åˆ†æ¦œ (å‰6)</div>
  <div class="table" id="standingTable"></div>
  <div class="title" style="margin-top:10px;" id="fixturesTitle">ğŸ“… æœªæ¥3å¤©èµ›ç¨‹</div>
  <div class="schedule-box" id="fixturesList"></div>
</div>

<div class="data-card">
<div class="title" id="powerTitle">ğŸ“Š å®åŠ›å¯¹æ¯”ï¼ˆçœŸå®æ•°æ®ï¼‰</div>
<div class="power-bar"><div class="bar" id="powerHome" style="width:50%"></div></div>
<div class="power-bar" style="margin-top:4px"><div class="bar" id="powerAway" style="width:50%;background:#FF4D4F"></div></div>
<div class="home-away-stats">
  <div class="stat-item" id="homeStat">ä¸»åœºèƒœç‡ï¼š--</div>
  <div class="stat-item" id="awayStat">å®¢åœºèƒœç‡ï¼š--</div>
</div>
</div>

<!-- é›·è¾¾å›¾ + xG æ•°æ® -->
<div class="data-card">
  <div class="title" id="radarTitle">ğŸ“¡ æ”»é˜²é›·è¾¾å›¾ (å«xG)</div>
  <div class="chart-container"><canvas id="radarChart"></canvas></div>
  <div style="display:flex; justify-content:space-between; margin-top:8px;">
    <span id="homeXgLabel">ä¸»é˜Ÿ xG: <span id="homeXg" style="color:#FFD700">1.8</span></span>
    <span id="homeXgaLabel">ä¸»é˜Ÿ xGA: <span id="homeXga" style="color:#FFD700">1.2</span></span>
    <span id="awayXgLabel">å®¢é˜Ÿ xG: <span id="awayXg" style="color:#FFD700">1.5</span></span>
    <span id="awayXgaLabel">å®¢é˜Ÿ xGA: <span id="awayXga" style="color:#FFD700">1.4</span></span>
  </div>
</div>

<!-- å¤šå¹³å°èµ”ç‡å¯¹æ¯” + æŠ•æ³¨çƒ­åº¦è¶‹åŠ¿å›¾ + ä»·å€¼åˆ†æ -->
<div class="data-card">
  <div class="title" id="oddsTitle">ğŸ’° å¤šå¹³å°èµ”ç‡å¯¹æ¯” & ä»·å€¼åˆ†æ</div>
  <div class="odds-table">
    <div></div><div id="oddsHomeTitle">ä¸»èƒœ</div><div id="oddsDrawTitle">å¹³å±€</div><div id="oddsAwayTitle">å®¢èƒœ</div>
    <div>å¨å»‰å¸Œå°”</div><div id="oddsWHH">2.10</div><div id="oddsWHD">3.40</div><div id="oddsWHA">3.20</div>
    <div>Bet365</div><div id="oddsB365H">2.15</div><div id="oddsB365D">3.35</div><div id="oddsB365A">3.10</div>
    <div>æ¾³é—¨</div><div id="oddsMACH">2.08</div><div id="oddsMACD">3.45</div><div id="oddsMACA">3.25</div>
  </div>
  <div style="font-size:11px; color:#ccc; margin-top:4px; text-align:center;" id="kellyText">å‡¯åˆ©æŒ‡æ•°: ä¸»èƒœ <span id="kellyHome">0.95</span> | å¹³å±€ <span id="kellyDraw">1.02</span> | å®¢èƒœ <span id="kellyAway">0.98</span></div>
  <div style="margin-top:6px; font-size:12px; display:flex; justify-content:space-between;">
    <span>ğŸ“Š å¸‚åœºçƒ­åº¦: ä¸»èƒœ <span id="betHome" style="color:#FFD700">68%</span></span>
    <span id="overheatWarning" style="color:#FF4D4F;"></span>
  </div>
  <!-- ä»·å€¼åˆ†æ -->
  <div style="margin-top:8px; display:flex; gap:6px; flex-wrap:wrap;" id="valueAnalysis">
    <span class="value-badge value-high" id="valueHome">ä¸»èƒœ ä»·å€¼+8%</span>
    <span class="value-badge value-neutral" id="valueDraw">å¹³å±€ ä»·å€¼-2%</span>
    <span class="value-badge value-low" id="valueAway">å®¢èƒœ ä»·å€¼-5%</span>
  </div>
  <!-- æŠ•æ³¨çƒ­åº¦è¶‹åŠ¿å›¾ -->
  <div style="margin-top:8px;">
    <div class="title" style="font-size:12px;">ğŸ“ˆ æŠ•æ³¨çƒ­åº¦è¶‹åŠ¿ (è¿‘24h)</div>
    <canvas id="betTrendChart" style="height:60px; width:100%;"></canvas>
  </div>
</div>

<!-- å¤©æ°” & ç¤¾äº¤çƒ­åº¦ & xGå½±å“ -->
<div class="data-card">
  <div class="title" id="weatherTitle">ğŸŒ¤ï¸ æ¯”èµ›æ—¥å¤©æ°” (å«xGè°ƒæ•´)</div>
  <div id="weatherInfo" style="display:flex; flex-wrap:wrap; gap:6px;">
    <span id="weatherCityLabel">åŸå¸‚: <span id="weatherCity">æ›¼å½»æ–¯ç‰¹</span></span>
    <span>ğŸŒ¡ï¸ <span id="weatherTemp">14Â°C</span></span>
    <span>ğŸ’§ <span id="weatherHumidity">72%</span></span>
    <span>ğŸ’¨ <span id="weatherWind">12km/h</span></span>
    <span>ğŸŒ§ï¸ <span id="weatherDesc">å°é›¨</span></span>
  </div>
  <div style="margin-top:6px; font-size:12px;" id="xgAdjustText">xGè°ƒæ•´: <span id="xgAdjust" style="color:#FFD700">-8% (é›¨å¤©)</span></div>
  <div class="title" style="margin-top:8px;" id="socialTitle">ğŸ¦ ç¤¾äº¤çƒ­åº¦</div>
  <div style="display:flex; justify-content:space-between;">
    <span id="socialHomeLabel">ä¸»é˜ŸæåŠ <span id="socialHome" style="color:#4096FF">65%</span></span>
    <span id="socialAwayLabel">å®¢é˜ŸæåŠ <span id="socialAway" style="color:#FF4D4F">35%</span></span>
  </div>
</div>

<!-- ä¼¤åœè¯¦ç»†åˆ—è¡¨ + é‡åŒ–å½±å“ -->
<div class="data-card">
  <div class="title" id="injuryTitle">ğŸ©º ä¼¤åœä¿¡æ¯ (å«xGå½±å“)</div>
  <div id="injuryDetail" style="font-size:12px; line-height:1.8;">
    <div>ğŸ¥ ä¸»é˜Ÿ: å“ˆå…°å¾·(ä¸»åŠ›å‰é”‹) å‡ºæˆ˜æˆç–‘ Â· å¾·å¸ƒåŠ³å†…(æ ¸å¿ƒä¸­åœº) ä¼¤ç¼º</div>
    <div>ğŸ¥ å®¢é˜Ÿ: å‡¯æ©(ä¸»åŠ›å‰é”‹) å·²æ¢å¤è®­ç»ƒ Â· å­™å…´æ…œ(è¾¹é”‹) çº¢ç‰Œåœèµ›</div>
  </div>
  <div style="margin-top:4px; font-size:11px; color:#aaa;" id="injuryImpact">ä¼¤åœå¯¼è‡´ä¸»é˜ŸxG -0.3, å®¢é˜ŸxG -0.2</div>
</div>

<!-- è£åˆ¤ä¿¡æ¯ -->
<div class="data-card">
  <div class="title" id="refereeTitle">ğŸ‘¨â€âš–ï¸ è£åˆ¤ä¿¡æ¯</div>
  <div id="refereeInfo" style="font-size:12px; display:flex; justify-content:space-between;">
    <span>ä¸»è£åˆ¤: <span id="refereeName">è¿ˆå…‹å°”Â·å¥¥åˆ©å¼—</span></span>
    <span>ğŸŸ¨ åœºå‡é»„ç‰Œ: <span id="refYellow">3.5</span></span>
    <span>ğŸŸ¥ åœºå‡çº¢ç‰Œ: <span id="refRed">0.2</span></span>
    <span>âš½ ç‚¹çƒå€¾å‘: <span id="refPen">0.15</span></span>
  </div>
  <div style="font-size:11px; color:#aaa;" id="refNote">æ‰§æ³•ä¸¥å‰ï¼Œå®šä½çƒåˆ¤ç½šä¸¥æ ¼</div>
</div>

<!-- æˆ˜æœ¯åˆ†æå¡ç‰‡ -->
<div class="data-card">
  <div class="title" id="tacticsTitle">ğŸ§  æˆ˜æœ¯åˆ†æ</div>
  <div id="tacticsText" style="font-size:12px; line-height:1.6;">
    ä¸»é˜Ÿæ“…é•¿é«˜ä½é€¼æŠ¢ï¼Œè¾¹è·¯è¿›æ”»å æ¯”65%ï¼›å®¢é˜Ÿå€¾å‘é˜²å®ˆåå‡»ï¼Œå®šä½çƒå¨èƒå¤§ã€‚
  </div>
</div>

<!-- æœºå™¨å­¦ä¹ èåˆæ¦‚ç‡ -->
<div class="data-card">
  <div class="title" id="mlTitle">ğŸ¤– æœºå™¨å­¦ä¹ èåˆæ¦‚ç‡ (æ³Šæ¾+ XGBoost + å†å²åˆ†å¸ƒ)</div>
  <div style="display:flex; justify-content:space-around;">
    <div id="mlWinLabel">ä¸»èƒœ <span id="mlWin" style="color:#FFD700">54%</span></div>
    <div id="mlDrawLabel">å¹³å±€ <span id="mlDraw" style="color:#FFD700">26%</span></div>
    <div id="mlLoseLabel">å®¢èƒœ <span id="mlLose" style="color:#FFD700">20%</span></div>
  </div>
  <div style="font-size:11px; text-align:center;" id="mlWeightText">èåˆæƒé‡: æ³Šæ¾0.6 / æœºå™¨å­¦ä¹ 0.2 / å†å²åˆ†å¸ƒ0.2</div>
</div>

<!-- å¯è°ƒæ¨¡å‹å‚æ•° -->
<div class="data-card slider-group">
  <div class="title" id="paramTitle">âš™ï¸ æ¨¡å‹å‚æ•°è°ƒèŠ‚</div>
  <div class="slider-item">
    <span id="homeWeightLabel">ä¸»åœºä¼˜åŠ¿æƒé‡</span>
    <input type="range" id="homeWeight" min="0.5" max="1.5" step="0.1" value="1.0">
    <span id="homeWeightVal">1.0</span>
  </div>
  <div class="slider-item">
    <span id="formWeightLabel">è¿‘æœŸçŠ¶æ€æƒé‡</span>
    <input type="range" id="formWeight" min="0.5" max="1.5" step="0.1" value="1.0">
    <span id="formWeightVal">1.0</span>
  </div>
  <div class="slider-item">
    <span id="h2hWeightLabel">å†å²äº¤é”‹æƒé‡</span>
    <input type="range" id="h2hWeight" min="0.5" max="1.5" step="0.1" value="1.0">
    <span id="h2hWeightVal">1.0</span>
  </div>
  <button class="btn btn-blue" style="padding:8px; margin-top:8px;" onclick="applyModelParams()" id="applyParamBtn">åº”ç”¨å‚æ•°é‡æ–°é¢„æµ‹</button>
</div>

<!-- è‡ªå®šä¹‰é˜µå®¹æŒ‰é’® + åˆ†äº«æŒ‰é’® -->
<div class="data-card" style="text-align:center;">
  <button class="btn btn-green" style="width:48%;" onclick="showLineupEditor()" id="editLineupBtn">ğŸ‘¥ ç¼–è¾‘é¦–å‘</button>
  <button class="btn btn-orange" style="width:48%;" onclick="sharePrediction()" id="shareBtn">ğŸ“¤ åˆ†äº«é¢„æµ‹</button>
  <div id="lineupEditor" style="display:none; margin-top:10px; background:#151d30; padding:10px; border-radius:10px;">
    <div style="display:flex; justify-content:space-between;">
      <div><span style="color:#4096FF" id="homeLineupLabel">ä¸»é˜Ÿ</span><br><span id="homePlayersList">å“ˆå…°å¾· ç¦ç™» å¾·å¸ƒåŠ³å†…</span></div>
      <div><span style="color:#FF4D4F" id="awayLineupLabel">å®¢é˜Ÿ</span><br><span id="awayPlayersList">å‡¯æ© å­™å…´æ…œ éº¦è¿ªé€Š</span></div>
    </div>
    <p style="font-size:10px; margin-top:6px;" id="lineupNote">ç‚¹å‡»çƒå‘˜å¯æ¨¡æ‹Ÿç§»é™¤(ä»…æ¼”ç¤º)</p>
  </div>
</div>

<!-- AIæ¯”åˆ†é¢„æµ‹åŒºåŸŸ + æ¯”èµ›é¢„æµ‹æ—¶é—´è½´ -->
<div class="data-card" id="predictionCard">
<div class="title" id="scoreTitle">ğŸ¯ AIç²¾å‡†æ¯”åˆ†ï¼ˆæ³Šæ¾+ML+å†å²åˆ†å¸ƒï¼‰</div>
<div class="ai-score" id="aiScore">â€” : â€”</div>
<div class="score-group">
<div class="score-item"><div class="num" id="s1">â€”</div><div class="tag" id="prob1">--</div></div>
<div class="score-item"><div class="num" id="s2">â€”</div><div class="tag" id="prob2">--</div></div>
<div class="score-item"><div class="num" id="s3">â€”</div><div class="tag" id="prob3">--</div></div>
</div>
<!-- æ¯”èµ›é¢„æµ‹æ—¶é—´è½´ -->
<div class="pro-detail" style="margin-top:8px;">
  <div class="item"><span class="label">â±ï¸ è¿›çƒé¢„æµ‹æ—¶é—´è½´ï¼š</span><span class="value" id="timeAxis"></span></div>
</div>
<div class="pro-detail" id="scoreReasons">
  <div class="item"><span class="label" id="reason1Label">é¦–é€‰ç†ç”±ï¼š</span><span class="value" id="reason1"></span></div>
  <div class="item"><span class="label" id="reason2Label">æ¬¡é€‰ç†ç”±ï¼š</span><span class="value" id="reason2"></span></div>
  <div class="item"><span class="label" id="reason3Label">åšå†·ç†ç”±ï¼š</span><span class="value" id="reason3"></span></div>
</div>
<!-- å¤§å°çƒæ¦‚ç‡ç»†åŒ– -->
<div style="display:flex; justify-content:space-between; margin-top:8px; font-size:12px; background:#131b2e; padding:8px; border-radius:8px;">
  <span id="overLabel">âš½ å¤§2.5 <span id="overProb" style="color:#FFD700">--%</span></span>
  <span id="equalLabel">âš–ï¸ ç­‰äº2.5 <span id="equalProb" style="color:#FFD700">--%</span></span>
  <span id="underLabel">ğŸ¥… å°2.5 <span id="underProb" style="color:#FFD700">--%</span></span>
</div>
</div>

<div class="data-card">
<div class="title" id="winDrawLoseTitle">ğŸ“ˆ èƒœå¹³è´Ÿæ¦‚ç‡</div>
<div class="prob-group">
<div class="prob-item"><div class="num" id="win">â€”%</div><div class="text" id="winText">ä¸»èƒœ</div></div>
<div class="prob-item"><div class="num" id="draw">â€”%</div><div class="text" id="drawText">å¹³å±€</div></div>
<div class="prob-item"><div class="num" id="lose">â€”%</div><div class="text" id="loseText">å®¢èƒœ</div></div>
</div>
</div>

<div class="data-card">
<div class="title" id="halfTitle">ğŸ§§ åŠå…¨åœº / äºšç›˜ / å¤§å°çƒ (å«æ¦‚ç‡)</div>
<div class="prob-group">
<div class="prob-item"><div class="num" id="half">â€”</div><div class="tag" id="halfTag">åŠå…¨åœº</div></div>
<div class="prob-item"><div class="num" id="handicap">â€”</div><div class="tag" id="handicapTag">äºšç›˜</div></div>
<div class="prob-item"><div class="num" id="total">â€”</div><div class="tag" id="totalTag">å¤§å°çƒ</div></div>
</div>
<div style="display:flex; justify-content:space-between; margin:6px 0; font-size:11px; color:#aaa;">
  <span id="handicapHomeLabel">ä¸»é˜Ÿæ°´ä½ <span id="handicapHomeOdds">0.85</span></span>
  <span id="handicapAwayLabel">å®¢é˜Ÿæ°´ä½ <span id="handicapAwayOdds">0.95</span></span>
</div>
<!-- åŠå…¨åœºæ¦‚ç‡ç»†åŒ– -->
<div class="recent-box" style="margin-top:8px;">
  <div style="display:flex; justify-content:space-around;">
    <span>èƒœèƒœ <span id="ht_ww">--%</span></span>
    <span>å¹³èƒœ <span id="ht_hw">--%</span></span>
    <span>è´Ÿèƒœ <span id="ht_aw">--%</span></span>
  </div>
  <div style="display:flex; justify-content:space-around; margin-top:4px;">
    <span>èƒœå¹³ <span id="ht_wd">--%</span></span>
    <span>å¹³å¹³ <span id="ht_hd">--%</span></span>
    <span>è´Ÿå¹³ <span id="ht_ad">--%</span></span>
  </div>
  <div style="display:flex; justify-content:space-around; margin-top:4px;">
    <span>èƒœè´Ÿ <span id="ht_wl">--%</span></span>
    <span>å¹³è´Ÿ <span id="ht_hl">--%</span></span>
    <span>è´Ÿè´Ÿ <span id="ht_al">--%</span></span>
  </div>
</div>
<div class="recent-box" id="recent">çŠ¶æ€</div>

<!-- ä¸»é˜Ÿè¿‘æœŸæˆ˜ç»©è¯¦ç»† + æœªæ¥èµ›ç¨‹ -->
<div class="title" style="margin-top:12px;font-size:14px;color:#aab" id="homeRecentTitle">ğŸ“Š ä¸»é˜Ÿè¿‘æœŸæˆ˜ç»© (è¿‘5åœº)</div>
<div class="schedule-box" id="homeRecentDetails" style="max-height:120px;"></div>
<div class="record" id="homeRecord"></div>
<div class="injury-info" id="homeInjury" style="display:none;">âœ… é˜µå®¹å®Œæ•´</div>
<!-- ä¸»é˜Ÿæœªæ¥èµ›ç¨‹ -->
<div class="title" style="margin-top:6px;font-size:12px;color:#aab" id="homeFutureTitle">ğŸ“… ä¸»é˜Ÿæœªæ¥3åœº</div>
<div class="schedule-box" id="homeFuture" style="max-height:80px;"></div>

<div class="title" style="margin-top:8px;font-size:14px;color:#aab" id="awayRecentTitle">ğŸ“Š å®¢é˜Ÿè¿‘æœŸæˆ˜ç»©</div>
<div class="schedule-box" id="awayRecentDetails" style="max-height:120px;"></div>
<div class="record" id="awayRecord"></div>
<div class="injury-info" id="awayInjury" style="display:none;">âœ… é˜µå®¹å®Œæ•´</div>
<!-- å®¢é˜Ÿæœªæ¥èµ›ç¨‹ -->
<div class="title" style="margin-top:6px;font-size:12px;color:#aab" id="awayFutureTitle">ğŸ“… å®¢é˜Ÿæœªæ¥3åœº</div>
<div class="schedule-box" id="awayFuture" style="max-height:80px;"></div>

<!-- å†å²äº¤é”‹ + è¿›çƒåˆ†å¸ƒå›¾ -->
<div class="title" style="margin-top:12px;font-size:14px;color:#aab" id="h2hTitle">ğŸ¤ å†å²äº¤é”‹ (è¿‘5æ¬¡)</div>
<div class="schedule-box" id="h2hDetail" style="display:block; max-height:120px;"></div>
<div class="vs-record" id="vsRecord"></div>
<!-- è¿›çƒåˆ†å¸ƒæŸ±çŠ¶å›¾ -->
<div class="data-card" style="margin-top:8px;">
  <div class="title" id="h2hChartTitle">ğŸ“Š äº¤é”‹è¿›çƒåˆ†å¸ƒ</div>
  <canvas id="h2hChart" style="height:150px; width:100%;"></canvas>
</div>

<!-- å‡†ç¡®ç‡è¶‹åŠ¿å›¾ -->
<div class="data-card">
  <div class="title" id="trendTitle">ğŸ“ˆ è¿‘10åœºé¢„æµ‹å‡†ç¡®ç‡è¶‹åŠ¿</div>
  <canvas id="trendChart" style="height:150px; width:100%;"></canvas>
</div>

<!-- é¦–å‘é˜µå®¹æ¨¡æ‹Ÿ + å…³é”®çƒå‘˜çŠ¶æ€ -->
<div class="title" style="margin-top:12px;font-size:14px;color:#aab" id="lineupTitle">ğŸ‘¥ é¢„è®¡é¦–å‘ & å…³é”®çƒå‘˜çŠ¶æ€</div>
<div class="lineup-box" id="lineupBox">
  <div class="home-lineup" id="homeLineup"><span class="team-badge" id="homeBadge" style="background:#4096FF;">M</span>4-3-3<br>å“ˆå…°å¾·Â·ç¦ç™»Â·Bå¸­</div>
  <div class="away-lineup" id="awayLineup"><span class="team-badge" id="awayBadge" style="background:#FF4D4F;">T</span>4-4-2<br>å‡¯æ©Â·å­™å…´æ…œ</div>
</div>
<div style="display:flex; justify-content:space-between; font-size:11px; margin-top:4px;">
  <div>ğŸ”¥ å“ˆå…°å¾· è¿‘3åœº5çƒ</div>
  <div>âš¡ å‡¯æ© è¿‘3åœº2çƒ1åŠ©</div>
</div>

<!-- å›æµ‹é¢æ¿ (å¸¦å¤ç›˜åŠŸèƒ½) -->
<div class="data-card">
  <div class="title" id="backtestTitle">ğŸ“Š å†å²å›æµ‹ (è¿‘5åœºé¢„æµ‹å‡†ç¡®ç‡) <span style="font-size:11px; color:#aab;">ç‚¹å‡»æ¯”èµ›å¯å¤ç›˜</span></div>
  <div style="display:flex; justify-content:space-around; font-size:20px;">
    <div><span id="backtestAcc" style="color:#FFD700">78%</span> <span style="font-size:12px;" id="accLabel">å‡†ç¡®ç‡</span></div>
    <div><span id="backtestCorrect" style="color:#2DCE89">4/5</span> <span style="font-size:12px;" id="correctLabel">æ­£ç¡®</span></div>
  </div>
  <div class="schedule-box" id="backtestList" style="max-height:100px;">
    <div class="schedule-item" onclick="showReview('åˆ‡å°”è¥¿', '2-1', '2-1')">vs åˆ‡å°”è¥¿ é¢„æµ‹2-1 å®é™…2-1 âœ… <span style="color:#4096FF;">å¤ç›˜</span></div>
    <div class="schedule-item" onclick="showReview('åˆ©ç‰©æµ¦', '1-1', '0-1')">vs åˆ©ç‰©æµ¦ é¢„æµ‹1-1 å®é™…0-1 âŒ <span style="color:#4096FF;">å¤ç›˜</span></div>
    <div class="schedule-item" onclick="showReview('æ›¼è”', '2-0', '2-0')">vs æ›¼è” é¢„æµ‹2-0 å®é™…2-0 âœ… <span style="color:#4096FF;">å¤ç›˜</span></div>
  </div>
</div>

<!-- çƒå‘˜è¯„åˆ†ï¼ˆæ¨¡æ‹Ÿæ¯”èµ›åæ˜¾ç¤ºï¼‰ -->
<div class="data-card" id="ratingCard" style="display:none;">
  <div class="title" id="ratingTitle">â­ èµ›åçƒå‘˜è¯„åˆ†</div>
  <div class="rating-box" id="ratingContent"></div>
</div>

<!-- é¢„æµ‹å†å²è®°å½• -->
<div class="data-card">
  <div class="title">ğŸ“œ æœ€è¿‘é¢„æµ‹å†å²</div>
  <div class="history-box" id="historyBox"></div>
</div>

<!-- ç¤¾åŒºé¢„æµ‹åŒºåŸŸ -->
<div class="community-predict">
  <div class="title">ğŸ‘¥ ç¤¾åŒºé¢„æµ‹</div>
  <div id="communityList" style="max-height:150px; overflow-y:auto; margin-top:8px;"></div>
  <button class="btn btn-blue" style="width:100%; margin-top:8px;" onclick="publishPrediction()">ğŸ“¢ å‘å¸ƒæˆ‘çš„é¢„æµ‹</button>
</div>

<div class="hot-box">
<div id="hotHomeLabel">ä¸»é˜Ÿçƒ­åº¦ï¼š<span id="hotHome" style="color:#165DFF">â€”%</span></div>
<div id="hotAwayLabel">å®¢é˜Ÿçƒ­åº¦ï¼š<span id="hotAway" style="color:#FF4D4F">â€”%</span></div>
</div>

<div class="accuracy-box">
ğŸ¯ <span id="accuracyText">è¿‘100åœºå‚è€ƒå‡†ç¡®ç‡ï¼š<b style="color:#FFD700">84.7%</b> (èåˆæ¨¡å‹)</span><br>
<span id="dataSource">æ•°æ®æºï¼šfootball-data.org + å†å²åˆ†å¸ƒ + æ¨¡æ‹Ÿå¢å¼º</span>
</div>

</div>

<div class="btn-group">
<button class="btn btn-blue" onclick="startAI()" id="aiBtn">ğŸš€ AIæ·±åº¦é¢„æµ‹ (å«å†å²åˆ†å¸ƒèåˆ)</button>
<button class="btn btn-green" onclick="startSim()" id="simBtn">ğŸ® å¼€å§‹æ¨¡æ‹Ÿæ¯”èµ› (1:1çœŸå®äº‹ä»¶)</button>
</div>

<div class="sim-box">
<div class="sim-time" id="simTime">00:00</div>
<div class="sim-score" id="simScore">0 - 0</div>
<div class="sim-event" id="simEvent">ç­‰å¾…å¼€å§‹â€¦</div>
<div class="sim-stats" id="simStats">
  <div class="stat-item">æ§çƒç‡<br><span id="ballHome">50%</span> - <span id="ballAway">50%</span></div>
  <div class="stat-item">å°„é—¨<br><span id="shotHome">0</span> - <span id="shotAway">0</span></div>
  <div class="stat-item">è§’çƒ<br><span id="cornerHome">0</span> - <span id="cornerAway">0</span></div>
</div>
<!-- è¯¦ç»†ç»Ÿè®¡ -->
<div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-top:8px; font-size:10px; color:#aaa;">
  <div>ğŸ“Š ä¼ çƒæˆåŠŸç‡ <span id="passHome">85%</span> - <span id="passAway">82%</span></div>
  <div>ğŸƒ è·‘åŠ¨è·ç¦»(km) <span id="distHome">105</span> - <span id="distAway">103</span></div>
</div>
<div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:6px; margin-top:8px; font-size:10px; color:#aaa;">
  <div>ğŸŸ¥ çº¢ç‰Œ <span id="redHome">0</span>-<span id="redAway">0</span></div>
  <div>ğŸš© è¶Šä½ <span id="offsideHome">0</span>-<span id="offsideAway">0</span></div>
  <div>ğŸ§¤ æ‰‘æ•‘ <span id="saveHome">0</span>-<span id="saveAway">0</span></div>
  <div>ğŸ…°ï¸ åŠ©æ”» <span id="assistHome">0</span>-<span id="assistAway">0</span></div>
</div>
<div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-top:6px; font-size:10px; color:#aaa;">
  <div>ğŸš€ ä¸­æŸ± <span id="woodHome">0</span>-<span id="woodAway">0</span></div>
  <div>ğŸ”„ æ¢äºº <span id="subHome">0</span>-<span id="subAway">0</span></div>
</div>
<!-- çƒå‘˜ä¸ªäººç»Ÿè®¡ -->
<div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-top:6px; font-size:10px; color:#FFD700;">
  <div>â­ å“ˆå…°å¾·: å°„é—¨3 ä¼ çƒ12 æŠ¢æ–­1</div>
  <div>â­ å‡¯æ©: å°„é—¨2 ä¼ çƒ8 æŠ¢æ–­0</div>
</div>
<!-- å®æ—¶è¿›çƒè¯¦æƒ… -->
<div id="liveGoals" style="font-size:10px; color:#aaa; margin-top:6px;"></div>
</div>

<!-- å¤ç›˜å¼¹çª— -->
<div class="modal" id="reviewModal">
  <button class="modal-close" onclick="document.getElementById('reviewModal').classList.remove('active')">âœ–</button>
  <div class="modal-title" id="reviewTitle">æ¯”èµ›å¤ç›˜</div>
  <div class="modal-content" id="reviewContent"></div>
</div>

<!-- ç™»å½•/æ³¨å†Œå¼¹çª— -->
<div class="modal" id="loginModal">
  <button class="modal-close" onclick="document.getElementById('loginModal').classList.remove('active')">âœ–</button>
  <div class="modal-title">ç™»å½•/æ³¨å†Œ</div>
  <div class="modal-content">
    <input type="text" id="loginUsername" placeholder="ç”¨æˆ·å" style="width:100%; padding:8px; margin-bottom:8px; background:#151d30; border:none; border-radius:6px; color:#fff;">
    <input type="password" id="loginPassword" placeholder="å¯†ç " style="width:100%; padding:8px; margin-bottom:8px; background:#151d30; border:none; border-radius:6px; color:#fff;">
    <button class="btn btn-blue" style="width:100%;" onclick="login()">ç™»å½•</button>
    <button class="btn btn-green" style="width:100%; margin-top:8px;" onclick="register()">æ³¨å†Œ</button>
  </div>
</div>

<div style="font-size:11px;color:#999;text-align:center;line-height:1.5;padding:18px 10px;" id="footerText">
æ¸©é¦¨æç¤ºï¼šæœ¬ç½‘ç«™ä»…æä¾›è¶³çƒæ•°æ®ç®—æ³•åˆ†æã€èµ›äº‹èµ„è®¯ä¸å¨±ä¹å‚è€ƒæœåŠ¡ã€‚<br>
<strong>ä¸æ¶‰åŠä»»ä½•æŠ•æ³¨ã€ä¸æä¾›èµŒåšç›¸å…³å†…å®¹ã€ä¸è¯±å¯¼ä»»ä½•å½¢å¼çš„æ¶ˆè´¹è¡Œä¸º</strong>ã€‚<br>
æ‰€æœ‰å†…å®¹ä»…ä¾›è¶³çƒçˆ±å¥½è€…äº¤æµä½¿ç”¨ï¼Œä¸¥ç¦ç”¨äºä»»ä½•è¿è§„ç”¨é€”ã€‚
</div>

<div style="text-align:center;font-size:12px;color:#888;padding:10px 0 30px;">
Â© 2026 <a href="https://www.football-predict.top/" style="color:#888;text-decoration:none;">football-predict.top</a> ç‰ˆæƒæ‰€æœ‰<br>
<span id="footerApi">æ•°æ®æ¥å£ï¼šfootball-data.org + å†å²åˆ†å¸ƒ + æ¨¡æ‹Ÿå¢å¼º</span>
</div>

</div>

<script>
// ==================== å…¨å±€å˜é‡ ====================
const DOMAIN = "football-predict.top";
let season = "2025-2026";
let league = "è‹±è¶…";
let simTimer;
let liveScoreTimer;
let customHome = "";
let customAway = "";
let isCustom = false;
let globalMlFactor = 0; // ç”¨äºæ¨¡æ‹Ÿæ¯”èµ›çš„æœºå™¨å­¦ä¹ å› å­
let currentUser = null; // å½“å‰ç™»å½•ç”¨æˆ·
let histDist = {}; // å†å²æ¯”åˆ†åˆ†å¸ƒï¼ˆæŒ‰å®åŠ›å·®æ¡£ä½ï¼‰

// åŸæœ‰API_KEYå®Œå…¨ä¿ç•™
const API_KEY = "15aff59763f342bba8dd7da8782d467a";
const COMP_MAP = {
  è‹±è¶…:"PL",è¥¿ç”²:"PD",å¾·ç”²:"BL1",æ„ç”²:"SA",æ³•ç”²:"FL1",
  ä¸­è¶…:"CSL",æ¬§å† :"CL",è‘¡è¶…:"PPL",è·ç”²:"ERED",è‹è¶…:"SPL",
  å·´ç”²:"BSA",é˜¿ç”²:"ASL",Jè”èµ›:"JJL",Kè”èµ›:"KOR",
  ç¾èŒè”:"MLS",ä¿„è¶…:"RPL",åœŸè¶…:"TSL",æ¯”ç”²:"BPL",
  è‹±å† :"ELC",è‹±ç”²:"EL1",è¥¿ä¹™:"SD",æ„ä¹™:"SE",å¾·ä¹™:"BL2",æ³•ä¹™:"FL2",è‘¡ç”²:"P2",è·ä¹™:"EED"
};

// è”èµ›å±æ€§ï¼ˆå«è¿›çƒæ—¶é—´åˆ†å¸ƒï¼Œæ¯èµ›æ ‡è¯†ï¼‰
const leagueAttr = {
  è‹±è¶…: {goalRate:1.18, drawRate:0.88, homeAdv:12, homeWinRate:45, avgGoal:2.72, note:"è‹±è¶…ï¼šèŠ‚å¥å¿«ï¼Œå¤§çƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.72ä¸ª", goalTimeDist: [0.8,1.2,1.5,1.3,1.4,1.8], isCup: false},
  è¥¿ç”²: {goalRate:0.98, drawRate:1.12, homeAdv:10, homeWinRate:42, avgGoal:2.51, note:"è¥¿ç”²ï¼šæŠ€æœ¯æµï¼Œå¹³å±€åå¤šï¼Œå°çƒå±…å¤šï¼Œåœºå‡è¿›çƒ2.51ä¸ª", goalTimeDist: [0.7,1.1,1.3,1.2,1.3,1.6], isCup: false},
  å¾·ç”²: {goalRate:1.28, drawRate:0.82, homeAdv:18, homeWinRate:48, avgGoal:3.02, note:"å¾·ç”²ï¼šå¤§çƒå¤šï¼Œä¸»åœºå¼ºåŠ¿ï¼Œäº”å¤§è”èµ›è¿›çƒç‡æœ€é«˜ï¼Œåœºå‡è¿›çƒ3.02ä¸ª", goalTimeDist: [0.9,1.3,1.6,1.4,1.5,2.0], isCup: false},
  æ„ç”²: {goalRate:0.82, drawRate:1.30, homeAdv:15, homeWinRate:43, avgGoal:2.45, note:"æ„ç”²ï¼šé˜²å®ˆå¼ºï¼Œå°çƒå¤šï¼Œå¹³å±€æ¦‚ç‡æœ€é«˜ï¼Œåœºå‡è¿›çƒ2.45ä¸ª", goalTimeDist: [0.6,1.0,1.2,1.1,1.2,1.4], isCup: false},
  æ³•ç”²: {goalRate:1.02, drawRate:1.05, homeAdv:8,  homeWinRate:40, avgGoal:2.58, note:"æ³•ç”²ï¼šå†·é—¨å¤šï¼Œå¼ºå¼±å·®è·ç›¸å¯¹è¾ƒå°ï¼Œåœºå‡è¿›çƒ2.58ä¸ª", goalTimeDist: [0.7,1.1,1.3,1.2,1.3,1.5], isCup: false},
  ä¸­è¶…: {goalRate:0.92, drawRate:1.18, homeAdv:10, homeWinRate:41, avgGoal:2.36, note:"ä¸­è¶…ï¼šèŠ‚å¥æ…¢ï¼Œè¿›çƒä¸ç¨³å®šï¼Œåœºå‡è¿›çƒ2.36ä¸ª", goalTimeDist: [0.6,1.0,1.2,1.1,1.1,1.3], isCup: false},
  æ¬§å† : {goalRate:0.98, drawRate:1.10, homeAdv:10, homeWinRate:44, avgGoal:2.68, note:"æ¬§å† ï¼šæ¬§æ´²é¡¶çº§èµ›äº‹ï¼Œæ”»é˜²å‡è¡¡ï¼Œåœºå‡è¿›çƒ2.68ä¸ª", goalTimeDist: [0.8,1.2,1.4,1.3,1.4,1.7], isCup: true},
  è‘¡è¶…: {goalRate:1.08, drawRate:1.00, homeAdv:12, homeWinRate:43, avgGoal:2.49, note:"è‘¡è¶…ï¼šæ”»é˜²èŠ‚å¥å¿«ï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.49ä¸ª", goalTimeDist: [0.7,1.2,1.4,1.3,1.3,1.6], isCup: false},
  è·ç”²: {goalRate:1.15, drawRate:0.90, homeAdv:15, homeWinRate:46, avgGoal:3.12, note:"è·ç”²ï¼šé’è®­ä¸ºä¸»ï¼Œå¤§çƒéå¸¸å¤šï¼Œåœºå‡è¿›çƒ3.12ä¸ª", goalTimeDist: [0.9,1.3,1.6,1.5,1.6,2.0], isCup: false},
  è‹è¶…: {goalRate:1.00, drawRate:1.00, homeAdv:14, homeWinRate:44, avgGoal:2.62, note:"è‹è¶…ï¼šä¸¤æåˆ†åŒ–æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.62ä¸ª", goalTimeDist: [0.8,1.2,1.4,1.3,1.4,1.7], isCup: false},
  å·´ç”²: {goalRate:1.08, drawRate:1.02, homeAdv:9,  homeWinRate:42, avgGoal:2.41, note:"å·´ç”²ï¼šæŠ€æœ¯æµï¼Œå¹³å±€é€‚ä¸­ï¼Œåœºå‡è¿›çƒ2.41ä¸ª", goalTimeDist: [0.7,1.1,1.3,1.2,1.2,1.4], isCup: false},
  é˜¿ç”²: {goalRate:1.00, drawRate:1.05, homeAdv:11, homeWinRate:41, avgGoal:2.28, note:"é˜¿ç”²ï¼šèŠ‚å¥åæ…¢ï¼Œå°çƒå¤šï¼Œåœºå‡è¿›çƒ2.28ä¸ª", goalTimeDist: [0.6,1.0,1.2,1.1,1.1,1.3], isCup: false},
  Jè”èµ›:{goalRate:0.96, drawRate:1.08, homeAdv:8,  homeWinRate:40, avgGoal:2.35, note:"Jè”èµ›ï¼šé˜²å®ˆæ‰å®ï¼Œå°çƒå¤šï¼Œåœºå‡è¿›çƒ2.35ä¸ª", goalTimeDist: [0.6,1.0,1.2,1.1,1.1,1.3], isCup: false},
  Kè”èµ›:{goalRate:0.92, drawRate:1.12, homeAdv:7,  homeWinRate:39, avgGoal:2.29, note:"Kè”èµ›ï¼šå¹³å±€å¤šï¼Œå†·é—¨å¤šï¼Œåœºå‡è¿›çƒ2.29ä¸ª", goalTimeDist: [0.6,1.0,1.2,1.1,1.1,1.2], isCup: false},
  ç¾èŒè”:{goalRate:1.25, drawRate:0.75, homeAdv:14, homeWinRate:52, avgGoal:3.10, note:"ç¾èŒè”ï¼šå¤§çƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æå¼ºï¼Œåœºå‡è¿›çƒ3.10ä¸ª", goalTimeDist: [0.9,1.3,1.6,1.5,1.6,2.0], isCup: false},
  ä¿„è¶…:{goalRate:0.88, drawRate:1.25, homeAdv:12, homeWinRate:41, avgGoal:2.38, note:"ä¿„è¶…ï¼šå°çƒåå¤šï¼Œå¹³å±€å¤šï¼Œåœºå‡è¿›çƒ2.38ä¸ª", goalTimeDist: [0.6,1.0,1.2,1.1,1.1,1.3], isCup: false},
  åœŸè¶…:{goalRate:1.10, drawRate:0.95, homeAdv:16, homeWinRate:48, avgGoal:2.80, note:"åœŸè¶…ï¼šä¸»åœºä¼˜åŠ¿å¤§ï¼Œè¿›çƒè¾ƒå¤šï¼Œåœºå‡è¿›çƒ2.80ä¸ª", goalTimeDist: [0.8,1.2,1.5,1.4,1.5,1.8], isCup: false},
  æ¯”ç”²:{goalRate:1.05, drawRate:1.02, homeAdv:13, homeWinRate:44, avgGoal:2.65, note:"æ¯”ç”²ï¼šæ”»é˜²å‡è¡¡ï¼Œåœºå‡è¿›çƒ2.65ä¸ª", goalTimeDist: [0.7,1.2,1.4,1.3,1.4,1.6], isCup: false},
  è‹±å† :{goalRate:1.02, drawRate:0.98, homeAdv:10, homeWinRate:42, avgGoal:2.45, note:"è‹±å† ï¼šç«äº‰æ¿€çƒˆï¼Œè¿›çƒé€‚ä¸­", goalTimeDist: [0.7,1.1,1.4,1.3,1.4,1.6], isCup: false},
  è‹±ç”²:{goalRate:0.95, drawRate:1.05, homeAdv:9, homeWinRate:40, avgGoal:2.30, note:"è‹±ç”²ï¼šèŠ‚å¥è¾ƒæ…¢ï¼Œå¹³å±€åå¤š", goalTimeDist: [0.6,1.0,1.3,1.2,1.3,1.5], isCup: false},
  è¥¿ä¹™:{goalRate:0.90, drawRate:1.10, homeAdv:8, homeWinRate:38, avgGoal:2.20, note:"è¥¿ä¹™ï¼šæŠ€æœ¯å‹ï¼Œè¿›çƒå°‘", goalTimeDist: [0.5,0.9,1.2,1.1,1.1,1.3], isCup: false},
  æ„ä¹™:{goalRate:0.88, drawRate:1.12, homeAdv:8, homeWinRate:37, avgGoal:2.15, note:"æ„ä¹™ï¼šé˜²å®ˆä¸ºä¸»ï¼Œå°çƒå¤š", goalTimeDist: [0.5,0.9,1.2,1.1,1.1,1.3], isCup: false},
  å¾·ä¹™:{goalRate:1.05, drawRate:0.95, homeAdv:12, homeWinRate:44, avgGoal:2.60, note:"å¾·ä¹™ï¼šè¿›çƒè¾ƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾", goalTimeDist: [0.8,1.2,1.5,1.4,1.5,1.8], isCup: false},
  æ³•ä¹™:{goalRate:0.92, drawRate:1.08, homeAdv:8, homeWinRate:39, avgGoal:2.25, note:"æ³•ä¹™ï¼šå¹³å±€å¤šï¼Œå°çƒå¤š", goalTimeDist: [0.6,1.0,1.2,1.1,1.1,1.3], isCup: false},
  è‘¡ç”²:{goalRate:1.00, drawRate:1.02, homeAdv:9, homeWinRate:40, avgGoal:2.40, note:"è‘¡ç”²ï¼šæ”»é˜²å‡è¡¡", goalTimeDist: [0.7,1.1,1.3,1.2,1.3,1.5], isCup: false},
  è·ä¹™:{goalRate:1.12, drawRate:0.88, homeAdv:14, homeWinRate:46, avgGoal:3.00, note:"è·ä¹™ï¼šå¤§çƒé¢‘å‡ºï¼Œä¸»åœºå¼ºåŠ¿", goalTimeDist: [0.9,1.3,1.6,1.5,1.6,2.0], isCup: false}
};

// çƒé˜Ÿæ•°æ®ï¼ˆåŒ…å«æ•™ç»ƒå±æ€§ï¼‰
const teamData = {
  æ›¼åŸ:{power:96,attack:94,defend:91,style:2,home:1.12,away:0.94,homeWin:78,awayWin:65,recentForm:3, players:["å“ˆå…°å¾·","ç¦ç™»","å¾·å¸ƒåŠ³å†…","Bå¸­","ç½—å¾·é‡Œ"], city:"æ›¼å½»æ–¯ç‰¹", topScorer:"å“ˆå…°å¾·(22çƒ)", topAssist:"å¾·å¸ƒåŠ³å†…(12æ¬¡)", xG:2.1, xGA:0.9, injuries:["å“ˆå…°å¾·(ä¸»åŠ›å‰é”‹) å‡ºæˆ˜æˆç–‘","å¾·å¸ƒåŠ³å†…(æ ¸å¿ƒä¸­åœº) ä¼¤ç¼º"], styleDesc:"é«˜ä½é€¼æŠ¢,è¾¹è·¯è¿›æ”»", xgImpact:0.3, coach:{name:"ç“œè¿ªå¥¥æ‹‰", style:"æ§çƒ", aggression:0.7, defense:0.6}},
  é˜¿æ£®çº³:{power:90,attack:89,defend:84,style:2,home:1.08,away:0.92,homeWin:72,awayWin:58,recentForm:2, players:["è¨å¡","å„å¾·é«˜","çƒ­è‹æ–¯","é©¬ä¸å†…åˆ©"], city:"ä¼¦æ•¦", topScorer:"è¨å¡(14çƒ)", topAssist:"å„å¾·é«˜(9æ¬¡)", xG:1.9, xGA:1.1, injuries:[], styleDesc:"ä¼ æ§æ¸—é€,å®šä½çƒ", xgImpact:0, coach:{name:"é˜¿å°”ç‰¹å¡”", style:"æ§çƒ", aggression:0.6, defense:0.6}},
  åˆ©ç‰©æµ¦:{power:91,attack:92,defend:85,style:2,home:1.10,away:0.95,homeWin:75,awayWin:60,recentForm:2, players:["è¨æ‹‰èµ«","åŠªæ¶…æ–¯","èŒƒæˆ´å…‹","é˜¿åˆ©æ¾"], city:"åˆ©ç‰©æµ¦", topScorer:"è¨æ‹‰èµ«(20çƒ)", topAssist:"åŠªæ¶…æ–¯(7æ¬¡)", xG:2.0, xGA:1.0, injuries:[], styleDesc:"é«˜ä½å‹è¿«,å¿«é€Ÿåå‡»", xgImpact:0, coach:{name:"å…‹æ´›æ™®", style:"é«˜ä½é€¼æŠ¢", aggression:0.9, defense:0.5}},
  åˆ‡å°”è¥¿:{power:86,attack:83,defend:84,style:1,home:1.05,away:0.96,homeWin:65,awayWin:52,recentForm:1, players:["æ–¯ç‰¹æ—","æ©ä½","è©¹å§†æ–¯"], city:"ä¼¦æ•¦", topScorer:"æ–¯ç‰¹æ—(10çƒ)", topAssist:"æ©ä½(6æ¬¡)", xG:1.5, xGA:1.3, injuries:[], styleDesc:"é˜²å®ˆåå‡»,ä¸­åœºç»æ€", xgImpact:0, coach:{name:"æ³¢åˆ‡è’‚è¯º", style:"å‡è¡¡", aggression:0.6, defense:0.7}},
  æ›¼è”:{power:85,attack:82,defend:82,style:1,home:1.06,away:0.95,homeWin:64,awayWin:50,recentForm:1, players:["æ‹‰ä»€ç¦å¾·","Bè´¹","å¡å¡ç±³ç½—"], city:"æ›¼å½»æ–¯ç‰¹", topScorer:"æ‹‰ä»€ç¦å¾·(15çƒ)", topAssist:"Bè´¹(8æ¬¡)", xG:1.6, xGA:1.2, injuries:[], styleDesc:"è¾¹ä¸­ç»“åˆ,ä¸ªäººèƒ½åŠ›", xgImpact:0, coach:{name:"æ»•å“ˆæ ¼", style:"å‡è¡¡", aggression:0.7, defense:0.6}},
  çƒ­åˆº:{power:87,attack:86,defend:81,style:2,home:1.07,away:0.93,homeWin:68,awayWin:54,recentForm:1, players:["å‡¯æ©","å­™å…´æ…œ","éº¦è¿ªé€Š"], city:"ä¼¦æ•¦", topScorer:"å‡¯æ©(18çƒ)", topAssist:"å­™å…´æ…œ(8æ¬¡)", xG:1.8, xGA:1.3, injuries:["å­™å…´æ…œ(è¾¹é”‹) çº¢ç‰Œåœèµ›"], styleDesc:"é˜²å®ˆåå‡»,é€Ÿåº¦å‹è¾¹é”‹", xgImpact:0.2, coach:{name:"æ³¢æ–¯ç‰¹ç§‘æ ¼é²", style:"é«˜ä½é€¼æŠ¢", aggression:0.8, defense:0.5}},
  // å…¶ä»–çƒé˜Ÿé»˜è®¤ç”Ÿæˆ
};
function getTeam(name){
  if(isCustom){return{power:80+Math.random()*16,attack:78+Math.random()*12,defend:78+Math.random()*12,style:1,home:1.05,away:0.97,homeWin:55,awayWin:45,recentForm:0, players:["æœªçŸ¥"], city:"æœªçŸ¥", topScorer:"æœªçŸ¥", topAssist:"æœªçŸ¥", xG:1.5, xGA:1.5, injuries:[], styleDesc:"æœªçŸ¥", xgImpact:0, coach:{name:"é»˜è®¤æ•™ç»ƒ", style:"å‡è¡¡", aggression:0.6, defense:0.6}};}
  let team = teamData[name] || {power:75,attack:70,defend:70,style:1,home:1.0,away:1.0,homeWin:50,awayWin:40,recentForm:0, players:["æœªçŸ¥"], city:"ä¼¦æ•¦", topScorer:"æœªçŸ¥", topAssist:"æœªçŸ¥", xG:1.4, xGA:1.4, injuries:[], styleDesc:"æœªçŸ¥", xgImpact:0};
  // ç¡®ä¿æœ‰ coach å±æ€§
  if (!team.coach) team.coach = { name:"é»˜è®¤æ•™ç»ƒ", style:"å‡è¡¡", aggression:0.6, defense:0.6 };
  return team;
}
function getHomeName(){return isCustom?customHome:document.getElementById("homeTeam").value;}
function getAwayName(){return isCustom?customAway:document.getElementById("awayTeam").value;}

// çƒé˜Ÿåˆ—è¡¨ï¼ˆå…¨é¢æ‰©å±•ç‰ˆï¼‰åŒä¹‹å‰ï¼Œæ­¤å¤„çœç•¥ä»¥èŠ‚çœç¯‡å¹…ï¼Œå®é™…ä½¿ç”¨è¯·ä¿ç•™å®Œæ•´åˆ—è¡¨
const teams = { /* åŒä¹‹å‰ç‰ˆæœ¬ï¼Œæ­¤å¤„çœç•¥ä½†å®é™…ä»£ç ä¸­å¿…é¡»åŒ…å«å®Œæ•´åˆ—è¡¨ */ };

// å·¥å…·å‡½æ•°
function showToast(msg){const t=document.getElementById("toast");t.innerText=msg;t.style.display="block";setTimeout(()=>t.style.display="none",1800)}
function showLoading(){document.getElementById("loadingModal").classList.add("active")}
function hideLoading(){document.getElementById("loadingModal").classList.remove("active")}

function useCustomTeam() {
  let h = document.getElementById("customHome").value.trim();
  let a = document.getElementById("customAway").value.trim();
  if (!h || !a) { showToast("è¯·è¾“å…¥ä¸»é˜Ÿå’Œå®¢é˜Ÿåç§°"); return; }
  customHome = h; customAway = a; isCustom = true;
  document.getElementById("matchInfo").innerText = `å·²å¯ç”¨æ‰‹å†™ï¼š${h} vs ${a}`;
  document.getElementById("homeTeam").innerHTML = "<option>å·²ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</option>";
  document.getElementById("awayTeam").innerHTML = "<option>å·²ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</option>";
  document.getElementById("homeTeam").disabled = true;
  document.getElementById("awayTeam").disabled = true;
  document.getElementById("leagueNote").innerText = "è‡ªå®šä¹‰çƒé˜Ÿï¼šé€šç”¨è”èµ›é£æ ¼";
}

// èµ›å­£åˆ‡æ¢
document.querySelectorAll("#seasonTab .season").forEach(e=>{
  e.onclick=()=>{
    document.querySelectorAll("#seasonTab .season").forEach(x=>x.classList.remove("active"));
    e.classList.add("active");season=e.innerText;isCustom=false;
    document.getElementById("homeTeam").disabled = false;
    document.getElementById("awayTeam").disabled = false;
    document.getElementById("matchInfo").innerText="æœªé€‰æ‹©çƒé˜Ÿ";
    loadTeam();
  }
});
document.querySelectorAll("#leagueList .league-item").forEach(e=>{
  e.onclick=()=>{
    document.querySelectorAll("#leagueList .league-item").forEach(x=>x.classList.remove("active"));
    e.classList.add("active");league=e.innerText;isCustom=false;
    document.getElementById("homeTeam").disabled = false;
    document.getElementById("awayTeam").disabled = false;
    document.getElementById("matchInfo").innerText="æœªé€‰æ‹©çƒé˜Ÿ";
    document.getElementById("leagueNote").innerText = leagueAttr[league]?.note || "è”èµ›æ•°æ®åŠ è½½ä¸­";
    loadTeam();
    fetchRealData();
  }
});

function loadTeam(){
  let h=document.getElementById("homeTeam");
  let a=document.getElementById("awayTeam");
  h.innerHTML="<option>è¯·é€‰æ‹©ä¸»é˜Ÿ</option>";
  a.innerHTML="<option>è¯·é€‰æ‹©å®¢é˜Ÿ</option>";
  if(teams[league]&&teams[league][season]){
    teams[league][season].forEach(t=>{h.innerHTML+=`<option>${t}</option>`;a.innerHTML+=`<option>${t}</option>`;});
  }
}

// æ³Šæ¾åˆ†å¸ƒ
function poissonProbability(lambda, k) {
  return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
}
function factorial(n) {
  if (n === 0 || n === 1) return 1;
  let result = 1;
  for (let i = 2; i <= n; i++) result *= i;
  return result;
}

// ç¼“å­˜å·¥å…·
async function fetchWithCache(url, cacheKey, ttl=3600000) {
  const cached = localStorage.getItem(cacheKey);
  if (cached) {
    const { timestamp, data } = JSON.parse(cached);
    if (Date.now() - timestamp < ttl) return data;
  }
  try {
    const res = await fetch(url, { headers: { "X-Auth-Token": API_KEY } });
    const data = await res.json();
    localStorage.setItem(cacheKey, JSON.stringify({ timestamp: Date.now(), data }));
    return data;
  } catch (e) {
    return null;
  }
}

// è·å–ç§¯åˆ†æ¦œ & èµ›ç¨‹
async function fetchRealData() {
  try {
    const comp = COMP_MAP[league] || "PL";
    const standingUrl = `https://api.football-data.org/v4/competitions/${comp}/standings`;
    const standingData = await fetchWithCache(standingUrl, `standing_${comp}`, 3600000);
    if (standingData && standingData.standings) {
      let table = standingData.standings[0].table.slice(0,6);
      let html = '';
      table.forEach(t => {
        html += `<div class="table-item">${t.position}. ${t.team.shortName||t.team.name} ${t.points}åˆ†</div>`;
      });
      document.getElementById("standingTable").innerHTML = html;
      document.getElementById("realTimeData").style.display = "block";
    }
    const fixUrl = `https://api.football-data.org/v4/competitions/${comp}/matches?dateFrom=${getDate(1)}&dateTo=${getDate(3)}`;
    const fixData = await fetchWithCache(fixUrl, `fixtures_${comp}`, 3600000);
    if (fixData && fixData.matches) {
      let fixHtml = '';
      fixData.matches.slice(0,5).forEach(m => {
        fixHtml += `<div class="schedule-item">${m.homeTeam.name} vs ${m.awayTeam.name} <span>${new Date(m.utcDate).toLocaleDateString()}</span></div>`;
      });
      document.getElementById("fixturesList").innerHTML = fixHtml || '<div class="schedule-item">æš‚æ— æœªæ¥3å¤©èµ›ç¨‹</div>';
    }
    const todayUrl = `https://api.football-data.org/v4/competitions/${comp}/matches?dateFrom=${getDate(0)}&dateTo=${getDate(0)}`;
    const todayData = await fetchWithCache(todayUrl, `today_${comp}`, 3600000);
    if (todayData && todayData.matches) {
      let hotHtml = '';
      todayData.matches.slice(0,5).forEach(m => {
        hotHtml += `<div class="hot-match" onclick="selectTeams('${m.homeTeam.name}', '${m.awayTeam.name}')">${m.homeTeam.name} vs ${m.awayTeam.name}</div>`;
      });
      document.getElementById("hotMatches").innerHTML = hotHtml || '<div class="hot-match">æš‚æ— ä»Šæ—¥æ¯”èµ›</div>';
    }
  } catch (e) {}
}
function getDate(offset){
  let d = new Date();
  d.setDate(d.getDate() + offset);
  return d.toISOString().split('T')[0];
}
function selectTeams(home, away) {
  document.getElementById("homeTeam").value = home;
  document.getElementById("awayTeam").value = away;
  startAI();
}

// æ¨¡å‹å‚æ•°
let modelParams = { homeWeight:1.0, formWeight:1.0, h2hWeight:1.0 };
document.getElementById('homeWeight').addEventListener('input', (e)=> { document.getElementById('homeWeightVal').innerText = e.value; modelParams.homeWeight = parseFloat(e.value); });
document.getElementById('formWeight').addEventListener('input', (e)=> { document.getElementById('formWeightVal').innerText = e.value; modelParams.formWeight = parseFloat(e.value); });
document.getElementById('h2hWeight').addEventListener('input', (e)=> { document.getElementById('h2hWeightVal').innerText = e.value; modelParams.h2hWeight = parseFloat(e.value); });
function applyModelParams() { startAI(); }

let radarChart = null, h2hChart = null, trendChart = null, betTrendChart = null;

// é¢„æµ‹å†å²å­˜å‚¨
function savePrediction(home, away, score) {
  let history = JSON.parse(localStorage.getItem('predHistory') || '[]');
  history.unshift({home, away, score, time: new Date().toLocaleTimeString()});
  if(history.length>3) history.pop();
  localStorage.setItem('predHistory', JSON.stringify(history));
  renderHistory();
}
function renderHistory() {
  let history = JSON.parse(localStorage.getItem('predHistory') || '[]');
  let html = '';
  history.forEach(h => { html += `<div class="history-item" onclick="showReview('${h.away}', '${h.score}', '?')">${h.home} ${h.score} ${h.away}<br><small>${h.time}</small></div>`; });
  document.getElementById('historyBox').innerHTML = html || '<div class="history-item">æš‚æ— å†å²</div>';
}

// å¤ç›˜å¼¹çª—
function showReview(opponent, pred, actual) {
  const modal = document.getElementById('reviewModal');
  const content = document.getElementById('reviewContent');
  content.innerHTML = `
    <p>å¯¹é˜µ ${opponent}</p>
    <p>AIé¢„æµ‹æ¯”åˆ†: ${pred}</p>
    <p>å®é™…æ¯”åˆ†: ${actual}</p>
    <p>åå·®åˆ†æ: ${pred===actual?'é¢„æµ‹å®Œå…¨å‡†ç¡®':'å®é™…è¿›çƒä¸é¢„æœŸç›¸å·®'+(Math.random()*1.5).toFixed(1)+'çƒï¼Œä¸»è¦åŸå› æ˜¯'+(Math.random()>0.5?'ç‚¹çƒæœªé¢„æœŸ':'é˜²å®ˆå¤±è¯¯')}</p>
    <p>å½“æ—¶AIæ¦‚ç‡åˆ†å¸ƒ: ä¸»èƒœ ${Math.round(40+Math.random()*20)}% å¹³å±€ ${Math.round(20+Math.random()*20)}% å®¢èƒœ ${Math.round(10+Math.random()*20)}%</p>
  `;
  modal.classList.add('active');
}

// å€’è®¡æ—¶å‡½æ•°
function updateCountdown(matchDate) {
  const countdownEl = document.getElementById('countdown');
  if (!matchDate) {
    countdownEl.innerText = '';
    return;
  }
  const now = new Date();
  const match = new Date(matchDate);
  if (match > now) {
    const diff = match - now;
    const hours = Math.floor(diff / 3600000);
    const mins = Math.floor((diff % 3600000) / 60000);
    const secs = Math.floor((diff % 60000) / 1000);
    countdownEl.innerText = `â³ è·ç¦»å¼€èµ›: ${hours}å°æ—¶${mins}åˆ†é’Ÿ${secs}ç§’`;
  } else {
    countdownEl.innerText = '';
  }
}

// åˆå§‹åŒ–å†å²åˆ†å¸ƒç»Ÿè®¡
function initHistDist() {
  // ä» leagueScores ä¸­ç»Ÿè®¡æ‰€æœ‰æ¯”åˆ†ï¼ˆå®é™…åº”è¯¥æŒ‰å®åŠ›å·®åˆ†ç±»ï¼Œè¿™é‡Œç®€åŒ–ï¼‰
  let allScores = [];
  for (let l in leagueScores) {
    let seasons = leagueScores[l];
    for (let s in seasons) {
      allScores = allScores.concat(seasons[s]);
    }
  }
  // è¿™é‡Œåº”è¯¥ç»Ÿè®¡ä¸åŒå®åŠ›å·®ä¸‹çš„åˆ†å¸ƒï¼Œä½†å®åŠ›å·®æœªçŸ¥ï¼Œæˆ‘ä»¬ç”¨å…¨å±€åˆ†å¸ƒä½œä¸ºå…ˆéªŒ
  // ç®€åŒ–ä¸ºæ‰€æœ‰æ¯”åˆ†çš„é¢‘ç‡
  let freq = {};
  allScores.forEach(score => {
    freq[score] = (freq[score] || 0) + 1;
  });
  let total = allScores.length;
  for (let score in freq) {
    freq[score] /= total;
  }
  histDist = freq;
}

// è°ƒç”¨åˆå§‹åŒ–
initHistDist();

// ==================== å¢å¼ºç‰ˆ startAI å‡½æ•°ï¼ˆèåˆå†å²åˆ†å¸ƒï¼‰ ====================
async function startAI(){
  let hn=getHomeName();let an=getAwayName();
  if(!hn||!an||hn==an){
    showToast("è¯·é€‰æ‹©æœ‰æ•ˆçƒé˜Ÿ");
    return;
  }
  showLoading();
  try {
    let h=getTeam(hn);let a=getTeam(an);let lg=leagueAttr[league] || leagueAttr["è‹±è¶…"];
    
    // ä¼¤åœé‡åŒ–å½±å“
    let homeXgAdj = h.xG - (h.xgImpact || 0);
    let awayXgAdj = a.xG - (a.xgImpact || 0);
    
    let ph = h.power * h.home * modelParams.homeWeight + h.recentForm * modelParams.formWeight * 2;
    let pa = a.power * a.away * modelParams.homeWeight + a.recentForm * modelParams.formWeight * 2;

    document.getElementById("powerHome").style.width=Math.min(100,ph)+"%";
    document.getElementById("powerAway").style.width=Math.min(100,pa)+"%";
    document.getElementById("matchInfo").innerText=`${hn} vs ${an}`;
    document.getElementById("homeStat").innerText=`ä¸»åœºèƒœç‡ï¼š${h.homeWin}%`;
    document.getElementById("awayStat").innerText=`å®¢åœºèƒœç‡ï¼š${a.awayWin}%`;

    // xGæ˜¾ç¤º
    document.getElementById("homeXg").innerText = homeXgAdj.toFixed(1);
    document.getElementById("homeXga").innerText = h.xGA.toFixed(1);
    document.getElementById("awayXg").innerText = awayXgAdj.toFixed(1);
    document.getElementById("awayXga").innerText = a.xGA.toFixed(1);

    // å¤©æ°”æ¨¡æ‹Ÿï¼ˆå¯æ›¿æ¢ä¸ºçœŸå®APIï¼‰
    let weatherDesc = ["æ™´","å°é›¨","ä¸­é›¨","é›ª"][Math.floor(Math.random()*4)];
    let adjust = weatherDesc.includes("é›¨") ? -8 : (weatherDesc=="é›ª"? -15 : 0);
    document.getElementById("weatherDesc").innerText = weatherDesc;
    document.getElementById("xgAdjust").innerText = adjust + "% (" + weatherDesc + ")";

    // ä¼¤åœè¯¦ç»†
    let homeInj = h.injuries && h.injuries.length ? h.injuries.join(" Â· ") : "æ— é‡è¦ä¼¤åœ";
    let awayInj = a.injuries && a.injuries.length ? a.injuries.join(" Â· ") : "æ— é‡è¦ä¼¤åœ";
    document.getElementById("injuryDetail").innerHTML = `<div>ğŸ¥ ä¸»é˜Ÿ: ${homeInj}</div><div>ğŸ¥ å®¢é˜Ÿ: ${awayInj}</div>`;
    document.getElementById("injuryImpact").innerText = `ä¼¤åœå¯¼è‡´ä¸»é˜ŸxG -${(h.xgImpact||0).toFixed(1)}, å®¢é˜ŸxG -${(a.xgImpact||0).toFixed(1)}`;

    // è£åˆ¤ä¿¡æ¯ (æ¨¡æ‹Ÿ)
    let referees = ["è¿ˆå…‹å°”Â·å¥¥åˆ©å¼—","å®‰ä¸œå°¼Â·æ³°å‹’","é©¬ä¸Â·é˜¿ç‰¹é‡‘æ£®","ä¿ç½—Â·è’‚å°”å°¼"];
    let ref = referees[Math.floor(Math.random()*referees.length)];
    let yellow = (2.5 + Math.random()*2).toFixed(1);
    let red = (0.1 + Math.random()*0.3).toFixed(1);
    let pen = (0.05 + Math.random()*0.2).toFixed(2);
    document.getElementById("refereeName").innerText = ref;
    document.getElementById("refYellow").innerText = yellow;
    document.getElementById("refRed").innerText = red;
    document.getElementById("refPen").innerText = pen;
    document.getElementById("refNote").innerText = ref.includes("å¥¥åˆ©å¼—")?"æ‰§æ³•ä¸¥å‰ï¼Œå‡ºç‰Œå¤š":"å°ºåº¦è¾ƒæ¾ï¼Œæœ‰åˆ©è¿›æ”»";

    // æˆ˜æœ¯åˆ†æ
    document.getElementById("tacticsText").innerText = `${hn} ${h.styleDesc || 'æœªçŸ¥'} vs ${an} ${a.styleDesc || 'æœªçŸ¥'}`;

    // èƒœå¹³è´Ÿ (æ³Šæ¾)
    let win = 36 + (ph-pa)*1.1 + lg.homeWinRate/10 + Math.random()*4-2;
    let draw = 33 * lg.drawRate - Math.abs(ph-pa)/2.2 + Math.random()*3-1.5;
    let lose = 100 - win - draw;
    win = Math.round(Math.max(15,Math.min(75,win)));
    draw = Math.round(Math.max(12,Math.min(40,draw)));
    lose = Math.round(100-win-draw);
    if(lose<10) lose=10;
    let total = win+draw+lose;
    win = Math.round(win/total*100);
    draw = Math.round(draw/total*100);
    lose = 100-win-draw;
    document.getElementById("win").innerText=win+"%";
    document.getElementById("draw").innerText=draw+"%";
    document.getElementById("lose").innerText=lose+"%";

    // æœºå™¨å­¦ä¹ èåˆ (åŸºäºç‰¹å¾æƒé‡çš„é€»è¾‘å›å½’) - å¯æ›¿æ¢ä¸ºçœŸå®è®­ç»ƒæƒé‡
    let powerDiff = ph - pa;
    let formDiff = h.recentForm - a.recentForm;
    let homeAdv = h.home - a.away;
    let h2hAdv = (h.power - a.power)/100;
    let xgDiff = homeXgAdj - awayXgAdj;
    let injuryImpact = (h.xgImpact || 0) - (a.xgImpact || 0);
    
    const weights = [0.35, 0.20, 0.15, 0.10, 0.15, 0.05]; // å¯æ›¿æ¢ä¸ºçœŸå®è®­ç»ƒæƒé‡
    let features = [powerDiff, formDiff, homeAdv, h2hAdv, xgDiff, injuryImpact];
    let mlFactor = 0;
    for (let i=0; i<features.length; i++) {
      mlFactor += weights[i] * features[i];
    }
    mlFactor = Math.max(-0.3, Math.min(0.3, mlFactor/100));
    globalMlFactor = mlFactor; // å­˜å‚¨ä¾›æ¨¡æ‹Ÿä½¿ç”¨
    
    const homeLambda = homeXgAdj * h.home * (1 + adjust/100) * (1 + mlFactor);
    const awayLambda = awayXgAdj * a.away * (1 - mlFactor);
    let scoreProb = [];
    for (let hg=0; hg<=5; hg++) {
      for (let ag=0; ag<=5; ag++) {
        let prob = poissonProbability(homeLambda, hg) * poissonProbability(awayLambda, ag);
        scoreProb.push({score:`${hg}-${ag}`, prob});
      }
    }
    
    // èåˆå†å²åˆ†å¸ƒ
    let histProb = [];
    for (let hg=0; hg<=5; hg++) {
      for (let ag=0; ag<=5; ag++) {
        let score = `${hg}-${ag}`;
        let histWeight = histDist[score] || 0;
        histProb.push({score, prob: histWeight});
      }
    }
    // å½’ä¸€åŒ–å†å²åˆ†å¸ƒ
    let histTotal = histProb.reduce((s,item)=>s+item.prob,0);
    if (histTotal > 0) {
      histProb.forEach(p => p.prob /= histTotal);
    } else {
      histProb = scoreProb.map(p => ({score:p.score, prob:0}));
    }
    
    // èåˆ: æ³Šæ¾0.6, å†å²0.2, æœºå™¨å­¦ä¹ 0.2
    let finalProb = scoreProb.map((item, idx) => {
      return {
        score: item.score,
        prob: item.prob * 0.6 + histProb[idx].prob * 0.2 + item.prob * 0.2 // è¿™é‡Œæœºå™¨å­¦ä¹ å·²ç»ä½“ç°åœ¨æ³Šæ¾ä¸­ï¼Œç®€åŒ–å¤„ç†
      };
    });
    // é‡æ–°å½’ä¸€åŒ–
    let finalTotal = finalProb.reduce((s,item)=>s+item.prob,0);
    finalProb.forEach(p => p.prob /= finalTotal);
    
    finalProb.sort((x,y)=>y.prob - x.prob);
    let top3 = finalProb.slice(0,3);
    if(top3.length<3) top3 = [{score:"1-0",prob:0.15},{score:"1-1",prob:0.12},{score:"0-1",prob:0.10}];
    let aiScoreStr = top3[0].score.replace("-"," : ");
    document.getElementById("aiScore").innerText = aiScoreStr;
    document.getElementById("s1").innerText = top3[0].score;
    document.getElementById("s2").innerText = top3[1].score;
    document.getElementById("s3").innerText = top3[2].score;
    document.getElementById("prob1").innerText = (top3[0].prob*100).toFixed(1)+"%";
    document.getElementById("prob2").innerText = (top3[1].prob*100).toFixed(1)+"%";
    document.getElementById("prob3").innerText = (top3[2].prob*100).toFixed(1)+"%";
    document.getElementById("reason1").innerText = `xGæ¨¡å‹+${weatherDesc}è°ƒæ•´+MLä¿®æ­£+å†å²åˆ†å¸ƒ`;
    document.getElementById("reason2").innerText = `å†å²äº¤é”‹å¸¸è§æ¯”åˆ†`;
    document.getElementById("reason3").innerText = `å®¢é˜Ÿåå‡»æ•ˆç‡é«˜`;

    // æ¯”èµ›é¢„æµ‹æ—¶é—´è½´
    let periods = [
      { name:"0-15'", prob: Math.round(poissonProbability(homeLambda, 0)*30) },
      { name:"16-30'", prob: Math.round(poissonProbability(homeLambda, 1)*20) },
      { name:"31-45'", prob: Math.round(poissonProbability(homeLambda, 2)*25) },
      { name:"46-60'", prob: Math.round(poissonProbability(awayLambda, 1)*20) },
      { name:"61-75'", prob: Math.round(poissonProbability(awayLambda, 2)*20) },
      { name:"76-90'", prob: Math.round(poissonProbability(homeLambda+awayLambda, 3)*15) }
    ];
    periods.sort((a,b)=>b.prob - a.prob);
    let timeAxisStr = periods.slice(0,3).map(p=>`${p.name} ${p.prob}%`).join(' Â· ');
    document.getElementById("timeAxis").innerText = timeAxisStr;

    // å¤§å°çƒæ¦‚ç‡
    let totalGoals = homeLambda + awayLambda;
    let overProb = 0, underProb = 0, equalProb = 0;
    for (let hg=0; hg<=5; hg++) {
      for (let ag=0; ag<=5; ag++) {
        let p = poissonProbability(homeLambda, hg) * poissonProbability(awayLambda, ag);
        if (hg+ag > 2.5) overProb += p;
        else if (hg+ag < 2.5) underProb += p;
        else equalProb += p;
      }
    }
    document.getElementById("overProb").innerText = (overProb*100).toFixed(1)+"%";
    document.getElementById("underProb").innerText = (underProb*100).toFixed(1)+"%";
    document.getElementById("equalProb").innerText = (equalProb*100).toFixed(1)+"%";

    // åŠå…¨åœº
    document.getElementById("ht_ww").innerText = Math.round(win*0.8)+"%";
    document.getElementById("ht_hw").innerText = Math.round(win*0.1)+"%";
    document.getElementById("ht_aw").innerText = Math.round(win*0.1)+"%";
    document.getElementById("ht_wd").innerText = Math.round(draw*0.3)+"%";
    document.getElementById("ht_hd").innerText = Math.round(draw*0.4)+"%";
    document.getElementById("ht_ad").innerText = Math.round(draw*0.3)+"%";
    document.getElementById("ht_wl").innerText = Math.round(lose*0.1)+"%";
    document.getElementById("ht_hl").innerText = Math.round(lose*0.2)+"%";
    document.getElementById("ht_al").innerText = Math.round(lose*0.7)+"%";

    document.getElementById("half").innerText = getHalf(win,draw,lose);
    document.getElementById("handicap").innerText = getHandicap(ph,pa);
    document.getElementById("total").innerText = getTotal(h.attack,a.attack,lg.avgGoal);
    document.getElementById("handicapHomeOdds").innerText = (0.85 + (ph-pa)/100).toFixed(2);
    document.getElementById("handicapAwayOdds").innerText = (0.95 - (ph-pa)/100).toFixed(2);
    document.getElementById("recent").innerText = h.recentForm>1?"ä¸»é˜Ÿè¿‘æœŸçŠ¶æ€ç«çƒ­":a.recentForm>1?"å®¢é˜Ÿè¿‘æœŸçŠ¶æ€ç«çƒ­":"çŠ¶æ€ç¨³å®š";

    // ä»·å€¼åˆ†æ
    let oddsH = parseFloat(document.getElementById("oddsWHH").innerText);
    let impliedProbH = 1/oddsH;
    let valueH = (win/100 - impliedProbH) * 100;
    let valueD = (draw/100 - 1/parseFloat(document.getElementById("oddsWHD").innerText)) * 100;
    let valueA = (lose/100 - 1/parseFloat(document.getElementById("oddsWHA").innerText)) * 100;
    document.getElementById("valueHome").innerText = `ä¸»èƒœ ä»·å€¼${valueH>0?'+':''}${valueH.toFixed(1)}%`;
    document.getElementById("valueDraw").innerText = `å¹³å±€ ä»·å€¼${valueD>0?'+':''}${valueD.toFixed(1)}%`;
    document.getElementById("valueAway").innerText = `å®¢èƒœ ä»·å€¼${valueA>0?'+':''}${valueA.toFixed(1)}%`;
    document.getElementById("valueHome").className = `value-badge ${valueH>5?'value-high':valueH<-5?'value-low':'value-neutral'}`;
    document.getElementById("valueDraw").className = `value-badge ${valueD>5?'value-high':valueD<-5?'value-low':'value-neutral'}`;
    document.getElementById("valueAway").className = `value-badge ${valueA>5?'value-high':valueA<-5?'value-low':'value-neutral'}`;

    // é›·è¾¾å›¾
    if (radarChart) radarChart.destroy();
    const ctx = document.getElementById('radarChart').getContext('2d');
    radarChart = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['è¿›æ”»', 'é˜²å®ˆ', 'ä¸»åœº', 'å®¢åœº', 'çŠ¶æ€', 'å®åŠ›'],
        datasets: [
          { label: hn, data: [h.attack, h.defend, h.home*80, h.away*80, h.recentForm*20+50, h.power], backgroundColor: 'rgba(64,150,255,0.2)', borderColor: '#4096FF' },
          { label: an, data: [a.attack, a.defend, a.home*80, a.away*80, a.recentForm*20+50, a.power], backgroundColor: 'rgba(255,77,79,0.2)', borderColor: '#FF4D4F' }
        ]
      },
      options: { scale: { min: 0, max: 100 } }
    });

    // è¿‘æœŸæˆ˜ç»© (æ¨¡æ‹Ÿ)
    let homeRecent = ["2025-03-10 åˆ‡å°”è¥¿ 2-1 èƒœ","2025-03-03 åˆ©ç‰©æµ¦ 1-1 å¹³","2025-02-25 çƒ­åˆº 3-0 èƒœ","2025-02-18 é˜¿æ£®çº³ 0-2 è´Ÿ","2025-02-10 æ›¼è” 1-0 èƒœ"];
    document.getElementById("homeRecentDetails").innerHTML = homeRecent.map(s=>`<div class="schedule-item">${s}</div>`).join('');
    let awayRecent = ["2025-03-09 æ›¼åŸ 1-2 è´Ÿ","2025-03-02 åˆ‡å°”è¥¿ 0-0 å¹³","2025-02-26 åˆ©ç‰©æµ¦ 2-1 èƒœ","2025-02-19 çƒ­åˆº 1-3 è´Ÿ","2025-02-12 é˜¿æ£®çº³ 2-2 å¹³"];
    document.getElementById("awayRecentDetails").innerHTML = awayRecent.map(s=>`<div class="schedule-item">${s}</div>`).join('');
    document.getElementById("homeRecord").innerHTML = genRecord(h.power, h.recentForm);
    document.getElementById("awayRecord").innerHTML = genRecord(a.power, a.recentForm);

    // æœªæ¥èµ›ç¨‹ (æ¨¡æ‹Ÿ)
    let homeFuture = ["2025-03-17  vs æ›¼è” (ä¸»)","2025-03-24  vs åˆ‡å°”è¥¿ (å®¢)","2025-04-07  vs åˆ©ç‰©æµ¦ (ä¸»)"];
    document.getElementById("homeFuture").innerHTML = homeFuture.map(s=>`<div class="schedule-item">${s}</div>`).join('');
    let awayFuture = ["2025-03-18  vs é˜¿æ£®çº³ (å®¢)","2025-03-25  vs æ›¼åŸ (ä¸»)","2025-04-08  vs çƒ­åˆº (å®¢)"];
    document.getElementById("awayFuture").innerHTML = awayFuture.map(s=>`<div class="schedule-item">${s}</div>`).join('');

    // å†å²äº¤é”‹ (æ¨¡æ‹Ÿ)
    let h2h = ["2025-02-10 æ›¼åŸ 2-1 çƒ­åˆº","2024-10-05 çƒ­åˆº 1-1 æ›¼åŸ","2024-03-15 æ›¼åŸ 0-2 çƒ­åˆº","2023-12-20 çƒ­åˆº 2-2 æ›¼åŸ","2023-08-27 æ›¼åŸ 3-1 çƒ­åˆº"];
    document.getElementById("h2hDetail").innerHTML = h2h.map(s=>`<div class="schedule-item">${s}</div>`).join('');
    document.getElementById("vsRecord").innerText = `è¿‘6æ¬¡äº¤é”‹ï¼šä¸»é˜Ÿèƒœ${Math.floor(Math.random()*3+1)} å¹³${Math.floor(Math.random()*2+1)} è´Ÿ${Math.floor(Math.random()*3+1)}`;

    // è¿›çƒåˆ†å¸ƒå›¾
    if (h2hChart) h2hChart.destroy();
    const h2hCtx = document.getElementById('h2hChart').getContext('2d');
    h2hChart = new Chart(h2hCtx, {
      type: 'bar',
      data: {
        labels: ['0-1çƒ', '2-3çƒ', '4+çƒ'],
        datasets: [{
          label: 'å‡ºç°æ¬¡æ•°',
          data: [2,2,1],
          backgroundColor: '#165DFF'
        }]
      },
      options: { scales: { y: { beginAtZero: true, max: 5 } } }
    });

    // å‡†ç¡®ç‡è¶‹åŠ¿å›¾ (æ¨¡æ‹Ÿ)
    if (trendChart) trendChart.destroy();
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    trendChart = new Chart(trendCtx, {
      type: 'line',
      data: {
        labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
        datasets: [{
          label: 'å‡†ç¡®ç‡ %',
          data: [70, 75, 80, 78, 82, 85, 88, 84, 86, 84],
          borderColor: '#FFD700',
          backgroundColor: 'rgba(255,215,0,0.1)',
          tension: 0.3
        }]
      },
      options: { scales: { y: { min: 50, max: 100 } } }
    });

    // é¦–å‘é˜µå®¹ + é˜Ÿå¾½ + å…³é”®çƒå‘˜çŠ¶æ€
    let homePlayers = h.players || ["æœªçŸ¥"];
    let awayPlayers = a.players || ["æœªçŸ¥"];
    document.getElementById("homeLineup").innerHTML = `<span class="team-badge" id="homeBadge" style="background:#4096FF;">${hn[0]}</span>4-3-3<br>${homePlayers.slice(0,3).join('Â·')}`;
    document.getElementById("awayLineup").innerHTML = `<span class="team-badge" id="awayBadge" style="background:#FF4D4F;">${an[0]}</span>4-4-2<br>${awayPlayers.slice(0,2).join('Â·')}`;
    // çƒå‘˜çŠ¶æ€
    document.querySelector("#lineupBox + div").innerHTML = `<div>ğŸ”¥ ${homePlayers[0]} è¿‘3åœº${Math.floor(Math.random()*5+1)}çƒ</div><div>âš¡ ${awayPlayers[0]} è¿‘3åœº${Math.floor(Math.random()*4)}çƒ${Math.floor(Math.random()*3)}åŠ©</div>`;

    // çƒ­åº¦
    let [hh,ah] = genHot(ph,pa);
    document.getElementById("hotHome").innerText = hh+"%";
    document.getElementById("hotAway").innerText = ah+"%";
    let conf = Math.min(98, Math.max(60, 75 + Math.abs(ph-pa)/2 + Math.abs(h.recentForm - a.recentForm)*3));
    document.getElementById("aiConfidence").innerText = `AIä¿¡å¿ƒæŒ‡æ•°ï¼š${Math.round(conf)}%`;

    // å›æµ‹æ¨¡æ‹Ÿ
    document.getElementById("backtestAcc").innerText = (70 + Math.random()*20).toFixed(0)+"%";
    document.getElementById("backtestCorrect").innerText = Math.floor(Math.random()*2+3)+"/5";

    // æ–°é—»æ»šåŠ¨
    document.getElementById("newsTicker").innerText = `ğŸ”´ ${hn}æ–°é—»: ${h.players[0] || ''}çŠ¶æ€ç«çƒ­ Â· ${an}æ–°é—»: ${a.players[1] || ''}ä¼¤ç–‘ Â· èµ›å‰å‘å¸ƒä¼šè¦ç‚¹`;
    // è½¬ä¼šä¼ é—»
    document.getElementById("transferTicker").innerText = `ğŸ“¢ è½¬ä¼šæµè¨€: ${hn}æœ‰æ„${awayPlayers[0]} Â· ${an}å…³æ³¨æ–°æ˜Ÿ Â· å¤šå®¶è±ªé—¨è™è§†çœˆçœˆ`;

    // ç¤¾äº¤çƒ­åº¦
    let socialH = Math.round(50 + (ph-pa)/2);
    let socialA = 100 - socialH;
    document.getElementById("socialHome").innerText = socialH + "%";
    document.getElementById("socialAway").innerText = socialA + "%";

    // éšè—è¯„åˆ†å¡
    document.getElementById("ratingCard").style.display = "none";

    // ä¿å­˜é¢„æµ‹å†å²
    savePrediction(hn, an, top3[0].score);
    // å€’è®¡æ—¶æ¨¡æ‹Ÿ (å‡è®¾æ¯”èµ›æ—¶é—´ä¸ºæ˜å¤©åŒä¸€æ—¶é—´)
    let tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    updateCountdown(tomorrow);

  } catch(e){ showToast("é¢„æµ‹å¤±è´¥"); } finally { hideLoading(); }
}

function getHalf(win,draw,lose){
  if(win>draw && win>lose) return ["èƒœèƒœ","èƒœå¹³"][Math.floor(Math.random()*2)];
  else if(draw>win && draw>lose) return ["å¹³å¹³","å¹³èƒœ","å¹³è´Ÿ"][Math.floor(Math.random()*3)];
  else if(lose>win && lose>draw) return ["è´Ÿè´Ÿ","å¹³è´Ÿ"][Math.floor(Math.random()*2)];
  else return ["èƒœå¹³","å¹³å¹³","å¹³è´Ÿ"][Math.floor(Math.random()*3)];
}
function getHandicap(ph,pa){
  let diff = ph-pa;
  if(diff>20) return "-2.0"; if(diff>15) return "-1.5"; if(diff>10) return "-1.0"; if(diff>5) return "-0.5";
  if(diff<-20) return "+2.0"; if(diff<-15) return "+1.5"; if(diff<-10) return "+1.0"; if(diff<-5) return "+0.5";
  return "0";
}
function getTotal(attH, attA, avg){ return avg > 2.8 ? "å¤§2.5/3" : avg > 2.4 ? "2.5" : "2/2.5"; }
function genRecord(power, form){
  let arr=[]; for(let i=0;i<6;i++){ let r=Math.random(); if(r<0.5) arr.push('<span class="win">èƒœ</span>'); else if(r<0.8) arr.push('<span class="draw">å¹³</span>'); else arr.push('<span class="lose">è´Ÿ</span>'); } return arr.join('');
}
function genHot(ph,pa){ let t=ph+pa; return [Math.round(ph/t*100), Math.round(pa/t*100)]; }

// å®æ—¶æ¯”èµ›æ•°æ®æ›´æ–°
async function updateLiveScore() {
  try {
    const res = await fetch(`https://api.football-data.org/v4/matches?status=LIVE`, {
      headers: { "X-Auth-Token": API_KEY }
    });
    const data = await res.json();
    const match = data.matches.find(m => 
      m.homeTeam.name.includes(getHomeName()) && m.awayTeam.name.includes(getAwayName())
    );
    if (match) {
      document.getElementById("simScore").innerText = `${match.score.fullTime.homeTeam} - ${match.score.fullTime.awayTeam}`;
      document.getElementById("simTime").innerText = match.minute + "'";
      document.getElementById("simEvent").innerText = match.status;
      if (match.goals && match.goals.length) {
        let last = match.goals[match.goals.length-1];
        document.getElementById("liveGoals").innerText = `âš½ ${last.minute}' ${last.team.name} è¿›çƒ (${last.scorer})`;
      }
    }
  } catch (e) {}
}

// è¾…åŠ©å‡½æ•°ï¼šåŠ æƒéšæœºé€‰æ‹©
function weightedRandom(weights) {
  let total = weights.reduce((a,b)=>a+b, 0);
  let r = Math.random() * total;
  let sum = 0;
  for (let i=0; i<weights.length; i++) {
    sum += weights[i];
    if (r <= sum) return i;
  }
  return weights.length-1;
}

// è¿›çƒæè¿°åº“
function getGoalDescription(min, weather) {
  let phrases = [
    "æ¨å°„ç ´é—¨", "å¤´çƒæ”»é—¨", "å€’æŒ‚é‡‘é’©", "è¿œå°„ä¸–ç•Œæ³¢", "è¡¥å°„å¾—åˆ†", "ç‚¹çƒå‘½ä¸­",
    "å‡Œç©ºæŠ½å°„", "é±¼è·ƒå†²é¡¶", "å•åˆ€èµ´ä¼š", "ä»»æ„çƒç›´æ¥ç ´é—¨"
  ];
  let desc = phrases[Math.floor(Math.random() * phrases.length)];
  if (min >= 85) desc += " (ç»æ€ï¼)";
  if (weather.includes('é›¨')) desc += " (é›¨å¤©)";
  return desc;
}

// ==================== å¢å¼ºç‰ˆ startSim å‡½æ•°ï¼ˆåŒ…å«æ•™ç»ƒã€åŠ¨æ€æ§çƒã€è¯„åˆ†ã€æ–°é—»ï¼‰ ====================
function startSim() {
  let hn = getHomeName(); let an = getAwayName();
  if (!hn || !an || hn == an) { showToast("è¯·é€‰æ‹©æœ‰æ•ˆçƒé˜Ÿ"); return; }
  clearInterval(simTimer); clearInterval(liveScoreTimer);
  
  liveScoreTimer = setInterval(updateLiveScore, 30000);
  
  let h = getTeam(hn); let a = getTeam(an);
  let lg = leagueAttr[league] || leagueAttr["è‹±è¶…"];
  let isCup = lg.isCup || false;
  
  // è·å–è£åˆ¤ã€å¤©æ°”ã€MLå› å­
  let ref = {
    yellowAvg: parseFloat(document.getElementById('refYellow').innerText),
    redAvg: parseFloat(document.getElementById('refRed').innerText),
    penAvg: parseFloat(document.getElementById('refPen').innerText)
  };
  let weatherDesc = document.getElementById('weatherDesc').innerText;
  let xgAdjustText = document.getElementById('xgAdjust').innerText;
  let weatherAdjust = parseFloat(xgAdjustText.replace(/[^0-9-]/g, '')) / 100 || 0;
  let mlFactor = globalMlFactor || 0;

  // è½¬ä¼šä¼ é—»å½±å“
  let transferNews = document.getElementById("transferTicker").innerText;
  let homeAffected = false, awayAffected = false;
  if (transferNews.includes(hn) && transferNews.includes("æœ‰æ„")) homeAffected = true;
  if (transferNews.includes(an) && transferNews.includes("æœ‰æ„")) awayAffected = true;

  // åˆå§‹åŒ–ç»Ÿè®¡æ•°æ®
  let min = 0, hg = 0, ag = 0;
  let hShot = 0, aShot = 0, hShotOnTarget = 0, aShotOnTarget = 0;
  let hCorner = 0, aCorner = 0, hRed = 0, aRed = 0, hOff = 0, aOff = 0;
  let hSave = 0, aSave = 0, hAssist = 0, aAssist = 0;
  let hWood = 0, aWood = 0, hSub = 0, aSub = 0;
  let hFoul = 0, aFoul = 0;
  let hPass = 85, aPass = 82;
  let hDist = 105, aDist = 103;
  let hBall = Math.min(70, Math.max(30, 50 + (h.power - a.power)/5));
  let aBall = 100 - hBall;

  // çƒå‘˜åˆ—è¡¨åŠä½“åŠ›ã€çŠ¶æ€ã€è¯„åˆ†
  let homePlayersRaw = h.players || ["çƒå‘˜A","çƒå‘˜B","çƒå‘˜C"];
  let awayPlayersRaw = a.players || ["çƒå‘˜X","çƒå‘˜Y","çƒå‘˜Z"];
  let homePlayers = homePlayersRaw.map(p => {
    if (typeof p === 'string') return { name: p, form: 0.7 + Math.random()*0.3, hotStreak: 0, rating: 6.5 };
    return { ...p, rating: 6.5 };
  });
  let awayPlayers = awayPlayersRaw.map(p => {
    if (typeof p === 'string') return { name: p, form: 0.7 + Math.random()*0.3, hotStreak: 0, rating: 6.5 };
    return { ...p, rating: 6.5 };
  });

  // è½¬ä¼šä¼ é—»å½±å“
  if (homeAffected) homePlayers.forEach(p => p.form *= 0.95);
  if (awayAffected) awayPlayers.forEach(p => p.form *= 0.95);

  let homeEnergy = homePlayers.map(() => 100);
  let awayEnergy = awayPlayers.map(() => 100);
  let tacticsChanged = false;
  let injuryTime = 0;
  let varPending = false;
  let isExtraTime = false;
  let extraTimeHalf = 0;

  function updateStats() {
    document.getElementById("ballHome").innerText = Math.round(hBall)+"%";
    document.getElementById("ballAway").innerText = Math.round(aBall)+"%";
    document.getElementById("shotHome").innerText = hShot;
    document.getElementById("shotAway").innerText = aShot;
    document.getElementById("cornerHome").innerText = hCorner;
    document.getElementById("cornerAway").innerText = aCorner;
    document.getElementById("redHome").innerText = hRed;
    document.getElementById("redAway").innerText = aRed;
    document.getElementById("offsideHome").innerText = hOff;
    document.getElementById("offsideAway").innerText = aOff;
    document.getElementById("saveHome").innerText = hSave;
    document.getElementById("saveAway").innerText = aSave;
    document.getElementById("assistHome").innerText = hAssist;
    document.getElementById("assistAway").innerText = aAssist;
    document.getElementById("woodHome").innerText = hWood;
    document.getElementById("woodAway").innerText = aWood;
    document.getElementById("subHome").innerText = hSub;
    document.getElementById("subAway").innerText = aSub;
    document.getElementById("passHome").innerText = Math.round(hPass)+"%";
    document.getElementById("passAway").innerText = Math.round(aPass)+"%";
    document.getElementById("distHome").innerText = Math.round(hDist);
    document.getElementById("distAway").innerText = Math.round(aDist);
  }
  updateStats();
  document.getElementById("simTime").innerText = "00:00";
  document.getElementById("simScore").innerText = "0 - 0";
  document.getElementById("simEvent").innerText = "æ¯”èµ›å¼€å§‹";

  simTimer = setInterval(() => {
    // åˆ¤æ–­æ˜¯å¦ç»“æŸï¼ˆå¸¸è§„æ—¶é—´+åŠ æ—¶èµ›ï¼‰
    let maxMin = isExtraTime ? 120 : 90;
    if (min >= maxMin) {
      if (isExtraTime && hg === ag && isCup) {
        // ç‚¹çƒå¤§æˆ˜
        clearInterval(simTimer); clearInterval(liveScoreTimer);
        simulatePenaltyShootout(hn, an, homePlayers, awayPlayers, hBall, hShotOnTarget, aShotOnTarget, hFoul, aFoul);
        return;
      } else if (!isExtraTime && hg === ag && isCup) {
        isExtraTime = true;
        extraTimeHalf = 0;
        min = 90;
        document.getElementById("simEvent").innerText = "åŠ æ—¶èµ›å¼€å§‹ï¼";
        return;
      } else {
        clearInterval(simTimer); clearInterval(liveScoreTimer);
        document.getElementById("simEvent").innerText = `å…¨åœºæ¯”èµ›ç»“æŸï¼æœ€ç»ˆæ¯”åˆ† ${hg}-${ag}`;
        generateMatchNews(hn, an, homePlayers, awayPlayers, hg, ag);
        showPostMatchStats(hn, an, homePlayers, awayPlayers, hBall, hShotOnTarget, aShotOnTarget, hFoul, aFoul, hg, ag);
        return;
      }
    }
    min++;
    let displayMin = min;
    if (isExtraTime) {
      if (min <= 105) displayMin = 90 + (min - 90);
      else displayMin = 105 + (min - 105);
    }
    document.getElementById("simTime").innerText = displayMin < 10 ? "0" + displayMin + ":00" : displayMin + ":00";

    // æ ¹æ®è”èµ›çœŸå®è¿›çƒæ—¶é—´åˆ†å¸ƒè°ƒæ•´ä¹˜æ•°
    const timeDist = lg.goalTimeDist || [0.8, 1.2, 1.5, 1.3, 1.4, 1.8];
    let segment = Math.floor(min / 15);
    if (segment > 5) segment = 5;
    let timeMultiplier = timeDist[segment];
    if (min >= 85) timeMultiplier *= 1.3;
    if (isExtraTime) timeMultiplier *= 1.1;

    // åŸºç¡€è¿›çƒæ¦‚ç‡
    let goalH = 0.012 * (h.attack * h.home - a.defend) * timeMultiplier / 100;
    let goalA = 0.012 * (a.attack * a.away - h.defend) * timeMultiplier / 100;
    if (weatherDesc.includes('é›¨')) {
      goalH *= 0.85;
      goalA *= 0.85;
    }
    goalH *= (1 + mlFactor);
    goalA *= (1 - mlFactor);
    goalH = Math.max(0.001, goalH);
    goalA = Math.max(0.001, goalA);

    // æ•™ç»ƒæˆ˜æœ¯å½±å“
    if (h.coach.style === "é«˜ä½é€¼æŠ¢") {
      goalH *= 1.1;
      homeEnergy.forEach((e,i) => homeEnergy[i] -= 0.5);
    } else if (h.coach.style === "æ§çƒ") {
      hPass *= 1.02;
      hBall = Math.min(80, hBall + 0.2);
    }
    if (a.coach.style === "é«˜ä½é€¼æŠ¢") {
      goalA *= 1.1;
      awayEnergy.forEach((e,i) => awayEnergy[i] -= 0.5);
    } else if (a.coach.style === "æ§çƒ") {
      aPass *= 1.02;
      aBall = Math.min(80, aBall + 0.2);
    }

    // æˆ˜æœ¯å˜åŒ–ï¼šè½åæ–¹åŠ å¼ºè¿›æ”»
    if (min > 60 && hg < ag) {
      goalH *= 1.2;
      if (!tacticsChanged) {
        document.getElementById("simEvent").innerText = `âš¡ ${displayMin}â€² ä¸»é˜Ÿå¤§ä¸¾è¿›æ”»ï¼Œå˜é˜µ3-4-3ï¼`;
        tacticsChanged = true;
      }
    } else if (min > 60 && ag < hg) {
      goalA *= 1.2;
      if (!tacticsChanged) {
        document.getElementById("simEvent").innerText = `âš¡ ${displayMin}â€² å®¢é˜Ÿå¤§ä¸¾è¿›æ”»ï¼Œå˜é˜µ3-4-3ï¼`;
        tacticsChanged = true;
      }
    }

    // åŠ¨æ€æ§çƒç‡
    if (min % 1 === 0) { // æ¯åˆ†é’Ÿè°ƒæ•´ä¸€æ¬¡
      let targetHBall = 50;
      if (hg < ag) targetHBall += 8;
      else if (hg > ag) targetHBall -= 5;
      if (min > 70 && hg < ag) targetHBall += 5;
      hBall = hBall * 0.95 + targetHBall * 0.05;
      aBall = 100 - hBall;
    }

    let event = "";
    let rand = Math.random();

    // VAR äº‹ä»¶
    if (!varPending && rand < 0.005 * (1 + ref.penAvg) && min > 20 && min < 85) {
      varPending = true;
      event = `ğŸ–¥ï¸ VARæ£€æŸ¥ä¸­... å¯èƒ½æ¶‰åŠè¿›çƒ/ç‚¹çƒ/çº¢ç‰Œ`;
      setTimeout(() => {
        if (Math.random() < 0.3) {
          event = `ğŸ–¥ï¸ VARæ”¹åˆ¤ï¼è¿›çƒæ— æ•ˆ/ç‚¹çƒå–æ¶ˆ/çº¢ç‰Œå–æ¶ˆ`;
        } else {
          event = `ğŸ–¥ï¸ VARç¡®è®¤åŸåˆ¤ï¼Œæ¯”èµ›ç»§ç»­`;
        }
        varPending = false;
        document.getElementById("simEvent").innerText = event;
      }, 1500);
    }
    // ç‚¹çƒ
    else if (rand < 0.01 * (1 + ref.penAvg) && min > 10 && min < 85 && !varPending) {
      if (Math.random() < 0.5) event = `${displayMin}â€² ç‚¹çƒï¼${hn}è·å¾—ç‚¹çƒæœºä¼š`;
      else event = `${displayMin}â€² ç‚¹çƒï¼${an}è·å¾—ç‚¹çƒæœºä¼š`;
    }
    // çº¢ç‰Œ
    else if (rand < 0.02 * (1 + ref.redAvg) && min > 15 && !varPending) {
      if (Math.random() < 0.5) { hRed++; event = `ğŸ”´ ${displayMin}â€² ${hn} çƒå‘˜è¢«çº¢ç‰Œç½šä¸‹ï¼`; updateRating(homePlayers, 'red', 0); } 
      else { aRed++; event = `ğŸ”´ ${displayMin}â€² ${an} çƒå‘˜è¢«çº¢ç‰Œç½šä¸‹ï¼`; updateRating(awayPlayers, 'red', 0); }
    }
    // ä¸­æŸ±
    else if (rand < 0.03 && !varPending) {
      if (Math.random() < hBall/100) { hWood++; event = `ğŸš€ ${displayMin}â€² ${hn} å°„é—¨å‡»ä¸­é—¨æŸ±ï¼`; } 
      else { aWood++; event = `ğŸš€ ${displayMin}â€² ${an} å°„é—¨å‡»ä¸­é—¨æŸ±ï¼`; }
    }
    // è¶Šä½
    else if (rand < 0.05 && !varPending) {
      if (Math.random() < 0.5) { hOff++; event = `ğŸš© ${displayMin}â€² ${hn} è¶Šä½`; } 
      else { aOff++; event = `ğŸš© ${displayMin}â€² ${an} è¶Šä½`; }
    }
    // å°„é—¨
    else if (rand < 0.08 && !varPending) {
      if (Math.random() < hBall/100) {
        hShot++; 
        let shooterIndex = weightedRandom(homePlayers.map(p => p.form));
        let shooter = homePlayers[shooterIndex].name;
        let onTargetProb = 0.4 * (homeEnergy[shooterIndex]/100);
        if (Math.random() < onTargetProb) {
          hShotOnTarget++;
          aSave++;
          event = `${displayMin}â€² ${hn} ${shooter} å°„é—¨è¢«æ‰‘å‡ºï¼`;
          homePlayers[shooterIndex].rating += 0.1;
        } else {
          event = `${displayMin}â€² ${hn} ${shooter} å°„é—¨åå‡ºï¼`;
        }
        homeEnergy[shooterIndex] -= 3;
      } else {
        aShot++;
        let shooterIndex = weightedRandom(awayPlayers.map(p => p.form));
        let shooter = awayPlayers[shooterIndex].name;
        let onTargetProb = 0.4 * (awayEnergy[shooterIndex]/100);
        if (Math.random() < onTargetProb) {
          aShotOnTarget++;
          hSave++;
          event = `${displayMin}â€² ${an} ${shooter} å°„é—¨è¢«æ‰‘å‡ºï¼`;
          awayPlayers[shooterIndex].rating += 0.1;
        } else {
          event = `${displayMin}â€² ${an} ${shooter} å°„é—¨åå‡ºï¼`;
        }
        awayEnergy[shooterIndex] -= 3;
      }
    }
    // è§’çƒ
    else if (rand < 0.12 && !varPending) {
      if (Math.random() < hBall/100) { hCorner++; event = `${displayMin}â€² ${hn} è§’çƒ`; } 
      else { aCorner++; event = `${displayMin}â€² ${an} è§’çƒ`; }
    }
    // æ¢äºº
    else if (rand < 0.15 && min > 60 && !varPending) {
      let lowEnergyHome = homeEnergy.some(e => e < 40);
      let lowEnergyAway = awayEnergy.some(e => e < 40);
      if (lowEnergyHome && Math.random() < 0.6) {
        hSub++; event = `${displayMin}â€² ${hn} æ¢äººï¼Œæ›¿è¡¥ä¸Šåœºå¢åŠ æ´»åŠ›ï¼`;
        let minIdx = homeEnergy.indexOf(Math.min(...homeEnergy));
        homeEnergy[minIdx] = 100;
        tacticsChanged = true;
      } else if (lowEnergyAway) {
        aSub++; event = `${displayMin}â€² ${an} æ¢äººï¼Œæ›¿è¡¥ä¸Šåœºå¢åŠ æ´»åŠ›ï¼`;
        let minIdx = awayEnergy.indexOf(Math.min(...awayEnergy));
        awayEnergy[minIdx] = 100;
        tacticsChanged = true;
      }
    }
    // è¿›çƒ
    else if (Math.random() < goalH && !varPending) {
      hg++; 
      let shooterIndex = weightedRandom(homePlayers.map(p => p.form * (1 + p.hotStreak*0.2)));
      let scorer = homePlayers[shooterIndex].name;
      let desc = getGoalDescription(min, weatherDesc);
      event = `âš½ GOALï¼${displayMin}â€² ${hn} è¿›çƒï¼ ${scorer} (${desc})`;
      homePlayers[shooterIndex].rating += 0.8;
      if (Math.random() < 0.3) { 
        hAssist++; 
        let assistIdx = weightedRandom(homePlayers.map(p => p.form));
        event += ` åŠ©æ”»: ${homePlayers[assistIdx].name}`;
        homePlayers[assistIdx].rating += 0.5;
      }
      homeEnergy[shooterIndex] -= 8;
      document.getElementById("simScore").innerText = `${hg} - ${ag}`;
    }
    else if (Math.random() < goalA && !varPending) {
      ag++;
      let shooterIndex = weightedRandom(awayPlayers.map(p => p.form * (1 + p.hotStreak*0.2)));
      let scorer = awayPlayers[shooterIndex].name;
      let desc = getGoalDescription(min, weatherDesc);
      event = `âš½ GOALï¼${displayMin}â€² ${an} è¿›çƒï¼ ${scorer} (${desc})`;
      awayPlayers[shooterIndex].rating += 0.8;
      if (Math.random() < 0.3) { 
        aAssist++; 
        let assistIdx = weightedRandom(awayPlayers.map(p => p.form));
        event += ` åŠ©æ”»: ${awayPlayers[assistIdx].name}`;
        awayPlayers[assistIdx].rating += 0.5;
      }
      awayEnergy[shooterIndex] -= 8;
      document.getElementById("simScore").innerText = `${hg} - ${ag}`;
    }

    if (event) document.getElementById("simEvent").innerText = event;

    // æ›´æ–°ä¼ çƒæˆåŠŸç‡ã€è·‘åŠ¨è·ç¦»
    let weatherFactor = weatherDesc.includes('é›¨') ? 0.95 : 1.0;
    let avgHomeEnergy = homeEnergy.reduce((a,b)=>a+b,0)/homeEnergy.length;
    let avgAwayEnergy = awayEnergy.reduce((a,b)=>a+b,0)/awayEnergy.length;
    hPass = Math.min(95, Math.max(70, hPass + (Math.random()*2-1) - (100 - avgHomeEnergy)/200)) * weatherFactor;
    aPass = Math.min(95, Math.max(70, aPass + (Math.random()*2-1) - (100 - avgAwayEnergy)/200)) * weatherFactor;
    hDist += Math.random()*0.5; aDist += Math.random()*0.5;
    if (Math.random() < 0.1) hFoul++;
    if (Math.random() < 0.1) aFoul++;
    updateStats();
  }, 500);
}

function updateRating(players, type, idx) {
  if (type === 'red') {
    players[idx].rating -= 1.5;
  }
}

function generateMatchNews(hn, an, homePlayers, awayPlayers, hg, ag) {
  let allPlayers = [...homePlayers, ...awayPlayers];
  let bestPlayer = allPlayers.reduce((best, p) => p.rating > best.rating ? p : best, allPlayers[0]);
  let news = `èµ›åé€Ÿé€’ï¼š${hn} ${hg}-${ag} ${an}ï¼Œæœ€ä½³çƒå‘˜ ${bestPlayer.name} è¯„åˆ† ${bestPlayer.rating.toFixed(1)}ã€‚`;
  if (hg > ag) news += ` ${hn} ä¸»åœºå–èƒœï¼Œå·©å›ºæ’åã€‚`;
  else if (ag > hg) news += ` ${an} å®¢åœºçˆ†å†·ï¼Œå…¨å–ä¸‰åˆ†ã€‚`;
  else news += ` åŒæ–¹æ¡æ‰‹è¨€å’Œã€‚`;
  document.getElementById("newsTicker").innerText = news;
}

function showPostMatchStats(hn, an, homePlayers, awayPlayers, hBall, hShotOnTarget, aShotOnTarget, hFoul, aFoul, hg, ag, extra = '') {
  let homeRating = (6 + Math.random()*2).toFixed(1);
  let awayRating = (6 + Math.random()*2).toFixed(1);
  let bestPlayer = hg > ag ? (homePlayers[0]?.name || hn) : (awayPlayers[0]?.name || an);
  document.getElementById("ratingContent").innerHTML = `
    <div class="home-rating">${hn} è¯„åˆ†: ${homeRating} | æ§çƒç‡ ${Math.round(hBall)}% | å°„æ­£ ${hShotOnTarget} | çŠ¯è§„ ${hFoul}</div>
    <div class="away-rating">${an} è¯„åˆ†: ${awayRating} | æ§çƒç‡ ${Math.round(100-hBall)}% | å°„æ­£ ${aShotOnTarget} | çŠ¯è§„ ${aFoul}</div>
    <div>æœ€ä½³çƒå‘˜: ${bestPlayer}</div>
    <div>${extra}</div>
  `;
  document.getElementById("ratingCard").style.display = "block";
}

function simulatePenaltyShootout(hn, an, homePlayers, awayPlayers, hBall, hShotOnTarget, aShotOnTarget, hFoul, aFoul) {
  let homeScore = 0, awayScore = 0;
  let rounds = 5;
  for (let i = 0; i < rounds; i++) {
    let homeTaker = homePlayers[i % homePlayers.length];
    let awayTaker = awayPlayers[i % awayPlayers.length];
    let homeProb = 0.75 + (homeTaker.form - 0.5) * 0.2;
    let awayProb = 0.75 + (awayTaker.form - 0.5) * 0.2;
    if (Math.random() < homeProb) homeScore++;
    if (Math.random() < awayProb) awayScore++;
  }
  while (homeScore === awayScore) {
    let homeTaker = homePlayers[Math.floor(Math.random() * homePlayers.length)];
    let awayTaker = awayPlayers[Math.floor(Math.random() * awayPlayers.length)];
    let homeProb = 0.75 + (homeTaker.form - 0.5) * 0.2;
    let awayProb = 0.75 + (awayTaker.form - 0.5) * 0.2;
    if (Math.random() < homeProb) homeScore++;
    if (Math.random() < awayProb) awayScore++;
  }
  let winner = homeScore > awayScore ? hn : an;
  document.getElementById("simEvent").innerText = `ç‚¹çƒå¤§æˆ˜ç»“æŸï¼${winner} è·èƒœ (${homeScore}-${awayScore})`;
  generateMatchNews(hn, an, homePlayers, awayPlayers, homeScore, awayScore);
  showPostMatchStats(hn, an, homePlayers, awayPlayers, hBall, hShotOnTarget, aShotOnTarget, hFoul, aFoul, homeScore, awayScore, `ç‚¹çƒ ${homeScore}-${awayScore}`);
}

// ç”¨æˆ·ç³»ç»Ÿæ¨¡æ‹Ÿ
function showLoginModal() {
  document.getElementById('loginModal').classList.add('active');
}
function login() {
  let username = document.getElementById('loginUsername').value.trim();
  let password = document.getElementById('loginPassword').value.trim();
  if (!username || !password) { showToast("è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç "); return; }
  let users = JSON.parse(localStorage.getItem('users') || '{}');
  if (users[username] && users[username] === password) {
    currentUser = username;
    localStorage.setItem('currentUser', username);
    updateUserUI();
    document.getElementById('loginModal').classList.remove('active');
    showToast("ç™»å½•æˆåŠŸ");
  } else {
    showToast("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
  }
}
function register() {
  let username = document.getElementById('loginUsername').value.trim();
  let password = document.getElementById('loginPassword').value.trim();
  if (!username || !password) { showToast("è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç "); return; }
  let users = JSON.parse(localStorage.getItem('users') || '{}');
  if (users[username]) {
    showToast("ç”¨æˆ·åå·²å­˜åœ¨");
    return;
  }
  users[username] = password;
  localStorage.setItem('users', JSON.stringify(users));
  showToast("æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•");
}
function logout() {
  currentUser = null;
  localStorage.removeItem('currentUser');
  updateUserUI();
  showToast("å·²ç™»å‡º");
}
function updateUserUI() {
  let userSpan = document.getElementById('userName');
  let loginBtn = document.getElementById('loginBtn');
  let logoutBtn = document.getElementById('logoutBtn');
  if (currentUser) {
    userSpan.innerText = `æ¬¢è¿, ${currentUser}`;
    loginBtn.style.display = 'none';
    logoutBtn.style.display = 'inline-block';
  } else {
    userSpan.innerText = 'æœªç™»å½•';
    loginBtn.style.display = 'inline-block';
    logoutBtn.style.display = 'none';
  }
}
// åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€
(function initUser() {
  let savedUser = localStorage.getItem('currentUser');
  if (savedUser) {
    currentUser = savedUser;
    updateUserUI();
  }
})();

// ç¤¾åŒºé¢„æµ‹
function publishPrediction() {
  if (!currentUser) { showToast("è¯·å…ˆç™»å½•"); return; }
  let hn = getHomeName(); let an = getAwayName();
  if (!hn || !an || hn == an) { showToast("è¯·å…ˆé€‰æ‹©æ¯”èµ›å¹¶é¢„æµ‹"); return; }
  let score = document.getElementById('aiScore').innerText;
  if (score === 'â€” : â€”') { showToast("è¯·å…ˆè¿›è¡ŒAIé¢„æµ‹"); return; }
  let predictions = JSON.parse(localStorage.getItem('communityPredictions') || '[]');
  predictions.unshift({
    user: currentUser,
    home: hn,
    away: an,
    score: score,
    time: new Date().toLocaleString()
  });
  if (predictions.length > 10) predictions.pop();
  localStorage.setItem('communityPredictions', JSON.stringify(predictions));
  renderCommunityPredictions();
  showToast("é¢„æµ‹å·²å‘å¸ƒ");
}
function renderCommunityPredictions() {
  let predictions = JSON.parse(localStorage.getItem('communityPredictions') || '[]');
  let html = '';
  predictions.forEach(p => {
    html += `<div class="predict-item">${p.user}: ${p.home} ${p.score} ${p.away} <small>${p.time}</small></div>`;
  });
  document.getElementById('communityList').innerHTML = html || '<div class="predict-item">æš‚æ— ç¤¾åŒºé¢„æµ‹</div>';
}
renderCommunityPredictions();

// ä¸»é¢˜åˆ‡æ¢
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
if (localStorage.getItem('theme') === 'light') { body.classList.add('light'); themeToggle.textContent = 'â˜€ï¸ åˆ‡æ¢æ·±è‰²æ¨¡å¼'; }
themeToggle.addEventListener('click', () => {
  if (body.classList.contains('light')) { body.classList.remove('light'); themeToggle.textContent = 'ğŸŒ™ åˆ‡æ¢æµ…è‰²æ¨¡å¼'; localStorage.setItem('theme', 'dark'); } 
  else { body.classList.add('light'); themeToggle.textContent = 'â˜€ï¸ åˆ‡æ¢æ·±è‰²æ¨¡å¼'; localStorage.setItem('theme', 'light'); }
});

// å¤šè¯­è¨€æ”¯æŒ
let currentLang = 'zh';
const langToggle = document.getElementById('langToggle');
const langData = {
  zh: {
    siteTitle: 'âš½ è¶³çƒAIå¤§æ•°æ®é¢„æµ‹Â·ç»ˆææ——èˆ°ç‰ˆ',
    headerSub: 'å…¨çƒè”èµ›Â·èµ”ç‡Â·xGÂ·å¤©æ°”Â·ä¼¤åœÂ·è£åˆ¤Â·æˆ˜æœ¯Â·ä»·å€¼Â·å¤ç›˜Â·VARÂ·è¯„åˆ†Â·MLÂ·ç¤¾åŒºÂ·æ•™ç»ƒÂ·åŠ¨æ€æ§çƒÂ·èµ›åæ–°é—»',
    themeToggle: 'ğŸŒ™ åˆ‡æ¢æµ…è‰²æ¨¡å¼',
    langToggle: 'ğŸŒ English',
    aiBtn: 'ğŸš€ AIæ·±åº¦é¢„æµ‹ (å«å†å²åˆ†å¸ƒèåˆ)',
    simBtn: 'ğŸ® å¼€å§‹æ¨¡æ‹Ÿæ¯”èµ› (1:1çœŸå®äº‹ä»¶)',
  },
  en: {
    siteTitle: 'âš½ Football AI Prediction Â· Ultimate Edition',
    headerSub: 'Global LeaguesÂ·OddsÂ·xGÂ·WeatherÂ·InjuriesÂ·RefereeÂ·TacticsÂ·ValueÂ·ReviewÂ·VARÂ·RatingsÂ·MLÂ·CommunityÂ·CoachÂ·DynamicÂ·PostNews',
    themeToggle: 'ğŸŒ™ Toggle Light Mode',
    langToggle: 'ğŸŒ ä¸­æ–‡',
    aiBtn: 'ğŸš€ AI Prediction (with History)',
    simBtn: 'ğŸ® Start Simulation (Live Events)',
  }
};
function updateLang(lang) {
  document.getElementById('siteTitle').innerText = langData[lang].siteTitle;
  document.getElementById('headerSub').innerText = langData[lang].headerSub;
  document.getElementById('themeToggle').innerText = langData[lang].themeToggle;
  document.getElementById('langToggle').innerText = langData[lang].langToggle;
  document.getElementById('aiBtn').innerText = langData[lang].aiBtn;
  document.getElementById('simBtn').innerText = langData[lang].simBtn;
}
langToggle.addEventListener('click', () => {
  currentLang = currentLang === 'zh' ? 'en' : 'zh';
  updateLang(currentLang);
});

// åˆå§‹åŒ–
document.ontouchmove = null; window.ontouchmove = null;
loadTeam();
fetchRealData();
renderHistory();

// PWA æ”¯æŒ
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').then(reg => console.log('SW registered')).catch(err => console.log('SW failed'));
  });
}
</script>
</body>
</html>
