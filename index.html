<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>âš½ è¶…çº§è¶³çƒAI Â· çœŸå®èµ›äº‹ç‰ˆ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
:root{
  --primary:#00E6A0;
  --secondary:#00A8F0;
  --warning:#FFCC00;
  --danger:#FF3B30;
  --bg-main:#0B1218;
  --bg-card:#16202D;
  --bg-item:#1E2A3A;
  --border:#24303F;
  --text-white:#EAEFFC;
  --text-gray:#9CAFC3;
  --text-muted:#66768A;
}
body{background:var(--bg-main);color:var(--text-white);padding-bottom:88px;overflow-x:hidden}
html{scroll-behavior:smooth}

/* é¡¶éƒ¨çŠ¶æ€æ  */
.status-bar{background:#121A25;padding:8px 14px;font-size:12px;color:var(--text-gray);display:flex;justify-content:space-between;align-items:center}
.status-bar .tag{background:rgba(0,230,160,0.1);color:var(--primary);padding:2px 6px;border-radius:4px;font-size:11px;font-weight:600}

/* LogoåŒºåŸŸ */
.logo-area{background:var(--bg-card);padding:16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--border)}
.logo{width:40px;height:40px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;font-size:18px}
.app-title{flex:1}
.app-name{font-size:18px;color:#fff;font-weight:700}
.app-desc{font-size:12px;color:var(--text-gray);margin-top:2px}

/* ä¸»å¯¼èˆª */
.main-nav{background:#121A25;display:flex;position:sticky;top:0;z-index:999;border-bottom:1px solid var(--border);overflow-x:auto;scrollbar-width:none}
.main-nav::-webkit-scrollbar{display:none}
.nav-item{flex-shrink:0;min-width:20%;text-align:center;padding:14px 10px;font-size:14px;color:var(--text-gray);position:relative;transition:all 0.2s ease;cursor:pointer}
.nav-item.active{color:var(--primary);font-weight:600}
.nav-item.active::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:24px;height:3px;background:var(--primary);border-radius:3px}

/* é¡µé¢å®¹å™¨ */
.page{display:none;animation:fadeIn 0.3s ease}
.page.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* é€šç”¨å¡ç‰‡ */
.card{background:var(--bg-card);margin:12px;border-radius:16px;padding:18px;box-shadow:0 4px 16px rgba(0,8,16,0.3)}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.card-title{font-size:16px;color:#fff;font-weight:600;display:flex;align-items:center;gap:8px}
.card-sub{font-size:12px;color:var(--text-gray);margin-top:4px}
.card-tag{font-size:11px;background:rgba(0,230,160,0.1);color:var(--primary);padding:3px 8px;border-radius:6px;font-weight:600}

/* èµ›äº‹æ¿å—æ ‡é¢˜ */
.match-block-title{font-size:14px;font-weight:600;color:var(--text-white);margin:16px 12px 8px;padding-left:6px;border-left:3px solid var(--primary)}

/* é€‰æ‹©å™¨è¡Œ */
.select-row{display:flex;gap:10px;margin:12px}
.select-group{flex:1;display:flex;flex-direction:column;gap:4px}
.select-label{font-size:12px;color:var(--text-gray);padding-left:4px}
.team-select{width:100%;background:var(--bg-item);border:1px solid var(--border);border-radius:12px;padding:14px 12px;color:var(--text-white);font-size:14px;appearance:none;background-image:url("data:image/svg+xml;utf8,<svg fill='%239CAFC3' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");background-repeat:no-repeat;background-position:right 10px center;background-size:16px}

/* æŒ‰é’®æ ·å¼ */
.btn-group{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:0 12px}
.btn{border:none;border-radius:12px;padding:16px;text-align:center;font-weight:600;font-size:15px;transition:all 0.2s ease;position:relative;overflow:hidden;cursor:pointer}
.btn:active{transform:scale(0.98)}
.btn-primary{background:linear-gradient(90deg,var(--primary),#00C8A0);color:#000}
.btn-secondary{background:linear-gradient(90deg,var(--secondary),#0088D0);color:#fff}
.btn-warning{background:linear-gradient(90deg,var(--warning),#FFAA00);color:#111}
.btn:disabled{opacity:0.5;pointer-events:none}

/* æ•°æ®ç½‘æ ¼ */
.stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:12px}
.stat-grid-2{grid-template-columns:repeat(2,1fr)}
.stat-item{background:var(--bg-item);border-radius:12px;padding:14px 8px;text-align:center;transition:all 0.2s ease;cursor:pointer}
.stat-item:active{transform:scale(0.96)}
.stat-label{font-size:12px;color:var(--text-gray)}
.stat-value{font-size:18px;color:#fff;font-weight:700;margin-top:4px}
.stat-value.sm{font-size:16px}

/* æ¦‚ç‡è¿›åº¦æ¡ */
.prob-row{display:flex;align-items:center;gap:10px;margin:12px 0}
.prob-label{width:40px;font-size:13px;color:var(--text-gray)}
.prob-bar{flex:1;height:8px;background:var(--bg-item);border-radius:10px;overflow:hidden}
.prob-fill{height:100%;border-radius:10px;transition:width 0.6s ease}
.prob-fill.win{background:var(--primary)}
.prob-fill.draw{background:var(--warning)}
.prob-fill.lose{background:var(--danger)}
.prob-num{width:45px;text-align:right;font-size:13px;font-weight:600;color:#fff}

/* ç»“æœåˆ—è¡¨ */
.result-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border)}
.result-item:last-child{border-bottom:none}
.result-team{font-size:14px;color:var(--text-white)}
.result-score{color:var(--primary);font-weight:700;font-size:16px}
.result-prob{color:var(--warning);font-weight:600;font-size:14px}

/* èµ›äº‹å¡ç‰‡ */
.match-card{background:var(--bg-item);border-radius:12px;padding:14px;margin-bottom:10px}
.match-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.match-league{font-size:12px;color:var(--primary);font-weight:600}
.match-time{font-size:12px;color:var(--text-gray)}
.match-status{font-size:11px;padding:2px 6px;border-radius:4px;font-weight:600}
.match-status.live{background:rgba(255,59,48,0.15);color:var(--danger)}
.match-status.upcoming{background:rgba(255,204,0,0.15);color:var(--warning)}
.match-status.end{background:rgba(0,230,160,0.15);color:var(--primary)}
.match-team-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0}
.match-team{display:flex;align-items:center;gap:8px;font-size:15px;color:#fff;font-weight:500}
.match-score{font-size:18px;font-weight:700;color:#fff}
.match-score.live{color:var(--danger)}
.match-score.end{color:var(--primary)}

/* åŠ è½½çŠ¶æ€ */
.loading-box{text-align:center;padding:30px 0;color:var(--text-gray)}
.loading{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,0.2);border-radius:50%;border-top-color:#fff;animation:spin 0.6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* èŠå¤©ç•Œé¢ */
.chat-box{height:580px;overflow-y:auto;padding:16px;scrollbar-width:none}
.chat-box::-webkit-scrollbar{display:none}
.msg{max-width:85%;margin-bottom:14px;padding:12px 16px;border-radius:18px;line-height:1.5;font-size:14px;animation:msgUp 0.2s ease}
@keyframes msgUp{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.msg-user{background:var(--primary);color:#000;margin-left:auto;border-bottom-right-radius:4px}
.msg-ai{background:var(--bg-item);color:var(--text-white);margin-right:auto;border-bottom-left-radius:4px}
.chat-input-bar{position:fixed;bottom:0;left:0;right:0;background:#121A25;padding:10px 12px;display:flex;gap:8px;border-top:1px solid var(--border);z-index:999}
.chat-input{flex:1;background:var(--bg-item);border:none;border-radius:24px;padding:14px 18px;color:#fff;outline:none;font-size:14px}
.chat-send{background:var(--primary);color:#000;border:none;border-radius:24px;padding:0 20px;font-weight:600;min-width:60px;cursor:pointer}

/* ç›´æ’­æ¨¡æ‹Ÿç•Œé¢ */
.live-card{background:var(--bg-card);margin:12px;border-radius:16px;padding:20px;text-align:center;display:none;animation:fadeIn 0.3s ease}
.live-league{color:var(--text-gray);font-size:13px;margin-bottom:8px}
.live-time{font-size:24px;font-weight:bold;margin:8px 0;color:#fff}
.live-score{font-size:36px;color:var(--warning);font-weight:bold;margin:12px 0}
.live-team-name{display:flex;justify-content:space-between;font-size:16px;font-weight:600;color:#fff;margin:0 10px}
.live-event{font-size:15px;color:var(--primary);height:24px;margin:10px 0}
.live-timeline{margin:16px 0;text-align:left;max-height:120px;overflow-y:auto;scrollbar-width:none}
.live-timeline::-webkit-scrollbar{display:none}
.timeline-item{font-size:12px;color:var(--text-gray);padding:4px 0;display:flex;gap:8px;align-items:center}
.timeline-time{width:35px;color:var(--warning);font-weight:600}
.real-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px;font-size:13px;color:var(--text-gray)}
.stats-row{display:flex;justify-content:space-between;align-items:center;margin:10px 0}
.stats-label{font-size:13px;color:var(--text-gray)}
.stats-bar{flex:1;margin:0 10px;height:6px;background:var(--bg-item);border-radius:10px;overflow:hidden;display:flex}
.stats-home{height:100%;background:var(--primary)}
.stats-away{height:100%;background:var(--danger)}

/* çƒå‘˜å¡ç‰‡ */
.player-card{background:var(--bg-item);border-radius:12px;padding:14px;margin-bottom:10px}
.player-row{display:flex;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)}
.player-row:last-child{border-bottom:none}
.player-name{flex:1;color:#fff;font-size:15px}
.player-pos{color:var(--text-gray);font-size:12px;margin-right:8px;background:rgba(0,168,240,0.1);padding:2px 6px;border-radius:4px}
.player-stat{color:var(--primary);font-weight:bold;width:40px;text-align:center}
.player-header{display:grid;grid-template-columns:2fr repeat(5,1fr);gap:8px;margin-top:8px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.player-header div{font-size:11px;color:var(--text-gray);text-align:center}
.player-header div:first-child{text-align:left}

/* ç§¯åˆ†æ¦œæ ·å¼ */
.rank-row{display:grid;grid-template-columns:30px 1fr 40px 40px 40px 40px;gap:8px;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);font-size:13px}
.rank-row.header{color:var(--text-gray);font-weight:600}
.rank-num{text-align:center;font-weight:600}
.rank-team{font-weight:500}
.rank-data{text-align:center}

/* åˆè§„æç¤º */
.tips-box{background:rgba(0,230,160,0.05);border:1px solid rgba(0,230,160,0.1);border-radius:10px;padding:12px;margin:12px}
.tips-text{font-size:12px;line-height:1.5;color:var(--text-muted);text-align:center}

/* å“åº”å¼é€‚é… */
@media(max-width:375px){
  .stat-grid{grid-template-columns:repeat(2,1fr)}
  .nav-item{min-width:22%;padding:14px 8px;font-size:13px}
  .card{padding:14px;margin:10px}
}
</style>
</head>
<body onload="initPage()">

<div class="status-bar">
  <div>è¶…çº§è¶³çƒAI Â· çœŸå®æ•°æ®ç‰ˆ</div>
  <div class="tag">å®æ—¶èµ›äº‹</div>
</div>

<div class="logo-area">
  <div class="logo">AI</div>
  <div class="app-title">
    <div class="app-name">è¶…çº§è¶³çƒAI</div>
    <div class="app-desc">çœŸå®èµ›äº‹æ¨¡å‹ï½œä¸“ä¸šæ•°æ®åˆ†æ</div>
  </div>
</div>

<div class="main-nav">
  <div class="nav-item active" onclick="go('home')">é¦–é¡µ</div>
  <div class="nav-item" onclick="go('recommend')">AIæ¨è</div>
  <div class="nav-item" onclick="go('ai')">è¶…çº§AI</div>
  <div class="nav-item" onclick="go('simulate')">æ¨¡æ‹Ÿç›´æ’­</div>
  <div class="nav-item" onclick="go('player')">çƒå‘˜æ•°æ®</div>
  <div class="nav-item" onclick="go('league')">è”èµ›æ•°æ®</div>
</div>

<div id="pages">
  <!-- ====================== é¦–é¡µï¼ˆå·²é›†æˆçœŸå®èµ›äº‹ï¼‰ ====================== -->
  <div class="page active" id="home">
    <div class="card">
      <div class="card-header">
        <div class="card-title">ğŸ”¥ ä»Šæ—¥çœŸå®èµ›äº‹</div>
        <div class="card-tag" id="todayDate"></div>
      </div>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <div id="matchLoading" class="loading-box">
        <span class="loading"></span>
        <div style="margin-top:10px">æ­£åœ¨åŠ è½½ä»Šæ—¥èµ›äº‹...</div>
      </div>

      <!-- èµ›äº‹åŠ¨æ€æ¸²æŸ“å®¹å™¨ -->
      <div id="matchContainer" style="display:none"></div>

      <!-- æ— èµ›äº‹æç¤º -->
      <div id="matchEmpty" class="loading-box" style="display:none">
        ä»Šæ—¥æš‚æ— ä¸»æµè”èµ›èµ›äº‹
      </div>

      <!-- åŠ è½½å¤±è´¥æç¤º -->
      <div id="matchError" class="loading-box" style="display:none">
        èµ›äº‹åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ“Š æ ¸å¿ƒåŠŸèƒ½</div>
      <div class="stat-grid stat-grid-2">
        <div class="stat-item" onclick="go('recommend')">
          <div class="stat-value sm">AIæ™ºèƒ½æ¨è</div>
          <div class="stat-label">èƒœå¹³è´Ÿ/æ¯”åˆ†/å¤§å°çƒ</div>
        </div>
        <div class="stat-item" onclick="go('simulate')">
          <div class="stat-value sm">æ¨¡æ‹Ÿç›´æ’­ç³»ç»Ÿ</div>
          <div class="stat-label">1:1è¿˜åŸçœŸå®æ¯”èµ›</div>
        </div>
        <div class="stat-item" onclick="go('ai')">
          <div class="stat-value sm">è¶…çº§AIå¯¹è¯</div>
          <div class="stat-label">ä¸“ä¸šèµ›äº‹æ·±åº¦åˆ†æ</div>
        </div>
        <div class="stat-item" onclick="go('league')">
          <div class="stat-value sm">è”èµ›æ•°æ®åº“</div>
          <div class="stat-label">ç§¯åˆ†æ¦œ/çƒé˜Ÿæ•°æ®</div>
        </div>
      </div>
    </div>

    <div class="tips-box">
      <div class="tips-text">
        æ¸©é¦¨æç¤ºï¼šæœ¬ç³»ç»Ÿæ‰€æœ‰èµ›äº‹æ•°æ®å‡æ¥è‡ªå…¬å¼€APIï¼ŒAIæ¨èç»“æœä»…ä¸ºå¨±ä¹ä¸æŠ€æœ¯æ¼”ç¤ºå‚è€ƒï¼Œä¸æ„æˆä»»ä½•æŠ•æ³¨å»ºè®®ï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”ã€‚
      </div>
    </div>
  </div>

  <!-- ====================== AIæ¨èé¡µ ====================== -->
  <div class="page" id="recommend">
    <div class="card">
      <div class="card-title">ğŸ¯ AIçœŸå®æ¯”åˆ†æ¨è</div>
      <div class="card-sub">åŸºäºçœŸå®è”èµ›æ¨¡å‹ Â· 10000æ¬¡è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ</div>
    </div>

    <div class="card">
      <div class="select-row">
        <div class="select-group">
          <div class="select-label">ä¸»é˜Ÿ</div>
          <select id="recHome" class="team-select"></select>
        </div>
        <div class="select-group">
          <div class="select-label">å®¢é˜Ÿ</div>
          <select id="recAway" class="team-select"></select>
        </div>
      </div>
      <button class="btn btn-primary" id="recBtn" onclick="genRecommend()">ç«‹å³ç”ŸæˆAIæ¨è</button>
    </div>

    <div id="recResultPanel" style="display:none">
      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸ“Š èµ›äº‹åŸºæœ¬é¢åˆ†æ</div>
        </div>
        <div id="recBaseInfo" style="font-size:14px;line-height:1.6;color:var(--text-gray)"></div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ“ˆ èƒœå¹³è´Ÿæ¦‚ç‡åˆ†å¸ƒ</div>
        <div class="prob-row">
          <div class="prob-label">ä¸»èƒœ</div>
          <div class="prob-bar"><div class="prob-fill win" id="winBar"></div></div>
          <div class="prob-num" id="winProb">0%</div>
        </div>
        <div class="prob-row">
          <div class="prob-label">å¹³å±€</div>
          <div class="prob-bar"><div class="prob-fill draw" id="drawBar"></div></div>
          <div class="prob-num" id="drawProb">0%</div>
        </div>
        <div class="prob-row">
          <div class="prob-label">å®¢èƒœ</div>
          <div class="prob-bar"><div class="prob-fill lose" id="loseBar"></div></div>
          <div class="prob-num" id="loseProb">0%</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ² æ ¸å¿ƒç©æ³•æ¨è</div>
        <div class="stat-grid stat-grid-2">
          <div class="stat-item">
            <div class="stat-label">èƒœè´Ÿæ¨è</div>
            <div class="stat-value sm" id="recWin"></div>
          </div>
          <div class="stat-item">
            <div class="stat-label">å¤§å°çƒ</div>
            <div class="stat-value sm" id="recOU"></div>
          </div>
          <div class="stat-item">
            <div class="stat-label">åœºå‡è¿›çƒ</div>
            <div class="stat-value sm" id="recGoal">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">æ¨¡æ‹Ÿæ¬¡æ•°</div>
            <div class="stat-value sm">10000æ¬¡</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ† æ¦‚ç‡Top6 æ¯”åˆ†æ¨è</div>
        <div id="recScoreList"></div>
      </div>
    </div>
  </div>

  <!-- ====================== è¶…çº§AIå¯¹è¯é¡µ ====================== -->
  <div class="page" id="ai">
    <div class="chat-box" id="chatBox">
      <div class="msg msg-ai">ä½ å¥½ï¼æˆ‘æ˜¯è¶…çº§è¶³çƒAIï¼Œå·²æ¥å…¥å…¨çƒäº”å¤§è”èµ›çœŸå®èµ›äº‹æ¨¡å‹ï¼Œæ”¯æŒèµ›äº‹åˆ†æã€èƒœç‡é¢„æµ‹ã€æ¯”åˆ†æ¨èã€å¤§å°çƒåˆ¤æ–­ã€çƒå‘˜æ•°æ®æŸ¥è¯¢ç­‰å…¨ç±»å‹è¶³çƒç›¸å…³é—®é¢˜ã€‚</div>
    </div>
    <div class="chat-input-bar">
      <input class="chat-input" id="chatInput" placeholder="è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šæ›¼åŸvsæ›¼è”èƒœç‡å¤šå°‘ï¼Ÿ">
      <button class="chat-send" onclick="sendChat()">å‘é€</button>
    </div>
  </div>

  <!-- ====================== æ¨¡æ‹Ÿç›´æ’­é¡µ ====================== -->
  <div class="page" id="simulate">
    <div class="card">
      <div class="card-title">ğŸ² çœŸå®èµ›äº‹æ¨¡æ‹Ÿç›´æ’­</div>
      <div class="card-sub">åŸºäºçœŸå®çƒé˜Ÿæ•°æ® Â· å…¨æµç¨‹èµ›äº‹è¿˜åŸ</div>
    </div>

    <div class="card">
      <div class="select-row">
        <div class="select-group">
          <div class="select-label">ä¸»é˜Ÿ</div>
          <select id="homeTeam" class="team-select"></select>
        </div>
        <div class="select-group">
          <div class="select-label">å®¢é˜Ÿ</div>
          <select id="awayTeam" class="team-select"></select>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-warning" onclick="simOne()">å•åœºå¿«é€Ÿæ¨¡æ‹Ÿ</button>
        <button class="btn btn-primary" onclick="startSim()">10000æ¬¡æ¦‚ç‡æ¨¡æ‹Ÿ</button>
      </div>
      <button class="btn btn-secondary" style="width:calc(100% - 24px);margin:10px 12px 0" onclick="startMatch()">â–¶ï¸ å¼€å§‹90åˆ†é’Ÿå®æ—¶ç›´æ’­</button>
    </div>

    <div class="live-card" id="matchLive">
      <div class="live-league" id="liveLeague">æ¨¡æ‹Ÿèµ›äº‹ç›´æ’­</div>
      <div id="liveTime" class="live-time">0'</div>
      <div class="live-team-name">
        <span id="liveHomeName">ä¸»é˜Ÿ</span>
        <span id="liveAwayName">å®¢é˜Ÿ</span>
      </div>
      <div id="liveScore" class="live-score">0 - 0</div>
      <div id="liveEvent" class="live-event">æ¯”èµ›å³å°†å¼€å§‹</div>
      
      <div class="card" style="margin:16px 0 0;padding:14px;background:#121A25">
        <div class="card-title" style="font-size:14px;margin-bottom:10px">ğŸ“Š å®æ—¶æŠ€æœ¯ç»Ÿè®¡</div>
        <div class="stats-row">
          <div class="stats-label" id="homePoss">50%</div>
          <div class="stats-bar">
            <div class="stats-home" id="homePossBar" style="width:50%"></div>
            <div class="stats-away" id="awayPossBar" style="width:50%"></div>
          </div>
          <div class="stats-label" id="awayPoss">50%</div>
        </div>
        <div class="stats-row">
          <div class="stats-label" id="homeShot">0</div>
          <div class="stats-label">å°„é—¨</div>
          <div class="stats-label" id="awayShot">0</div>
        </div>
        <div class="stats-row">
          <div class="stats-label" id="homeOnT">0</div>
          <div class="stats-label">å°„æ­£</div>
          <div class="stats-label" id="awayOnT">0</div>
        </div>
        <div class="stats-row">
          <div class="stats-label" id="homeCorner">0</div>
          <div class="stats-label">è§’çƒ</div>
          <div class="stats-label" id="awayCorner">0</div>
        </div>
        <div class="stats-row">
          <div class="stats-label" id="homeFoul">0</div>
          <div class="stats-label">çŠ¯è§„</div>
          <div class="stats-label" id="awayFoul">0</div>
        </div>
        <div class="stats-row">
          <div class="stats-label" id="homeYellow">0</div>
          <div class="stats-label">é»„ç‰Œ</div>
          <div class="stats-label" id="awayYellow">0</div>
        </div>
      </div>

      <div>
        <div style="text-align:left;font-size:14px;font-weight:600;margin:16px 0 8px;color:#fff">ğŸ“ èµ›äº‹äº‹ä»¶</div>
        <div class="live-timeline" id="liveTimeline"></div>
      </div>
    </div>

    <div class="card" id="resultCard" style="display:none;margin-top:16px">
      <div class="card-title">ğŸ“ˆ æ¦‚ç‡Top6 æ¯”åˆ†</div>
      <div id="resultList"></div>
    </div>
  </div>

  <!-- ====================== çƒå‘˜æ•°æ®é¡µ ====================== -->
  <div class="page" id="player">
    <div class="card">
      <div class="card-title">ğŸ‘¤ çƒå‘˜èµ›å­£æ•°æ®åº“</div>
      <div class="card-sub">å‡ºåœºï½œè¿›çƒï½œåŠ©æ”»ï½œèµ›å­£è¯„åˆ†</div>
    </div>

    <div class="card">
      <div class="select-group">
        <div class="select-label">é€‰æ‹©çƒé˜Ÿ</div>
        <select id="playerTeam" class="team-select" onchange="loadPlayerData()">
          <option value="">è¯·é€‰æ‹©çƒé˜Ÿ</option>
        </select>
      </div>
    </div>

    <div id="playerList">
      <div class="card" style="text-align:center;color:var(--text-gray)">
        è¯·é€‰æ‹©çƒé˜ŸæŸ¥çœ‹çƒå‘˜èµ›å­£æ•°æ®
      </div>
    </div>
  </div>

  <!-- ====================== è”èµ›æ•°æ®é¡µ ====================== -->
  <div class="page" id="league">
    <div class="card">
      <div class="card-title">ğŸ† è”èµ›ç§¯åˆ†æ¦œ</div>
      <div class="card-sub">äº”å¤§è”èµ›å®æ—¶æ’å</div>
    </div>

    <div class="card">
      <div class="select-group">
        <div class="select-label">é€‰æ‹©è”èµ›</div>
        <select id="leagueSelect" class="team-select" onchange="loadRankData()">
          <option value="premier">è‹±è¶…</option>
          <option value="laliga">è¥¿ç”²</option>
          <option value="seriea">æ„ç”²</option>
          <option value="bundes">å¾·ç”²</option>
          <option value="ligue1">æ³•ç”²</option>
        </select>
      </div>

      <div class="rank-row header">
        <div class="rank-num">#</div>
        <div class="rank-team">çƒé˜Ÿ</div>
        <div class="rank-data">èµ›</div>
        <div class="rank-data">èƒœ</div>
        <div class="rank-data">å¹³</div>
        <div class="rank-data">åˆ†</div>
      </div>
      <div id="rankList"></div>
    </div>
  </div>
</div>

<script>
// ====================== å…¨å±€é…ç½® ======================
// ä¸»æµè”èµ›ä¸­è‹±æ–‡æ˜ å°„ï¼ˆåªæ˜¾ç¤ºè¿™äº›è”èµ›çš„èµ›äº‹ï¼‰
const LEAGUE_MAP = {
  "English Premier League": "è‹±è¶…",
  "Spanish La Liga": "è¥¿ç”²",
  "Italian Serie A": "æ„ç”²",
  "German Bundesliga": "å¾·ç”²",
  "French Ligue 1": "æ³•ç”²",
  "UEFA Champions League": "æ¬§å† ",
  "UEFA Europa League": "æ¬§è”",
  "UEFA Europa Conference League": "æ¬§åè”"
};
const SHOW_LEAGUES = Object.keys(LEAGUE_MAP);

const leagueConfig = {
  premier: {name:"è‹±è¶…",teams:["æ›¼åŸ","é˜¿æ£®çº³","åˆ©ç‰©æµ¦","é˜¿æ–¯é¡¿ç»´æ‹‰","çƒ­åˆº","åˆ‡å°”è¥¿","æ›¼è”","çº½å¡æ–¯å°”"]},
  laliga: {name:"è¥¿ç”²",teams:["çš‡é©¬","å·´è¨","é©¬ç«","çš‡å®¶ç¤¾ä¼š","æ¯”åˆ©äºšé›·äºšå°”","å¡ç»´åˆ©äºš"]},
  seriea: {name:"æ„ç”²",teams:["å›½ç±³","å°¤æ–‡","ACç±³å…°","é‚£ä¸å‹’æ–¯","äºšç‰¹å…°å¤§","ç½—é©¬"]},
  bundes: {name:"å¾·ç”²",teams:["æ‹œä»","å¤šç‰¹","å‹’æ²ƒåº“æ£®","è±æ¯”é”¡","æ³•å…°å…‹ç¦","æ²ƒå°”å¤«æ–¯å ¡"]},
  ligue1: {name:"æ³•ç”²",teams:["å·´é»","æ‘©çº³å“¥","é‡Œå°”","é‡Œæ˜‚","é©¬èµ›","é›·æ©"]}
};
const allTeams = [...new Set(Object.values(leagueConfig).flatMap(l=>l.teams))];

// çƒé˜Ÿæ”»é˜²å®åŠ›é…ç½®
const teamPower = {
  "æ›¼åŸ":{att:82,def:80,homeBonus:1.12,league:"è‹±è¶…"},
  "é˜¿æ£®çº³":{att:78,def:81,homeBonus:1.1,league:"è‹±è¶…"},
  "åˆ©ç‰©æµ¦":{att:80,def:77,homeBonus:1.11,league:"è‹±è¶…"},
  "æ›¼è”":{att:74,def:72,homeBonus:1.08,league:"è‹±è¶…"},
  "åˆ‡å°”è¥¿":{att:73,def:75,homeBonus:1.08,league:"è‹±è¶…"},
  "çƒ­åˆº":{att:76,def:70,homeBonus:1.07,league:"è‹±è¶…"},
  "é˜¿æ–¯é¡¿ç»´æ‹‰":{att:72,def:74,homeBonus:1.07,league:"è‹±è¶…"},
  "çº½å¡æ–¯å°”":{att:71,def:73,homeBonus:1.07,league:"è‹±è¶…"},
  "çš‡é©¬":{att:81,def:79,homeBonus:1.12,league:"è¥¿ç”²"},
  "å·´è¨":{att:79,def:78,homeBonus:1.11,league:"è¥¿ç”²"},
  "é©¬ç«":{att:72,def:82,homeBonus:1.1,league:"è¥¿ç”²"},
  "çš‡å®¶ç¤¾ä¼š":{att:70,def:75,homeBonus:1.06,league:"è¥¿ç”²"},
  "æ¯”åˆ©äºšé›·äºšå°”":{att:69,def:72,homeBonus:1.06,league:"è¥¿ç”²"},
  "å¡ç»´åˆ©äºš":{att:68,def:70,homeBonus:1.05,league:"è¥¿ç”²"},
  "æ‹œä»":{att:83,def:78,homeBonus:1.12,league:"å¾·ç”²"},
  "å¤šç‰¹":{att:78,def:73,homeBonus:1.09,league:"å¾·ç”²"},
  "å‹’æ²ƒåº“æ£®":{att:75,def:76,homeBonus:1.08,league:"å¾·ç”²"},
  "è±æ¯”é”¡":{att:74,def:74,homeBonus:1.08,league:"å¾·ç”²"},
  "æ³•å…°å…‹ç¦":{att:70,def:71,homeBonus:1.06,league:"å¾·ç”²"},
  "æ²ƒå°”å¤«æ–¯å ¡":{att:68,def:70,homeBonus:1.05,league:"å¾·ç”²"},
  "å›½ç±³":{att:77,def:80,homeBonus:1.1,league:"æ„ç”²"},
  "å°¤æ–‡":{att:73,def:78,homeBonus:1.09,league:"æ„ç”²"},
  "ACç±³å…°":{att:75,def:74,homeBonus:1.09,league:"æ„ç”²"},
  "é‚£ä¸å‹’æ–¯":{att:74,def:73,homeBonus:1.08,league:"æ„ç”²"},
  "äºšç‰¹å…°å¤§":{att:76,def:70,homeBonus:1.07,league:"æ„ç”²"},
  "ç½—é©¬":{att:72,def:72,homeBonus:1.07,league:"æ„ç”²"},
  "å·´é»":{att:82,def:76,homeBonus:1.11,league:"æ³•ç”²"},
  "æ‘©çº³å“¥":{att:75,def:72,homeBonus:1.08,league:"æ³•ç”²"},
  "é‡Œå°”":{att:70,def:74,homeBonus:1.07,league:"æ³•ç”²"},
  "é‡Œæ˜‚":{att:72,def:70,homeBonus:1.07,league:"æ³•ç”²"},
  "é©¬èµ›":{att:71,def:71,homeBonus:1.06,league:"æ³•ç”²"},
  "é›·æ©":{att:69,def:70,homeBonus:1.06,league:"æ³•ç”²"}
};

// çƒå‘˜æ•°æ®åº“
const playerData = {
  "æ›¼åŸ": [
    {name:"å“ˆå…°å¾·",pos:"å‰é”‹",apps:35,goals:24,assists:8,yellow:4,rating:8.2},
    {name:"å¾·å¸ƒåŠ³å†…",pos:"ä¸­åœº",apps:32,goals:7,assists:16,yellow:3,rating:7.9},
    {name:"ç¦ç™»",pos:"ä¸­åœº",apps:33,goals:11,assists:9,yellow:2,rating:7.7},
    {name:"ç½—å¾·é‡Œ",pos:"åè…°",apps:34,goals:4,assists:5,yellow:6,rating:7.6},
    {name:"åŸƒå¾·æ£®",pos:"é—¨å°†",apps:35,goals:0,assists:1,yellow:1,rating:7.5}
  ],
  "åˆ©ç‰©æµ¦": [
    {name:"è¨æ‹‰èµ«",pos:"å‰é”‹",apps:34,goals:18,assists:10,yellow:2,rating:7.8},
    {name:"ç´¢åšæ–¯æ´›ä¼Š",pos:"ä¸­åœº",apps:33,goals:8,assists:7,yellow:5,rating:7.6},
    {name:"èŒƒæˆ´å…‹",pos:"åå«",apps:32,goals:3,assists:2,yellow:3,rating:7.7}
  ],
  "é˜¿æ£®çº³": [
    {name:"è¨å¡",pos:"è¾¹é”‹",apps:35,goals:13,assists:10,yellow:3,rating:7.7},
    {name:"å„å¾·é«˜",pos:"ä¸­åœº",apps:34,goals:10,assists:9,yellow:2,rating:7.6},
    {name:"å“ˆå¼—èŒ¨",pos:"å‰é”‹",apps:33,goals:9,assists:5,yellow:4,rating:7.2}
  ],
  "æ›¼è”": [
    {name:"æ‹‰ä»€ç¦å¾·",pos:"å‰é”‹",apps:32,goals:10,assists:6,yellow:5,rating:7.1},
    {name:"Bè´¹",pos:"ä¸­åœº",apps:35,goals:8,assists:10,yellow:7,rating:7.4}
  ],
  "çš‡é©¬": [
    {name:"è´æ—å„å§†",pos:"ä¸­åœº",apps:34,goals:17,assists:8,yellow:5,rating:8.1},
    {name:"ç»´å°¼ä¿®æ–¯",pos:"å‰é”‹",apps:31,goals:14,assists:8,yellow:6,rating:7.9}
  ],
  "å·´è¨": [
    {name:"è±ä¸‡",pos:"å‰é”‹",apps:32,goals:19,assists:6,yellow:3,rating:7.7},
    {name:"äºšé©¬å°”",pos:"è¾¹é”‹",apps:34,goals:6,assists:8,yellow:2,rating:7.6}
  ],
  "æ‹œä»": [
    {name:"å‡¯æ©",pos:"å‰é”‹",apps:34,goals:26,assists:8,yellow:2,rating:8.0},
    {name:"ç©†è¥¿äºšæ‹‰",pos:"ä¸­åœº",apps:32,goals:10,assists:9,yellow:3,rating:7.8}
  ],
  "å·´é»": [
    {name:"å§†å·´ä½©",pos:"å‰é”‹",apps:33,goals:24,assists:9,yellow:4,rating:8.1},
    {name:"ç™»è´è±",pos:"è¾¹é”‹",apps:32,goals:7,assists:10,yellow:5,rating:7.5}
  ],
  "å›½ç±³": [
    {name:"åŠ³å¡”ç½—",pos:"å‰é”‹",apps:34,goals:20,assists:6,yellow:5,rating:7.9},
    {name:"å·´é›·æ‹‰",pos:"ä¸­åœº",apps:33,goals:5,assists:7,yellow:4,rating:7.5}
  ],
  "å°¤æ–‡": [
    {name:"å¼—æ‹‰éœç»´å¥‡",pos:"å‰é”‹",apps:33,goals:15,assists:3,yellow:4,rating:7.4},
    {name:"åŸºè€¶è¨",pos:"è¾¹é”‹",apps:32,goals:8,assists:6,yellow:5,rating:7.3}
  ]
};

// è”èµ›ç§¯åˆ†æ¦œæ•°æ®åº“
const rankData = {
  premier: [
    {team:"æ›¼åŸ",played:25,win:20,draw:3,lose:2,points:63},
    {team:"é˜¿æ£®çº³",played:25,win:18,draw:4,lose:3,points:58},
    {team:"åˆ©ç‰©æµ¦",played:25,win:17,draw:5,lose:3,points:56},
    {team:"é˜¿æ–¯é¡¿ç»´æ‹‰",played:25,win:16,draw:3,lose:6,points:51},
    {team:"çƒ­åˆº",played:25,win:13,draw:4,lose:8,points:43},
    {team:"åˆ‡å°”è¥¿",played:25,win:12,draw:5,lose:8,points:41},
    {team:"æ›¼è”",played:25,win:11,draw:3,lose:11,points:36}
  ],
  laliga: [
    {team:"çš‡é©¬",played:24,win:20,draw:2,lose:2,points:62},
    {team:"å·´è¨",played:24,win:18,draw:3,lose:3,points:57},
    {team:"é©¬ç«",played:24,win:15,draw:4,lose:5,points:49},
    {team:"çš‡å®¶ç¤¾ä¼š",played:24,win:12,draw:6,lose:6,points:42}
  ],
  seriea: [
    {team:"å›½ç±³",played:24,win:19,draw:3,lose:2,points:60},
    {team:"å°¤æ–‡",played:24,win:16,draw:5,lose:3,points:53},
    {team:"ACç±³å…°",played:24,win:15,draw:4,lose:5,points:49}
  ],
  bundes: [
    {team:"æ‹œä»",played:22,win:17,draw:3,lose:2,points:54},
    {team:"å¤šç‰¹",played:22,win:14,draw:4,lose:4,points:46},
    {team:"å‹’æ²ƒåº“æ£®",played:22,win:13,draw:5,lose:4,points:44}
  ],
  ligue1: [
    {team:"å·´é»",played:23,win:19,draw:3,lose:1,points:60},
    {team:"æ‘©çº³å“¥",played:23,win:14,draw:4,lose:5,points:46},
    {team:"é‡Œå°”",played:23,win:12,draw:5,lose:6,points:41}
  ]
};

// ====================== ã€æ ¸å¿ƒæ–°å¢ã€‘æ¯æ—¥çœŸå®èµ›äº‹åŠ è½½å‡½æ•° ======================
function loadTodayRealMatches() {
  // è·å–ä»Šæ—¥æ—¥æœŸï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰
  const today = new Date();
  const dateStr = today.getFullYear() + "-" + String(today.getMonth()+1).padStart(2,'0') + "-" + String(today.getDate()).padStart(2,'0');
  document.getElementById('todayDate').innerText = dateStr;

  // æ¥å£åœ°å€ï¼šæŒ‰æ—¥æœŸè·å–è¶³çƒèµ›äº‹
  const apiUrl = `https://www.thesportsdb.com/api/v1/json/3/eventsday.php?d=${dateStr}&s=Soccer`;

  // è·å–DOMå…ƒç´ 
  const loadingBox = document.getElementById('matchLoading');
  const container = document.getElementById('matchContainer');
  const emptyBox = document.getElementById('matchEmpty');
  const errorBox = document.getElementById('matchError');

  // é‡ç½®çŠ¶æ€
  loadingBox.style.display = 'block';
  container.style.display = 'none';
  emptyBox.style.display = 'none';
  errorBox.style.display = 'none';

  // è°ƒç”¨API
  fetch(apiUrl)
    .then(res => res.json())
    .then(data => {
      loadingBox.style.display = 'none';
      
      // æ— èµ›äº‹æ•°æ®
      if(!data.events || data.events.length === 0) {
        emptyBox.style.display = 'block';
        return;
      }

      // è¿‡æ»¤ä¸»æµè”èµ›
      const filterEvents = data.events.filter(event => SHOW_LEAGUES.includes(event.strLeague));
      if(filterEvents.length === 0) {
        emptyBox.style.display = 'block';
        return;
      }

      // æŒ‰çŠ¶æ€åˆ†ç±»èµ›äº‹
      const liveEvents = filterEvents.filter(e => e.strStatus === "In Progress");
      const upcomingEvents = filterEvents.filter(e => !["In Progress","Match Finished"].includes(e.strStatus));
      const endEvents = filterEvents.filter(e => e.strStatus === "Match Finished");

      // æ¸²æŸ“èµ›äº‹HTML
      let html = '';
      
      // ç›´æ’­ä¸­èµ›äº‹
      if(liveEvents.length > 0) {
        html += '<div class="match-block-title">ğŸ”´ ç›´æ’­ä¸­</div>';
        liveEvents.forEach(event => {
          const homeTeam = event.strHomeTeam;
          const awayTeam = event.strAwayTeam;
          const homeScore = event.intHomeScore || 0;
          const awayScore = event.intAwayScore || 0;
          const league = LEAGUE_MAP[event.strLeague] || event.strLeague;
          
          html += `
          <div class="match-card">
            <div class="match-header">
              <div class="match-league">${league}</div>
              <div class="match-status live">ç›´æ’­ä¸­</div>
            </div>
            <div class="match-team-row">
              <div class="match-team">${homeTeam}</div>
              <div class="match-score live">${homeScore} - ${awayScore}</div>
              <div class="match-team">${awayTeam}</div>
            </div>
          </div>`;
        });
      }

      // ä»Šæ—¥æœªå¼€èµ›
      if(upcomingEvents.length > 0) {
        html += '<div class="match-block-title">â° ä»Šæ—¥æœªå¼€èµ›</div>';
        upcomingEvents.forEach(event => {
          const homeTeam = event.strHomeTeam;
          const awayTeam = event.strAwayTeam;
          const league = LEAGUE_MAP[event.strLeague] || event.strLeague;
          // è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼Œåªä¿ç•™æ—¶:åˆ†
          const matchTime = event.strTime ? event.strTime.slice(0,5) : 'å¾…å®š';
          
          html += `
          <div class="match-card">
            <div class="match-header">
              <div class="match-league">${league}</div>
              <div class="match-time">${matchTime} å¼€èµ›</div>
            </div>
            <div class="match-team-row">
              <div class="match-team">${homeTeam}</div>
              <div class="match-score">VS</div>
              <div class="match-team">${awayTeam}</div>
            </div>
          </div>`;
        });
      }

      // å·²å®Œèµ›
      if(endEvents.length > 0) {
        html += '<div class="match-block-title">âœ… å·²å®Œèµ›</div>';
        endEvents.forEach(event => {
          const homeTeam = event.strHomeTeam;
          const awayTeam = event.strAwayTeam;
          const homeScore = event.intHomeScore || 0;
          const awayScore = event.intAwayScore || 0;
          const league = LEAGUE_MAP[event.strLeague] || event.strLeague;
          
          html += `
          <div class="match-card">
            <div class="match-header">
              <div class="match-league">${league}</div>
              <div class="match-status end">å·²å®Œèµ›</div>
            </div>
            <div class="match-team-row">
              <div class="match-team">${homeTeam}</div>
              <div class="match-score end">${homeScore} - ${awayScore}</div>
              <div class="match-team">${awayTeam}</div>
            </div>
          </div>`;
        });
      }

      // æ’å…¥åˆ°å®¹å™¨
      container.innerHTML = html;
      container.style.display = 'block';
    })
    .catch(err => {
      // åŠ è½½å¤±è´¥å¤„ç†
      console.error('èµ›äº‹åŠ è½½å¤±è´¥', err);
      loadingBox.style.display = 'none';
      errorBox.style.display = 'block';
    });
}

// ====================== é¡µé¢åˆå§‹åŒ– ======================
function initPage() {
  // åˆå§‹åŒ–çƒé˜Ÿä¸‹æ‹‰æ¡†
  const selectElements = [
    document.getElementById('recHome'),
    document.getElementById('recAway'),
    document.getElementById('homeTeam'),
    document.getElementById('awayTeam'),
    document.getElementById('playerTeam')
  ];
  selectElements.forEach(sel => {
    let html = '<option value="">è¯·é€‰æ‹©çƒé˜Ÿ</option>';
    for (let league in leagueConfig) {
      html += `<optgroup label="${leagueConfig[league].name}">`;
      leagueConfig[league].teams.forEach(team => {
        html += `<option value="${team}">${team}</option>`;
      });
      html += `</optgroup>`;
    }
    sel.innerHTML = html;
  });

  // åŠ è½½ç§¯åˆ†æ¦œ
  loadRankData();
  // ã€æ ¸å¿ƒã€‘åŠ è½½ä»Šæ—¥çœŸå®èµ›äº‹
  loadTodayRealMatches();
}

// ====================== é¡µé¢åˆ‡æ¢å‡½æ•° ======================
function go(page) {
  if(matchInterval) {
    clearInterval(matchInterval);
    matchInterval = null;
  }
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById(page).classList.add('active');
  const idx = ['home','recommend','ai','simulate','player','league'].indexOf(page);
  document.querySelectorAll('.nav-item')[idx].classList.add('active');
  window.scrollTo(0,0);
}

// ====================== ç§¯åˆ†æ¦œåŠ è½½å‡½æ•° ======================
function loadRankData() {
  const league = document.getElementById('leagueSelect').value;
  const list = document.getElementById('rankList');
  const data = rankData[league];
  list.innerHTML = data.map((item,idx)=>`
    <div class="rank-row">
      <div class="rank-num">${idx+1}</div>
      <div class="rank-team">${item.team}</div>
      <div class="rank-data">${item.played}</div>
      <div class="rank-data">${item.win}</div>
      <div class="rank-data">${item.draw}</div>
      <div class="rank-data">${item.points}</div>
    </div>
  `).join('');
}

// ====================== çƒå‘˜æ•°æ®åŠ è½½å‡½æ•° ======================
function loadPlayerData() {
  const t = document.getElementById('playerTeam').value;
  const list = document.getElementById('playerList');
  if(!t || !playerData[t]){
    list.innerHTML = '<div class="card" style="text-align:center;color:var(--text-gray)">æš‚æ— è¯¥çƒé˜Ÿæ•°æ®</div>';
    return;
  }
  list.innerHTML = `
    <div class="card">
      <div class="player-header">
        <div>çƒå‘˜</div>
        <div>å‡ºåœº</div>
        <div>è¿›çƒ</div>
        <div>åŠ©æ”»</div>
        <div>é»„ç‰Œ</div>
        <div>è¯„åˆ†</div>
      </div>
      ${playerData[t].map(p=>`
        <div class="player-row">
          <div class="player-name">${p.name} <span class="player-pos">${p.pos}</span></div>
          <div class="player-stat">${p.apps}</div>
          <div class="player-stat">${p.goals}</div>
          <div class="player-stat">${p.assists}</div>
          <div class="player-stat">${p.yellow}</div>
          <div class="player-stat" style="color:var(--warning)">${p.rating}</div>
        </div>
      `).join('')}
    </div>
  `;
}

// ====================== æ³Šæ¾ç®—æ³• çœŸå®æ¯”åˆ†æ ¡å‡†ç‰ˆ ======================
function getTeamPower(team) {
  return teamPower[team] || {att:65,def:65,homeBonus:1.05,league:"æœªçŸ¥"};
}

function poissonGoal(att, def, homeBonus=1, isHome=true) {
  const baseAtt = isHome ? (att / 100) * homeBonus : (att / 100) * 0.95;
  const defFactor = (100 - def) / 100;
  const Î» = baseAtt * defFactor * 1.3;
  
  let p = 1, k = 0;
  const L = Math.exp(-Î»);
  while (p > L) { 
    p *= Math.random(); 
    k++; 
  }

  if(k >= 4 && Math.random() < 0.7) k = 3;
  if(k >= 5) k = 4;
  return Math.min(k, 5);
}

function getRealScore(home, away) {
  const hPower = getTeamPower(home);
  const aPower = getTeamPower(away);
  const hg = poissonGoal(hPower.att, aPower.def, hPower.homeBonus, true);
  const ag = poissonGoal(aPower.att, hPower.def, 1, false);
  return `${hg}-${ag}`;
}

// ====================== AIæ¨èç”Ÿæˆå‡½æ•° ======================
function genRecommend() {
  const h = document.getElementById('recHome').value;
  const a = document.getElementById('recAway').value;
  if (!h || !a || h === a) {
    alert('è¯·é€‰æ‹©ä¸¤æ”¯ä¸åŒçš„çƒé˜Ÿ');
    return;
  }

  const btn = document.getElementById('recBtn');
  btn.innerHTML = '<span class="loading"></span> ç”Ÿæˆä¸­...';
  btn.disabled = true;

  setTimeout(()=>{
    let count = {};
    let win = 0, draw = 0, lose = 0, totalGoal = 0;
    const hPower = getTeamPower(h);
    const aPower = getTeamPower(a);

    for (let i = 0; i < 10000; i++) {
      const hg = poissonGoal(hPower.att, aPower.def, hPower.homeBonus, true);
      const ag = poissonGoal(aPower.att, hPower.def, 1, false);
      const s = `${hg}-${ag}`;
      count[s] = (count[s] || 0) + 1;
      totalGoal += hg + ag;
      if (hg > ag) win++;
      else if (hg === ag) draw++;
      else lose++;
    }

    const top6 = Object.entries(count).sort((x,y)=>y[1]-x[1]).slice(0,6);
    const winRate = (win/100).toFixed(1);
    const drawRate = (draw/100).toFixed(1);
    const loseRate = (lose/100).toFixed(1);
    const avgGoal = (totalGoal/10000).toFixed(1);
    const ouResult = avgGoal >= 2.5 ? 'å¤§çƒ(2.5)' : 'å°çƒ(2.5)';
    const winResult = winRate > drawRate && winRate > loseRate ? `ä¸»èƒœ ${h}` : 
                      loseRate > winRate && loseRate > drawRate ? `å®¢èƒœ ${a}` : 'å¹³å±€';

    document.getElementById('recBaseInfo').innerHTML = `
      <strong>${h}</strong> ä¸»åœºæ”»é˜²å®åŠ›ï¼šè¿›æ”»${hPower.att}ï¼Œé˜²å®ˆ${hPower.def}ï¼Œä¸»åœºåŠ æˆ${hPower.homeBonus}å€<br>
      <strong>${a}</strong> å®¢åœºæ”»é˜²å®åŠ›ï¼šè¿›æ”»${aPower.att}ï¼Œé˜²å®ˆ${aPower.def}<br>
      åŸºäºäº”å¤§è”èµ›çœŸå®èµ›äº‹æ¨¡å‹ï¼Œé€šè¿‡10000æ¬¡è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿï¼Œç”Ÿæˆä»¥ä¸‹ä¸“ä¸šå‚è€ƒæ•°æ®ã€‚
    `;

    document.getElementById('winBar').style.width = winRate + '%';
    document.getElementById('drawBar').style.width = drawRate + '%';
    document.getElementById('loseBar').style.width = loseRate + '%';
    document.getElementById('winProb').innerText = winRate + '%';
    document.getElementById('drawProb').innerText = drawRate + '%';
    document.getElementById('loseProb').innerText = loseRate + '%';

    document.getElementById('recWin').innerText = winResult;
    document.getElementById('recOU').innerText = ouResult;
    document.getElementById('recGoal').innerText = avgGoal;

    document.getElementById('recScoreList').innerHTML = top6.map(([s,c])=>`
      <div class="result-item">
        <div class="result-team">${h} vs ${a}</div>
        <div class="result-score">${s.replace('-',' : ')}</div>
        <div class="result-prob">${(c/100).toFixed(2)}%</div>
      </div>
    `).join('');

    document.getElementById('recResultPanel').style.display = 'block';
    btn.innerHTML = 'ç«‹å³ç”ŸæˆAIæ¨è';
    btn.disabled = false;
  },800);
}

// ====================== æ¨¡æ‹ŸåŠŸèƒ½å‡½æ•° ======================
function simOne() {
  const h = document.getElementById('homeTeam').value;
  const a = document.getElementById('awayTeam').value;
  if (!h || !a || h === a) return alert('è¯·é€‰æ‹©ä¸¤æ”¯ä¸åŒçƒé˜Ÿ');
  alert(`${h} ${getRealScore(h, a)} ${a}`);
}

function startSim() {
  const h = document.getElementById('homeTeam').value;
  const a = document.getElementById('awayTeam').value;
  if (!h || !a || h === a) return alert('è¯·é€‰æ‹©ä¸¤æ”¯ä¸åŒçƒé˜Ÿ');

  let count = {};
  let win = 0, draw = 0, lose = 0, totalGoal = 0;

  for (let i = 0; i < 10000; i++) {
    const s = getRealScore(h, a);
    count[s] = (count[s] || 0) + 1;
    const [hg, ag] = s.split('-').map(Number);
    totalGoal += hg + ag;
    if (hg > ag) win++;
    else if (hg === ag) draw++;
    else lose++;
  }

  const top6 = Object.entries(count).sort((x, y) => y[1] - x[1]).slice(0, 6);
  document.getElementById('resultList').innerHTML = top6.map(([s, c]) => `
    <div class="result-item">
      <div class="result-score">${s.replace('-', ' : ')}</div>
      <div class="result-prob">${(c / 100).toFixed(2)}%</div>
    </div>
  `).join('');

  document.getElementById('resultCard').style.display = 'block';
}

// ====================== å®æ—¶ç›´æ’­æ¨¡æ‹Ÿå‡½æ•° ======================
let matchInterval = null;
function startMatch() {
  const H = document.getElementById('homeTeam').value;
  const A = document.getElementById('awayTeam').value;
  if (!H || !A || H === A) { alert("è¯·é€‰æ‹©ä¸¤æ”¯ä¸åŒçƒé˜Ÿ"); return; }
  if(matchInterval) clearInterval(matchInterval);

  const live = document.getElementById("matchLive");
  const lt = document.getElementById("liveTime");
  const ls = document.getElementById("liveScore");
  const le = document.getElementById("liveEvent");
  const timeline = document.getElementById("liveTimeline");
  document.getElementById("liveHomeName").innerText = H;
  document.getElementById("liveAwayName").innerText = A;
  
  live.style.display = "block";
  timeline.innerHTML = '';
  const final = getRealScore(H, A);
  const fH = Number(final.split("-")[0]);
  const fA = Number(final.split("-")[1]);
  const hPower = getTeamPower(H);
  const aPower = getTeamPower(A);

  let h = 0, a = 0, time = 0;
  let poss = hPower.homeBonus > 1.1 ? 55 : 50;
  let hShot = 0, aShot = 0, hOnT = 0, aOnT = 0;
  let hCorner = 0, aCorner = 0, hFoul = 0, aFoul = 0;
  let hYellow = 0, aYellow = 0;
  let subCount = 0;

  ls.innerText = "0 - 0";
  lt.innerText = "0'";
  le.innerText = "æ¯”èµ›å¼€å§‹";
  addTimeline(0, "æ¯”èµ›æ­£å¼å¼€å§‹");

  function updateStats() {
    document.getElementById("homePoss").innerText = Math.round(poss) + "%";
    document.getElementById("awayPoss").innerText = (100 - Math.round(poss)) + "%";
    document.getElementById("homePossBar").style.width = poss + "%";
    document.getElementById("awayPossBar").style.width = (100 - poss) + "%";
    document.getElementById("homeShot").innerText = hShot;
    document.getElementById("awayShot").innerText = aShot;
    document.getElementById("homeOnT").innerText = hOnT;
    document.getElementById("awayOnT").innerText = aOnT;
    document.getElementById("homeCorner").innerText = hCorner;
    document.getElementById("awayCorner").innerText = aCorner;
    document.getElementById("homeFoul").innerText = hFoul;
    document.getElementById("awayFoul").innerText = aFoul;
    document.getElementById("homeYellow").innerText = hYellow;
    document.getElementById("awayYellow").innerText = aYellow;
  }
  updateStats();

  function addTimeline(time, text) {
    const div = document.createElement('div');
    div.className = 'timeline-item';
    div.innerHTML = `<span class="timeline-time">${time}'</span><span>${text}</span>`;
    timeline.prepend(div);
  }

  matchInterval = setInterval(() => {
    time++;
    lt.innerText = `${time}'`;

    if (time === 45) {
      le.innerText = "â¸ï¸ åŠåœºç»“æŸ";
      addTimeline(45, "åŠåœºç»“æŸï¼Œæ¯”åˆ† " + h + "-" + a);
    }
    if (time === 46) {
      le.innerText = "â–¶ï¸ ä¸‹åŠåœºå¼€å§‹";
      addTimeline(46, "ä¸‹åŠåœºæ¯”èµ›å¼€å§‹");
    }

    poss = Math.max(40, Math.min(65, poss + (Math.random() - 0.5) * 2));

    if (Math.random() < 0.15) {
      const r = Math.random();
      const isHomeEvent = Math.random() < poss/100;

      if (r < 0.2) {
        isHomeEvent ? hFoul++ : aFoul++;
        le.innerText = isHomeEvent ? `${H} çŠ¯è§„` : `${A} çŠ¯è§„`;
      } else if (r < 0.35) {
        isHomeEvent ? hCorner++ : aCorner++;
        le.innerText = isHomeEvent ? `${H} è·å¾—è§’çƒ` : `${A} è·å¾—è§’çƒ`;
        addTimeline(time, le.innerText);
      } else if (r < 0.48) {
        isHomeEvent ? (hFoul++, hYellow++) : (aFoul++, aYellow++);
        le.innerText = isHomeEvent ? `ğŸŸ¨ ${H} çƒå‘˜é»„ç‰Œè­¦å‘Š` : `ğŸŸ¨ ${A} çƒå‘˜é»„ç‰Œè­¦å‘Š`;
        addTimeline(time, le.innerText);
      } else if (r < 0.6 && subCount < 5) {
        subCount++;
        le.innerText = isHomeEvent ? `ğŸ”„ ${H} æ¢äººè°ƒæ•´` : `ğŸ”„ ${A} æ¢äººè°ƒæ•´`;
        addTimeline(time, le.innerText);
      } else if (r < 0.8) {
        isHomeEvent ? hShot++ : aShot++;
        if (Math.random() < 0.35) isHomeEvent ? hOnT++ : aOnT++;
        le.innerText = isHomeEvent ? `ğŸ”¥ ${H} å®Œæˆå°„é—¨` : `ğŸ”¥ ${A} å®Œæˆå°„é—¨`;
      }
    }

    const canGoal = (time >= 15 && time <= 42) || (time >= 50 && time <= 88);
    if (canGoal && (h < fH || a < fA) && Math.random() < 0.08) {
      if (h < fH && (Math.random() < poss/100 || a >= fA)) {
        h++; hShot++; hOnT++;
        le.innerText = `âš½ GOOOOOALï¼${H} è¿›çƒï¼`;
        addTimeline(time, `${H} è¿›çƒï¼å½“å‰æ¯”åˆ† ${h}-${a}`);
      } else if (a < fA) {
        a++; aShot++; aOnT++;
        le.innerText = `âš½ GOOOOOALï¼${A} è¿›çƒï¼`;
        addTimeline(time, `${A} è¿›çƒï¼å½“å‰æ¯”åˆ† ${h}-${a}`);
      }
      ls.innerText = `${h} - ${a}`;
    }

    updateStats();

    if (time >= 90) {
      clearInterval(matchInterval);
      lt.innerText = "90+' å®Œåœº";
      le.innerText = `ğŸ å…¨åœºæ¯”èµ›ç»“æŸ ${H} ${h}-${a} ${A}`;
      addTimeline(90, `å…¨åœºæ¯”èµ›ç»“æŸï¼Œæœ€ç»ˆæ¯”åˆ† ${h}-${a}`);
      matchInterval = null;
    }
  }, 150);
}

// ====================== è¶…çº§AIå¯¹è¯å‡½æ•° ======================
function sendChat() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  const box = document.getElementById('chatBox');
  
  box.innerHTML += `<div class="msg msg-user">${text}</div>`;
  input.value = '';
  box.scrollTop = box.scrollHeight;

  setTimeout(() => {
    let ans = '';
    const lowerText = text.toLowerCase();
    
    const helloKeywords = ['ä½ å¥½','æ‚¨å¥½','hi','hello','åœ¨å—','åœ¨ä¸åœ¨','å“ˆå–½','å—¨'];
    const isHello = helloKeywords.some(key=>lowerText.includes(key));
    if (isHello) {
      ans = `ä½ å¥½ï¼æˆ‘æ˜¯è¶…çº§è¶³çƒAIï¼Œå·²æ¥å…¥å…¨çƒäº”å¤§è”èµ›çœŸå®èµ›äº‹æ¨¡å‹ï¼Œæˆ‘å¯ä»¥å¸®ä½ ï¼š
1. èµ›äº‹èƒœç‡/æ¯”åˆ†/å¤§å°çƒæ·±åº¦åˆ†æ
2. çƒé˜Ÿ/çƒå‘˜èµ›å­£è¯¦ç»†æ•°æ®æŸ¥è¯¢
3. èµ›äº‹æ¨¡æ‹Ÿä¸ä¸“ä¸šç©æ³•æ¨è
4. è”èµ›ç§¯åˆ†æ¦œ/æ”»é˜²æ¦œæ•°æ®æŸ¥è¯¢

ä½ å¯ä»¥ç›´æ¥å‘Šè¯‰æˆ‘å¯¹é˜µçš„çƒé˜Ÿï¼ˆæ¯”å¦‚â€œæ›¼åŸvsæ›¼è”â€ï¼‰ï¼Œæˆ–è€…æƒ³æŸ¥è¯¢çš„çƒé˜Ÿ/çƒå‘˜ï¼Œæˆ‘ä¼šä¸ºä½ ç”Ÿæˆä¸“ä¸šåˆ†æã€‚`;
    } 
    
    else {
      const matchTeams = allTeams.filter(team=> lowerText.includes(team.toLowerCase()));
      
      if (matchTeams.length === 1) {
        const team = matchTeams[0];
        const power = getTeamPower(team);
        const players = playerData[team] ? playerData[team].sort((a,b)=>b.rating-a.rating) : [];
        const topPlayer = players[0];
        
        let rankInfo = 'æš‚æ— æ’åæ•°æ®';
        for (let league in rankData) {
          const rankItem = rankData[league].find(item=>item.team === team);
          if (rankItem) {
            rankInfo = `${leagueConfig[league].name}ç¬¬${rankData[league].findIndex(item=>item.team === team)+1}åï¼Œ${rankItem.played}æˆ˜${rankItem.win}èƒœ${rankItem.draw}å¹³${rankItem.lose}è´Ÿï¼Œç§¯${rankItem.points}åˆ†`;
            break;
          }
        }

        ans = `ã€${team} çƒé˜Ÿä¸“ä¸šæ•°æ®ã€‘
ğŸ† è”èµ›æ’åï¼š${rankInfo}
âš”ï¸ æ”»é˜²å®åŠ›ï¼šè¿›æ”»${power.att}ï¼Œé˜²å®ˆ${power.def}ï¼Œä¸»åœºåŠ æˆ${power.homeBonus}å€
â­ èµ›å­£æ ¸å¿ƒçƒå‘˜ï¼š${topPlayer.name}ï¼ˆ${topPlayer.pos}ï¼‰
  å‡ºåœºï¼š${topPlayer.apps}æ¬¡ | è¿›çƒï¼š${topPlayer.goals} | åŠ©æ”»ï¼š${topPlayer.assists} | èµ›å­£è¯„åˆ†ï¼š${topPlayer.rating}

ä½ å¯ä»¥å‘Šè¯‰æˆ‘è¯¥çƒé˜Ÿçš„å¯¹é˜µå¯¹æ‰‹ï¼Œæˆ‘ä¼šä¸ºä½ ç”Ÿæˆèƒœç‡ä¸æ¯”åˆ†é¢„æµ‹ã€‚`;
      }

      else if (matchTeams.length >= 2) {
        const h = matchTeams[0], a = matchTeams[1];
        let win=0, draw=0, lose=0, totalGoal=0;
        let count = {};

        for(let i=0;i<10000;i++){
          const [hg,ag] = getRealScore(h,a).split('-').map(Number);
          const s = `${hg}-${ag}`;
          count[s] = (count[s]||0)+1;
          totalGoal += hg+ag;
          if(hg>ag)win++;else if(hg===ag)draw++;else lose++;
        }

        const top3 = Object.entries(count).sort((x,y)=>y[1]-x[1]).slice(0,3);
        const winRate = (win/100).toFixed(1);
        const drawRate = (draw/100).toFixed(1);
        const loseRate = (lose/100).toFixed(1);
        const avgGoal = (totalGoal/10000).toFixed(2);
        const ouResult = avgGoal >= 2.5 ? 'å¤§çƒ(2.5)' : 'å°çƒ(2.5)';
        const winResult = winRate > drawRate && winRate > loseRate ? `ä¸»èƒœ ${h}` : 
                          loseRate > winRate && loseRate > drawRate ? `å®¢èƒœ ${a}` : 'å¹³å±€';

        ans = `ã€${h} vs ${a} ä¸“ä¸šæ·±åº¦åˆ†æã€‘
ğŸ“ˆ èƒœå¹³è´Ÿæ¦‚ç‡
${h} èƒœç‡ï¼š${winRate}%
å¹³å±€æ¦‚ç‡ï¼š${drawRate}%
${a} èƒœç‡ï¼š${loseRate}%
èƒœè´Ÿæ¨èï¼š${winResult}

ğŸ² æ ¸å¿ƒæ•°æ®
åœºå‡é¢„æœŸè¿›çƒï¼š${avgGoal}çƒ
å¤§å°çƒæ¨èï¼š${ouResult}

ğŸ† Top3 é«˜æ¦‚ç‡æ¯”åˆ†
${top3.map((s,i)=>`${i+1}. ${s[0]}  æ¦‚ç‡ï¼š${(s[1]/100).toFixed(2)}%`).join('\n')}

æ•°æ®åŸºäºäº”å¤§è”èµ›çœŸå®èµ›äº‹æ¨¡å‹10000æ¬¡è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿç”Ÿæˆï¼Œä»…ä½œå¨±ä¹å‚è€ƒã€‚`;
      }

      else if (lowerText.includes('çƒå‘˜') || lowerText.includes('æ•°æ®')) {
        const teamMatch = Object.keys(playerData).filter(t=>lowerText.includes(t.toLowerCase()));
        if (teamMatch.length > 0) {
          const team = teamMatch[0];
          ans = `ã€${team} çƒå‘˜èµ›å­£æ•°æ®ã€‘
${playerData[team].map(p=>`
${p.name}ï¼ˆ${p.pos}ï¼‰
å‡ºåœºï¼š${p.apps}æ¬¡ | è¿›çƒï¼š${p.goals} | åŠ©æ”»ï¼š${p.assists} | é»„ç‰Œï¼š${p.yellow} | è¯„åˆ†ï¼š${p.rating}`).join('')}

ä½ å¯ä»¥å‘Šè¯‰æˆ‘å…·ä½“çƒå‘˜åï¼ŒæŸ¥è¯¢æ›´è¯¦ç»†æ•°æ®ã€‚`;
        } else {
          ans = 'è¯·å‘Šè¯‰æˆ‘ä½ æƒ³æŸ¥è¯¢çš„çƒé˜Ÿï¼Œæˆ‘å°†ä¸ºä½ å±•ç¤ºè¯¥é˜Ÿçƒå‘˜çš„å®Œæ•´èµ›å­£æ•°æ®ã€‚';
        }
      }

      else {
        ans = `æˆ‘æ²¡æœ‰ç†è§£ä½ çš„é—®é¢˜ï¼Œä½ å¯ä»¥è¿™æ ·é—®æˆ‘ï¼š
1. ç›´æ¥è¾“å…¥å¯¹é˜µçƒé˜Ÿï¼Œæ¯”å¦‚ã€Œæ›¼åŸvsæ›¼è”ã€ï¼Œæˆ‘ä¼šç”Ÿæˆèƒœç‡å’Œæ¯”åˆ†åˆ†æ
2. ç›´æ¥è¾“å…¥çƒé˜Ÿåï¼Œæ¯”å¦‚ã€Œçš‡é©¬ã€ï¼Œæˆ‘ä¼šå±•ç¤ºè¯¥çƒé˜Ÿçš„è¯¦ç»†æ•°æ®
3. è¾“å…¥ã€ŒXXçƒå‘˜æ•°æ®ã€ï¼ŒæŸ¥è¯¢å¯¹åº”çƒå‘˜çš„èµ›å­£è¡¨ç°
4. è¾“å…¥ã€Œè‹±è¶…ç§¯åˆ†æ¦œã€ï¼ŒæŸ¥çœ‹è”èµ›æ’åæ•°æ®`;
      }
    }

    box.innerHTML += `<div class="msg msg-ai">${ans.replace(/\n/g,'<br>')}</div>`;
    box.scrollTop = box.scrollHeight;
  }, 1000);
}
</script>
</body>
</html>
