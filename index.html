<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš½ è‹±è¶…ç§¯åˆ†æ¦œ + AI æ¯”åˆ†é¢„æµ‹</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #333; }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th { background-color: #4CAF50; color: white; }
        select, button {
            padding: 10px;
            font-size: 16px;
            margin: 10px 5px 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover { background-color: #45a049; }
        .prediction-box {
            background: #e3f2fd;
            border-left: 5px solid #2196F3;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .score-prob {
            font-size: 1.1em;
            font-weight: bold;
            color: #0d47a1;
        }
    </style>
</head>
<body>
    <h1>âš½ è‹±è¶…ç§¯åˆ†æ¦œ & AI æ¯”åˆ†é¢„æµ‹</h1>
    
    <div class="container">
        <h2>ğŸ“Š å½“å‰ç§¯åˆ†æ¦œ</h2>
        <div id="loading">åŠ è½½æ•°æ®ä¸­...</div>
        <table id="standings-table" style="display:none;">
            <thead>
                <tr>
                    <th>æ’å</th>
                    <th>çƒé˜Ÿ</th>
                    <th>åœºæ¬¡</th>
                    <th>èƒœ</th>
                    <th>å¹³</th>
                    <th>è´Ÿ</th>
                    <th>è¿›çƒ</th>
                    <th>å¤±çƒ</th>
                    <th>å‡€èƒœçƒ</th>
                    <th>ç§¯åˆ†</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>

    <div class="container">
        <h2>ğŸ¤– AI æ¯”åˆ†é¢„æµ‹ï¼ˆæ³Šæ¾æ¨¡å‹ï¼‰</h2>
        <p>é€‰æ‹©ä¸¤æ”¯çƒé˜Ÿï¼Œé¢„æµ‹èƒœå¹³è´Ÿæ¦‚ç‡åŠæœ€å¯èƒ½æ¯”åˆ†ï¼š</p>
        <div>
            <select id="home-team">
                <option value="">â€” é€‰æ‹©ä¸»é˜Ÿ â€”</option>
            </select>
            <span style="font-weight:bold;"> VS </span>
            <select id="away-team">
                <option value="">â€” é€‰æ‹©å®¢é˜Ÿ â€”</option>
            </select>
            <button onclick="predictMatch()">ğŸ”® é¢„æµ‹</button>
        </div>
        <div id="prediction-result" class="prediction-box" style="display:none;"></div>
    </div>

    <script>
        // æ³Šæ¾æ¦‚ç‡è®¡ç®—å‡½æ•°
        function poissonProb(mean, k) {
            if (mean === 0) return k === 0 ? 1 : 0;
            return Math.exp(-mean) * Math.pow(mean, k) / factorial(k);
        }
        function factorial(n) {
            if (n === 0 || n === 1) return 1;
            return n * factorial(n - 1);
        }

        // é¢„æµ‹ä¸»é˜Ÿã€å®¢é˜Ÿçš„èƒœå¹³è´Ÿæ¦‚ç‡åŠæœ€å¯èƒ½æ¯”åˆ†
        function predictMatch() {
            const homeName = document.getElementById('home-team').value;
            const awayName = document.getElementById('away-team').value;
            if (!homeName || !awayName) {
                alert('è¯·é€‰æ‹©ä¸»é˜Ÿå’Œå®¢é˜Ÿ');
                return;
            }
            if (homeName === awayName) {
                alert('ä¸»é˜Ÿå’Œå®¢é˜Ÿä¸èƒ½ç›¸åŒ');
                return;
            }

            const homeTeam = window.teamsData.find(t => t.name === homeName);
            const awayTeam = window.teamsData.find(t => t.name === awayName);
            if (!homeTeam || !awayTeam) return;

            // æœŸæœ›è¿›çƒï¼ˆä¸»åœºä¼˜åŠ¿+0.2ï¼‰
            const homeExpected = (homeTeam.avg_scored + awayTeam.avg_conceded) / 2 + 0.2;
            const awayExpected = (awayTeam.avg_scored + homeTeam.avg_conceded) / 2;

            // èƒœå¹³è´Ÿæ¦‚ç‡ï¼ˆ0-5çƒï¼‰
            let homeWin = 0, draw = 0, awayWin = 0;
            for (let i = 0; i <= 5; i++) {
                for (let j = 0; j <= 5; j++) {
                    const prob = poissonProb(homeExpected, i) * poissonProb(awayExpected, j);
                    if (i > j) homeWin += prob;
                    else if (i === j) draw += prob;
                    else awayWin += prob;
                }
            }
            // å½’ä¸€åŒ–
            const total = homeWin + draw + awayWin;
            homeWin = (homeWin / total * 100).toFixed(1);
            draw = (draw / total * 100).toFixed(1);
            awayWin = (awayWin / total * 100).toFixed(1);

            // æœ€å¯èƒ½æ¯”åˆ†ï¼ˆå‰3ï¼‰
            let scoreProbs = [];
            for (let i = 0; i <= 4; i++) {
                for (let j = 0; j <= 4; j++) {
                    const prob = poissonProb(homeExpected, i) * poissonProb(awayExpected, j);
                    scoreProbs.push({score: `${i}-${j}`, prob: prob});
                }
            }
            scoreProbs.sort((a, b) => b.prob - a.prob);
            const topScores = scoreProbs.slice(0, 3).map(s => 
                `${s.score} (${(s.prob*100).toFixed(1)}%)`
            ).join(', ');

            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('prediction-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>ğŸ† ${homeName} vs ${awayName}</h3>
                <p style="font-size:1.2em;">
                    <span style="color:#4CAF50;">${homeName} èƒœï¼š${homeWin}%</span> 
                    | å¹³ï¼š${draw}% 
                    | <span style="color:#f44336;">${awayName} èƒœï¼š${awayWin}%</span>
                </p>
                <p>ğŸ“Š æœ€å¯èƒ½æ¯”åˆ†ï¼š${topScores}</p>
                <p style="color:#666; font-size:0.9em;">*åŸºäºæ³Šæ¾åˆ†å¸ƒ+ä¸»åœºä¼˜åŠ¿ï¼Œä»…ä¾›å‚è€ƒ</p>
            `;
        }

        // è·å–æ•°æ®å¹¶æ¸²æŸ“é¡µé¢
        async function loadData() {
            try {
                // åŠ æ—¶é—´æˆ³ç»•è¿‡ CDN ç¼“å­˜
                const timestamp = new Date().getTime();
                const res = await fetch('https://cdn.jsdelivr.net/gh/zxc8011097/zxc8011097.github.io@main/data.json?t=' + timestamp);
                const data = await res.json();
                const teams = data.teams;
                window.teamsData = teams;

                // æ¸²æŸ“ç§¯åˆ†æ¦œ
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';
                teams.forEach(team => {
                    const row = `<tr>
                        <td>${team.position}</td>
                        <td><strong>${team.name}</strong></td>
                        <td>${team.played}</td>
                        <td>${team.won}</td>
                        <td>${team.drawn}</td>
                        <td>${team.lost}</td>
                        <td>${team.goals_for}</td>
                        <td>${team.goals_against}</td>
                        <td>${team.goal_difference}</td>
                        <td><strong>${team.points}</strong></td>
                    </tr>`;
                    tbody.innerHTML += row;
                });

                document.getElementById('loading').style.display = 'none';
                document.getElementById('standings-table').style.display = 'table';

                // å¡«å……ä¸‹æ‹‰æ¡†
                const homeSelect = document.getElementById('home-team');
                const awaySelect = document.getElementById('away-team');
                // æ¸…ç©ºåŸæœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ªæç¤ºé¡¹ï¼‰
                homeSelect.innerHTML = '<option value="">â€” é€‰æ‹©ä¸»é˜Ÿ â€”</option>';
                awaySelect.innerHTML = '<option value="">â€” é€‰æ‹©å®¢é˜Ÿ â€”</option>';
                teams.sort((a,b) => a.name.localeCompare(b.name)).forEach(team => {
                    const option1 = document.createElement('option');
                    option1.value = team.name;
                    option1.textContent = team.name;
                    homeSelect.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = team.name;
                    option2.textContent = team.name;
                    awaySelect.appendChild(option2);
                });

            } catch (err) {
                document.getElementById('loading').innerHTML = 'âŒ åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚';
                console.error(err);
            }
        }

        loadData();
    </script>
</body>
</html>
