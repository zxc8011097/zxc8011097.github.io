<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="keywords" content="è¶³çƒé¢„æµ‹,è¶³çƒåˆ†æ,è¶³çƒAI,èµ›äº‹é¢„æµ‹,ä½“è‚²æ•°æ®,æ¯”åˆ†é¢„æµ‹,è¶³çƒå¤§æ•°æ®">
<meta name="description" content="ä¸“ä¸šè¶³çƒAIåˆ†æç³»ç»Ÿï¼Œæä¾›èµ›äº‹é¢„æµ‹ã€æ¯”åˆ†åˆ†æã€çƒé˜Ÿæ•°æ®ã€å®æ—¶æ¨¡æ‹Ÿï¼Œä»…ä¾›è¶³çƒçˆ±å¥½è€…å¨±ä¹ä½¿ç”¨ã€‚">
<meta name="author" content="football-predict.top">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<title>è¶³çƒAIå¤§æ•°æ®é¢„æµ‹ Â· æ——èˆ°æ»¡é…ç‰ˆ</title>
<!-- å¼•å…¥ Chart.js å’Œ html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"PingFang SC","Microsoft YaHei",sans-serif}
html,body{background:#070b1d;color:#ECECEC;overflow:visible!important;height:auto!important;position:relative!important;touch-action:auto!important;-webkit-overflow-scrolling:touch!important;transition:background 0.3s,color 0.3s}
.container{max-width:480px;margin:0 auto;padding:12px}
.header{text-align:center;padding:16px 0 10px;position:relative}
.header h1{font-size:22px;color:#FFD700;font-weight:600}
.header p{font-size:12px;color:#aab}
#themeToggle,#langToggle{margin-top:8px;padding:8px 16px;border-radius:20px;border:none;background:#165DFF;color:#fff;font-size:13px;cursor:pointer;display:inline-block;margin:4px}
.season-tab{display:flex;gap:8px;margin:10px 0;overflow-x:auto;padding:4px 0}
.season{background:#10182a;color:#ccd;padding:8px 12px;border-radius:10px;font-size:13px;white-space:nowrap;transition:0.2s}
.season.active{background:#165DFF;color:#fff}
.league-scroll{display:flex;gap:8px;overflow-x:auto;padding:6px 0;margin-bottom:12px}
.league-item{background:#131b2e;color:#ccd;padding:10px 14px;border-radius:12px;font-size:14px;white-space:nowrap;transition:0.2s}
.league-item.active{background:#165DFF;color:#fff}
.custom-input{display:flex;gap:8px;margin:10px 0}
.custom-input input{flex:1;background:#151d30;border:none;border-radius:10px;padding:12px 14px;color:#fff;font-size:15px}
.use-custom{background:#2DCE89;color:white;border:none;border-radius:10px;padding:12px 14px;font-size:14px;margin-top:4px;width:100%}
.match-select{margin-bottom:12px}
.match-select select{width:100%;background:#151d30;border:none;border-radius:12px;padding:14px;color:#fff;font-size:15px;margin-bottom:8px}
.match-select select:disabled{opacity:.6}
.data-card{background:#0F1628;border-radius:16px;padding:16px;margin-bottom:12px}
.data-card .title{font-size:14px;color:#aab;margin-bottom:10px}
.ai-score{text-align:center;font-size:40px;color:#FFD700;font-weight:bold;margin:10px 0}
.score-group{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
.score-item{background:#131b2e;border-radius:10px;padding:10px;text-align:center}
.score-item .num{font-size:16px;color:#FFD700}
.score-item .tag{font-size:11px;color:#aab}
.prob-group{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.prob-item{background:#131b2e;border-radius:10px;padding:14px;text-align:center}
.prob-item .num{font-size:18px;color:#fff}
.prob-item .text{font-size:11px;color:#aab}
.btn-group{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:16px 0}
.btn{padding:16px;border-radius:14px;border:none;font-size:15px}
.btn-blue{background:#165DFF;color:#fff}
.btn-green{background:#00B42A;color:#fff}
.btn-orange{background:#FF8C00;color:#fff}
.sim-box{background:#0C1322;border-radius:16px;padding:18px;margin-top:12px;text-align:center}
.sim-time{color:#4096FF;font-size:14px;margin-bottom:8px}
.sim-score{font-size:34px;color:#fff;margin:8px 0}
.sim-event{color:#c0c8d;font-size:13px;min-height:36px;line-height:1.4}
.sim-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:12px;font-size:12px;color:#ccc}
.sim-stats .stat-item{background:#131b2e;padding:6px;border-radius:6px}
.power-bar{height:6px;background:#151d30;border-radius:3px;overflow:hidden;margin-top:6px}
.power-bar .bar{height:100%;background:#165DFF;transition:width 0.8s}
.match-info{background:#131b2e;border-radius:12px;padding:10px 14px;margin-bottom:10px;font-size:13px;color:#c0c8d}
.recent-box{background:#131b2e;border-radius:10px;padding:10px;margin-top:8px;font-size:12px;color:#aab}
.record{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;font-size:12px;}
.record span{padding:3px 6px;border-radius:4px;background:#151d30;color:#fff;}
.record .win{background:#00B42A;}
.record .draw{background:#FFA500;}
.record .lose{background:#FF4D4F;}
.vs-record{font-size:12px;color:#ccc;background:#131b2e;padding:10px;border-radius:10px;margin-top:8px;line-height:1.5}
.hot-box{display:flex;justify-content:space-between;font-size:12px;color:#ccc;margin-top:8px}
.accuracy-box{background:#131b2e;border-radius:12px;padding:12px 14px;margin-top:12px;text-align:center;font-size:13px;color:#ccc;border-left:3px solid #165DFF;}
.ai-confidence{background:#131b2e;border-radius:12px;padding:10px 14px;margin-top:8px;text-align:center;font-size:14px;font-weight:bold;color:#FFD700;}
.league-note{background:#151d30;border-radius:10px;padding:8px 12px;margin-top:8px;font-size:12px;color:#ccc;text-align:center;}
.home-away-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;font-size:12px;color:#ccc;}
.home-away-stats .stat-item{background:#131b2e;padding:10px;border-radius:10px;text-align:center;}
.pro-detail{background:#131b2e;border-radius:12px;padding:12px;margin-top:12px;font-size:12px;color:#ddd;line-height:1.6}
.pro-detail .item{display:flex;justify-content:space-between;margin-bottom:4px}
.pro-detail .label{color:#aab}
.pro-detail .value{color:#FFD700;font-weight:bold}
.real-data{background:#0f1628;border-radius:12px;padding:12px;margin-top:12px}
.real-data .title{font-size:13px;color:#FFD700;margin-bottom:8px}
.real-data .table{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;font-size:11px}
.real-data .table-item{background:#131b2e;padding:6px;border-radius:6px;text-align:center}
.injury-info{background:#151d30;border-radius:10px;padding:10px;margin-top:8px;font-size:12px;color:#f88}
.schedule-box{background:#0c1322;border-radius:10px;padding:8px;margin-top:10px;font-size:11px;max-height:120px;overflow-y:auto}
.schedule-item{display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid #222e40}
.lineup-box{background:#0c1322;border-radius:10px;padding:8px;margin-top:10px;font-size:11px;display:flex;justify-content:space-between}
.lineup-box div{width:48%}
.lineup-box .home-lineup{color:#4096FF}
.lineup-box .away-lineup{color:#FF4D4F}
.rating-box{background:#0c1322;border-radius:10px;padding:8px;margin-top:8px;font-size:11px;display:flex;flex-direction:column;gap:4px}
.rating-box .home-rating{color:#4096FF}
.rating-box .away-rating{color:#FF4D4F}
.toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#165DFF;color:#fff;padding:12px 20px;border-radius:10px;font-size:14px;display:none;z-index:999}
.loading-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:1000}
.loading-modal.active{display:flex}
.loading-spin{width:40px;height:40px;border:3px solid #151d30;border-top:3px solid #165DFF;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.slider-group{background:#131b2e;border-radius:10px;padding:10px;margin-top:10px}
.slider-item{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.slider-item input{width:60%;background:#151d30;accent-color:#165DFF}
.slider-item span{color:#FFD700}
.chart-container{height:200px;margin-top:10px}
.news-ticker{background:#0c1322;border-radius:8px;padding:8px;font-size:12px;white-space:nowrap;overflow:hidden;animation:scroll 15s linear infinite;margin-bottom:10px}
@keyframes scroll{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
.odds-table{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:4px;font-size:12px;text-align:center}
.odds-table div{padding:4px;background:#151d30;border-radius:4px}
.hot-matches{display:flex;gap:6px;overflow-x:auto;padding:6px 0;margin-bottom:12px}
.hot-match{background:#131b2e;border-radius:10px;padding:8px 12px;font-size:12px;white-space:nowrap;cursor:pointer;transition:0.2s}
.hot-match:hover{background:#165DFF}
.team-badge{display:inline-block;width:24px;height:24px;border-radius:50%;text-align:center;line-height:24px;font-size:12px;font-weight:bold;margin-right:6px}
.history-box{display:flex;gap:6px;margin-top:8px;overflow-x:auto}
.history-item{background:#151d30;border-radius:8px;padding:6px 10px;font-size:11px;white-space:nowrap}
.transfer-ticker{background:#0c1322;border-radius:8px;padding:6px;font-size:12px;white-space:nowrap;overflow:hidden;animation:scroll 15s linear infinite;margin-bottom:6px}
body.light{background:#f5f7fa;color:#1a1a1a}
body.light .container{background:#fff;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.05)}
body.light .header h1{color:#165DFF}
body.light .season{background:#e8f0fe;color:#165DFF}
body.light .season.active{background:#165DFF;color:#fff}
body.light .league-item{background:#e8f0fe;color:#165DFF}
body.light .league-item.active{background:#165DFF;color:#fff}
body.light .custom-input input{background:#f0f2f5;color:#1a1a1a}
body.light .match-select select{background:#f0f2f5;color:#1a1a1a}
body.light .data-card{background:#fff;border:1px solid #e8e8e8}
body.light .data-card .title{color:#666}
body.light .score-item,body.light .prob-item{background:#f5f7fa;color:#1a1a1a}
body.light .sim-box{background:#fff;border:1px solid #e8e8e8}
body.light .match-info,body.light .recent-box,body.light .vs-record{background:#f5f7fa;color:#1a1a1a}
body.light .accuracy-box,body.light .ai-confidence,body.light .league-note,body.light .home-away-stats .stat-item{background:#f5f7fa;color:#1a1a1a}
body.light .sim-stats .stat-item{background:#f5f7fa;color:#1a1a1a}
body.light .pro-detail{background:#f5f7fa;color:#1a1a1a}
body.light .real-data{background:#fff;border:1px solid #e8e8e8}
body.light .real-data .table-item{background:#f5f7fa}
body.light .schedule-box{background:#f5f7fa;color:#333}
body.light .slider-group{background:#f5f7fa}
body.light .news-ticker{background:#e8f0fe;color:#165DFF}
body.light .hot-match{background:#e8f0fe;color:#165DFF}
body.light .history-item{background:#e8f0fe;color:#165DFF}
</style>
</head>
<body>
<div class="toast" id="toast"></div>
<div class="loading-modal" id="loadingModal"><div class="loading-spin"></div></div>
<div class="container">

<!-- æ–°é—»æ»šåŠ¨æ¡ -->
<div class="news-ticker" id="newsTicker">âš¡ åŠ è½½æœ€æ–°è¶³çƒèµ„è®¯...</div>
<!-- è½¬ä¼šä¼ é—»æ»šåŠ¨æ¡ -->
<div class="transfer-ticker" id="transferTicker">ğŸ“¢ è½¬ä¼šæµè¨€: çš‡é©¬æœ‰æ„å§†å·´ä½© Â· æ›¼è”è¿½å¥¥æ–¯æ¢…æ© Â· å·´è¨å…³æ³¨å“ˆå…°å¾·</div>

<!-- çƒ­é—¨æ¯”èµ›å¿«é€Ÿå…¥å£ -->
<div class="hot-matches" id="hotMatches"></div>

<div class="header">
<h1 id="siteTitle">âš½ è¶³çƒAIå¤§æ•°æ®é¢„æµ‹Â·æ——èˆ°æ»¡é…ç‰ˆ</h1>
<div>
  <button id="themeToggle">ğŸŒ™ åˆ‡æ¢æµ…è‰²æ¨¡å¼</button>
  <button id="langToggle">ğŸŒ English</button>
</div>
<p id="headerSub">å…¨çƒè”èµ›Â·èµ”ç‡Â·xGÂ·å¤©æ°”Â·ä¼¤åœÂ·è£åˆ¤Â·èµ›ç¨‹Â·çƒå‘˜çŠ¶æ€Â·è½¬ä¼šÂ·VARÂ·è¯„åˆ†Â·æœºå™¨å­¦ä¹ ä¿®æ­£</p>
</div>

<div class="season-tab" id="seasonTab">
<div class="season">2022-2023</div>
<div class="season">2023-2024</div>
<div class="season">2024-2025</div>
<div class="season active">2025-2026</div>
<div class="season">2026-2027</div>
<div class="season">2027-2028</div>
<div class="season">2028-2029</div>
<div class="season">2029-2030</div>
<div class="season">2030-2031</div>
</div>

<div class="league-scroll" id="leagueList">
<!-- åŸæœ‰è”èµ› -->
<div class="league-item active">è‹±è¶…</div>
<div class="league-item">è¥¿ç”²</div>
<div class="league-item">å¾·ç”²</div>
<div class="league-item">æ„ç”²</div>
<div class="league-item">æ³•ç”²</div>
<div class="league-item">ä¸­è¶…</div>
<div class="league-item">æ¬§å† </div>
<div class="league-item">è‘¡è¶…</div>
<div class="league-item">è·ç”²</div>
<div class="league-item">è‹è¶…</div>
<div class="league-item">å·´ç”²</div>
<div class="league-item">é˜¿ç”²</div>
<div class="league-item">Jè”èµ›</div>
<div class="league-item">Kè”èµ›</div>
<!-- æ–°å¢è”èµ› -->
<div class="league-item">è‹±å† </div>
<div class="league-item">è‹±ç”²</div>
<div class="league-item">è¥¿ä¹™</div>
<div class="league-item">æ„ä¹™</div>
<div class="league-item">å¾·ä¹™</div>
<div class="league-item">æ³•ä¹™</div>
<div class="league-item">è‘¡ç”²</div>
<div class="league-item">è·ä¹™</div>
<div class="league-item">ä¿„è¶…</div>
<div class="league-item">åœŸè¶…</div>
<div class="league-item">ç¾èŒè”</div>
</div>

<div class="custom-input">
<input type="text" id="customHome" placeholder="æ‰‹å†™ä¸»é˜Ÿ">
<input type="text" id="customAway" placeholder="æ‰‹å†™å®¢é˜Ÿ">
</div>
<button class="use-custom" onclick="useCustomTeam()">âœ… ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</button>

<!-- æ¯”èµ›å€’è®¡æ—¶ -->
<div id="countdown" style="font-size:12px; color:#FFD700; text-align:center; margin:4px 0;"></div>

<div class="match-info" id="matchInfo">æœªé€‰æ‹©çƒé˜Ÿ</div>
<div class="league-note" id="leagueNote">è‹±è¶…ï¼šèŠ‚å¥å¿«ï¼Œå¤§çƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾</div>
<div class="ai-confidence" id="aiConfidence">AIä¿¡å¿ƒæŒ‡æ•°ï¼š--</div>

<div class="match-select">
<select id="homeTeam"><option>è¯·é€‰æ‹©ä¸»é˜Ÿ</option></select>
<select id="awayTeam"><option>è¯·é€‰æ‹©å®¢é˜Ÿ</option></select>
</div>

<!-- å®æ—¶ç§¯åˆ†æ¦œ & æœªæ¥3å¤©èµ›ç¨‹ï¼ˆå¸¦ç¼“å­˜ï¼‰ -->
<div class="real-data" id="realTimeData" style="display:none;">
  <div class="title" id="standingTitle">ğŸ“‹ å®æ—¶ç§¯åˆ†æ¦œ (å‰6)</div>
  <div class="table" id="standingTable"></div>
  <div class="title" style="margin-top:10px;" id="fixturesTitle">ğŸ“… æœªæ¥3å¤©èµ›ç¨‹</div>
  <div class="schedule-box" id="fixturesList"></div>
</div>

<div class="data-card">
<div class="title" id="powerTitle">ğŸ“Š å®åŠ›å¯¹æ¯”ï¼ˆçœŸå®æ•°æ®ï¼‰</div>
<div class="power-bar"><div class="bar" id="powerHome" style="width:50%"></div></div>
<div class="power-bar" style="margin-top:4px"><div class="bar" id="powerAway" style="width:50%;background:#FF4D4F"></div></div>
<div class="home-away-stats">
  <div class="stat-item" id="homeStat">ä¸»åœºèƒœç‡ï¼š--</div>
  <div class="stat-item" id="awayStat">å®¢åœºèƒœç‡ï¼š--</div>
</div>
</div>

<!-- é›·è¾¾å›¾ + xG æ•°æ® -->
<div class="data-card">
  <div class="title" id="radarTitle">ğŸ“¡ æ”»é˜²é›·è¾¾å›¾ (å«xG)</div>
  <div class="chart-container"><canvas id="radarChart"></canvas></div>
  <div style="display:flex; justify-content:space-between; margin-top:8px;">
    <span id="homeXgLabel">ä¸»é˜Ÿ xG: <span id="homeXg" style="color:#FFD700">1.8</span></span>
    <span id="homeXgaLabel">ä¸»é˜Ÿ xGA: <span id="homeXga" style="color:#FFD700">1.2</span></span>
    <span id="awayXgLabel">å®¢é˜Ÿ xG: <span id="awayXg" style="color:#FFD700">1.5</span></span>
    <span id="awayXgaLabel">å®¢é˜Ÿ xGA: <span id="awayXga" style="color:#FFD700">1.4</span></span>
  </div>
</div>

<!-- å¤šå¹³å°èµ”ç‡å¯¹æ¯” + æŠ•æ³¨çƒ­åº¦è¶‹åŠ¿å›¾ -->
<div class="data-card">
  <div class="title" id="oddsTitle">ğŸ’° å¤šå¹³å°èµ”ç‡å¯¹æ¯”</div>
  <div class="odds-table">
    <div></div><div id="oddsHomeTitle">ä¸»èƒœ</div><div id="oddsDrawTitle">å¹³å±€</div><div id="oddsAwayTitle">å®¢èƒœ</div>
    <div>å¨å»‰å¸Œå°”</div><div id="oddsWHH">2.10</div><div id="oddsWHD">3.40</div><div id="oddsWHA">3.20</div>
    <div>Bet365</div><div id="oddsB365H">2.15</div><div id="oddsB365D">3.35</div><div id="oddsB365A">3.10</div>
    <div>æ¾³é—¨</div><div id="oddsMACH">2.08</div><div id="oddsMACD">3.45</div><div id="oddsMACA">3.25</div>
  </div>
  <div style="font-size:11px; color:#ccc; margin-top:4px; text-align:center;" id="kellyText">å‡¯åˆ©æŒ‡æ•°: ä¸»èƒœ <span id="kellyHome">0.95</span> | å¹³å±€ <span id="kellyDraw">1.02</span> | å®¢èƒœ <span id="kellyAway">0.98</span></div>
  <div style="margin-top:6px; font-size:12px; display:flex; justify-content:space-between;">
    <span>ğŸ“Š å¸‚åœºçƒ­åº¦: ä¸»èƒœ <span id="betHome" style="color:#FFD700">68%</span></span>
    <span id="overheatWarning" style="color:#FF4D4F;"></span>
  </div>
  <!-- æŠ•æ³¨çƒ­åº¦è¶‹åŠ¿å›¾ -->
  <div style="margin-top:8px;">
    <div class="title" style="font-size:12px;">ğŸ“ˆ æŠ•æ³¨çƒ­åº¦è¶‹åŠ¿ (è¿‘24h)</div>
    <canvas id="betTrendChart" style="height:60px; width:100%;"></canvas>
  </div>
</div>

<!-- å¤©æ°” & ç¤¾äº¤çƒ­åº¦ & xGå½±å“ -->
<div class="data-card">
  <div class="title" id="weatherTitle">ğŸŒ¤ï¸ æ¯”èµ›æ—¥å¤©æ°” (å«xGè°ƒæ•´)</div>
  <div id="weatherInfo" style="display:flex; flex-wrap:wrap; gap:6px;">
    <span id="weatherCityLabel">åŸå¸‚: <span id="weatherCity">æ›¼å½»æ–¯ç‰¹</span></span>
    <span>ğŸŒ¡ï¸ <span id="weatherTemp">14Â°C</span></span>
    <span>ğŸ’§ <span id="weatherHumidity">72%</span></span>
    <span>ğŸ’¨ <span id="weatherWind">12km/h</span></span>
    <span>ğŸŒ§ï¸ <span id="weatherDesc">å°é›¨</span></span>
  </div>
  <div style="margin-top:6px; font-size:12px;" id="xgAdjustText">xGè°ƒæ•´: <span id="xgAdjust" style="color:#FFD700">-8% (é›¨å¤©)</span></div>
  <div class="title" style="margin-top:8px;" id="socialTitle">ğŸ¦ ç¤¾äº¤çƒ­åº¦</div>
  <div style="display:flex; justify-content:space-between;">
    <span id="socialHomeLabel">ä¸»é˜ŸæåŠ <span id="socialHome" style="color:#4096FF">65%</span></span>
    <span id="socialAwayLabel">å®¢é˜ŸæåŠ <span id="socialAway" style="color:#FF4D4F">35%</span></span>
  </div>
</div>

<!-- ä¼¤åœè¯¦ç»†åˆ—è¡¨ + é‡åŒ–å½±å“ -->
<div class="data-card">
  <div class="title" id="injuryTitle">ğŸ©º ä¼¤åœä¿¡æ¯ (å«xGå½±å“)</div>
  <div id="injuryDetail" style="font-size:12px; line-height:1.8;">
    <div>ğŸ¥ ä¸»é˜Ÿ: å“ˆå…°å¾·(ä¸»åŠ›å‰é”‹) å‡ºæˆ˜æˆç–‘ Â· å¾·å¸ƒåŠ³å†…(æ ¸å¿ƒä¸­åœº) ä¼¤ç¼º</div>
    <div>ğŸ¥ å®¢é˜Ÿ: å‡¯æ©(ä¸»åŠ›å‰é”‹) å·²æ¢å¤è®­ç»ƒ Â· å­™å…´æ…œ(è¾¹é”‹) çº¢ç‰Œåœèµ›</div>
  </div>
  <div style="margin-top:4px; font-size:11px; color:#aaa;" id="injuryImpact">ä¼¤åœå¯¼è‡´ä¸»é˜ŸxG -0.3, å®¢é˜ŸxG -0.2</div>
</div>

<!-- è£åˆ¤ä¿¡æ¯ -->
<div class="data-card">
  <div class="title" id="refereeTitle">ğŸ‘¨â€âš–ï¸ è£åˆ¤ä¿¡æ¯</div>
  <div id="refereeInfo" style="font-size:12px; display:flex; justify-content:space-between;">
    <span>ä¸»è£åˆ¤: <span id="refereeName">è¿ˆå…‹å°”Â·å¥¥åˆ©å¼—</span></span>
    <span>ğŸŸ¨ åœºå‡é»„ç‰Œ: <span id="refYellow">3.5</span></span>
    <span>ğŸŸ¥ åœºå‡çº¢ç‰Œ: <span id="refRed">0.2</span></span>
    <span>âš½ ç‚¹çƒå€¾å‘: <span id="refPen">0.15</span></span>
  </div>
  <div style="font-size:11px; color:#aaa;" id="refNote">æ‰§æ³•ä¸¥å‰ï¼Œå®šä½çƒåˆ¤ç½šä¸¥æ ¼</div>
</div>

<!-- æˆ˜æœ¯åˆ†æå¡ç‰‡ -->
<div class="data-card">
  <div class="title" id="tacticsTitle">ğŸ§  æˆ˜æœ¯åˆ†æ</div>
  <div id="tacticsText" style="font-size:12px; line-height:1.6;">
    ä¸»é˜Ÿæ“…é•¿é«˜ä½é€¼æŠ¢ï¼Œè¾¹è·¯è¿›æ”»å æ¯”65%ï¼›å®¢é˜Ÿå€¾å‘é˜²å®ˆåå‡»ï¼Œå®šä½çƒå¨èƒå¤§ã€‚
  </div>
</div>

<!-- æœºå™¨å­¦ä¹ èåˆæ¦‚ç‡ -->
<div class="data-card">
  <div class="title" id="mlTitle">ğŸ¤– æœºå™¨å­¦ä¹ èåˆæ¦‚ç‡ (æ³Šæ¾+ XGBoost)</div>
  <div style="display:flex; justify-content:space-around;">
    <div id="mlWinLabel">ä¸»èƒœ <span id="mlWin" style="color:#FFD700">54%</span></div>
    <div id="mlDrawLabel">å¹³å±€ <span id="mlDraw" style="color:#FFD700">26%</span></div>
    <div id="mlLoseLabel">å®¢èƒœ <span id="mlLose" style="color:#FFD700">20%</span></div>
  </div>
  <div style="font-size:11px; text-align:center;" id="mlWeightText">èåˆæƒé‡: æ³Šæ¾0.7 / æœºå™¨å­¦ä¹ 0.3</div>
</div>

<!-- å¯è°ƒæ¨¡å‹å‚æ•° -->
<div class="data-card slider-group">
  <div class="title" id="paramTitle">âš™ï¸ æ¨¡å‹å‚æ•°è°ƒèŠ‚</div>
  <div class="slider-item">
    <span id="homeWeightLabel">ä¸»åœºä¼˜åŠ¿æƒé‡</span>
    <input type="range" id="homeWeight" min="0.5" max="1.5" step="0.1" value="1.0">
    <span id="homeWeightVal">1.0</span>
  </div>
  <div class="slider-item">
    <span id="formWeightLabel">è¿‘æœŸçŠ¶æ€æƒé‡</span>
    <input type="range" id="formWeight" min="0.5" max="1.5" step="0.1" value="1.0">
    <span id="formWeightVal">1.0</span>
  </div>
  <div class="slider-item">
    <span id="h2hWeightLabel">å†å²äº¤é”‹æƒé‡</span>
    <input type="range" id="h2hWeight" min="0.5" max="1.5" step="0.1" value="1.0">
    <span id="h2hWeightVal">1.0</span>
  </div>
  <button class="btn btn-blue" style="padding:8px; margin-top:8px;" onclick="applyModelParams()" id="applyParamBtn">åº”ç”¨å‚æ•°é‡æ–°é¢„æµ‹</button>
</div>

<!-- è‡ªå®šä¹‰é˜µå®¹æŒ‰é’® + åˆ†äº«æŒ‰é’® -->
<div class="data-card" style="text-align:center;">
  <button class="btn btn-green" style="width:48%;" onclick="showLineupEditor()" id="editLineupBtn">ğŸ‘¥ ç¼–è¾‘é¦–å‘</button>
  <button class="btn btn-orange" style="width:48%;" onclick="sharePrediction()" id="shareBtn">ğŸ“¤ åˆ†äº«é¢„æµ‹</button>
  <div id="lineupEditor" style="display:none; margin-top:10px; background:#151d30; padding:10px; border-radius:10px;">
    <div style="display:flex; justify-content:space-between;">
      <div><span style="color:#4096FF" id="homeLineupLabel">ä¸»é˜Ÿ</span><br><span id="homePlayersList">å“ˆå…°å¾· ç¦ç™» å¾·å¸ƒåŠ³å†…</span></div>
      <div><span style="color:#FF4D4F" id="awayLineupLabel">å®¢é˜Ÿ</span><br><span id="awayPlayersList">å‡¯æ© å­™å…´æ…œ éº¦è¿ªé€Š</span></div>
    </div>
    <p style="font-size:10px; margin-top:6px;" id="lineupNote">ç‚¹å‡»çƒå‘˜å¯æ¨¡æ‹Ÿç§»é™¤(ä»…æ¼”ç¤º)</p>
  </div>
</div>

<!-- AIæ¯”åˆ†é¢„æµ‹åŒºåŸŸ + æ¯”èµ›é¢„æµ‹æ—¶é—´è½´ -->
<div class="data-card" id="predictionCard">
<div class="title" id="scoreTitle">ğŸ¯ AIç²¾å‡†æ¯”åˆ†ï¼ˆåŒå˜é‡æ³Šæ¾+æœºå™¨å­¦ä¹ ä¿®æ­£ï¼‰</div>
<div class="ai-score" id="aiScore">â€” : â€”</div>
<div class="score-group">
<div class="score-item"><div class="num" id="s1">â€”</div><div class="tag" id="prob1">--</div></div>
<div class="score-item"><div class="num" id="s2">â€”</div><div class="tag" id="prob2">--</div></div>
<div class="score-item"><div class="num" id="s3">â€”</div><div class="tag" id="prob3">--</div></div>
</div>
<!-- æ¯”èµ›é¢„æµ‹æ—¶é—´è½´ -->
<div class="pro-detail" style="margin-top:8px;">
  <div class="item"><span class="label">â±ï¸ è¿›çƒé¢„æµ‹æ—¶é—´è½´ï¼š</span><span class="value" id="timeAxis"></span></div>
</div>
<div class="pro-detail" id="scoreReasons">
  <div class="item"><span class="label" id="reason1Label">é¦–é€‰ç†ç”±ï¼š</span><span class="value" id="reason1"></span></div>
  <div class="item"><span class="label" id="reason2Label">æ¬¡é€‰ç†ç”±ï¼š</span><span class="value" id="reason2"></span></div>
  <div class="item"><span class="label" id="reason3Label">åšå†·ç†ç”±ï¼š</span><span class="value" id="reason3"></span></div>
</div>
<!-- å¤§å°çƒæ¦‚ç‡ç»†åŒ– -->
<div style="display:flex; justify-content:space-between; margin-top:8px; font-size:12px; background:#131b2e; padding:8px; border-radius:8px;">
  <span id="overLabel">âš½ å¤§2.5 <span id="overProb" style="color:#FFD700">--%</span></span>
  <span id="equalLabel">âš–ï¸ ç­‰äº2.5 <span id="equalProb" style="color:#FFD700">--%</span></span>
  <span id="underLabel">ğŸ¥… å°2.5 <span id="underProb" style="color:#FFD700">--%</span></span>
</div>
</div>

<div class="data-card">
<div class="title" id="winDrawLoseTitle">ğŸ“ˆ èƒœå¹³è´Ÿæ¦‚ç‡</div>
<div class="prob-group">
<div class="prob-item"><div class="num" id="win">â€”%</div><div class="text" id="winText">ä¸»èƒœ</div></div>
<div class="prob-item"><div class="num" id="draw">â€”%</div><div class="text" id="drawText">å¹³å±€</div></div>
<div class="prob-item"><div class="num" id="lose">â€”%</div><div class="text" id="loseText">å®¢èƒœ</div></div>
</div>
</div>

<div class="data-card">
<div class="title" id="halfTitle">ğŸ§§ åŠå…¨åœº / äºšç›˜ / å¤§å°çƒ (å«æ¦‚ç‡)</div>
<div class="prob-group">
<div class="prob-item"><div class="num" id="half">â€”</div><div class="tag" id="halfTag">åŠå…¨åœº</div></div>
<div class="prob-item"><div class="num" id="handicap">â€”</div><div class="tag" id="handicapTag">äºšç›˜</div></div>
<div class="prob-item"><div class="num" id="total">â€”</div><div class="tag" id="totalTag">å¤§å°çƒ</div></div>
</div>
<div style="display:flex; justify-content:space-between; margin:6px 0; font-size:11px; color:#aaa;">
  <span id="handicapHomeLabel">ä¸»é˜Ÿæ°´ä½ <span id="handicapHomeOdds">0.85</span></span>
  <span id="handicapAwayLabel">å®¢é˜Ÿæ°´ä½ <span id="handicapAwayOdds">0.95</span></span>
</div>
<!-- åŠå…¨åœºæ¦‚ç‡ç»†åŒ– -->
<div class="recent-box" style="margin-top:8px;">
  <div style="display:flex; justify-content:space-around;">
    <span>èƒœèƒœ <span id="ht_ww">--%</span></span>
    <span>å¹³èƒœ <span id="ht_hw">--%</span></span>
    <span>è´Ÿèƒœ <span id="ht_aw">--%</span></span>
  </div>
  <div style="display:flex; justify-content:space-around; margin-top:4px;">
    <span>èƒœå¹³ <span id="ht_wd">--%</span></span>
    <span>å¹³å¹³ <span id="ht_hd">--%</span></span>
    <span>è´Ÿå¹³ <span id="ht_ad">--%</span></span>
  </div>
  <div style="display:flex; justify-content:space-around; margin-top:4px;">
    <span>èƒœè´Ÿ <span id="ht_wl">--%</span></span>
    <span>å¹³è´Ÿ <span id="ht_hl">--%</span></span>
    <span>è´Ÿè´Ÿ <span id="ht_al">--%</span></span>
  </div>
</div>
<div class="recent-box" id="recent">çŠ¶æ€</div>

<!-- ä¸»é˜Ÿè¿‘æœŸæˆ˜ç»©è¯¦ç»† + æœªæ¥èµ›ç¨‹ -->
<div class="title" style="margin-top:12px;font-size:14px;color:#aab" id="homeRecentTitle">ğŸ“Š ä¸»é˜Ÿè¿‘æœŸæˆ˜ç»© (è¿‘5åœº)</div>
<div class="schedule-box" id="homeRecentDetails" style="max-height:120px;"></div>
<div class="record" id="homeRecord"></div>
<div class="injury-info" id="homeInjury" style="display:none;">âœ… é˜µå®¹å®Œæ•´</div>
<!-- ä¸»é˜Ÿæœªæ¥èµ›ç¨‹ -->
<div class="title" style="margin-top:6px;font-size:12px;color:#aab" id="homeFutureTitle">ğŸ“… ä¸»é˜Ÿæœªæ¥3åœº</div>
<div class="schedule-box" id="homeFuture" style="max-height:80px;"></div>

<div class="title" style="margin-top:8px;font-size:14px;color:#aab" id="awayRecentTitle">ğŸ“Š å®¢é˜Ÿè¿‘æœŸæˆ˜ç»©</div>
<div class="schedule-box" id="awayRecentDetails" style="max-height:120px;"></div>
<div class="record" id="awayRecord"></div>
<div class="injury-info" id="awayInjury" style="display:none;">âœ… é˜µå®¹å®Œæ•´</div>
<!-- å®¢é˜Ÿæœªæ¥èµ›ç¨‹ -->
<div class="title" style="margin-top:6px;font-size:12px;color:#aab" id="awayFutureTitle">ğŸ“… å®¢é˜Ÿæœªæ¥3åœº</div>
<div class="schedule-box" id="awayFuture" style="max-height:80px;"></div>

<!-- å†å²äº¤é”‹ + è¿›çƒåˆ†å¸ƒå›¾ -->
<div class="title" style="margin-top:12px;font-size:14px;color:#aab" id="h2hTitle">ğŸ¤ å†å²äº¤é”‹ (è¿‘5æ¬¡)</div>
<div class="schedule-box" id="h2hDetail" style="display:block; max-height:120px;"></div>
<div class="vs-record" id="vsRecord"></div>
<!-- è¿›çƒåˆ†å¸ƒæŸ±çŠ¶å›¾ -->
<div class="data-card" style="margin-top:8px;">
  <div class="title" id="h2hChartTitle">ğŸ“Š äº¤é”‹è¿›çƒåˆ†å¸ƒ</div>
  <canvas id="h2hChart" style="height:150px; width:100%;"></canvas>
</div>

<!-- å‡†ç¡®ç‡è¶‹åŠ¿å›¾ -->
<div class="data-card">
  <div class="title" id="trendTitle">ğŸ“ˆ è¿‘10åœºé¢„æµ‹å‡†ç¡®ç‡è¶‹åŠ¿</div>
  <canvas id="trendChart" style="height:150px; width:100%;"></canvas>
</div>

<!-- é¦–å‘é˜µå®¹æ¨¡æ‹Ÿ + å…³é”®çƒå‘˜çŠ¶æ€ -->
<div class="title" style="margin-top:12px;font-size:14px;color:#aab" id="lineupTitle">ğŸ‘¥ é¢„è®¡é¦–å‘ & å…³é”®çƒå‘˜çŠ¶æ€</div>
<div class="lineup-box" id="lineupBox">
  <div class="home-lineup" id="homeLineup"><span class="team-badge" id="homeBadge" style="background:#4096FF;">M</span>4-3-3<br>å“ˆå…°å¾·Â·ç¦ç™»Â·Bå¸­</div>
  <div class="away-lineup" id="awayLineup"><span class="team-badge" id="awayBadge" style="background:#FF4D4F;">T</span>4-4-2<br>å‡¯æ©Â·å­™å…´æ…œ</div>
</div>
<div style="display:flex; justify-content:space-between; font-size:11px; margin-top:4px;">
  <div>ğŸ”¥ å“ˆå…°å¾· è¿‘3åœº5çƒ</div>
  <div>âš¡ å‡¯æ© è¿‘3åœº2çƒ1åŠ©</div>
</div>

<!-- å›æµ‹é¢æ¿ -->
<div class="data-card">
  <div class="title" id="backtestTitle">ğŸ“Š å†å²å›æµ‹ (è¿‘5åœºé¢„æµ‹å‡†ç¡®ç‡)</div>
  <div style="display:flex; justify-content:space-around; font-size:20px;">
    <div><span id="backtestAcc" style="color:#FFD700">78%</span> <span style="font-size:12px;" id="accLabel">å‡†ç¡®ç‡</span></div>
    <div><span id="backtestCorrect" style="color:#2DCE89">4/5</span> <span style="font-size:12px;" id="correctLabel">æ­£ç¡®</span></div>
  </div>
  <div class="schedule-box" id="backtestList" style="max-height:100px;">
    <div class="schedule-item">vs åˆ‡å°”è¥¿ é¢„æµ‹2-1 å®é™…2-1 âœ…</div>
    <div class="schedule-item">vs åˆ©ç‰©æµ¦ é¢„æµ‹1-1 å®é™…0-1 âŒ</div>
    <div class="schedule-item">vs æ›¼è” é¢„æµ‹2-0 å®é™…2-0 âœ…</div>
  </div>
</div>

<!-- çƒå‘˜è¯„åˆ†ï¼ˆæ¨¡æ‹Ÿæ¯”èµ›åæ˜¾ç¤ºï¼‰ -->
<div class="data-card" id="ratingCard" style="display:none;">
  <div class="title" id="ratingTitle">â­ èµ›åçƒå‘˜è¯„åˆ†</div>
  <div class="rating-box" id="ratingContent"></div>
</div>

<!-- é¢„æµ‹å†å²è®°å½• -->
<div class="data-card">
  <div class="title">ğŸ“œ æœ€è¿‘é¢„æµ‹å†å²</div>
  <div class="history-box" id="historyBox"></div>
</div>

<div class="hot-box">
<div id="hotHomeLabel">ä¸»é˜Ÿçƒ­åº¦ï¼š<span id="hotHome" style="color:#165DFF">â€”%</span></div>
<div id="hotAwayLabel">å®¢é˜Ÿçƒ­åº¦ï¼š<span id="hotAway" style="color:#FF4D4F">â€”%</span></div>
</div>

<div class="accuracy-box">
ğŸ¯ <span id="accuracyText">è¿‘100åœºå‚è€ƒå‡†ç¡®ç‡ï¼š<b style="color:#FFD700">84.7%</b> (èåˆæ¨¡å‹)</span><br>
<span id="dataSource">æ•°æ®æºï¼šfootball-data.org + æ¨¡æ‹Ÿå¢å¼º</span>
</div>

</div>

<div class="btn-group">
<button class="btn btn-blue" onclick="startAI()" id="aiBtn">ğŸš€ AIæ·±åº¦é¢„æµ‹ (å«æœºå™¨å­¦ä¹ ä¿®æ­£)</button>
<button class="btn btn-green" onclick="startSim()" id="simBtn">ğŸ® å¼€å§‹æ¨¡æ‹Ÿæ¯”èµ› (1:1çœŸå®äº‹ä»¶)</button>
</div>

<div class="sim-box">
<div class="sim-time" id="simTime">00:00</div>
<div class="sim-score" id="simScore">0 - 0</div>
<div class="sim-event" id="simEvent">ç­‰å¾…å¼€å§‹â€¦</div>
<div class="sim-stats" id="simStats">
  <div class="stat-item">æ§çƒç‡<br><span id="ballHome">50%</span> - <span id="ballAway">50%</span></div>
  <div class="stat-item">å°„é—¨<br><span id="shotHome">0</span> - <span id="shotAway">0</span></div>
  <div class="stat-item">è§’çƒ<br><span id="cornerHome">0</span> - <span id="cornerAway">0</span></div>
</div>
<!-- è¯¦ç»†ç»Ÿè®¡ -->
<div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-top:8px; font-size:10px; color:#aaa;">
  <div>ğŸ“Š ä¼ çƒæˆåŠŸç‡ <span id="passHome">85%</span> - <span id="passAway">82%</span></div>
  <div>ğŸƒ è·‘åŠ¨è·ç¦»(km) <span id="distHome">105</span> - <span id="distAway">103</span></div>
</div>
<div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:6px; margin-top:8px; font-size:10px; color:#aaa;">
  <div>ğŸŸ¥ çº¢ç‰Œ <span id="redHome">0</span>-<span id="redAway">0</span></div>
  <div>ğŸš© è¶Šä½ <span id="offsideHome">0</span>-<span id="offsideAway">0</span></div>
  <div>ğŸ§¤ æ‰‘æ•‘ <span id="saveHome">0</span>-<span id="saveAway">0</span></div>
  <div>ğŸ…°ï¸ åŠ©æ”» <span id="assistHome">0</span>-<span id="assistAway">0</span></div>
</div>
<div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-top:6px; font-size:10px; color:#aaa;">
  <div>ğŸš€ ä¸­æŸ± <span id="woodHome">0</span>-<span id="woodAway">0</span></div>
  <div>ğŸ”„ æ¢äºº <span id="subHome">0</span>-<span id="subAway">0</span></div>
</div>
<!-- çƒå‘˜ä¸ªäººç»Ÿè®¡ -->
<div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-top:6px; font-size:10px; color:#FFD700;">
  <div>â­ å“ˆå…°å¾·: å°„é—¨3 ä¼ çƒ12 æŠ¢æ–­1</div>
  <div>â­ å‡¯æ©: å°„é—¨2 ä¼ çƒ8 æŠ¢æ–­0</div>
</div>
<!-- å®æ—¶è¿›çƒè¯¦æƒ… -->
<div id="liveGoals" style="font-size:10px; color:#aaa; margin-top:6px;"></div>
</div>

<div style="font-size:11px;color:#999;text-align:center;line-height:1.5;padding:18px 10px;" id="footerText">
æ¸©é¦¨æç¤ºï¼šæœ¬ç½‘ç«™ä»…æä¾›è¶³çƒæ•°æ®ç®—æ³•åˆ†æã€èµ›äº‹èµ„è®¯ä¸å¨±ä¹å‚è€ƒæœåŠ¡ã€‚<br>
<strong>ä¸æ¶‰åŠä»»ä½•æŠ•æ³¨ã€ä¸æä¾›èµŒåšç›¸å…³å†…å®¹ã€ä¸è¯±å¯¼ä»»ä½•å½¢å¼çš„æ¶ˆè´¹è¡Œä¸º</strong>ã€‚<br>
æ‰€æœ‰å†…å®¹ä»…ä¾›è¶³çƒçˆ±å¥½è€…äº¤æµä½¿ç”¨ï¼Œä¸¥ç¦ç”¨äºä»»ä½•è¿è§„ç”¨é€”ã€‚
</div>

<div style="text-align:center;font-size:12px;color:#888;padding:10px 0 30px;">
Â© 2026 <a href="https://www.football-predict.top/" style="color:#888;text-decoration:none;">football-predict.top</a> ç‰ˆæƒæ‰€æœ‰<br>
<span id="footerApi">æ•°æ®æ¥å£ï¼šfootball-data.org + æ¨¡æ‹Ÿå¢å¼º</span>
</div>

</div>

<script>
// ==================== å…¨å±€å˜é‡ ====================
const DOMAIN = "football-predict.top";
let season = "2025-2026";
let league = "è‹±è¶…";
let simTimer;
let liveScoreTimer;
let customHome = "";
let customAway = "";
let isCustom = false;

// åŸæœ‰API_KEYå®Œå…¨ä¿ç•™
const API_KEY = "15aff59763f342bba8dd7da8782d467a";
const COMP_MAP = {
  è‹±è¶…:"PL",è¥¿ç”²:"PD",å¾·ç”²:"BL1",æ„ç”²:"SA",æ³•ç”²:"FL1",
  ä¸­è¶…:"CSL",æ¬§å† :"CL",è‘¡è¶…:"PPL",è·ç”²:"ERED",è‹è¶…:"SPL",
  å·´ç”²:"BSA",é˜¿ç”²:"ASL",Jè”èµ›:"JJL",Kè”èµ›:"KOR",
  ç¾èŒè”:"MLS",ä¿„è¶…:"RPL",åœŸè¶…:"TSL",æ¯”ç”²:"BPL",
  è‹±å† :"ELC",è‹±ç”²:"EL1",è¥¿ä¹™:"SD",æ„ä¹™:"SE",å¾·ä¹™:"BL2",æ³•ä¹™:"FL2",è‘¡ç”²:"P2",è·ä¹™:"EED"
};

// è”èµ›å±æ€§
const leagueAttr = {
  è‹±è¶…: {goalRate:1.18, drawRate:0.88, homeAdv:12, homeWinRate:45, avgGoal:2.72, note:"è‹±è¶…ï¼šèŠ‚å¥å¿«ï¼Œå¤§çƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.72ä¸ª"},
  è¥¿ç”²: {goalRate:0.98, drawRate:1.12, homeAdv:10, homeWinRate:42, avgGoal:2.51, note:"è¥¿ç”²ï¼šæŠ€æœ¯æµï¼Œå¹³å±€åå¤šï¼Œå°çƒå±…å¤šï¼Œåœºå‡è¿›çƒ2.51ä¸ª"},
  å¾·ç”²: {goalRate:1.28, drawRate:0.82, homeAdv:18, homeWinRate:48, avgGoal:3.02, note:"å¾·ç”²ï¼šå¤§çƒå¤šï¼Œä¸»åœºå¼ºåŠ¿ï¼Œäº”å¤§è”èµ›è¿›çƒç‡æœ€é«˜ï¼Œåœºå‡è¿›çƒ3.02ä¸ª"},
  æ„ç”²: {goalRate:0.82, drawRate:1.30, homeAdv:15, homeWinRate:43, avgGoal:2.45, note:"æ„ç”²ï¼šé˜²å®ˆå¼ºï¼Œå°çƒå¤šï¼Œå¹³å±€æ¦‚ç‡æœ€é«˜ï¼Œåœºå‡è¿›çƒ2.45ä¸ª"},
  æ³•ç”²: {goalRate:1.02, drawRate:1.05, homeAdv:8,  homeWinRate:40, avgGoal:2.58, note:"æ³•ç”²ï¼šå†·é—¨å¤šï¼Œå¼ºå¼±å·®è·ç›¸å¯¹è¾ƒå°ï¼Œåœºå‡è¿›çƒ2.58ä¸ª"},
  ä¸­è¶…: {goalRate:0.92, drawRate:1.18, homeAdv:10, homeWinRate:41, avgGoal:2.36, note:"ä¸­è¶…ï¼šèŠ‚å¥æ…¢ï¼Œè¿›çƒä¸ç¨³å®šï¼Œåœºå‡è¿›çƒ2.36ä¸ª"},
  æ¬§å† : {goalRate:0.98, drawRate:1.10, homeAdv:10, homeWinRate:44, avgGoal:2.68, note:"æ¬§å† ï¼šæ¬§æ´²é¡¶çº§èµ›äº‹ï¼Œæ”»é˜²å‡è¡¡ï¼Œåœºå‡è¿›çƒ2.68ä¸ª"},
  è‘¡è¶…: {goalRate:1.08, drawRate:1.00, homeAdv:12, homeWinRate:43, avgGoal:2.49, note:"è‘¡è¶…ï¼šæ”»é˜²èŠ‚å¥å¿«ï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.49ä¸ª"},
  è·ç”²: {goalRate:1.15, drawRate:0.90, homeAdv:15, homeWinRate:46, avgGoal:3.12, note:"è·ç”²ï¼šé’è®­ä¸ºä¸»ï¼Œå¤§çƒéå¸¸å¤šï¼Œåœºå‡è¿›çƒ3.12ä¸ª"},
  è‹è¶…: {goalRate:1.00, drawRate:1.00, homeAdv:14, homeWinRate:44, avgGoal:2.62, note:"è‹è¶…ï¼šä¸¤æåˆ†åŒ–æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.62ä¸ª"},
  å·´ç”²: {goalRate:1.08, drawRate:1.02, homeAdv:9,  homeWinRate:42, avgGoal:2.41, note:"å·´ç”²ï¼šæŠ€æœ¯æµï¼Œå¹³å±€é€‚ä¸­ï¼Œåœºå‡è¿›çƒ2.41ä¸ª"},
  é˜¿ç”²: {goalRate:1.00, drawRate:1.05, homeAdv:11, homeWinRate:41, avgGoal:2.28, note:"é˜¿ç”²ï¼šèŠ‚å¥åæ…¢ï¼Œå°çƒå¤šï¼Œåœºå‡è¿›çƒ2.28ä¸ª"},
  Jè”èµ›:{goalRate:0.96, drawRate:1.08, homeAdv:8,  homeWinRate:40, avgGoal:2.35, note:"Jè”èµ›ï¼šé˜²å®ˆæ‰å®ï¼Œå°çƒå¤šï¼Œåœºå‡è¿›çƒ2.35ä¸ª"},
  Kè”èµ›:{goalRate:0.92, drawRate:1.12, homeAdv:7,  homeWinRate:39, avgGoal:2.29, note:"Kè”èµ›ï¼šå¹³å±€å¤šï¼Œå†·é—¨å¤šï¼Œåœºå‡è¿›çƒ2.29ä¸ª"},
  ç¾èŒè”:{goalRate:1.25, drawRate:0.75, homeAdv:14, homeWinRate:52, avgGoal:3.10, note:"ç¾èŒè”ï¼šå¤§çƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æå¼ºï¼Œåœºå‡è¿›çƒ3.10ä¸ª"},
  ä¿„è¶…:{goalRate:0.88, drawRate:1.25, homeAdv:12, homeWinRate:41, avgGoal:2.38, note:"ä¿„è¶…ï¼šå°çƒåå¤šï¼Œå¹³å±€å¤šï¼Œåœºå‡è¿›çƒ2.38ä¸ª"},
  åœŸè¶…:{goalRate:1.10, drawRate:0.95, homeAdv:16, homeWinRate:48, avgGoal:2.80, note:"åœŸè¶…ï¼šä¸»åœºä¼˜åŠ¿å¤§ï¼Œè¿›çƒè¾ƒå¤šï¼Œåœºå‡è¿›çƒ2.80ä¸ª"},
  æ¯”ç”²:{goalRate:1.05, drawRate:1.02, homeAdv:13, homeWinRate:44, avgGoal:2.65, note:"æ¯”ç”²ï¼šæ”»é˜²å‡è¡¡ï¼Œåœºå‡è¿›çƒ2.65ä¸ª"},
  è‹±å† :{goalRate:1.02, drawRate:0.98, homeAdv:10, homeWinRate:42, avgGoal:2.45, note:"è‹±å† ï¼šç«äº‰æ¿€çƒˆï¼Œè¿›çƒé€‚ä¸­"},
  è‹±ç”²:{goalRate:0.95, drawRate:1.05, homeAdv:9, homeWinRate:40, avgGoal:2.30, note:"è‹±ç”²ï¼šèŠ‚å¥è¾ƒæ…¢ï¼Œå¹³å±€åå¤š"},
  è¥¿ä¹™:{goalRate:0.90, drawRate:1.10, homeAdv:8, homeWinRate:38, avgGoal:2.20, note:"è¥¿ä¹™ï¼šæŠ€æœ¯å‹ï¼Œè¿›çƒå°‘"},
  æ„ä¹™:{goalRate:0.88, drawRate:1.12, homeAdv:8, homeWinRate:37, avgGoal:2.15, note:"æ„ä¹™ï¼šé˜²å®ˆä¸ºä¸»ï¼Œå°çƒå¤š"},
  å¾·ä¹™:{goalRate:1.05, drawRate:0.95, homeAdv:12, homeWinRate:44, avgGoal:2.60, note:"å¾·ä¹™ï¼šè¿›çƒè¾ƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾"},
  æ³•ä¹™:{goalRate:0.92, drawRate:1.08, homeAdv:8, homeWinRate:39, avgGoal:2.25, note:"æ³•ä¹™ï¼šå¹³å±€å¤šï¼Œå°çƒå¤š"},
  è‘¡ç”²:{goalRate:1.00, drawRate:1.02, homeAdv:9, homeWinRate:40, avgGoal:2.40, note:"è‘¡ç”²ï¼šæ”»é˜²å‡è¡¡"},
  è·ä¹™:{goalRate:1.12, drawRate:0.88, homeAdv:14, homeWinRate:46, avgGoal:3.00, note:"è·ä¹™ï¼šå¤§çƒé¢‘å‡ºï¼Œä¸»åœºå¼ºåŠ¿"}
};

// çƒé˜Ÿæ•°æ®ï¼ˆä»…ä¿ç•™åŸæœ‰å¼ºé˜Ÿï¼Œå…¶ä½™ç”¨é»˜è®¤ç”Ÿæˆï¼‰
const teamData = {
  æ›¼åŸ:{power:96,attack:94,defend:91,style:2,home:1.12,away:0.94,homeWin:78,awayWin:65,recentForm:3, players:["å“ˆå…°å¾·","ç¦ç™»","å¾·å¸ƒåŠ³å†…","Bå¸­","ç½—å¾·é‡Œ"], city:"æ›¼å½»æ–¯ç‰¹", topScorer:"å“ˆå…°å¾·(22çƒ)", topAssist:"å¾·å¸ƒåŠ³å†…(12æ¬¡)", xG:2.1, xGA:0.9, injuries:["å“ˆå…°å¾·(ä¸»åŠ›å‰é”‹) å‡ºæˆ˜æˆç–‘","å¾·å¸ƒåŠ³å†…(æ ¸å¿ƒä¸­åœº) ä¼¤ç¼º"], styleDesc:"é«˜ä½é€¼æŠ¢,è¾¹è·¯è¿›æ”»", xgImpact:0.3},
  é˜¿æ£®çº³:{power:90,attack:89,defend:84,style:2,home:1.08,away:0.92,homeWin:72,awayWin:58,recentForm:2, players:["è¨å¡","å„å¾·é«˜","çƒ­è‹æ–¯","é©¬ä¸å†…åˆ©"], city:"ä¼¦æ•¦", topScorer:"è¨å¡(14çƒ)", topAssist:"å„å¾·é«˜(9æ¬¡)", xG:1.9, xGA:1.1, injuries:[], styleDesc:"ä¼ æ§æ¸—é€,å®šä½çƒ", xgImpact:0},
  åˆ©ç‰©æµ¦:{power:91,attack:92,defend:85,style:2,home:1.10,away:0.95,homeWin:75,awayWin:60,recentForm:2, players:["è¨æ‹‰èµ«","åŠªæ¶…æ–¯","èŒƒæˆ´å…‹","é˜¿åˆ©æ¾"], city:"åˆ©ç‰©æµ¦", topScorer:"è¨æ‹‰èµ«(20çƒ)", topAssist:"åŠªæ¶…æ–¯(7æ¬¡)", xG:2.0, xGA:1.0, injuries:[], styleDesc:"é«˜ä½å‹è¿«,å¿«é€Ÿåå‡»", xgImpact:0},
  åˆ‡å°”è¥¿:{power:86,attack:83,defend:84,style:1,home:1.05,away:0.96,homeWin:65,awayWin:52,recentForm:1, players:["æ–¯ç‰¹æ—","æ©ä½","è©¹å§†æ–¯"], city:"ä¼¦æ•¦", topScorer:"æ–¯ç‰¹æ—(10çƒ)", topAssist:"æ©ä½(6æ¬¡)", xG:1.5, xGA:1.3, injuries:[], styleDesc:"é˜²å®ˆåå‡»,ä¸­åœºç»æ€", xgImpact:0},
  æ›¼è”:{power:85,attack:82,defend:82,style:1,home:1.06,away:0.95,homeWin:64,awayWin:50,recentForm:1, players:["æ‹‰ä»€ç¦å¾·","Bè´¹","å¡å¡ç±³ç½—"], city:"æ›¼å½»æ–¯ç‰¹", topScorer:"æ‹‰ä»€ç¦å¾·(15çƒ)", topAssist:"Bè´¹(8æ¬¡)", xG:1.6, xGA:1.2, injuries:[], styleDesc:"è¾¹ä¸­ç»“åˆ,ä¸ªäººèƒ½åŠ›", xgImpact:0},
  çƒ­åˆº:{power:87,attack:86,defend:81,style:2,home:1.07,away:0.93,homeWin:68,awayWin:54,recentForm:1, players:["å‡¯æ©","å­™å…´æ…œ","éº¦è¿ªé€Š"], city:"ä¼¦æ•¦", topScorer:"å‡¯æ©(18çƒ)", topAssist:"å­™å…´æ…œ(8æ¬¡)", xG:1.8, xGA:1.3, injuries:["å­™å…´æ…œ(è¾¹é”‹) çº¢ç‰Œåœèµ›"], styleDesc:"é˜²å®ˆåå‡»,é€Ÿåº¦å‹è¾¹é”‹", xgImpact:0.2},
};
function getTeam(name){
  if(isCustom){return{power:80+Math.random()*16,attack:78+Math.random()*12,defend:78+Math.random()*12,style:1,home:1.05,away:0.97,homeWin:55,awayWin:45,recentForm:0, players:["æœªçŸ¥"], city:"æœªçŸ¥", topScorer:"æœªçŸ¥", topAssist:"æœªçŸ¥", xG:1.5, xGA:1.5, injuries:[], styleDesc:"æœªçŸ¥", xgImpact:0};}
  return teamData[name]||{power:75,attack:70,defend:70,style:1,home:1.0,away:1.0,homeWin:50,awayWin:40,recentForm:0, players:["æœªçŸ¥"], city:"ä¼¦æ•¦", topScorer:"æœªçŸ¥", topAssist:"æœªçŸ¥", xG:1.4, xGA:1.4, injuries:[], styleDesc:"æœªçŸ¥", xgImpact:0};
}
function getHomeName(){return isCustom?customHome:document.getElementById("homeTeam").value;}
function getAwayName(){return isCustom?customAway:document.getElementById("awayTeam").value;}

// çƒé˜Ÿåˆ—è¡¨ï¼ˆå…¨é¢æ‰©å±•ç‰ˆï¼‰
const teams = {
  "è‹±è¶…":{"2025-2026":["æ›¼åŸ","é˜¿æ£®çº³","åˆ©ç‰©æµ¦","åˆ‡å°”è¥¿","æ›¼è”","çƒ­åˆº","çº½å¡æ–¯å°”","å¸ƒè±é¡¿","é˜¿æ–¯é¡¿ç»´æ‹‰","åŸƒå¼—é¡¿","æ°´æ™¶å®«","è¥¿æ±‰å§†","å¯Œå‹’å§†","å¸ƒä¼¦ç‰¹ç¦å¾·","è¯ºä¸æ±‰æ£®æ—","ä¼¯æ©èŒ…æ–¯","ç‹¼é˜Ÿ","å—å®‰æ™®é¡¿","è±æ–¯ç‰¹åŸ","ä¼Šæ™®æ–¯ç»´å¥‡"]},
  "è¥¿ç”²":{"2025-2026":["çš‡é©¬","å·´è¨","é©¬ç«","å¡ç»´åˆ©äºš","çš‡å®¶ç¤¾ä¼š","èµ«ç½—çº³","ç“¦ä¼¦è¥¿äºš","æ¯•å°”å·´é„‚","æ¯”åˆ©äºšé›·äºšå°”","è´è’‚æ–¯","å¥¥è¨è‹çº³","é©¬æ´›å¡","æ‹‰æ–¯å¸•å°”é©¬æ–¯","é˜¿æ‹‰ç»´æ–¯","èµ«å¡”è´¹","å¡å°”å¡”","å·´åˆ—å¡è¯º","åŠ çš„æ–¯","æ ¼æ‹‰çº³è¾¾","é˜¿å°”æ¢…é‡Œäºš"]},
  "å¾·ç”²":{"2025-2026":["æ‹œä»","å¤šç‰¹","è±æ¯”é”¡","å‹’æ²ƒåº“æ£®","æŸæ—è”åˆ","æ³•å…°å…‹ç¦","é—¨å…´","æ–¯å›¾åŠ ç‰¹","æ²ƒå°”å¤«æ–¯å ¡","å¼—èµ–å ¡","éœèŠ¬æµ·å§†","ç¾å› èŒ¨","å¥¥æ ¼æ–¯å ¡","ç§‘éš†","æ³¢é¸¿","è¾¾å§†æ–½å¡”ç‰¹","æµ·ç™»æµ·å§†","åŸºå°”"]},
  "æ„ç”²":{"2025-2026":["å›½ç±³","ACç±³å…°","å°¤æ–‡","é‚£ä¸å‹’æ–¯","äºšç‰¹å…°å¤§","ç½—é©¬","æ‹‰é½å¥¥","ä½›ç½—ä¼¦è¨","åšæ´›å°¼äºš","éƒ½çµ","è’™æ‰","çƒ­é‚£äºš","è±åˆ‡","è¨ç´¢æ´›","å¼—ç½—è¥¿è¯ºå†…","æ©æ³¢åˆ©","ä¹Œè¿ªå†…æ–¯","å¡åˆ©äºšé‡Œ","ç»´ç½—çº³","è¨å‹’å°¼å¡”çº³"]},
  "æ³•ç”²":{"2025-2026":["å·´é»","é©¬èµ›","æ‘©çº³å“¥","é‡Œå°”","é‡Œæ˜‚","å°¼æ–¯","æœ—æ–¯","é›·æ©","æ–¯ç‰¹æ‹‰æ–¯å ¡","è’™å½¼åˆ©åŸƒ","å›¾å¢å…¹","å¸ƒé›·æ–¯ç‰¹","å—ç‰¹","å‹’é˜¿å¼—å°”","æ¢…æ–¯","å…‹è±è’™","æ´›é‡Œæ˜‚","æ¬§å¡å°”"]},
  "ä¸­è¶…":{"2025-2026":["ä¸Šæµ·æµ·æ¸¯","å±±ä¸œæ³°å±±","ä¸Šæµ·ç”³èŠ±","åŒ—äº¬å›½å®‰","æˆéƒ½è“‰åŸ","æ­¦æ±‰ä¸‰é•‡","æµ™æ±Ÿé˜Ÿ","å¤©æ´¥æ´¥é—¨è™","é•¿æ˜¥äºšæ³°","æ²³å—é˜Ÿ","æ²§å·é›„ç‹®","æ·±åœ³æ–°é¹åŸ","é’å²›æµ·ç‰›","å—é€šæ”¯äº‘","æ¢…å·å®¢å®¶"]},
  "æ¬§å† ":{"2025-2026":["æ›¼åŸ","çš‡é©¬","æ‹œä»","å·´è¨","å›½ç±³","å·´é»","å¤šç‰¹","åˆ©ç‰©æµ¦","é˜¿æ£®çº³","é©¬ç«","è±æ¯”é”¡","æ³¢å°”å›¾","æœ¬è²å¡","åŸƒå› éœæ¸©","å“¥æœ¬å“ˆæ ¹","å‡¯å°”ç‰¹äºº","é¡¿æ¶…èŒ¨å…‹çŸ¿å·¥","è¨å°”èŒ¨å ¡","è´å°”æ ¼è±å¾·çº¢æ˜Ÿ","å¹´è½»äºº"]},
  "è‘¡è¶…":{"2025-2026":["æœ¬è²å¡","æ³¢å°”å›¾","è‘¡è„ç‰™ä½“è‚²","å¸ƒæ‹‰åŠ ","å‰é©¬è‰¯æ–¯","é˜¿ç½—å¡","æ³•é©¬åˆ©åº·","åšé˜¿ç»´æ–¯å¡”","å¡è¨çš®äºš","åŸƒæ–¯æ‰˜é‡Œå°”","æ³•é²äºº","é˜¿é©¬å¤šæ‹‰","é‡Œå¥¥é˜¿ç»´","ç»´æ³½æ‹‰","æ²™ç»´ä»€"]},
  "è·ç”²":{"2025-2026":["é˜¿è´¾å…‹æ–¯","åŸƒå› éœæ¸©","è´¹è€¶è¯ºå¾·","ä¹Œå¾·å‹’æ”¯","é˜¿å°”å…‹é©¬å°”","ç‰¹æ¸©ç‰¹","é¹¿ç‰¹ä¸¹æ–¯å·´è¾¾","æµ·ä¼¦èŠ¬","ç¦å›¾çº³é”¡å¡”å¾·","å…¹æ²ƒå‹’","å‰è¿›ä¹‹é¹°","å¥ˆæ¢…äº¨","ç“¦å°”éŸ¦å…‹","é˜¿å°”æ¢…å‹’åŸ","èµ«æ‹‰å…‹å‹’æ–¯","æ²ƒä¼¦ä¸¹"]},
  "è‹è¶…":{"2025-2026":["å‡¯å°”ç‰¹äºº","æµæµªè€…","é˜¿ä¼¯ä¸","å¸Œä¼¯å°¼å®‰","å“ˆèŒ¨","åŸºå°”é©¬è¯ºå…‹","åœ£ç±³ä¼¦","é©¬ç‘ŸéŸ¦å°”","ç½—æ–¯éƒ¡","åˆ©æ–‡æ–¯é¡¿","é‚“è¿ªFC","åœ£çº¦ç¿°æ–¯é€š"]},
  "å·´ç”²":{"2025-2026":["å¸•å°”æ¢…æ‹‰æ–¯","å¼—æ‹‰é—¨æˆˆ","ç§‘æ—è’‚å®‰","åœ£ä¿ç½—","ç±³å†…ç½—ç«æŠ€","æ ¼é›·ç±³å¥¥","å·´è¥¿å›½é™…","åšå¡”å¼—æˆˆ","å¼—é²ç±³å«©å¡","å·´æ‹‰çº³ç«æŠ€","æ¡‘æ‰˜æ–¯","ç§‘é‡Œè’‚å·´","å¡é˜¿æ‹‰","ç¦å¡”é›·è¨","å·´ä¼Šäºš","æˆˆäºšæ–¯"]},
  "é˜¿ç”²":{"2025-2026":["åšå¡é’å¹´","æ²³åºŠ","ç‹¬ç«‹é˜Ÿ","åœ£æ´›ä¼¦ç´¢","æ‹‰åŠªæ–¯","æ‹‰æ™®æ‹‰å¡”ä½“æ“","é˜¿æ ¹å»·é’å¹´äºº","æ‹‰æ™®æ‹‰å¡”å¤§å­¦ç”Ÿ","ç§‘éš†ç«æŠ€","çº½ç»´å°”è€ç”·å­©","è¨æ–¯è²å°”å¾·","ç«æŠ€ä¿±ä¹éƒ¨","ç½—è¨é‡Œå¥¥ä¸­å¤®","é˜²å¾¡ä¸æ­£ä¹‰","å›¾åº“æ›¼ç«æŠ€","é£“é£é˜Ÿ","ç­è²å°”å¾·","åœ£è²è”åˆ","è¨å°”ç±³å®‰æœ","æˆˆå¤šä¼Šå…‹é²æ–¯"]},
  "Jè”èµ›":{"2025-2026":["å·å´å‰é”‹","æ¨ªæ»¨æ°´æ‰‹","æµ¦å’Œçº¢é’»","é¹¿å²›é¹¿è§’","åå¤å±‹é²¸","å¤§é˜ªæ¨±èŠ±","å¹¿å²›ä¸‰ç®­","ç¦å†ˆé»„èœ‚","æœ­å¹Œå†ˆè¨å¤š","é¸Ÿæ –ç ‚å²©","æ¹˜å—æ¯”é©¬","äº¬éƒ½ä¸æ­»é¸Ÿ","ç¥æˆ·èƒœåˆ©èˆ¹","æ¨ªæ»¨FC","æŸå¤ªé˜³ç¥","æ–°æ½Ÿå¤©é¹…","ä¸œäº¬FC","å¤§é˜ªé’¢å·´","ç”ºç”°æ³½ç»´äºš","ç£ç”°å–œæ‚¦"]},
  "Kè”èµ›":{"2025-2026":["å…¨åŒ—ç°ä»£","è”šå±±ç°ä»£","é¦–å°”FC","æ°´åŸä¸‰æ˜Ÿ","æµ¦é¡¹åˆ¶é“","å¤§é‚±FC","æµå·è”","æ±ŸåŸFC","ä»å·è”","æ°´åŸFC","å…‰å·FC","å¤§ç”°éŸ©äºšå¸‚æ°‘"]},
  "ç¾èŒè”":{"2025-2026":["è¿ˆé˜¿å¯†å›½é™…","æ´›æ‰çŸ¶FC","çº½çº¦åŸ","äºšç‰¹å…°å¤§è”","å¥¥å…°å¤šåŸ","å“¥ä¼¦å¸ƒæœºå‘˜","è´¹åŸè”åˆ","æ–°è‹±æ ¼å…°é©å‘½","è’™ç‰¹åˆ©å°”å†²å‡»","å¤šä¼¦å¤šFC","èŠåŠ å“¥ç«ç„°","åç››é¡¿è”","è¾›è¾›é‚£æ","åœ£è·¯æ˜“æ–¯åŸ","å¥¥æ–¯æ±€FC","çš‡å®¶ç›æ¹–åŸ","åœ£ä½•å¡åœ°éœ‡","è¾¾æ‹‰æ–¯FC","å ªè¨æ–¯åŸ","æ˜å°¼è‹è¾¾è”","æ³¢ç‰¹å…°ä¼æœ¨è€…","è¥¿é›…å›¾æµ·æ¹¾äºº","æ¸©å“¥åç™½æµª","æ´›æ‰çŸ¶é“¶æ²³","ä¼‘æ–¯é¡¿è¿ªçº³æ‘©","ç§‘ç½—æ‹‰å¤šæ€¥æµ"]},
  "ä¿„è¶…":{"2025-2026":["æ³½å°¼ç‰¹","è«æ–¯ç§‘ä¸­å¤®é™†å†›","è«æ–¯ç§‘è¿ªçº³æ‘©","å…‹æ‹‰æ–¯è¯ºè¾¾å°”","ç½—æ–¯æ‰˜å¤«","ç´¢å¥‘","è«æ–¯ç§‘ç«è½¦å¤´","ä¹Œæ‹‰å°”","å–€å±±çº¢å®çŸ³","å¥¥ä¼¦å ¡","è¯ºå¤«å“¥ç½—å¾·","æ²ƒç½—æ¶…æ—¥ç«ç‚¬","æ ¼ç½—å…¹å°¼","è«æ–¯ç§‘é±¼é›·","å¸Œå§†åŸº","å·´è’‚å¡"]},
  "åœŸè¶…":{"2025-2026":["åŠ æ‹‰å¡”è¨é›·","è´¹å†…å·´åˆ‡","è´è¥¿å…‹å¡”æ–¯","ç‰¹æ‹‰å¸ƒå®—ä½“è‚²","é˜¿è¾¾çº³å¾·ç±³å°”ä½“è‚²","ä¼Šæ–¯å¦å¸ƒå°”","å¼€å¡åˆ©ä½“è‚²","å®‰å¡”åˆ©äºšä½“è‚²","ç§‘å°¼äºšä½“è‚²","é˜¿å…°äºšä½“è‚²","é”¡ç“¦æ–¯ä½“è‚²","åŠ æµå®‰æ³°æ™®","å®‰å¡æ‹‰å¤åº“","å“ˆå¡”ä¼Šä½“è‚²","å½­è¿ªå…‹ä½“è‚²","ä»£ç±³å°”ä½“è‚²","å¡æ‹‰æ¯”å…‹ä½“è‚²"]},
  "æ¯”ç”²":{"2025-2026":["å¸ƒé²æ—¥","å®‰å¾·è±èµ«ç‰¹","äº¨å…‹","æ ‡å‡†åˆ—æ—¥","æ ¹ç‰¹","å®‰ç‰¹å«æ™®","åœ£å‰ç½—æ–¯","éŸ¦æ–¯ç‰¹æ´›","è‰²æ ¼æ‹‰å¸ƒé²æ—¥","æ¢…èµ«ä¼¦","å¥¥å“ˆç“¦é‡Œ","æ¬§æœ¬","ç§‘ç‰¹èµ–å…‹","åœ£å›¾å°”ç™»","æ²™å‹’ç½—ç“¦","è«ä¼¦è´å…‹"]},
  "è‹±å† ":{"2025-2026":["åˆ©å…¹è”","å—å®‰æ™®é¡¿","è±æ–¯ç‰¹åŸ","è¥¿å¸ƒæœ—","è¯ºç»´å¥‡","èµ«å°”åŸ","ç±³å¾·å°”æ–¯å ¡","è€ƒæ–‡å‚","æ™®é›·æ–¯é¡¿","æ¡‘å¾·å…°","æ–¯æ‰˜å…‹åŸ","æ–¯æ—ºè¥¿","å¸ƒè±å…‹æœ¬","ç±³å°”æ²ƒå°”","æ²ƒç‰¹ç¦å¾·","ä¼¯æ˜ç¿°","å¸ƒé‡Œæ–¯æ‰˜åŸ","è°¢å‘¨ä¸‰","å“ˆå¾·æ–¯è²å°”å¾·","ç½—ç‘Ÿæ±‰å§†","å¥³ç‹å…¬å›­å·¡æ¸¸è€…","æ™®åˆ©èŒ…æ–¯","åŠ çš„å¤«åŸ","ä¼Šæ™®æ–¯ç»´å¥‡"]},
  "è‹±ç”²":{"2025-2026":["å¾·æ¯”éƒ¡","åšå°”é¡¿","å·´æ©æ–¯åˆ©","å½¼å¾—å ¡è”","ç‰›æ´¥è”","æŸ¥å°”é¡¿","æœ´èŒ¨èŒ…æ–¯","æ—è‚¯åŸ","å¨ç§‘å§†","è°¢æ–¯ä¼¯åˆ©","å‰‘æ¡¥è”","ä¼¯é¡¿","åˆ‡å°”æ»•æ±‰å§†","åŸƒå…‹å¡ç‰¹åŸ","å¼—åˆ©ç‰¹ä¼å¾·","ç»´å°”æ¸¯","åŒ—å®‰æ™®é¡¿","å¸ƒé‡Œæ–¯æ‰˜æµæµª","é›·ä¸","å…‹åŠ³åˆ©","æ–¯è’‚æ–‡å°¼å¥‡","å¡è±å°”è”","è±é¡¿ä¸œæ–¹","å¸ƒè±å…‹æµ¦"]},
  "è¥¿ä¹™":{"2025-2026":["è¥¿ç­ç‰™äºº","è±åŠ å†…æ–¯","åŸƒç“¦å°”","å·´æ‹‰å¤šåˆ©å¾·","å¸Œæ´ªç«æŠ€","åŸƒå°”åˆ‡","è¨æ‹‰æˆˆè¨","è´¹ç½—å°”ç«æŠ€","é˜¿è«é›·æ¯”åŸƒå¡”","å®‰é“å°”","å¸ƒå°”æˆˆæ–¯","å¡å¡”èµ«çº³","é˜¿å°”ç“¦å¡ç‰¹","æ¯”åˆ©äºšé›·äºšå°”B","é˜¿å°”ç§‘å­”","æ¡‘å¦å¾·ç«æŠ€","è±ä¸‡ç‰¹","ç±³å…°å¾·æ–¯","å¥¥ç»´è€¶å¤š","éŸ¦æ–¯å¡","ç‰¹å†…é‡Œè´¹","åŸƒç™»æ–¯"]},
  "æ„ä¹™":{"2025-2026":["å¸•å°”é©¬","ç§‘è«","å¨å°¼æ–¯","å…‹é›·è«çº³","å¡å¦æ‰ç½—","å·´å‹’è«","æ¡‘æ™®å¤šåˆ©äºš","å¸ƒé›·è¥¿äºš","æ‘©å¾·çº³","å¥‡å¡”ä»£æ‹‰","æ¯”è¨","é›·ç„¦äºšçº³","ç§‘æ£®æ‰","æ–¯ä½©é½äºš","å—è’‚ç½—å°”","ç‰¹å°”çº³çº³","é˜¿æ–¯ç§‘åˆ©","è´¹æ‹‰å°”çš®è¨æ´›","è±ç§‘","å·´é‡Œ"]},
  "å¾·ä¹™":{"2025-2026":["åœ£ä¿åˆ©","åŸºå°”","æœå¡å°”å¤šå¤«","æ±‰å ¡","æ±‰è¯ºå¨","è²å°”ç‰¹","å¸•å¾·åšæ©","é©¬æ ¼å¾·å ¡","å¡å°”æ–¯é²å„","çº½ä¼¦å ¡","å‡¯æ³½æ–¯åŠ³æ»•","ç½—æ–¯æ‰˜å…‹","å¥¥æ–¯çº³å¸ƒå•å…‹","éŸ¦æ©å¨æ–¯å·´ç™»","ä¸ä¼¦ç‘å…‹","åŸƒå°”æ²ƒæ–¯å ¡","æ²™å°”å…‹04","æŸæ—èµ«å¡”"]},
  "æ³•ä¹™":{"2025-2026":["æ¬§å¡å°”","æ˜‚çƒ­","åœ£åŸƒè’‚å®‰","æ‹‰ç“¦å‹’","ç½—å¾·å…¹","æ³¢å°”å¤š","å·´æ–¯è’‚äºš","å¡æ˜‚","æ ¼å‹’è¯ºå¸ƒå°”","å·´é»FC","äºšçœ ","ç”˜å†ˆ","æ³¢åŸ","æ•¦åˆ»å°”å…‹","é˜¿é›…å…‹è‚–","ç“¦æœ—è°¢è®·","å­”å¡è¯º","å¥ç»´åˆ©","ç‰¹é²ç“¦"]},
  "è‘¡ç”²":{"2025-2026":["åœ£å…‹æ‹‰æ‹‰","é©¬é‡Œè¿ªè«","å›½æ°‘é˜Ÿ","é€šå¾·æ‹‰","é©¬å¤«æ‹‰","é›·å…‹æ–¯æ¬§æ–¯","é˜¿ç»´æ²³","è´¹é›·æ‹‰","è±é‡Œäºš","å¥¥åˆ©éŸ¦ä¼¦æ–¯","æœ¬è²å¡Bé˜Ÿ","æ³¢å°”å›¾Bé˜Ÿ","å¸ƒæ‹‰åŠ Bé˜Ÿ","ç»´å¡ä¹Œ","è´¹å°”ç›–æ‹‰ä»€","è±ç´¢æ–¯","ç§‘ç»´è‰¯","ä½©çº³è²è€¶å°”"]},
  "è·ä¹™":{"2025-2026":["å¨å»‰äºŒä¸–","æ ¼ç½—å®æ ¹","ç½—è¾¾JC","å¤šå¾·é›·èµ«ç‰¹","å¸ƒé›·è¾¾","åŸƒé—¨","é˜¿å°”å…‹é©¬å°”é’å¹´é˜Ÿ","é˜¿è´¾å…‹æ–¯é’å¹´é˜Ÿ","åŸƒå› éœæ¸©é’å¹´é˜Ÿ","ä¹Œå¾·å‹’æ”¯é’å¹´é˜Ÿ","èŠ¬æ´›","åå¸ƒå°”","æ ¼æ‹‰å¤«å¤æ™®","é©¬æ–¯ç‰¹é‡Œèµ«ç‰¹","å¥¥æ–¯","ç™»åšæ–¯","æµ·ç‰™","ç‰¹å°”æ–¯è¾¾","èµ«å°”è’™å¾·","FCåŸƒå› éœæ¸©","é‚“ä¼¯ä»€"]}
};

// å·¥å…·å‡½æ•°
function showToast(msg){const t=document.getElementById("toast");t.innerText=msg;t.style.display="block";setTimeout(()=>t.style.display="none",1800)}
function showLoading(){document.getElementById("loadingModal").classList.add("active")}
function hideLoading(){document.getElementById("loadingModal").classList.remove("active")}

function useCustomTeam() {
  let h = document.getElementById("customHome").value.trim();
  let a = document.getElementById("customAway").value.trim();
  if (!h || !a) { showToast("è¯·è¾“å…¥ä¸»é˜Ÿå’Œå®¢é˜Ÿåç§°"); return; }
  customHome = h; customAway = a; isCustom = true;
  document.getElementById("matchInfo").innerText = `å·²å¯ç”¨æ‰‹å†™ï¼š${h} vs ${a}`;
  document.getElementById("homeTeam").innerHTML = "<option>å·²ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</option>";
  document.getElementById("awayTeam").innerHTML = "<option>å·²ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</option>";
  document.getElementById("homeTeam").disabled = true;
  document.getElementById("awayTeam").disabled = true;
  document.getElementById("leagueNote").innerText = "è‡ªå®šä¹‰çƒé˜Ÿï¼šé€šç”¨è”èµ›é£æ ¼";
}

// èµ›å­£åˆ‡æ¢
document.querySelectorAll("#seasonTab .season").forEach(e=>{
  e.onclick=()=>{
    document.querySelectorAll("#seasonTab .season").forEach(x=>x.classList.remove("active"));
    e.classList.add("active");season=e.innerText;isCustom=false;
    document.getElementById("homeTeam").disabled = false;
    document.getElementById("awayTeam").disabled = false;
    document.getElementById("matchInfo").innerText="æœªé€‰æ‹©çƒé˜Ÿ";
    loadTeam();
  }
});
document.querySelectorAll("#leagueList .league-item").forEach(e=>{
  e.onclick=()=>{
    document.querySelectorAll("#leagueList .league-item").forEach(x=>x.classList.remove("active"));
    e.classList.add("active");league=e.innerText;isCustom=false;
    document.getElementById("homeTeam").disabled = false;
    document.getElementById("awayTeam").disabled = false;
    document.getElementById("matchInfo").innerText="æœªé€‰æ‹©çƒé˜Ÿ";
    document.getElementById("leagueNote").innerText = leagueAttr[league]?.note || "è”èµ›æ•°æ®åŠ è½½ä¸­";
    loadTeam();
    fetchRealData();
  }
});

function loadTeam(){
  let h=document.getElementById("homeTeam");
  let a=document.getElementById("awayTeam");
  h.innerHTML="<option>è¯·é€‰æ‹©ä¸»é˜Ÿ</option>";
  a.innerHTML="<option>è¯·é€‰æ‹©å®¢é˜Ÿ</option>";
  if(teams[league]&&teams[league][season]){
    teams[league][season].forEach(t=>{h.innerHTML+=`<option>${t}</option>`;a.innerHTML+=`<option>${t}</option>`;});
  }
}

// æ³Šæ¾åˆ†å¸ƒ
function poissonProbability(lambda, k) {
  return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
}
function factorial(n) {
  if (n === 0 || n === 1) return 1;
  let result = 1;
  for (let i = 2; i <= n; i++) result *= i;
  return result;
}

// ç¼“å­˜å·¥å…·
async function fetchWithCache(url, cacheKey, ttl=3600000) {
  const cached = localStorage.getItem(cacheKey);
  if (cached) {
    const { timestamp, data } = JSON.parse(cached);
    if (Date.now() - timestamp < ttl) return data;
  }
  try {
    const res = await fetch(url, { headers: { "X-Auth-Token": API_KEY } });
    const data = await res.json();
    localStorage.setItem(cacheKey, JSON.stringify({ timestamp: Date.now(), data }));
    return data;
  } catch (e) {
    return null;
  }
}

// è·å–ç§¯åˆ†æ¦œ & èµ›ç¨‹
async function fetchRealData() {
  try {
    const comp = COMP_MAP[league] || "PL";
    const standingUrl = `https://api.football-data.org/v4/competitions/${comp}/standings`;
    const standingData = await fetchWithCache(standingUrl, `standing_${comp}`, 3600000);
    if (standingData && standingData.standings) {
      let table = standingData.standings[0].table.slice(0,6);
      let html = '';
      table.forEach(t => {
        html += `<div class="table-item">${t.position}. ${t.team.shortName||t.team.name} ${t.points}åˆ†</div>`;
      });
      document.getElementById("standingTable").innerHTML = html;
      document.getElementById("realTimeData").style.display = "block";
    }
    const fixUrl = `https://api.football-data.org/v4/competitions/${comp}/matches?dateFrom=${getDate(1)}&dateTo=${getDate(3)}`;
    const fixData = await fetchWithCache(fixUrl, `fixtures_${comp}`, 3600000);
    if (fixData && fixData.matches) {
      let fixHtml = '';
      fixData.matches.slice(0,5).forEach(m => {
        fixHtml += `<div class="schedule-item">${m.homeTeam.name} vs ${m.awayTeam.name} <span>${new Date(m.utcDate).toLocaleDateString()}</span></div>`;
      });
      document.getElementById("fixturesList").innerHTML = fixHtml || '<div class="schedule-item">æš‚æ— æœªæ¥3å¤©èµ›ç¨‹</div>';
    }
    const todayUrl = `https://api.football-data.org/v4/competitions/${comp}/matches?dateFrom=${getDate(0)}&dateTo=${getDate(0)}`;
    const todayData = await fetchWithCache(todayUrl, `today_${comp}`, 3600000);
    if (todayData && todayData.matches) {
      let hotHtml = '';
      todayData.matches.slice(0,5).forEach(m => {
        hotHtml += `<div class="hot-match" onclick="selectTeams('${m.homeTeam.name}', '${m.awayTeam.name}')">${m.homeTeam.name} vs ${m.awayTeam.name}</div>`;
      });
      document.getElementById("hotMatches").innerHTML = hotHtml || '<div class="hot-match">æš‚æ— ä»Šæ—¥æ¯”èµ›</div>';
    }
  } catch (e) {}
}
function getDate(offset){
  let d = new Date();
  d.setDate(d.getDate() + offset);
  return d.toISOString().split('T')[0];
}
function selectTeams(home, away) {
  document.getElementById("homeTeam").value = home;
  document.getElementById("awayTeam").value = away;
  startAI();
}

// æ¨¡å‹å‚æ•°
let modelParams = { homeWeight:1.0, formWeight:1.0, h2hWeight:1.0 };
document.getElementById('homeWeight').addEventListener('input', (e)=> { document.getElementById('homeWeightVal').innerText = e.value; modelParams.homeWeight = parseFloat(e.value); });
document.getElementById('formWeight').addEventListener('input', (e)=> { document.getElementById('formWeightVal').innerText = e.value; modelParams.formWeight = parseFloat(e.value); });
document.getElementById('h2hWeight').addEventListener('input', (e)=> { document.getElementById('h2hWeightVal').innerText = e.value; modelParams.h2hWeight = parseFloat(e.value); });
function applyModelParams() { startAI(); }

let radarChart = null, h2hChart = null, trendChart = null, betTrendChart = null;

// é¢„æµ‹å†å²å­˜å‚¨
function savePrediction(home, away, score) {
  let history = JSON.parse(localStorage.getItem('predHistory') || '[]');
  history.unshift({home, away, score, time: new Date().toLocaleTimeString()});
  if(history.length>3) history.pop();
  localStorage.setItem('predHistory', JSON.stringify(history));
  renderHistory();
}
function renderHistory() {
  let history = JSON.parse(localStorage.getItem('predHistory') || '[]');
  let html = '';
  history.forEach(h => { html += `<div class="history-item">${h.home} ${h.score} ${h.away}<br><small>${h.time}</small></div>`; });
  document.getElementById('historyBox').innerHTML = html || '<div class="history-item">æš‚æ— å†å²</div>';
}

// å€’è®¡æ—¶å‡½æ•°
function updateCountdown(matchDate) {
  const countdownEl = document.getElementById('countdown');
  if (!matchDate) {
    countdownEl.innerText = '';
    return;
  }
  const now = new Date();
  const match = new Date(matchDate);
  if (match > now) {
    const diff = match - now;
    const hours = Math.floor(diff / 3600000);
    const mins = Math.floor((diff % 3600000) / 60000);
    const secs = Math.floor((diff % 60000) / 1000);
    countdownEl.innerText = `â³ è·ç¦»å¼€èµ›: ${hours}å°æ—¶${mins}åˆ†é’Ÿ${secs}ç§’`;
  } else {
    countdownEl.innerText = '';
  }
}

// ==================== å¢å¼ºç‰ˆ startAI å‡½æ•° ====================
async function startAI(){
  let hn=getHomeName();let an=getAwayName();
  if(!hn||!an||hn==an){
    showToast("è¯·é€‰æ‹©æœ‰æ•ˆçƒé˜Ÿ");
    return;
  }
  showLoading();
  try {
    let h=getTeam(hn);let a=getTeam(an);let lg=leagueAttr[league] || leagueAttr["è‹±è¶…"];
    
    // ä¼¤åœé‡åŒ–å½±å“
    let homeXgAdj = h.xG - (h.xgImpact || 0);
    let awayXgAdj = a.xG - (a.xgImpact || 0);
    
    let ph = h.power * h.home * modelParams.homeWeight + h.recentForm * modelParams.formWeight * 2;
    let pa = a.power * a.away * modelParams.homeWeight + a.recentForm * modelParams.formWeight * 2;

    document.getElementById("powerHome").style.width=Math.min(100,ph)+"%";
    document.getElementById("powerAway").style.width=Math.min(100,pa)+"%";
    document.getElementById("matchInfo").innerText=`${hn} vs ${an}`;
    document.getElementById("homeStat").innerText=`ä¸»åœºèƒœç‡ï¼š${h.homeWin}%`;
    document.getElementById("awayStat").innerText=`å®¢åœºèƒœç‡ï¼š${a.awayWin}%`;

    // xGæ˜¾ç¤º
    document.getElementById("homeXg").innerText = homeXgAdj.toFixed(1);
    document.getElementById("homeXga").innerText = h.xGA.toFixed(1);
    document.getElementById("awayXg").innerText = awayXgAdj.toFixed(1);
    document.getElementById("awayXga").innerText = a.xGA.toFixed(1);

    // å¤©æ°”æ¨¡æ‹Ÿ
    let weatherDesc = ["æ™´","å°é›¨","ä¸­é›¨","é›ª"][Math.floor(Math.random()*4)];
    let adjust = weatherDesc.includes("é›¨") ? -8 : (weatherDesc=="é›ª"? -15 : 0);
    document.getElementById("weatherDesc").innerText = weatherDesc;
    document.getElementById("xgAdjust").innerText = adjust + "% (" + weatherDesc + ")";

    // ä¼¤åœè¯¦ç»†
    let homeInj = h.injuries && h.injuries.length ? h.injuries.join(" Â· ") : "æ— é‡è¦ä¼¤åœ";
    let awayInj = a.injuries && a.injuries.length ? a.injuries.join(" Â· ") : "æ— é‡è¦ä¼¤åœ";
    document.getElementById("injuryDetail").innerHTML = `<div>ğŸ¥ ä¸»é˜Ÿ: ${homeInj}</div><div>ğŸ¥ å®¢é˜Ÿ: ${awayInj}</div>`;
    document.getElementById("injuryImpact").innerText = `ä¼¤åœå¯¼è‡´ä¸»é˜ŸxG -${(h.xgImpact||0).toFixed(1)}, å®¢é˜ŸxG -${(a.xgImpact||0).toFixed(1)}`;

    // è£åˆ¤ä¿¡æ¯ (æ¨¡æ‹Ÿ)
    let referees = ["è¿ˆå…‹å°”Â·å¥¥åˆ©å¼—","å®‰ä¸œå°¼Â·æ³°å‹’","é©¬ä¸Â·é˜¿ç‰¹é‡‘æ£®","ä¿ç½—Â·è’‚å°”å°¼"];
    let ref = referees[Math.floor(Math.random()*referees.length)];
    let yellow = (2.5 + Math.random()*2).toFixed(1);
    let red = (0.1 + Math.random()*0.3).toFixed(1);
    let pen = (0.05 + Math.random()*0.2).toFixed(2);
    document.getElementById("refereeName").innerText = ref;
    document.getElementById("refYellow").innerText = yellow;
    document.getElementById("refRed").innerText = red;
    document.getElementById("refPen").innerText = pen;
    document.getElementById("refNote").innerText = ref.includes("å¥¥åˆ©å¼—")?"æ‰§æ³•ä¸¥å‰ï¼Œå‡ºç‰Œå¤š":"å°ºåº¦è¾ƒæ¾ï¼Œæœ‰åˆ©è¿›æ”»";

    // æˆ˜æœ¯åˆ†æ
    document.getElementById("tacticsText").innerText = `${hn} ${h.styleDesc || 'æœªçŸ¥'} vs ${an} ${a.styleDesc || 'æœªçŸ¥'}`;

    // èƒœå¹³è´Ÿ (æ³Šæ¾)
    let win = 36 + (ph-pa)*1.1 + lg.homeWinRate/10 + Math.random()*4-2;
    let draw = 33 * lg.drawRate - Math.abs(ph-pa)/2.2 + Math.random()*3-1.5;
    let lose = 100 - win - draw;
    win = Math.round(Math.max(15,Math.min(75,win)));
    draw = Math.round(Math.max(12,Math.min(40,draw)));
    lose = Math.round(100-win-draw);
    if(lose<10) lose=10;
    let total = win+draw+lose;
    win = Math.round(win/total*100);
    draw = Math.round(draw/total*100);
    lose = 100-win-draw;
    document.getElementById("win").innerText=win+"%";
    document.getElementById("draw").innerText=draw+"%";
    document.getElementById("lose").innerText=lose+"%";

    // æœºå™¨å­¦ä¹ èåˆ (åŸºäºç‰¹å¾æƒé‡çš„é€»è¾‘å›å½’)
    // ç‰¹å¾: [å®åŠ›å·®, çŠ¶æ€å·®, ä¸»åœºä¼˜åŠ¿, å†å²äº¤é”‹ä¼˜åŠ¿, xGå·®, ä¼¤åœå½±å“]
    let powerDiff = ph - pa;
    let formDiff = h.recentForm - a.recentForm;
    let homeAdv = h.home - a.away;
    let h2hAdv = (h.power - a.power)/100; // æ¨¡æ‹Ÿå†å²äº¤é”‹ä¼˜åŠ¿
    let xgDiff = homeXgAdj - awayXgAdj;
    let injuryImpact = (h.xgImpact || 0) - (a.xgImpact || 0);
    
    // é¢„è®­ç»ƒæƒé‡ (æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…éœ€ç”¨çœŸå®æ•°æ®è®­ç»ƒ)
    const weights = [0.35, 0.20, 0.15, 0.10, 0.15, 0.05]; // å¯¹åº”ä¸Šè¿°ç‰¹å¾
    let features = [powerDiff, formDiff, homeAdv, h2hAdv, xgDiff, injuryImpact];
    let mlFactor = 0;
    for (let i=0; i<features.length; i++) {
      mlFactor += weights[i] * features[i];
    }
    // å°†mlFactorå½’ä¸€åŒ–åˆ°[-0.3, 0.3]ä¹‹é—´ï¼Œç”¨äºè°ƒæ•´æ³Šæ¾æ¦‚ç‡
    mlFactor = Math.max(-0.3, Math.min(0.3, mlFactor/100));
    
    // é‡æ–°è®¡ç®—æ³Šæ¾æ¯”åˆ†é¢„æµ‹ï¼Œå¹¶åº”ç”¨mlFactorå¾®è°ƒ
    const homeLambda = homeXgAdj * h.home * (1 + adjust/100) * (1 + mlFactor);
    const awayLambda = awayXgAdj * a.away * (1 - mlFactor);
    let scoreProb = [];
    for (let hg=0; hg<=5; hg++) {
      for (let ag=0; ag<=5; ag++) {
        let prob = poissonProbability(homeLambda, hg) * poissonProbability(awayLambda, ag);
        scoreProb.push({score:`${hg}-${ag}`, prob});
      }
    }
    scoreProb.sort((x,y)=>y.prob - x.prob);
    let top3 = scoreProb.slice(0,3);
    if(top3.length<3) top3 = [{score:"1-0",prob:0.15},{score:"1-1",prob:0.12},{score:"0-1",prob:0.10}];
    let aiScoreStr = top3[0].score.replace("-"," : ");
    document.getElementById("aiScore").innerText = aiScoreStr;
    document.getElementById("s1").innerText = top3[0].score;
    document.getElementById("s2").innerText = top3[1].score;
    document.getElementById("s3").innerText = top3[2].score;
    document.getElementById("prob1").innerText = (top3[0].prob*100).toFixed(1)+"%";
    document.getElementById("prob2").innerText = (top3[1].prob*100).toFixed(1)+"%";
    document.getElementById("prob3").innerText = (top3[2].prob*100).toFixed(1)+"%";
    document.getElementById("reason1").innerText = `xGæ¨¡å‹+${weatherDesc}è°ƒæ•´+MLä¿®æ­£`;
    document.getElementById("reason2").innerText = `å†å²äº¤é”‹å¸¸è§æ¯”åˆ†`;
    document.getElementById("reason3").innerText = `å®¢é˜Ÿåå‡»æ•ˆç‡é«˜`;

    // æ¯”èµ›é¢„æµ‹æ—¶é—´è½´
    let periods = [
      { name:"0-15'", prob: Math.round(poissonProbability(homeLambda, 0)*30) },
      { name:"16-30'", prob: Math.round(poissonProbability(homeLambda, 1)*20) },
      { name:"31-45'", prob: Math.round(poissonProbability(homeLambda, 2)*25) },
      { name:"46-60'", prob: Math.round(poissonProbability(awayLambda, 1)*20) },
      { name:"61-75'", prob: Math.round(poissonProbability(awayLambda, 2)*20) },
      { name:"76-90'", prob: Math.round(poissonProbability(homeLambda+awayLambda, 3)*15) }
    ];
    periods.sort((a,b)=>b.prob - a.prob);
    let timeAxisStr = periods.slice(0,3).map(p=>`${p.name} ${p.prob}%`).join(' Â· ');
    document.getElementById("timeAxis").innerText = timeAxisStr;

    // å¤§å°çƒæ¦‚ç‡
    let totalGoals = homeLambda + awayLambda;
    let overProb = 0, underProb = 0, equalProb = 0;
    for (let hg=0; hg<=5; hg++) {
      for (let ag=0; ag<=5; ag++) {
        let p = poissonProbability(homeLambda, hg) * poissonProbability(awayLambda, ag);
        if (hg+ag > 2.5) overProb += p;
        else if (hg+ag < 2.5) underProb += p;
        else equalProb += p;
      }
    }
    document.getElementById("overProb").innerText = (overProb*100).toFixed(1)+"%";
    document.getElementById("underProb").innerText = (underProb*100).toFixed(1)+"%";
    document.getElementById("equalProb").innerText = (equalProb*100).toFixed(1)+"%";

    // åŠå…¨åœº
    document.getElementById("ht_ww").innerText = Math.round(win*0.8)+"%";
    document.getElementById("ht_hw").innerText = Math.round(win*0.1)+"%";
    document.getElementById("ht_aw").innerText = Math.round(win*0.1)+"%";
    document.getElementById("ht_wd").innerText = Math.round(draw*0.3)+"%";
    document.getElementById("ht_hd").innerText = Math.round(draw*0.4)+"%";
    document.getElementById("ht_ad").innerText = Math.round(draw*0.3)+"%";
    document.getElementById("ht_wl").innerText = Math.round(lose*0.1)+"%";
    document.getElementById("ht_hl").innerText = Math.round(lose*0.2)+"%";
    document.getElementById("ht_al").innerText = Math.round(lose*0.7)+"%";

    document.getElementById("half").innerText = getHalf(win,draw,lose);
    document.getElementById("handicap").innerText = getHandicap(ph,pa);
    document.getElementById("total").innerText = getTotal(h.attack,a.attack,lg.avgGoal);
    document.getElementById("handicapHomeOdds").innerText = (0.85 + (ph-pa)/100).toFixed(2);
    document.getElementById("handicapAwayOdds").innerText = (0.95 - (ph-pa)/100).toFixed(2);
    document.getElementById("recent").innerText = h.recentForm>1?"ä¸»é˜Ÿè¿‘æœŸçŠ¶æ€ç«çƒ­":a.recentForm>1?"å®¢é˜Ÿè¿‘æœŸçŠ¶æ€ç«çƒ­":"çŠ¶æ€ç¨³å®š";

    // é›·è¾¾å›¾
    if (radarChart) radarChart.destroy();
    const ctx = document.getElementById('radarChart').getContext('2d');
    radarChart = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['è¿›æ”»', 'é˜²å®ˆ', 'ä¸»åœº', 'å®¢åœº', 'çŠ¶æ€', 'å®åŠ›'],
        datasets: [
          { label: hn, data: [h.attack, h.defend, h.home*80, h.away*80, h.recentForm*20+50, h.power], backgroundColor: 'rgba(64,150,255,0.2)', borderColor: '#4096FF' },
          { label: an, data: [a.attack, a.defend, a.home*80, a.away*80, a.recentForm*20+50, a.power], backgroundColor: 'rgba(255,77,79,0.2)', borderColor: '#FF4D4F' }
        ]
      },
      options: { scale: { min: 0, max: 100 } }
    });

    // è¿‘æœŸæˆ˜ç»© (æ¨¡æ‹Ÿ)
    let homeRecent = ["2025-03-10 åˆ‡å°”è¥¿ 2-1 èƒœ","2025-03-03 åˆ©ç‰©æµ¦ 1-1 å¹³","2025-02-25 çƒ­åˆº 3-0 èƒœ","2025-02-18 é˜¿æ£®çº³ 0-2 è´Ÿ","2025-02-10 æ›¼è” 1-0 èƒœ"];
    document.getElementById("homeRecentDetails").innerHTML = homeRecent.map(s=>`<div class="schedule-item">${s}</div>`).join('');
    let awayRecent = ["2025-03-09 æ›¼åŸ 1-2 è´Ÿ","2025-03-02 åˆ‡å°”è¥¿ 0-0 å¹³","2025-02-26 åˆ©ç‰©æµ¦ 2-1 èƒœ","2025-02-19 çƒ­åˆº 1-3 è´Ÿ","2025-02-12 é˜¿æ£®çº³ 2-2 å¹³"];
    document.getElementById("awayRecentDetails").innerHTML = awayRecent.map(s=>`<div class="schedule-item">${s}</div>`).join('');
    document.getElementById("homeRecord").innerHTML = genRecord(h.power, h.recentForm);
    document.getElementById("awayRecord").innerHTML = genRecord(a.power, a.recentForm);

    // æœªæ¥èµ›ç¨‹ (æ¨¡æ‹Ÿ)
    let homeFuture = ["2025-03-17  vs æ›¼è” (ä¸»)","2025-03-24  vs åˆ‡å°”è¥¿ (å®¢)","2025-04-07  vs åˆ©ç‰©æµ¦ (ä¸»)"];
    document.getElementById("homeFuture").innerHTML = homeFuture.map(s=>`<div class="schedule-item">${s}</div>`).join('');
    let awayFuture = ["2025-03-18  vs é˜¿æ£®çº³ (å®¢)","2025-03-25  vs æ›¼åŸ (ä¸»)","2025-04-08  vs çƒ­åˆº (å®¢)"];
    document.getElementById("awayFuture").innerHTML = awayFuture.map(s=>`<div class="schedule-item">${s}</div>`).join('');

    // å†å²äº¤é”‹ (æ¨¡æ‹Ÿ)
    let h2h = ["2025-02-10 æ›¼åŸ 2-1 çƒ­åˆº","2024-10-05 çƒ­åˆº 1-1 æ›¼åŸ","2024-03-15 æ›¼åŸ 0-2 çƒ­åˆº","2023-12-20 çƒ­åˆº 2-2 æ›¼åŸ","2023-08-27 æ›¼åŸ 3-1 çƒ­åˆº"];
    document.getElementById("h2hDetail").innerHTML = h2h.map(s=>`<div class="schedule-item">${s}</div>`).join('');
    document.getElementById("vsRecord").innerText = `è¿‘6æ¬¡äº¤é”‹ï¼šä¸»é˜Ÿèƒœ${Math.floor(Math.random()*3+1)} å¹³${Math.floor(Math.random()*2+1)} è´Ÿ${Math.floor(Math.random()*3+1)}`;

    // è¿›çƒåˆ†å¸ƒå›¾
    if (h2hChart) h2hChart.destroy();
    const h2hCtx = document.getElementById('h2hChart').getContext('2d');
    h2hChart = new Chart(h2hCtx, {
      type: 'bar',
      data: {
        labels: ['0-1çƒ', '2-3çƒ', '4+çƒ'],
        datasets: [{
          label: 'å‡ºç°æ¬¡æ•°',
          data: [2,2,1],
          backgroundColor: '#165DFF'
        }]
      },
      options: { scales: { y: { beginAtZero: true, max: 5 } } }
    });

    // å‡†ç¡®ç‡è¶‹åŠ¿å›¾ (æ¨¡æ‹Ÿ)
    if (trendChart) trendChart.destroy();
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    trendChart = new Chart(trendCtx, {
      type: 'line',
      data: {
        labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
        datasets: [{
          label: 'å‡†ç¡®ç‡ %',
          data: [70, 75, 80, 78, 82, 85, 88, 84, 86, 84],
          borderColor: '#FFD700',
          backgroundColor: 'rgba(255,215,0,0.1)',
          tension: 0.3
        }]
      },
      options: { scales: { y: { min: 50, max: 100 } } }
    });

    // é¦–å‘é˜µå®¹ + é˜Ÿå¾½ + å…³é”®çƒå‘˜çŠ¶æ€
    let homePlayers = h.players || ["æœªçŸ¥"];
    let awayPlayers = a.players || ["æœªçŸ¥"];
    document.getElementById("homeLineup").innerHTML = `<span class="team-badge" id="homeBadge" style="background:#4096FF;">${hn[0]}</span>4-3-3<br>${homePlayers.slice(0,3).join('Â·')}`;
    document.getElementById("awayLineup").innerHTML = `<span class="team-badge" id="awayBadge" style="background:#FF4D4F;">${an[0]}</span>4-4-2<br>${awayPlayers.slice(0,2).join('Â·')}`;
    // çƒå‘˜çŠ¶æ€
    document.querySelector("#lineupBox + div").innerHTML = `<div>ğŸ”¥ ${homePlayers[0]} è¿‘3åœº${Math.floor(Math.random()*5+1)}çƒ</div><div>âš¡ ${awayPlayers[0]} è¿‘3åœº${Math.floor(Math.random()*4)}çƒ${Math.floor(Math.random()*3)}åŠ©</div>`;

    // çƒ­åº¦
    let [hh,ah] = genHot(ph,pa);
    document.getElementById("hotHome").innerText = hh+"%";
    document.getElementById("hotAway").innerText = ah+"%";
    let conf = Math.min(98, Math.max(60, 75 + Math.abs(ph-pa)/2 + Math.abs(h.recentForm - a.recentForm)*3));
    document.getElementById("aiConfidence").innerText = `AIä¿¡å¿ƒæŒ‡æ•°ï¼š${Math.round(conf)}%`;

    // å›æµ‹æ¨¡æ‹Ÿ
    document.getElementById("backtestAcc").innerText = (70 + Math.random()*20).toFixed(0)+"%";
    document.getElementById("backtestCorrect").innerText = Math.floor(Math.random()*2+3)+"/5";

    // æ–°é—»æ»šåŠ¨
    document.getElementById("newsTicker").innerText = `ğŸ”´ ${hn}æ–°é—»: ${h.players[0] || ''}çŠ¶æ€ç«çƒ­ Â· ${an}æ–°é—»: ${a.players[1] || ''}ä¼¤ç–‘ Â· èµ›å‰å‘å¸ƒä¼šè¦ç‚¹`;
    // è½¬ä¼šä¼ é—»
    document.getElementById("transferTicker").innerText = `ğŸ“¢ è½¬ä¼šæµè¨€: ${hn}æœ‰æ„${awayPlayers[0]} Â· ${an}å…³æ³¨æ–°æ˜Ÿ Â· å¤šå®¶è±ªé—¨è™è§†çœˆçœˆ`;

    // ç¤¾äº¤çƒ­åº¦
    let socialH = Math.round(50 + (ph-pa)/2);
    let socialA = 100 - socialH;
    document.getElementById("socialHome").innerText = socialH + "%";
    document.getElementById("socialAway").innerText = socialA + "%";

    // éšè—è¯„åˆ†å¡
    document.getElementById("ratingCard").style.display = "none";

    // ä¿å­˜é¢„æµ‹å†å²
    savePrediction(hn, an, top3[0].score);
    // å€’è®¡æ—¶æ¨¡æ‹Ÿ (å‡è®¾æ¯”èµ›æ—¶é—´ä¸ºæ˜å¤©åŒä¸€æ—¶é—´)
    let tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    updateCountdown(tomorrow);

  } catch(e){ showToast("é¢„æµ‹å¤±è´¥"); } finally { hideLoading(); }
}

function getHalf(win,draw,lose){
  if(win>draw && win>lose) return ["èƒœèƒœ","èƒœå¹³"][Math.floor(Math.random()*2)];
  else if(draw>win && draw>lose) return ["å¹³å¹³","å¹³èƒœ","å¹³è´Ÿ"][Math.floor(Math.random()*3)];
  else if(lose>win && lose>draw) return ["è´Ÿè´Ÿ","å¹³è´Ÿ"][Math.floor(Math.random()*2)];
  else return ["èƒœå¹³","å¹³å¹³","å¹³è´Ÿ"][Math.floor(Math.random()*3)];
}
function getHandicap(ph,pa){
  let diff = ph-pa;
  if(diff>20) return "-2.0"; if(diff>15) return "-1.5"; if(diff>10) return "-1.0"; if(diff>5) return "-0.5";
  if(diff<-20) return "+2.0"; if(diff<-15) return "+1.5"; if(diff<-10) return "+1.0"; if(diff<-5) return "+0.5";
  return "0";
}
function getTotal(attH, attA, avg){ return avg > 2.8 ? "å¤§2.5/3" : avg > 2.4 ? "2.5" : "2/2.5"; }
function genRecord(power, form){
  let arr=[]; for(let i=0;i<6;i++){ let r=Math.random(); if(r<0.5) arr.push('<span class="win">èƒœ</span>'); else if(r<0.8) arr.push('<span class="draw">å¹³</span>'); else arr.push('<span class="lose">è´Ÿ</span>'); } return arr.join('');
}
function genHot(ph,pa){ let t=ph+pa; return [Math.round(ph/t*100), Math.round(pa/t*100)]; }

// å®æ—¶æ¯”èµ›æ•°æ®æ›´æ–°
async function updateLiveScore() {
  try {
    const res = await fetch(`https://api.football-data.org/v4/matches?status=LIVE`, {
      headers: { "X-Auth-Token": API_KEY }
    });
    const data = await res.json();
    const match = data.matches.find(m => 
      m.homeTeam.name.includes(getHomeName()) && m.awayTeam.name.includes(getAwayName())
    );
    if (match) {
      document.getElementById("simScore").innerText = `${match.score.fullTime.homeTeam} - ${match.score.fullTime.awayTeam}`;
      document.getElementById("simTime").innerText = match.minute + "'";
      document.getElementById("simEvent").innerText = match.status;
      if (match.goals && match.goals.length) {
        let last = match.goals[match.goals.length-1];
        document.getElementById("liveGoals").innerText = `âš½ ${last.minute}' ${last.team.name} è¿›çƒ (${last.scorer})`;
      }
    }
  } catch (e) {}
}

// æ¨¡æ‹Ÿæ¯”èµ› (å¢å¼ºç‰ˆ)
function startSim() {
  let hn = getHomeName(); let an = getAwayName();
  if (!hn || !an || hn == an) { showToast("è¯·é€‰æ‹©æœ‰æ•ˆçƒé˜Ÿ"); return; }
  clearInterval(simTimer); clearInterval(liveScoreTimer);
  
  liveScoreTimer = setInterval(updateLiveScore, 30000);
  
  let h = getTeam(hn); let a = getTeam(an);
  let min = 0, hg = 0, ag = 0;
  let hShot = 0, aShot = 0, hCorner = 0, aCorner = 0, hRed = 0, aRed = 0, hOff = 0, aOff = 0, hSave = 0, aSave = 0, hAssist = 0, aAssist = 0;
  let hWood = 0, aWood = 0, hSub = 0, aSub = 0;
  let hPass = 85, aPass = 82;
  let hDist = 105, aDist = 103;
  let hBall = Math.min(70, Math.max(30, 50 + (h.power - a.power)/5));
  let aBall = 100 - hBall;
  let homePlayers = h.players || ["çƒå‘˜A","çƒå‘˜B","çƒå‘˜C"];
  let awayPlayers = a.players || ["çƒå‘˜X","çƒå‘˜Y","çƒå‘˜Z"];
  let injuryTime = 0;
  let varPending = false;

  function updateStats() {
    document.getElementById("ballHome").innerText = hBall+"%"; document.getElementById("ballAway").innerText = aBall+"%";
    document.getElementById("shotHome").innerText = hShot; document.getElementById("shotAway").innerText = aShot;
    document.getElementById("cornerHome").innerText = hCorner; document.getElementById("cornerAway").innerText = aCorner;
    document.getElementById("redHome").innerText = hRed; document.getElementById("redAway").innerText = aRed;
    document.getElementById("offsideHome").innerText = hOff; document.getElementById("offsideAway").innerText = aOff;
    document.getElementById("saveHome").innerText = hSave; document.getElementById("saveAway").innerText = aSave;
    document.getElementById("assistHome").innerText = hAssist; document.getElementById("assistAway").innerText = aAssist;
    document.getElementById("woodHome").innerText = hWood; document.getElementById("woodAway").innerText = aWood;
    document.getElementById("subHome").innerText = hSub; document.getElementById("subAway").innerText = aSub;
    document.getElementById("passHome").innerText = hPass + "%"; document.getElementById("passAway").innerText = aPass + "%";
    document.getElementById("distHome").innerText = hDist; document.getElementById("distAway").innerText = aDist;
  }
  updateStats();
  document.getElementById("simTime").innerText = "00:00";
  document.getElementById("simScore").innerText = "0 - 0";
  document.getElementById("simEvent").innerText = "æ¯”èµ›å¼€å§‹";

  simTimer = setInterval(() => {
    if (min >= 90) {
      if (injuryTime === 0) {
        injuryTime = Math.floor(Math.random() * 6) + 1;
        document.getElementById("simEvent").innerText = `â±ï¸ ä¼¤åœè¡¥æ—¶ ${injuryTime} åˆ†é’Ÿ`;
      }
      if (min >= 90 + injuryTime) {
        clearInterval(simTimer); clearInterval(liveScoreTimer);
        document.getElementById("simEvent").innerText = `å…¨åœºæ¯”èµ›ç»“æŸï¼æœ€ç»ˆæ¯”åˆ† ${hg}-${ag}`;
        let homeRatings = { gk: (6+Math.random()*2).toFixed(1), def: (6+Math.random()*2).toFixed(1), mid: (6+Math.random()*2).toFixed(1), fwd: (6+Math.random()*2).toFixed(1) };
        let awayRatings = { gk: (6+Math.random()*2).toFixed(1), def: (6+Math.random()*2).toFixed(1), mid: (6+Math.random()*2).toFixed(1), fwd: (6+Math.random()*2).toFixed(1) };
        document.getElementById("ratingContent").innerHTML = 
          `<div class="home-rating">${hn} é—¨å°†:${homeRatings.gk} åå«:${homeRatings.def} ä¸­åœº:${homeRatings.mid} å‰é”‹:${homeRatings.fwd}</div>
           <div class="away-rating">${an} é—¨å°†:${awayRatings.gk} åå«:${awayRatings.def} ä¸­åœº:${awayRatings.mid} å‰é”‹:${awayRatings.fwd}</div>
           <div>æœ€ä½³çƒå‘˜: ${Math.random()>0.5?homePlayers[0]:awayPlayers[0]}</div>`;
        document.getElementById("ratingCard").style.display = "block";
        return;
      }
    }
    min++;
    let displayMin = min > 90 ? 90 + (min-90) : min;
    document.getElementById("simTime").innerText = displayMin < 10 ? "0" + displayMin + ":00" : displayMin + ":00";

    let timeMultiplier = 1;
    if (min >= 20 && min <= 35) timeMultiplier = 1.4;
    else if (min >= 56 && min <= 75) timeMultiplier = 1.5;
    else if (min >= 85) timeMultiplier = 1.8;
    let goalH = 0.012 * (h.attack * h.home - a.defend) * timeMultiplier / 100;
    let goalA = 0.012 * (a.attack * a.away - h.defend) * timeMultiplier / 100;
    goalH = Math.max(0.002, goalH); goalA = Math.max(0.002, goalA);

    let event = "";
    let rand = Math.random();

    if (!varPending && rand < 0.005 && min > 20 && min < 85) {
      varPending = true;
      event = `ğŸ–¥ï¸ VARæ£€æŸ¥ä¸­... å¯èƒ½æ¶‰åŠè¿›çƒ/ç‚¹çƒ/çº¢ç‰Œ`;
      setTimeout(() => {
        if (Math.random() < 0.3) {
          event = `ğŸ–¥ï¸ VARæ”¹åˆ¤ï¼è¿›çƒæ— æ•ˆ/ç‚¹çƒå–æ¶ˆ/çº¢ç‰Œå–æ¶ˆ`;
        } else {
          event = `ğŸ–¥ï¸ VARç¡®è®¤åŸåˆ¤ï¼Œæ¯”èµ›ç»§ç»­`;
        }
        varPending = false;
        document.getElementById("simEvent").innerText = event;
      }, 1500);
    }
    else if (rand < 0.01 && min > 10 && min < 85 && !varPending) {
      if (Math.random() < 0.5) event = `${min}â€² ç‚¹çƒï¼${hn}è·å¾—ç‚¹çƒæœºä¼š (${homePlayers[0]})`;
      else event = `${min}â€² ç‚¹çƒï¼${an}è·å¾—ç‚¹çƒæœºä¼š (${awayPlayers[1]})`;
    }
    else if (rand < 0.02 && min > 15 && !varPending) {
      if (Math.random() < 0.5) { hRed++; event = `ğŸ”´ ${min}â€² ${hn} ${homePlayers[2]} è¢«çº¢ç‰Œç½šä¸‹ï¼`; } 
      else { aRed++; event = `ğŸ”´ ${min}â€² ${an} ${awayPlayers[0]} è¢«çº¢ç‰Œç½šä¸‹ï¼`; }
    }
    else if (rand < 0.03 && !varPending) {
      if (Math.random() < hBall/100) { hWood++; event = `ğŸš€ ${min}â€² ${hn} å°„é—¨å‡»ä¸­é—¨æŸ±ï¼`; } 
      else { aWood++; event = `ğŸš€ ${min}â€² ${an} å°„é—¨å‡»ä¸­é—¨æŸ±ï¼`; }
    }
    else if (rand < 0.05 && !varPending) {
      if (Math.random() < 0.5) { hOff++; event = `ğŸš© ${min}â€² ${hn} è¶Šä½`; } 
      else { aOff++; event = `ğŸš© ${min}â€² ${an} è¶Šä½`; }
    }
    else if (rand < 0.08 && !varPending) {
      if (Math.random() < hBall/100) {
        hShot++; aSave++; event = `${min}â€² ${hn} å°„é—¨ï¼Œè¢«${awayPlayers[2]}æ‰‘å‡ºï¼`;
      } else {
        aShot++; hSave++; event = `${min}â€² ${an} å°„é—¨ï¼Œè¢«${homePlayers[1]}æ‰‘å‡ºï¼`;
      }
    }
    else if (rand < 0.12 && !varPending) {
      if (Math.random() < hBall/100) { hCorner++; event = `${min}â€² ${hn} è§’çƒ`; } 
      else { aCorner++; event = `${min}â€² ${an} è§’çƒ`; }
    }
    else if (rand < 0.15 && min > 60 && !varPending) {
      if (Math.random() < 0.5) { hSub++; event = `${min}â€² ${hn} æ¢äººï¼Œ8å·ä¸‹ï¼Œ19å·ä¸Š`; } 
      else { aSub++; event = `${min}â€² ${an} æ¢äººï¼Œ7å·ä¸‹ï¼Œ11å·ä¸Š`; }
    }
    else if (Math.random() < goalH && !varPending) {
      hg++; 
      let scorer = homePlayers[Math.floor(Math.random()*homePlayers.length)];
      let desc = Math.random()<0.3?"ä¸–ç•Œæ³¢ï¼è§’åº¦åˆé’»ï¼":"æ¨å°„ç ´é—¨";
      event = `âš½ GOALï¼${min}â€² ${hn} è¿›çƒï¼ ${scorer} (${desc})`;
      if (Math.random() < 0.3) { hAssist++; event += ` åŠ©æ”»: ${homePlayers[1]}`; }
      document.getElementById("simScore").innerText = `${hg} - ${ag}`;
    }
    else if (Math.random() < goalA && !varPending) {
      ag++;
      let scorer = awayPlayers[Math.floor(Math.random()*awayPlayers.length)];
      let desc = Math.random()<0.3?"å¤´çƒæ”»é—¨ï¼":"è¡¥å°„å¾—åˆ†";
      event = `âš½ GOALï¼${min}â€² ${an} è¿›çƒï¼ ${scorer} (${desc})`;
      if (Math.random() < 0.3) { aAssist++; event += ` åŠ©æ”»: ${awayPlayers[0]}`; }
      document.getElementById("simScore").innerText = `${hg} - ${ag}`;
    }

    if (event) document.getElementById("simEvent").innerText = event;
    hPass = Math.min(95, Math.max(70, hPass + (Math.random()*2-1)));
    aPass = Math.min(95, Math.max(70, aPass + (Math.random()*2-1)));
    hDist += Math.random()*0.5; aDist += Math.random()*0.5;
    updateStats();
  }, 500);
}

function showLineupEditor() {
  let editor = document.getElementById("lineupEditor");
  editor.style.display = editor.style.display === "none" ? "block" : "none";
  let h = getTeam(getHomeName());
  let a = getTeam(getAwayName());
  document.getElementById("homePlayersList").innerText = (h.players || []).slice(0,5).join(' ');
  document.getElementById("awayPlayersList").innerText = (a.players || []).slice(0,5).join(' ');
}

// åˆ†äº«é¢„æµ‹å¡ç‰‡
function sharePrediction() {
  const card = document.getElementById('predictionCard');
  if (!card) return;
  html2canvas(card).then(canvas => {
    const link = document.createElement('a');
    link.download = 'prediction.png';
    link.href = canvas.toDataURL();
    link.click();
    showToast('é¢„æµ‹å¡ç‰‡å·²ä¿å­˜');
  }).catch(() => showToast('æˆªå›¾å¤±è´¥'));
}

// å¤šè¯­è¨€æ”¯æŒ
let currentLang = 'zh';
const langToggle = document.getElementById('langToggle');
const langData = {
  zh: {
    siteTitle: 'âš½ è¶³çƒAIå¤§æ•°æ®é¢„æµ‹Â·æ——èˆ°æ»¡é…ç‰ˆ',
    headerSub: 'å…¨çƒè”èµ›Â·èµ”ç‡Â·xGÂ·å¤©æ°”Â·ä¼¤åœÂ·è£åˆ¤Â·èµ›ç¨‹Â·çƒå‘˜çŠ¶æ€Â·è½¬ä¼šÂ·VARÂ·è¯„åˆ†Â·æœºå™¨å­¦ä¹ ä¿®æ­£',
    themeToggle: 'ğŸŒ™ åˆ‡æ¢æµ…è‰²æ¨¡å¼',
    langToggle: 'ğŸŒ English',
    aiBtn: 'ğŸš€ AIæ·±åº¦é¢„æµ‹ (å«æœºå™¨å­¦ä¹ ä¿®æ­£)',
    simBtn: 'ğŸ® å¼€å§‹æ¨¡æ‹Ÿæ¯”èµ› (1:1çœŸå®äº‹ä»¶)',
  },
  en: {
    siteTitle: 'âš½ Football AI Prediction Â· Ultimate Edition',
    headerSub: 'Global LeaguesÂ·OddsÂ·xGÂ·WeatherÂ·InjuriesÂ·RefereeÂ·ScheduleÂ·Player FormÂ·TransfersÂ·VARÂ·RatingsÂ·ML',
    themeToggle: 'ğŸŒ™ Toggle Light Mode',
    langToggle: 'ğŸŒ ä¸­æ–‡',
    aiBtn: 'ğŸš€ AI Prediction (with ML)',
    simBtn: 'ğŸ® Start Simulation (Live Events)',
  }
};
function updateLang(lang) {
  document.getElementById('siteTitle').innerText = langData[lang].siteTitle;
  document.getElementById('headerSub').innerText = langData[lang].headerSub;
  document.getElementById('themeToggle').innerText = langData[lang].themeToggle;
  document.getElementById('langToggle').innerText = langData[lang].langToggle;
  document.getElementById('aiBtn').innerText = langData[lang].aiBtn;
  document.getElementById('simBtn').innerText = langData[lang].simBtn;
}
langToggle.addEventListener('click', () => {
  currentLang = currentLang === 'zh' ? 'en' : 'zh';
  updateLang(currentLang);
});

// ä¸»é¢˜åˆ‡æ¢
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
if (localStorage.getItem('theme') === 'light') { body.classList.add('light'); themeToggle.textContent = 'â˜€ï¸ åˆ‡æ¢æ·±è‰²æ¨¡å¼'; }
themeToggle.addEventListener('click', () => {
  if (body.classList.contains('light')) { body.classList.remove('light'); themeToggle.textContent = 'ğŸŒ™ åˆ‡æ¢æµ…è‰²æ¨¡å¼'; localStorage.setItem('theme', 'dark'); } 
  else { body.classList.add('light'); themeToggle.textContent = 'â˜€ï¸ åˆ‡æ¢æ·±è‰²æ¨¡å¼'; localStorage.setItem('theme', 'light'); }
});

// åˆå§‹åŒ–
document.ontouchmove = null; window.ontouchmove = null;
loadTeam();
fetchRealData();
renderHistory();

// PWA æ”¯æŒ
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').then(reg => console.log('SW registered')).catch(err => console.log('SW failed'));
  });
}
</script>
</body>
</html>
