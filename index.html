<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.5, user-scalable=yes">
  <title>âš¡ è¶³çƒé¢„æµ‹Â·è‡³å°Šå¢å¼ºç‰ˆÂ·å¤§å°ºå¯¸</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* ========== åŸºç¡€å…¨å±€æ ·å¼ï¼ˆè¶…å¤§ç‰ˆï¼‰========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }
    body {
      background: #0a1410;
      background-image: radial-gradient(circle at 30% 30%, #1a3a2a, #020806);
      padding: 2.5rem;
      min-height: 100vh;
      color: #e0f0e0;
      font-size: 20px; /* åŸºç¡€å­—ä½“å¤§å¹…æ”¾å¤§ */
    }
    .container { max-width: 1600px; margin: 0 auto; }

    /* ========== å¤´éƒ¨ï¼ˆè¶…å¤§ï¼‰========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 3rem;
      padding-bottom: 2rem;
      border-bottom: 4px solid #7cfc00;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(145deg, #aaffdd, #7cfc00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .badge {
      background: #1e4a3a;
      color: #b0ffd0;
      padding: 0.6rem 2rem;
      border-radius: 60px;
      font-size: 1.2rem;
      border: 2px solid #7cfc00;
    }

    /* ========== ä¸»å¡ç‰‡ï¼ˆè¶…å¤§ï¼‰========== */
    .card {
      background: rgba(20, 35, 30, 0.9);
      backdrop-filter: blur(12px);
      border-radius: 80px;
      padding: 3rem;
      border: 2px solid #2ecc71;
      box-shadow: 0 30px 60px rgba(0, 255, 150, 0.25);
      margin-bottom: 3rem;
    }

    /* ========== çƒé˜Ÿè¾“å…¥è¡Œï¼ˆè¶…å¤§ï¼‰========== */
    .team-row {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-bottom: 2.5rem;
      flex-wrap: wrap;
    }
    .team-input-wrapper {
      flex: 1 1 300px;
      position: relative;
    }
    .team-label {
      font-size: 1rem;
      color: #90d0a0;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .team-input {
      width: 100%;
      background: #0a1a12;
      border: 3px solid #1a5a3a;
      border-radius: 60px;
      padding: 1.5rem 2rem 1.5rem 4rem;
      font-size: 1.8rem;
      font-weight: 600;
      color: #e0f0e0;
      outline: none;
    }
    .team-input:focus {
      border-color: #7cfc00;
      box-shadow: 0 0 0 5px rgba(124, 252, 0, 0.25);
    }
    .team-icon {
      position: absolute;
      left: 1.8rem;
      top: 3.2rem;
      font-family: sans-serif;
      font-size: 1.8rem;
    }
    .vs {
      font-size: 3rem;
      font-weight: 800;
      color: #7cfc00;
      background: #1a3a2a;
      padding: 0.5rem 2.5rem;
      border-radius: 80px;
    }

    /* ========== æŒ‰é’®ç»„ï¼ˆè¶…å¤§ï¼‰========== */
    .button-group {
      display: flex;
      gap: 2rem;
      margin-bottom: 3rem;
      flex-wrap: wrap;
    }
    .btn {
      flex: 1;
      background: linear-gradient(145deg, #1e8a5a, #0a5a3a);
      border: none;
      color: white;
      padding: 1.5rem;
      border-radius: 80px;
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      cursor: pointer;
      border: 2px solid #7cfc00;
      transition: 0.1s;
      min-width: 200px;
    }
    .btn:active {
      transform: scale(0.97);
    }
    .btn-secondary {
      background: linear-gradient(145deg, #4a6a8a, #2a4a6a);
      border-color: #88aaff;
    }
    .btn-ai {
      background: linear-gradient(145deg, #8e44ad, #6c3483);
      border-color: #c39bd3;
    }

    /* ========== ç›´æ’­æµï¼ˆè¶…å¤§ï¼‰========== */
    .live-stream {
      background: #0a1a12;
      border-radius: 60px;
      padding: 2rem 2.5rem;
      margin-bottom: 3rem;
      border: 2px solid #7cfc00;
      max-height: 250px;
      overflow-y: auto;
      font-size: 1.2rem;
      color: #aaffaa;
    }
    .live-entry {
      margin-bottom: 0.8rem;
      border-left: 5px solid #7cfc00;
      padding-left: 1.5rem;
    }

    /* ========== çƒ­åŠ›å›¾ï¼ˆè¶…å¤§ï¼‰========== */
    .heatmap-container {
      background: #0e2a1e;
      border-radius: 60px;
      padding: 2rem;
      margin-bottom: 3rem;
      display: flex;
      gap: 2.5rem;
      flex-wrap: wrap;
    }
    .heatmap-half {
      flex: 1;
      min-width: 300px;
      height: 180px;
      background: #1a3a2a;
      border-radius: 40px;
      position: relative;
      overflow: hidden;
    }
    .shot-spot {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #7cfc00;
      opacity: 0.7;
      animation: pulse 1.5s infinite;
    }
    .shot-spot-away { background: #e67e22; }
    @keyframes pulse {
      0% { opacity: 0.4; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.5); }
      100% { opacity: 0.4; transform: scale(1); }
    }

    /* ========== xG é¢æ¿ï¼ˆè¶…å¤§ï¼‰========== */
    .xg-panel {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-bottom: 3rem;
      background: #0a1a12;
      border-radius: 80px;
      padding: 2rem 3rem;
    }
    .xg-item { flex: 1; text-align: center; }
    .xg-label { font-size: 1rem; color: #aaddaa; }
    .xg-value { font-size: 2.5rem; font-weight: 800; color: #7cfc00; }
    .xg-bar-container {
      flex: 2;
      height: 20px;
      background: #1a3a2a;
      border-radius: 30px;
      overflow: hidden;
    }
    .xg-bar {
      height: 100%;
      background: linear-gradient(90deg, #2ecc71, #7cfc00);
    }

    /* ========== å¤šæ¨¡å‹æ¦‚ç‡ï¼ˆè¶…å¤§ï¼‰========== */
    .models-panel {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
      background: #0a1a12;
      border-radius: 60px;
      padding: 2rem;
      margin-bottom: 2.5rem;
    }
    .model-item { text-align: center; }
    .model-name { font-size: 1rem; color: #aaddaa; }
    .model-prob { font-size: 1.8rem; font-weight: 700; color: #7cfc00; }

    /* ========== èåˆæ¦‚ç‡ï¼ˆè¶…å¤§ï¼‰========== */
    .ensemble-panel {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 2rem;
      background: #1a3a2a;
      border-radius: 80px;
      padding: 2rem 2rem;
      margin-bottom: 2.5rem;
    }
    .ensemble-item { text-align: center; }
    .ensemble-type { font-size: 1.2rem; color: #aaddaa; }
    .ensemble-prob { font-size: 3rem; font-weight: 800; color: #7cfc00; }

    /* ========== å†å²äº¤é”‹ï¼ˆè¶…å¤§ï¼‰========== */
    .history-panel {
      background: #0e2a1e;
      border-radius: 60px;
      padding: 2rem 2.5rem;
      margin-bottom: 2.5rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 2rem;
    }
    .history-title { font-weight: 700; color: #aaddaa; margin-right: 0.5rem; font-size: 1.3rem; }
    .history-grid {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }
    .history-item {
      background: #1a3a2a;
      border-radius: 40px;
      padding: 0.8rem 2rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffd966;
      border: 2px solid #7cfc00;
    }

    /* ========== AI åˆ†æåŒºå—ï¼ˆè¶…å¤§ï¼‰========== */
    .ai-analysis {
      background: #0e2a1e;
      border-left: 10px solid #7cfc00;
      border-radius: 40px;
      padding: 2rem;
      margin: 2.5rem 0;
    }
    .ai-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.2rem;
    }
    .ai-header i { font-size: 2.5rem; color: #7cfc00; }
    .ai-header span { font-size: 1.8rem; font-weight: 700; color: #aaffaa; }
    .ai-text { font-size: 1.2rem; line-height: 1.6; color: #d0f0d0; margin-bottom: 1rem; }
    .confidence-row {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-top: 1.2rem;
    }
    .confidence-bar { flex: 1; height: 12px; background: #1a3a2a; border-radius: 30px; overflow: hidden; }
    .confidence-fill { height: 100%; background: linear-gradient(90deg, #7cfc00, #2ecc71); }

    /* ========== è¿‘æœŸçŠ¶æ€ï¼ˆè¶…å¤§ï¼‰========== */
    .form-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 3rem;
      flex-wrap: wrap;
      gap: 2rem;
    }
    .form-team { display: flex; gap: 0.8rem; align-items: center; }
    .form-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: 800;
    }
    .win { background: #2ecc71; color: black; }
    .draw { background: #f1c40f; color: black; }
    .loss { background: #e74c3c; color: white; }

    /* ========== æ¯”åˆ†å¡ç‰‡ï¼ˆè¶…å¤§ï¼‰========== */
    .score-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }
    .score-item {
      background: #0a1a12;
      border-radius: 40px;
      padding: 2.5rem 0.5rem;
      text-align: center;
      border: 2px solid #2ecc71;
    }
    .score-number { font-size: 3rem; font-weight: 800; color: #ffd966; }
    .score-label {
      display: inline-block;
      background: #1e4a3a;
      padding: 0.8rem 2rem;
      border-radius: 60px;
      font-size: 1.2rem;
      font-weight: 600;
      color: #b0ffd0;
      margin: 1rem 0 0.8rem;
    }
    .probability { font-size: 2rem; font-weight: 700; color: #7cfc00; }
    .tip {
      display: inline-flex;
      align-items: center;
      gap: 0.8rem;
      background: #1e3a2a;
      border: 2px dashed #f39c12;
      padding: 0.8rem 2rem;
      border-radius: 60px;
      font-size: 1.2rem;
      color: #f1c40f;
    }

    /* ========== èµ”ç‡é¢æ¿ï¼ˆè¶…å¤§ï¼‰========== */
    .odds-panel {
      display: flex;
      justify-content: space-around;
      background: #0a1a12;
      border-radius: 80px;
      padding: 2rem 2rem;
      margin-bottom: 2.5rem;
    }
    .odds-item { text-align: center; }
    .odds-type { font-size: 1.2rem; color: #aaddaa; }
    .odds-value { font-size: 2rem; font-weight: 700; color: #f1c40f; }

    /* ========== è’™ç‰¹å¡æ´›é¢æ¿ï¼ˆè¶…å¤§ï¼‰========== */
    .monte-panel {
      background: #0e2a1e;
      border-radius: 60px;
      padding: 2rem;
      margin-bottom: 2.5rem;
    }
    .monte-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .monte-item {
      background: #1a3a2a;
      border-radius: 40px;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      font-size: 1.3rem;
    }

    /* ========== æƒé‡æ»‘å—ï¼ˆè¶…å¤§ï¼‰========== */
    .weight-panel {
      background: #0e2a1e;
      border-radius: 60px;
      padding: 2rem;
      margin-bottom: 2.5rem;
    }
    .weight-slider {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin: 1rem 0;
    }
    .weight-label { width: 150px; font-size: 1.2rem; }
    .weight-slider input { flex: 1; height: 10px; }

    /* ========== æ—¥å† & èµ›ç¨‹ï¼ˆè¶…å¤§ï¼‰========== */
    .calendar-panel {
      background: #0e2a1e;
      border-radius: 60px;
      padding: 2rem;
      margin-bottom: 2.5rem;
    }
    .calendar-grid {
      display: flex;
      gap: 1.5rem;
      overflow-x: auto;
      padding: 0.5rem 0;
    }
    .calendar-item {
      background: #1a3a2a;
      border-radius: 40px;
      padding: 1rem 2rem;
      min-width: 150px;
      text-align: center;
      border: 2px solid #7cfc00;
      cursor: pointer;
      font-size: 1.2rem;
    }

    /* ========== ä»Šæ—¥æ¯”èµ›ï¼ˆè¶…å¤§ï¼‰========== */
    .todays-matches-panel {
      background: #0e2a1e;
      border-radius: 60px;
      padding: 2rem;
      margin-bottom: 2.5rem;
      border: 2px solid #7cfc00;
    }
    .matches-list {
      max-height: 500px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }
    .match-item {
      background: #1a3a2a;
      border-radius: 40px;
      padding: 1.5rem 2rem;
      border: 2px solid #2ecc71;
      font-size: 1.2rem;
    }
    .match-time {
      font-size: 1.1rem;
      color: #aaffaa;
      background: #0a1a12;
      padding: 0.4rem 1.2rem;
      border-radius: 40px;
    }

    /* ========== æ’è¡Œæ¦œï¼ˆè¶…å¤§ï¼‰========== */
    .rank-panel {
      background: #0e2a1e;
      border-radius: 60px;
      padding: 2rem;
      margin-bottom: 2.5rem;
    }
    .rank-row {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 2px solid #1a5a3a;
      font-size: 1.3rem;
    }

    /* ========== é¡µè„šï¼ˆè¶…å¤§ï¼‰========== */
    .footer {
      margin-top: 4rem;
      padding-top: 2rem;
      border-top: 3px solid #7cfc00;
      display: flex;
      justify-content: space-between;
      color: #aaddaa;
      font-size: 1.2rem;
    }

    /* ========== å“åº”å¼è°ƒæ•´ï¼ˆæ‰‹æœºä¾ç„¶æ”¾å¤§ï¼‰========== */
    @media (max-width: 800px) {
      body { padding: 1.5rem; font-size: 18px; }
      .logo { font-size: 2.2rem; }
      .team-input { font-size: 1.4rem; }
      .btn { font-size: 1.2rem; padding: 1rem; }
      .score-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<div class="container">
  <!-- ========== å¤´éƒ¨ ========== -->
  <div class="header">
    <div class="logo">
      <i class="fas fa-crown"></i> è¶³çƒé¢„æµ‹Â·è‡³å°Šå¢å¼ºç‰ˆ
    </div>
    <div>
      <span class="badge" id="dataSourceBadge">âš¡ èåˆæ¨¡å‹</span>
      <span class="badge" style="margin-left:1rem;">ç§¯åˆ†: <span id="userCredits">1000</span></span>
      <button id="soundToggle" class="badge" style="background:#4a6a8a; border:none; margin-left:1rem; cursor:pointer;">
        <i class="fas fa-volume-off" id="soundIcon"></i>
      </button>
      <span class="badge"><i class="fas fa-mobile-alt"></i> PWA</span>
    </div>
  </div>

  <!-- ========== ä¸»å¡ç‰‡ ========== -->
  <div class="card">
    <!-- çƒé˜Ÿè¾“å…¥è¡Œ -->
    <div class="team-row">
      <div class="team-input-wrapper">
        <div class="team-label"><i class="fas fa-home"></i> ä¸»é˜Ÿ</div>
        <span class="team-icon" id="homeIcon"></span>
        <input type="text" id="homeTeam" class="team-input" placeholder="æ›¼åŸ">
      </div>
      <span class="vs">VS</span>
      <div class="team-input-wrapper">
        <div class="team-label"><i class="fas fa-plane"></i> å®¢é˜Ÿ</div>
        <span class="team-icon" id="awayIcon"></span>
        <input type="text" id="awayTeam" class="team-input" placeholder="åˆ©ç‰©æµ¦">
      </div>
    </div>

    <!-- æŒ‰é’®ç»„ -->
    <div class="button-group">
      <button id="refreshBtn" class="btn btn-ai"><i class="fas fa-sync-alt"></i> åˆ·æ–°é¢„æµ‹</button>
      <button id="useRealDataBtn" class="btn btn-secondary"><i class="fas fa-cloud-download-alt"></i> çœŸå®API</button>
      <button id="simulateLiveBtn" class="btn btn-secondary"><i class="fas fa-play"></i> æ¨¡æ‹Ÿç›´æ’­</button>
      <button id="copyResultBtn" class="btn btn-secondary"><i class="fas fa-copy"></i> å¤åˆ¶é¢„æµ‹</button>
      <button id="monteCarloBtn" class="btn btn-ai"><i class="fas fa-dice"></i> æ·±åº¦æ¨¡æ‹Ÿ</button>
    </div>

    <!-- èµ›å‰å¿«è®¯æ»šåŠ¨æ¡ -->
    <div class="news-ticker">
      <div class="news-content" id="newsTicker"></div>
    </div>

    <!-- ä»Šæ—¥æ¯”èµ›é¢æ¿ï¼ˆåŠ¨æ€æ’å…¥ï¼‰ -->
    <!-- ç›´æ’­æµåŒºåŸŸ -->
    <div id="liveStream" class="live-stream">
      <div class="live-entry">â±ï¸ ç­‰å¾…æ¯”èµ›å¼€å§‹...</div>
    </div>

    <!-- å†å²äº¤é”‹ -->
    <div id="historyPanel" class="history-panel">
      <span class="history-title"><i class="fas fa-history"></i> è¿‘5åœºäº¤é”‹</span>
      <div id="historyGrid" class="history-grid"></div>
    </div>

    <!-- æ”»é˜²é›·è¾¾å›¾ -->
    <div class="radar-container">
      <div class="radar-canvas-wrapper">
        <canvas id="radarHome" width="300" height="300"></canvas>
        <div style="text-align:center; margin-top:1rem; font-size:1.3rem;" id="homeTeamNameRadar">ä¸»é˜Ÿ</div>
      </div>
      <div class="radar-canvas-wrapper">
        <canvas id="radarAway" width="300" height="300"></canvas>
        <div style="text-align:center; margin-top:1rem; font-size:1.3rem;" id="awayTeamNameRadar">å®¢é˜Ÿ</div>
      </div>
    </div>

    <!-- å…³é”®çƒå‘˜è¯„åˆ† -->
    <div class="players-panel">
      <div class="players-row" id="homePlayers"></div>
      <div class="players-row" id="awayPlayers"></div>
    </div>

    <!-- è¿‘æœŸè¿›çƒèµ°åŠ¿ -->
    <div class="trend-container">
      <div class="trend-canvas-wrapper">
        <canvas id="trendCanvas" width="800" height="150"></canvas>
      </div>
    </div>

    <!-- xG é¢æ¿ -->
    <div id="xgPanel" class="xg-panel"></div>

    <!-- å¤šæ¨¡å‹æ¦‚ç‡é¢æ¿ -->
    <div id="modelsPanel" class="models-panel"></div>

    <!-- èµ”ç‡å¯¹æ¯”é¢æ¿ -->
    <div id="oddsPanel" class="odds-panel"></div>

    <!-- èƒœè´Ÿå€¾å‘æŒ‡ç¤ºå™¨ -->
    <div id="tiltIndicator" class="tilt-panel"></div>

    <!-- èåˆæ¦‚ç‡é¢æ¿ -->
    <div id="ensemblePanel" class="ensemble-panel"></div>

    <!-- è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿç»“æœé¢æ¿ -->
    <div id="montePanel" class="monte-panel"></div>

    <!-- AI åˆ†æåŒºå— -->
    <div id="aiAnalysis" class="ai-analysis"></div>

    <!-- è¿‘æœŸçŠ¶æ€ -->
    <div id="formPanel" class="form-row"></div>

    <!-- æ¯”åˆ†å¡ç‰‡ -->
    <div id="scoreContainer" class="score-grid"></div>

    <!-- è‡ªå®šä¹‰æƒé‡æ»‘å— -->
    <div id="weightPanel" class="weight-panel"></div>

    <!-- èµ›å­£ç§¯åˆ†æ¦œ -->
    <div class="rank-panel" style="margin-top:2rem;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
        <span style="font-size:1.8rem;"><i class="fas fa-table"></i> è™šæ‹Ÿèµ›å­£ç§¯åˆ†æ¦œ</span>
        <button id="refreshStandingsBtn" class="btn" style="padding:0.8rem 2rem; font-size:1.2rem;"><i class="fas fa-sync-alt"></i> åˆ·æ–°</button>
      </div>
      <div id="standingsGrid" style="display:grid; grid-template-columns:repeat(2,1fr); gap:1.5rem;"></div>
    </div>

    <!-- æ’è¡Œæ¦œ & ä¸‹æ³¨ -->
    <div class="rank-panel">
      <div style="display:flex; justify-content:space-between; margin-bottom:1.5rem;">
        <span style="font-size:1.8rem;"><i class="fas fa-trophy"></i> å…¨çƒé¢„æµ‹æ¦œ</span>
        <span style="font-size:1.5rem;"><i class="fas fa-coins"></i> ä¸‹æ³¨ç§¯åˆ†</span>
      </div>
      <div id="rankList"></div>
      <div style="display:flex; gap:1.5rem; margin-top:2rem;">
        <select id="betSelect" style="flex:1; background:#0a1a12; color:#e0f0e0; border:2px solid #7cfc00; border-radius:60px; padding:1rem; font-size:1.3rem;">
          <option value="home">ä¸»èƒœ</option>
          <option value="draw">å¹³å±€</option>
          <option value="away">å®¢èƒœ</option>
        </select>
        <input type="number" id="betAmount" value="10" min="1" max="1000" style="width:120px; background:#0a1a12; color:#e0f0e0; border:2px solid #7cfc00; border-radius:60px; padding:1rem; font-size:1.3rem;">
        <button id="placeBetBtn" class="btn btn-secondary" style="padding:1rem 2rem;">ä¸‹æ³¨</button>
      </div>
    </div>
  </div>

  <div class="footer">
    <div><i class="fas fa-shield-alt"></i> æœ¨å…°PSL-2.0</div>
    <div><i class="fas fa-globe-asia"></i> www.football-predict.top</div>
    <div><i class="fas fa-crown"></i> è‡³å°Šå¤§å°ºå¯¸ç‰ˆ</div>
  </div>
</div>

<script>
  "use strict";

  // ========== ğŸ”‘ é…ç½® ==========
  const FOOTBALL_API_KEY = '15aff59763f342bba8dd7da8782d467a';
  const API_BASE = 'https://api.football-data.org/v4';

  // ========== ğŸ³ï¸ çƒé˜Ÿå›½æ——/é˜Ÿå¾½æ˜ å°„ ==========
  const TEAM_ICONS = {
    'æ›¼åŸ': 'ğŸ‡¬ğŸ‡§', 'åˆ©ç‰©æµ¦': 'ğŸ‡¬ğŸ‡§', 'çš‡é©¬': 'ğŸ‡ªğŸ‡¸', 'å·´è¨': 'ğŸ‡ªğŸ‡¸',
    'æ‹œä»': 'ğŸ‡©ğŸ‡ª', 'å¤šç‰¹': 'ğŸ‡©ğŸ‡ª', 'å·´é»': 'ğŸ‡«ğŸ‡·', 'å°¤æ–‡': 'ğŸ‡®ğŸ‡¹',
    'ACç±³å…°': 'ğŸ‡®ğŸ‡¹', 'æ›¼è”': 'ğŸ‡¬ğŸ‡§', 'é˜¿æ£®çº³': 'ğŸ‡¬ğŸ‡§', 'åˆ‡å°”è¥¿': 'ğŸ‡¬ğŸ‡§',
    'çƒ­åˆº': 'ğŸ‡¬ğŸ‡§', 'å›½ç±³': 'ğŸ‡®ğŸ‡¹', 'é©¬ç«': 'ğŸ‡ªğŸ‡¸', 'å‹’æ²ƒåº“æ£®': 'ğŸ‡©ğŸ‡ª',
    'è±æ¯”é”¡': 'ğŸ‡©ğŸ‡ª', 'å¡ç»´åˆ©äºš': 'ğŸ‡ªğŸ‡¸', 'æ¯”åˆ©äºšé›·äºšå°”': 'ğŸ‡ªğŸ‡¸', 'æ³¢å°”å›¾': 'ğŸ‡µğŸ‡¹',
    'æœ¬è²å¡': 'ğŸ‡µğŸ‡¹', 'é˜¿è´¾å…‹æ–¯': 'ğŸ‡³ğŸ‡±', 'æ³½å°¼ç‰¹': 'ğŸ‡·ğŸ‡º', 'å‡¯å°”ç‰¹äºº': 'ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿',
    'åŠ æ‹‰å¡”è¨é›·': 'ğŸ‡¹ğŸ‡·', 'è¨å°”èŒ¨å ¡': 'ğŸ‡¦ğŸ‡¹', 'å“¥æœ¬å“ˆæ ¹': 'ğŸ‡©ğŸ‡°', 'å¹´è½»äºº': 'ğŸ‡¨ğŸ‡­',
    'é©¬å°”é»˜': 'ğŸ‡¸ğŸ‡ª', 'åæ²™å†›å›¢': 'ğŸ‡µğŸ‡±', 'è´å°”æ ¼è±å¾·çº¢æ˜Ÿ': 'ğŸ‡·ğŸ‡¸', 'é¡¿æ¶…èŒ¨å…‹çŸ¿å·¥': 'ğŸ‡ºğŸ‡¦',
    'é‡Œæ˜‚': 'ğŸ‡«ğŸ‡·', 'æ‘©çº³å“¥': 'ğŸ‡«ğŸ‡·', 'æ‹‰é½å¥¥': 'ğŸ‡®ğŸ‡¹', 'ç½—é©¬': 'ğŸ‡®ğŸ‡¹',
    'é‚£ä¸å‹’æ–¯': 'ğŸ‡®ğŸ‡¹', 'å¤šç‰¹è’™å¾·': 'ğŸ‡©ğŸ‡ª', 'é—¨å…´': 'ğŸ‡©ğŸ‡ª', 'æ³•å…°å…‹ç¦': 'ğŸ‡©ğŸ‡ª',
    'çš‡å®¶ç¤¾ä¼š': 'ğŸ‡ªğŸ‡¸', 'æ¯•å°”å·´é„‚': 'ğŸ‡ªğŸ‡¸', 'ç“¦ä¼¦è¥¿äºš': 'ğŸ‡ªğŸ‡¸', 'è´è’‚æ–¯': 'ğŸ‡ªğŸ‡¸',
    'å¸ƒè±é¡¿': 'ğŸ‡¬ğŸ‡§', 'çº½å¡æ–¯å°”': 'ğŸ‡¬ğŸ‡§', 'é˜¿æ–¯é¡¿ç»´æ‹‰': 'ğŸ‡¬ğŸ‡§', 'ç‹¼é˜Ÿ': 'ğŸ‡¬ğŸ‡§'
  };

  // ========== è¶…çœŸå®çƒé˜Ÿæ•°æ®åº“ç”Ÿæˆ ==========
  const FIRST_NAMES = ['James','John','Michael','David','Daniel','Kevin','Thomas','Paul','Mark','Steven','Robert','William','Charles','Joseph','Anthony','Andrew','Joshua','Christopher','Brian','Matthew'];
  const LAST_NAMES = ['Smith','Johnson','Williams','Brown','Jones','Garcia','Miller','Davis','Rodriguez','Martinez','Hernandez','Lopez','Gonzalez','Wilson','Anderson','Thomas','Taylor','Moore','Jackson','Martin'];

  function generatePlayers(count = 11) {
    const players = [];
    for (let i = 0; i < count; i++) {
      const firstName = FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)];
      const lastName = LAST_NAMES[Math.floor(Math.random() * LAST_NAMES.length)];
      players.push(`${firstName} ${lastName}`);
    }
    return players;
  }

  function generateTeamDB() {
    const teams = Object.keys(TEAM_ICONS);
    const db = {};
    teams.forEach(name => {
      db[name] = {
        attack: Math.floor(Math.random() * 30 + 70), // 70-100
        defense: Math.floor(Math.random() * 30 + 65),
        midfield: Math.floor(Math.random() * 30 + 70),
        speed: Math.floor(Math.random() * 30 + 65),
        experience: Math.floor(Math.random() * 20 + 75),
        shotsPerGame: 14 + Math.random() * 6,
        boxShotsPercent: 0.55 + Math.random() * 0.1,
        outsideShotsPercent: 0.25 + Math.random() * 0.1,
        headerShotsPercent: 0.1 + Math.random() * 0.05,
        conversionBox: 0.12 + Math.random() * 0.05,
        conversionOutside: 0.03 + Math.random() * 0.02,
        conversionHeader: 0.08 + Math.random() * 0.04,
        avgAge: 24 + Math.floor(Math.random() * 6),
        injuryProb: Math.random() * 0.2,
        style: ['æ§çƒ', 'é˜²å®ˆåå‡»', 'é•¿ä¼ å†²åŠ', 'é«˜ä½é€¼æŠ¢'][Math.floor(Math.random() * 4)],
        weatherAdapt: 0.8 + Math.random() * 0.4,
        players: generatePlayers()
      };
    });
    return db;
  }
  let TEAM_DB_FULL = generateTeamDB();

  function getTeamData(teamName) {
    return TEAM_DB_FULL[teamName] || {
      attack: 85, defense: 82, midfield: 80, speed: 78, experience: 80,
      shotsPerGame: 15.0,
      boxShotsPercent: 0.6, outsideShotsPercent: 0.27, headerShotsPercent: 0.13,
      conversionBox: 0.14, conversionOutside: 0.04, conversionHeader: 0.11,
      avgAge: 26, injuryProb: 0.1, style: 'å‡è¡¡', weatherAdapt: 1.0,
      players: generatePlayers()
    };
  }

  // ========== éŸ³æ•ˆç³»ç»Ÿ ==========
  let soundEnabled = false;
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function playClick() {
    if (!soundEnabled || audioCtx.state === 'suspended') return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.value = 800;
    gain.gain.value = 0.1;
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
    osc.connect(gain).connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.1);
  }

  // ========== å·¥å…·å‡½æ•° ==========
  function rand(min, max) { return Math.random() * (max - min) + min; }
  function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
  function parseForm(formStr) { return formStr.split('').map(c => c === 'W' ? 'W' : c === 'D' ? 'D' : 'L'); }

  // ========== è‡ªåŠ¨ä¿å­˜ ==========
  const STORAGE_KEY = 'football_teams';
  function loadTeamsFromStorage() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) {
      try {
        const { home, away } = JSON.parse(stored);
        document.getElementById('homeTeam').value = home || 'æ›¼åŸ';
        document.getElementById('awayTeam').value = away || 'åˆ©ç‰©æµ¦';
      } catch (e) { }
    } else {
      document.getElementById('homeTeam').value = 'æ›¼åŸ';
      document.getElementById('awayTeam').value = 'åˆ©ç‰©æµ¦';
    }
    updateTeamIcons();
  }
  function saveTeamsToStorage() {
    const home = document.getElementById('homeTeam').value.trim() || 'ä¸»é˜Ÿ';
    const away = document.getElementById('awayTeam').value.trim() || 'å®¢é˜Ÿ';
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ home, away }));
    updateTeamIcons();
  }

  function updateTeamIcons() {
    const home = document.getElementById('homeTeam').value.trim();
    const away = document.getElementById('awayTeam').value.trim();
    document.getElementById('homeIcon').innerText = TEAM_ICONS[home] || 'ğŸ³ï¸';
    document.getElementById('awayIcon').innerText = TEAM_ICONS[away] || 'ğŸ³ï¸';
    document.getElementById('homeTeamNameRadar').innerText = home || 'ä¸»é˜Ÿ';
    document.getElementById('awayTeamNameRadar').innerText = away || 'å®¢é˜Ÿ';
  }

  // ========== ç”Ÿæˆè¿‘æœŸçŠ¶æ€ ==========
  function generateForm() { return Array(5).fill().map(() => Math.random() < 0.45 ? 'W' : Math.random() < 0.7 ? 'D' : 'L'); }

  // ========== ç”Ÿæˆå†å²äº¤é”‹ ==========
  function generateHistory(homeTeam, awayTeam) {
    const history = [];
    for (let i = 0; i < 5; i++) {
      const homeGoals = randInt(0, 4);
      const awayGoals = randInt(0, 3);
      history.push(`${homeGoals}:${awayGoals}`);
    }
    return history;
  }

  // ========== å°„é—¨ä½ç½®xGè®¡ç®—ï¼ˆåŸºæœ¬ï¼‰==========
  function calculateXG(homeTeam, awayTeam) {
    const homeData = getTeamData(homeTeam);
    const awayData = getTeamData(awayTeam);
    const homePlayerFactor = 0.9 + Math.random() * 0.2;
    const awayPlayerFactor = 0.9 + Math.random() * 0.2;
    const homeAdv = 1.05 * homeData.weatherAdapt * (1 - homeData.injuryProb * 0.2) * homePlayerFactor;
    const awayAdv = 1.0 * awayData.weatherAdapt * (1 - awayData.injuryProb * 0.2) * awayPlayerFactor;
    let homeXG = homeData.shotsPerGame * homeAdv * homeData.boxShotsPercent * homeData.conversionBox
      + homeData.shotsPerGame * homeAdv * homeData.outsideShotsPercent * homeData.conversionOutside
      + homeData.shotsPerGame * homeAdv * homeData.headerShotsPercent * homeData.conversionHeader;
    let awayXG = awayData.shotsPerGame * awayAdv * awayData.boxShotsPercent * awayData.conversionBox
      + awayData.shotsPerGame * awayAdv * awayData.outsideShotsPercent * awayData.conversionOutside
      + awayData.shotsPerGame * awayAdv * awayData.headerShotsPercent * awayData.conversionHeader;
    homeXG *= (0.9 + Math.random() * 0.2);
    awayXG *= (0.9 + Math.random() * 0.2);
    homeXG = Math.min(3.8, Math.max(0.4, homeXG));
    awayXG = Math.min(3.5, Math.max(0.3, awayXG));
    return { home: homeXG, away: awayXG };
  }

  // ========== æˆ˜æœ¯æ»‘å—å½±å“ ==========
  let offensiveTendency = 50;
  let defensiveTendency = 50;
  function calculateXGWithTactics(homeTeam, awayTeam) {
    let xg = calculateXG(homeTeam, awayTeam);
    xg.home *= (offensiveTendency / 50);
    xg.away *= ((100 - defensiveTendency) / 50);
    return xg;
  }

  // ========== å¤šæ¨¡å‹é¢„æµ‹ ==========
  function modelDNN(xgDiff, formDiff, strengthDiff, homeAdv) {
    return 0.4 * xgDiff + 0.3 * formDiff + 0.2 * strengthDiff + 0.1 * homeAdv + (Math.random() - 0.5) * 0.3;
  }
  function modelRF(xgDiff, formDiff, strengthDiff, homeAdv) {
    return 0.35 * xgDiff + 0.25 * formDiff + 0.25 * strengthDiff + 0.15 * homeAdv + (Math.random() - 0.5) * 0.2;
  }
  function modelBayes(xgDiff, formDiff, strengthDiff, homeAdv) {
    return 0.3 * xgDiff + 0.2 * formDiff + 0.3 * strengthDiff + 0.2 * homeAdv + (Math.random() - 0.5) * 0.15;
  }

  // ========== è®¡ç®—æ¨¡å‹ç»“æœï¼ˆå«è‡ªå®šä¹‰æƒé‡ï¼‰==========
  let customWeights = { xgDiff: 0.3, formDiff: 0.2, strengthDiff: 0.15, homeAdv: 0.1, history: 0.07, injury: 0.08, players: 0.05 };
  
  function computeModels(homeXG, awayXG, homeForm, awayForm, homeTeam, awayTeam, history) {
    const homeData = getTeamData(homeTeam);
    const awayData = getTeamData(awayTeam);
    const xgDiff = homeXG - awayXG;
    const formScore = (homeForm.filter(r => r === 'W').length * 2 + homeForm.filter(r => r === 'D').length * 1) -
      (awayForm.filter(r => r === 'W').length * 2 + awayForm.filter(r => r === 'D').length * 1);
    const strengthDiff = homeData.attack - awayData.attack;
    const homeAdv = 0.5;
    const historyFactor = (history.filter(score => { let [h, a] = score.split(':'); return h > a; }).length -
      history.filter(score => { let [h, a] = score.split(':'); return h < a; }).length) * 0.05;

    const dnn = modelDNN(xgDiff, formScore / 10, strengthDiff / 10, homeAdv + historyFactor);
    const rf = modelRF(xgDiff, formScore / 10, strengthDiff / 10, homeAdv + historyFactor);
    const bayes = modelBayes(xgDiff, formScore / 10, strengthDiff / 10, homeAdv + historyFactor);

    const toProb = (raw) => {
      const expHome = Math.exp(raw);
      const expAway = Math.exp(-raw);
      const denom = expHome + expAway + 1.2;
      return {
        home: Math.round((expHome / denom) * 100),
        draw: Math.round((1.2 / denom) * 100),
        away: Math.round((expAway / denom) * 100)
      };
    };
    const dnnProb = toProb(dnn);
    const rfProb = toProb(rf);
    const bayesProb = toProb(bayes);

    // ä½¿ç”¨è‡ªå®šä¹‰æƒé‡è®¡ç®—èåˆæ¦‚ç‡ï¼ˆåŠ æƒå¹³å‡ï¼‰
    const totalWeight = customWeights.xgDiff + customWeights.formDiff + customWeights.strengthDiff + customWeights.homeAdv + customWeights.history + customWeights.injury + customWeights.players;
    const ensembleHome = Math.round((dnnProb.home * 0.4 + rfProb.home * 0.3 + bayesProb.home * 0.3) * (totalWeight / 2.5)); // ç®€åŒ–ï¼Œå®é™…å¯æ›´å¤æ‚
    const ensembleDraw = Math.round((dnnProb.draw * 0.4 + rfProb.draw * 0.3 + bayesProb.draw * 0.3) * (totalWeight / 2.5));
    const ensembleAway = 100 - ensembleHome - ensembleDraw;

    const stdDev = Math.sqrt(
      (Math.pow(dnnProb.home - ensembleHome, 2) +
        Math.pow(rfProb.home - ensembleHome, 2) +
        Math.pow(bayesProb.home - ensembleHome, 2)) / 3
    );
    const confidence = Math.max(60, Math.min(98, 90 - stdDev * 2));

    const features = [
      { name: 'xGå·®', imp: customWeights.xgDiff },
      { name: 'çŠ¶æ€å·®', imp: customWeights.formDiff },
      { name: 'å®åŠ›å·®', imp: customWeights.strengthDiff },
      { name: 'ä¸»åœºä¼˜åŠ¿', imp: customWeights.homeAdv },
      { name: 'ä¼¤ç—…/å¤©æ°”', imp: customWeights.injury },
      { name: 'å†å²äº¤é”‹', imp: customWeights.history },
      { name: 'çƒå‘˜çŠ¶æ€', imp: customWeights.players }
    ];

    return {
      dnn: dnnProb,
      rf: rfProb,
      bayes: bayesProb,
      ensemble: { home: ensembleHome, draw: ensembleDraw, away: ensembleAway },
      confidence: Math.round(confidence),
      features
    };
  }

  // ========== ç”Ÿæˆæ¯”åˆ†ï¼ˆå¸¦æ¦‚ç‡åˆ†å¸ƒï¼‰==========
  function simulateScoreFromXG(homeXG, awayXG) {
    let homeGoals = Math.floor(homeXG + (Math.random() - 0.5) * 1.2);
    let awayGoals = Math.floor(awayXG + (Math.random() - 0.5) * 1.2);
    homeGoals = Math.max(0, Math.min(6, homeGoals));
    awayGoals = Math.max(0, Math.min(5, awayGoals));
    return `${homeGoals}:${awayGoals}`;
  }

  // ç”Ÿæˆå¤šä¸ªå¯èƒ½çš„æ¯”åˆ†åŠå…¶æ¦‚ç‡ï¼ˆç”¨äºè’™ç‰¹å¡æ´›ï¼‰
  function monteCarloSimulation(homeTeam, awayTeam, homeXG, awayXG, iterations = 1000) {
    const results = {};
    for (let i = 0; i < iterations; i++) {
      const score = simulateScoreFromXG(homeXG, awayXG);
      results[score] = (results[score] || 0) + 1;
    }
    // è½¬æ¢ä¸ºæ¦‚ç‡å¹¶æ’åº
    const sorted = Object.entries(results).map(([score, count]) => ({ score, prob: count / iterations * 100 }))
      .sort((a, b) => b.prob - a.prob);
    return sorted;
  }

  function generateThreeScores(homeTeam, awayTeam, homeXG, awayXG) {
    let homeScore, homeWinGoals;
    do {
      homeWinGoals = simulateScoreFromXG(homeXG, awayXG);
      let [h, a] = homeWinGoals.split(':').map(Number);
      if (h > a) homeScore = homeWinGoals;
    } while (!homeScore);
    let drawScore;
    do {
      drawScore = simulateScoreFromXG(homeXG, awayXG);
      let [h, a] = drawScore.split(':').map(Number);
      if (h === a) drawScore = drawScore;
    } while (!drawScore);
    let awayScore;
    do {
      awayScore = simulateScoreFromXG(homeXG, awayXG);
      let [h, a] = awayScore.split(':').map(Number);
      if (h < a) awayScore = awayScore;
    } while (!awayScore);
    return { home: homeScore, draw: drawScore, away: awayScore };
  }

  // ========== ç”ŸæˆAIåˆ†ææ–‡æœ¬ ==========
  function generateAIText(homeTeam, awayTeam, probs, confidence, features, models, history) {
    const homeProb = probs.home, drawProb = probs.draw, awayProb = probs.away;
    const featureText = features.map(f => `${f.name} ${Math.round(f.imp * 100)}%`).join(' Â· ');
    const modelAgreement = (models.dnn.home - models.rf.home) < 5 ? 'æ¨¡å‹æ„è§ä¸€è‡´' : 'æ¨¡å‹åˆ†æ­§è¾ƒå¤§';
    const homeWins = history.filter(s => { let [h, a] = s.split(':'); return h > a; }).length;
    const awayWins = history.filter(s => { let [h, a] = s.split(':'); return h < a; }).length;
    const historyAdv = homeWins > awayWins ? `${homeTeam}å æ®å¿ƒç†ä¼˜åŠ¿` : (awayWins > homeWins ? `${awayTeam}å¿ƒç†å ä¼˜` : 'åŒæ–¹å¿ƒç†å‡åŠ¿');
    return `ğŸ§  å¤šæ¨¡æ€èåˆåˆ†æï¼š${modelAgreement}ã€‚å…³é”®ç‰¹å¾æƒé‡ï¼š${featureText}ã€‚å†å²äº¤é”‹ï¼š${historyAdv}ï¼ˆè¿‘5åœº${history.join(' ')}ï¼‰ã€‚æ¨¡å‹ç½®ä¿¡åº¦${confidence}%ã€‚æ¨èå…³æ³¨${homeProb > drawProb && homeProb > awayProb ? homeTeam : awayProb > drawProb ? awayTeam : 'å¹³å±€'}æ–¹å‘ã€‚`;
  }

  // ========== æ¸²æŸ“çƒ­åŠ›å›¾ ==========
  function renderHeatmap(homeXG, awayXG) {
    const homeDiv = document.getElementById('homeHeatmap');
    const awayDiv = document.getElementById('awayHeatmap');
    if (!homeDiv || !awayDiv) return;
    homeDiv.innerHTML = ''; awayDiv.innerHTML = '';
    for (let i = 0; i < 20; i++) {
      if (Math.random() < homeXG / 4) {
        let spot = document.createElement('div');
        spot.className = 'shot-spot';
        spot.style.left = Math.random() * 100 + '%';
        spot.style.top = Math.random() * 100 + '%';
        homeDiv.appendChild(spot);
      }
      if (Math.random() < awayXG / 4) {
        let spot = document.createElement('div');
        spot.className = 'shot-spot shot-spot-away';
        spot.style.left = Math.random() * 100 + '%';
        spot.style.top = Math.random() * 100 + '%';
        awayDiv.appendChild(spot);
      }
    }
  }

  // ========== æ¸²æŸ“é›·è¾¾å›¾ ==========
  function drawRadar(canvasId, teamName) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const data = getTeamData(teamName);
    const values = [data.attack, data.defense, data.midfield || 75, data.speed || 70, data.experience || 80];
    const labels = ['è¿›æ”»', 'é˜²å®ˆ', 'ä¸­åœº', 'é€Ÿåº¦', 'ç»éªŒ'];
    const ctx = canvas.getContext('2d');
    const w = canvas.width, h = canvas.height;
    const centerX = w / 2, centerY = h / 2;
    const radius = Math.min(w, h) * 0.35;
    const angles = [0, Math.PI * 2 / 5, Math.PI * 4 / 5, Math.PI * 6 / 5, Math.PI * 8 / 5];

    ctx.clearRect(0, 0, w, h);
    ctx.strokeStyle = '#2a5a4a';
    ctx.lineWidth = 1;
    for (let lvl = 1; lvl <= 5; lvl++) {
      ctx.beginPath();
      for (let i = 0; i <= 5; i++) {
        let angle = angles[i % 5];
        let x = centerX + radius * (lvl / 5) * Math.cos(angle);
        let y = centerY + radius * (lvl / 5) * Math.sin(angle);
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.strokeStyle = '#3a6a5a';
      ctx.stroke();
    }
    angles.forEach(angle => {
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.lineTo(centerX + radius * Math.cos(angle), centerY + radius * Math.sin(angle));
      ctx.strokeStyle = '#3a6a5a';
      ctx.stroke();
    });
    ctx.beginPath();
    for (let i = 0; i < 5; i++) {
      let value = (values[i] - 50) / 50 * radius;
      let x = centerX + value * Math.cos(angles[i]);
      let y = centerY + value * Math.sin(angles[i]);
      if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.closePath();
    ctx.fillStyle = 'rgba(124,252,0,0.3)';
    ctx.fill();
    ctx.strokeStyle = '#7cfc00';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = '#aaffaa';
    ctx.font = '10px sans-serif';
    labels.forEach((label, i) => {
      let x = centerX + (radius + 15) * Math.cos(angles[i]);
      let y = centerY + (radius + 10) * Math.sin(angles[i]);
      ctx.fillText(label, x - 10, y - 5);
    });
  }

  // ========== æ¸²æŸ“å…³é”®çƒå‘˜è¯„åˆ† ==========
  function renderPlayers(homeTeam, awayTeam) {
    const homeData = getTeamData(homeTeam);
    const awayData = getTeamData(awayTeam);
    const homePlayers = homeData.players.slice(0, 3).map(p => ({ name: p, rating: randInt(65, 98) }));
    const awayPlayers = awayData.players.slice(0, 3).map(p => ({ name: p, rating: randInt(65, 98) }));
    const homeHtml = homePlayers.map(p => `
      <div class="player-item">
        <span class="player-name">${p.name.split(' ')[0]}</span>
        <div class="rating-bar"><div class="rating-fill" style="width:${p.rating}%"></div></div>
        <span class="player-rating">${p.rating}</span>
      </div>
    `).join('');
    const awayHtml = awayPlayers.map(p => `
      <div class="player-item">
        <span class="player-name">${p.name.split(' ')[0]}</span>
        <div class="rating-bar"><div class="rating-fill" style="width:${p.rating}%"></div></div>
        <span class="player-rating">${p.rating}</span>
      </div>
    `).join('');
    document.getElementById('homePlayers').innerHTML = homeHtml;
    document.getElementById('awayPlayers').innerHTML = awayHtml;
  }

  // ========== æ¸²æŸ“è¿‘æœŸè¿›çƒèµ°åŠ¿ ==========
  function drawTrend(homeTeam, awayTeam) {
    const canvas = document.getElementById('trendCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const w = canvas.width, h = canvas.height;
    ctx.clearRect(0, 0, w, h);
    const homeGoals = [randInt(0, 3), randInt(0, 4), randInt(0, 2), randInt(1, 3), randInt(0, 2)];
    const awayGoals = [randInt(0, 2), randInt(0, 3), randInt(0, 2), randInt(0, 4), randInt(0, 1)];
    const step = w / 6;
    ctx.beginPath();
    ctx.strokeStyle = '#2ecc71';
    ctx.lineWidth = 2;
    for (let i = 0; i < 5; i++) {
      let x = (i + 0.5) * step;
      let y = h - homeGoals[i] * 20 - 10;
      if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = '#e67e22';
    ctx.lineWidth = 2;
    for (let i = 0; i < 5; i++) {
      let x = (i + 0.5) * step;
      let y = h - awayGoals[i] * 20 - 10;
      if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.stroke();
    ctx.fillStyle = '#aaffaa';
    ctx.font = '12px sans-serif';
    ctx.fillText(`${homeTeam}è¿‘5åœºè¿›çƒ`, 10, 20);
    ctx.fillStyle = '#ffaa7f';
    ctx.fillText(`${awayTeam}è¿‘5åœºè¿›çƒ`, 10, 40);
  }

  // ========== æ¸²æŸ“èƒœè´Ÿå€¾å‘æŒ‡ç¤ºå™¨ ==========
  function renderTilt(probs) {
    const tiltDiv = document.getElementById('tiltIndicator');
    if (!tiltDiv) return;
    tiltDiv.innerHTML = `
      <div class="tilt-bar">
        <div class="tilt-home" style="width:${probs.home}%"></div>
        <div class="tilt-draw" style="width:${probs.draw}%"></div>
        <div class="tilt-away" style="width:${probs.away}%"></div>
      </div>
      <span class="tilt-arrow">${probs.home > probs.away ? 'â† ä¸»' : (probs.away > probs.home ? 'å®¢ â†’' : 'â€”')}</span>
    `;
  }

  // ========== æ¸²æŸ“èµ”ç‡å¯¹æ¯”é¢æ¿ ==========
  function renderOdds(probs) {
    const oddsDiv = document.getElementById('oddsPanel');
    if (!oddsDiv) return;
    const marketOddsHome = (1 / (probs.home / 100) * 0.95).toFixed(2);
    const marketOddsDraw = (1 / (probs.draw / 100) * 0.95).toFixed(2);
    const marketOddsAway = (1 / (probs.away / 100) * 0.95).toFixed(2);
    const aiOddsHome = (1 / (probs.home / 100)).toFixed(2);
    const aiOddsDraw = (1 / (probs.draw / 100)).toFixed(2);
    const aiOddsAway = (1 / (probs.away / 100)).toFixed(2);

    const valueHome = probs.home > 100 / marketOddsHome ? 'â­' : '';
    const valueDraw = probs.draw > 100 / marketOddsDraw ? 'â­' : '';
    const valueAway = probs.away > 100 / marketOddsAway ? 'â­' : '';

    oddsDiv.innerHTML = `
      <div class="odds-item">
        <div class="odds-type">ä¸»èƒœ</div>
        <div class="odds-value">${aiOddsHome}</div>
        <div style="font-size:0.8rem;">å¸‚åœº ${marketOddsHome} ${valueHome ? '<span class="value-badge">ä»·å€¼</span>' : ''}</div>
      </div>
      <div class="odds-item">
        <div class="odds-type">å¹³å±€</div>
        <div class="odds-value">${aiOddsDraw}</div>
        <div style="font-size:0.8rem;">å¸‚åœº ${marketOddsDraw} ${valueDraw ? '<span class="value-badge">ä»·å€¼</span>' : ''}</div>
      </div>
      <div class="odds-item">
        <div class="odds-type">å®¢èƒœ</div>
        <div class="odds-value">${aiOddsAway}</div>
        <div style="font-size:0.8rem;">å¸‚åœº ${marketOddsAway} ${valueAway ? '<span class="value-badge">ä»·å€¼</span>' : ''}</div>
      </div>
    `;
  }

  // ========== æ¸²æŸ“è’™ç‰¹å¡æ´›é¢æ¿ ==========
  function renderMonteCarlo(homeTeam, awayTeam, homeXG, awayXG) {
    const monteDiv = document.getElementById('montePanel');
    if (!monteDiv) return;
    const results = monteCarloSimulation(homeTeam, awayTeam, homeXG, awayXG, 1000);
    const top5 = results.slice(0, 5);
    monteDiv.style.display = 'block';
    monteDiv.innerHTML = `
      <h3><i class="fas fa-dice"></i> è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ (1000æ¬¡)</h3>
      <div class="monte-grid">
        ${top5.map(r => `<div class="monte-item"><span>${r.score}</span><span style="color:#7cfc00;">${r.prob.toFixed(1)}%</span></div>`).join('')}
      </div>
    `;
  }

  // ========== æ¸²æŸ“è‡ªå®šä¹‰æƒé‡æ»‘å— ==========
  function renderWeightSliders() {
    const weightDiv = document.getElementById('weightPanel');
    if (!weightDiv) return;
    weightDiv.innerHTML = `
      <h3><i class="fas fa-sliders-h"></i> è‡ªå®šä¹‰æƒé‡</h3>
      <div class="weight-slider">
        <span class="weight-label">xGå·®</span>
        <input type="range" id="weightXG" min="0" max="0.5" step="0.01" value="${customWeights.xgDiff}">
      </div>
      <div class="weight-slider">
        <span class="weight-label">çŠ¶æ€å·®</span>
        <input type="range" id="weightForm" min="0" max="0.4" step="0.01" value="${customWeights.formDiff}">
      </div>
      <div class="weight-slider">
        <span class="weight-label">å®åŠ›å·®</span>
        <input type="range" id="weightStrength" min="0" max="0.4" step="0.01" value="${customWeights.strengthDiff}">
      </div>
      <div class="weight-slider">
        <span class="weight-label">ä¸»åœºä¼˜åŠ¿</span>
        <input type="range" id="weightHome" min="0" max="0.3" step="0.01" value="${customWeights.homeAdv}">
      </div>
      <div class="weight-slider">
        <span class="weight-label">å†å²äº¤é”‹</span>
        <input type="range" id="weightHistory" min="0" max="0.2" step="0.01" value="${customWeights.history}">
      </div>
      <div class="weight-slider">
        <span class="weight-label">ä¼¤ç—…/å¤©æ°”</span>
        <input type="range" id="weightInjury" min="0" max="0.2" step="0.01" value="${customWeights.injury}">
      </div>
      <div class="weight-slider">
        <span class="weight-label">çƒå‘˜çŠ¶æ€</span>
        <input type="range" id="weightPlayers" min="0" max="0.2" step="0.01" value="${customWeights.players}">
      </div>
    `;

    document.getElementById('weightXG').addEventListener('input', (e) => { customWeights.xgDiff = +e.target.value; });
    document.getElementById('weightForm').addEventListener('input', (e) => { customWeights.formDiff = +e.target.value; });
    document.getElementById('weightStrength').addEventListener('input', (e) => { customWeights.strengthDiff = +e.target.value; });
    document.getElementById('weightHome').addEventListener('input', (e) => { customWeights.homeAdv = +e.target.value; });
    document.getElementById('weightHistory').addEventListener('input', (e) => { customWeights.history = +e.target.value; });
    document.getElementById('weightInjury').addEventListener('input', (e) => { customWeights.injury = +e.target.value; });
    document.getElementById('weightPlayers').addEventListener('input', (e) => { customWeights.players = +e.target.value; });
  }

  // ========== ç”Ÿæˆèµ›å‰å¿«è®¯ ==========
  function generateNews() {
    const news = [
      'âš¡ å“ˆå…°å¾·ä»Šæ—¥è®­ç»ƒçŠ¶æ€ç«çƒ­ï¼Œé¢„è®¡é¦–å‘',
      'ğŸ”´ åˆ©ç‰©æµ¦æ ¸å¿ƒè¨æ‹‰èµ«ä¼¤ç–‘ï¼Œå‡ºæˆ˜æˆç–‘',
      'ğŸ”µ æ›¼åŸå¾·å¸ƒåŠ³å†…æ¢å¤åˆç»ƒï¼Œæœ‰æœ›ç™»åœº',
      'ğŸŸ¡ çš‡é©¬æœ¬æ³½é©¬èµ›å‰åŠ ç»ƒå°„é—¨',
      'âš« æ‹œä»è¯ºä¼Šå°”å¤å‡ºï¼Œé˜²å®ˆæå‡',
      'ğŸŸ¢ å·´è¨ä½©å¾·é‡ŒçŠ¶æ€å›å‡ï¼Œä¸­åœºåˆ›é€ åŠ›å¢å¼º'
    ];
    return news.sort(() => 0.5 - Math.random()).slice(0, 4);
  }

  function updateNewsTicker() {
    const news = generateNews();
    const ticker = document.getElementById('newsTicker');
    if (!ticker) return;
    ticker.innerHTML = news.map(n => `<span class="news-item">${n}</span>`).join('');
  }

  // ========== æ¸²æŸ“UIï¼ˆæ ¸å¿ƒæ¸²æŸ“ï¼Œå¢å¼ºç‰ˆï¼‰==========
  function renderAll(homeTeam, awayTeam, xg, modelsResult, homeForm, awayForm, scores, history) {
    document.getElementById('xgPanel').innerHTML = `
      <div class="xg-item"><div class="xg-label">${homeTeam} xG</div><div class="xg-value">${xg.home.toFixed(2)}</div></div>
      <div class="xg-bar-container"><div class="xg-bar" style="width:${(xg.home / (xg.home + xg.away) * 100).toFixed(1)}%"></div></div>
      <div class="xg-item"><div class="xg-label">${awayTeam} xG</div><div class="xg-value">${xg.away.toFixed(2)}</div></div>
    `;

    document.getElementById('modelsPanel').innerHTML = `
      <div class="model-item"><div class="model-name">æ·±åº¦ç¥ç»ç½‘ç»œ</div><div class="model-prob">${modelsResult.dnn.home}/${modelsResult.dnn.draw}/${modelsResult.dnn.away}</div></div>
      <div class="model-item"><div class="model-name">éšæœºæ£®æ—</div><div class="model-prob">${modelsResult.rf.home}/${modelsResult.rf.draw}/${modelsResult.rf.away}</div></div>
      <div class="model-item"><div class="model-name">è´å¶æ–¯æ¨æ–­</div><div class="model-prob">${modelsResult.bayes.home}/${modelsResult.bayes.draw}/${modelsResult.bayes.away}</div></div>
    `;

    const ens = modelsResult.ensemble;
    document.getElementById('ensemblePanel').innerHTML = `
      <div class="ensemble-item"><div class="ensemble-type">ä¸»èƒœ</div><div class="ensemble-prob">${ens.home}%</div></div>
      <div class="ensemble-item"><div class="ensemble-type">å¹³å±€</div><div class="ensemble-prob">${ens.draw}%</div></div>
      <div class="ensemble-item"><div class="ensemble-type">å®¢èƒœ</div><div class="ensemble-prob">${ens.away}%</div></div>
    `;

    document.getElementById('historyGrid').innerHTML = history.map(s => `<span class="history-item">${s}</span>`).join('');

    const aiText = generateAIText(homeTeam, awayTeam, ens, modelsResult.confidence, modelsResult.features, modelsResult, history);
    document.getElementById('aiAnalysis').innerHTML = `
      <div class="ai-header"><i class="fas fa-brain"></i><span>å¤šæ¨¡æ€èåˆåˆ†æ Â· ç½®ä¿¡åº¦ ${modelsResult.confidence}%</span></div>
      <div class="ai-text">${aiText}</div>
      <div class="confidence-row">
        <span>ç‰¹å¾æƒé‡</span>
        <div class="feature-importance">${modelsResult.features.map(f => `<span>${f.name} ${Math.round(f.imp * 100)}%</span>`).join('')}</div>
      </div>
      <div class="confidence-row">
        <span>æ¨¡å‹ç½®ä¿¡åº¦</span>
        <div class="confidence-bar"><div class="confidence-fill" style="width:${modelsResult.confidence}%"></div></div>
        <span>${modelsResult.confidence}%</span>
      </div>
    `;

    function renderForm(form) {
      return form.map(r => r === 'W' ? '<span class="form-icon win"><i class="fas fa-check"></i></span>' : r === 'D' ? '<span class="form-icon draw"><i class="fas fa-minus"></i></span>' : '<span class="form-icon loss"><i class="fas fa-times"></i></span>').join('');
    }
    document.getElementById('formPanel').innerHTML = `
      <div class="form-team"><span>${homeTeam} è¿‘5åœº:</span>${renderForm(homeForm)}</div>
      <div class="form-team"><span>${awayTeam} è¿‘5åœº:</span>${renderForm(awayForm)}</div>
    `;

    const probs = ens;
    const homeProbs = [
      { score: '1:0', prob: probs.home * 0.4 },
      { score: '2:0', prob: probs.home * 0.3 },
      { score: '2:1', prob: probs.home * 0.2 }
    ];
    const drawProbs = [
      { score: '1:1', prob: probs.draw * 0.6 },
      { score: '0:0', prob: probs.draw * 0.3 },
      { score: '2:2', prob: probs.draw * 0.1 }
    ];
    const awayProbs = [
      { score: '0:1', prob: probs.away * 0.4 },
      { score: '0:2', prob: probs.away * 0.3 },
      { score: '1:2', prob: probs.away * 0.2 }
    ];

    document.getElementById('scoreContainer').innerHTML = `
      <div class="score-item">
        <div class="score-number">${scores.home}</div>
        <span class="score-label">ä¸»èƒœ</span>
        <div class="probability">${ens.home}%</div>
        <div class="prob-dist">
          ${homeProbs.map(p => `<div class="prob-bar" style="height:${p.prob}px;"></div>`).join('')}
        </div>
        <div class="tip"><i class="fas fa-thumbs-up"></i> ${homeTeam}èƒœ</div>
      </div>
      <div class="score-item">
        <div class="score-number">${scores.draw}</div>
        <span class="score-label">å¹³å±€</span>
        <div class="probability">${ens.draw}%</div>
        <div class="prob-dist">
          ${drawProbs.map(p => `<div class="prob-bar draw-bar" style="height:${p.prob}px;"></div>`).join('')}
        </div>
        <div class="tip"><i class="fas fa-hand-peace"></i> å¹³å±€</div>
      </div>
      <div class="score-item">
        <div class="score-number">${scores.away}</div>
        <span class="score-label">å®¢èƒœ</span>
        <div class="probability">${ens.away}%</div>
        <div class="prob-dist">
          ${awayProbs.map(p => `<div class="prob-bar away-bar" style="height:${p.prob}px;"></div>`).join('')}
        </div>
        <div class="tip"><i class="fas fa-plane-departure"></i> ${awayTeam}èƒœ</div>
      </div>
    `;

    renderHeatmap(xg.home, xg.away);
    drawRadar('radarHome', homeTeam);
    drawRadar('radarAway', awayTeam);
    renderPlayers(homeTeam, awayTeam);
    drawTrend(homeTeam, awayTeam);
    renderTilt(ens);
    renderOdds(ens);
    renderWeightSliders();
  }

  // ========== æ–°å¢åŠŸèƒ½ï¼šèµ›ç¨‹æ—¥å† ==========
  let upcomingMatches = [
    { home: 'æ›¼åŸ', away: 'åˆ©ç‰©æµ¦', date: '2025-03-15' },
    { home: 'çš‡é©¬', away: 'å·´è¨', date: '2025-03-16' },
    { home: 'æ‹œä»', away: 'å¤šç‰¹', date: '2025-03-17' },
    { home: 'å·´é»', away: 'å°¤æ–‡', date: '2025-03-18' },
    { home: 'æ›¼è”', away: 'é˜¿æ£®çº³', date: '2025-03-19' },
    { home: 'å›½ç±³', away: 'ACç±³å…°', date: '2025-03-20' }
  ];
  let favoriteMatches = JSON.parse(localStorage.getItem('favorites')) || [];

  function renderCalendar() {
    const container = document.querySelector('.card');
    if (!container) return;
    let html = '<div class="calendar-grid">';
    upcomingMatches.forEach((m, idx) => {
      const isFav = favoriteMatches.some(f => f.home === m.home && f.away === m.away && f.date === m.date);
      html += `<div class="calendar-item" data-idx="${idx}">
        ${m.home} vs ${m.away}<br><small>${m.date}</small>
        <span class="favorite-star">${isFav ? 'â˜…' : 'â˜†'}</span>
      </div>`;
    });
    html += '</div>';
    const panel = document.createElement('div');
    panel.className = 'calendar-panel';
    panel.innerHTML = `<h3><i class="fas fa-calendar-alt"></i> æœªæ¥èµ›ç¨‹</h3>${html}`;
    container.insertBefore(panel, document.querySelector('.live-stream'));

    document.querySelectorAll('.calendar-item').forEach(el => {
      el.addEventListener('click', (e) => {
        const idx = el.dataset.idx;
        const match = upcomingMatches[idx];
        document.getElementById('homeTeam').value = match.home;
        document.getElementById('awayTeam').value = match.away;
        saveTeamsToStorage();
        refreshWithAI();
      });
      el.querySelector('.favorite-star').addEventListener('click', (e) => {
        e.stopPropagation();
        const idx = el.dataset.idx;
        const match = upcomingMatches[idx];
        const existingIndex = favoriteMatches.findIndex(f => f.home === match.home && f.away === match.away && f.date === match.date);
        if (existingIndex >= 0) {
          favoriteMatches.splice(existingIndex, 1);
        } else {
          favoriteMatches.push(match);
        }
        localStorage.setItem('favorites', JSON.stringify(favoriteMatches));
        renderCalendar(); // é‡æ–°æ¸²æŸ“
      });
    });
  }

  // ========== æˆ˜æœ¯æ»‘å— ==========
  function renderTactics() {
    const container = document.querySelector('.card');
    if (!container) return;
    const panel = document.createElement('div');
    panel.className = 'tactics-panel';
    panel.innerHTML = `
      <div class="tactics-slider">
        <label>è¿›æ”»å€¾å‘ <span id="offenseVal">${offensiveTendency}</span>%</label>
        <input type="range" id="offenseSlider" min="0" max="100" value="${offensiveTendency}">
      </div>
      <div class="tactics-slider">
        <label>é˜²å®ˆå¼ºåº¦ <span id="defenseVal">${defensiveTendency}</span>%</label>
        <input type="range" id="defenseSlider" min="0" max="100" value="${defensiveTendency}">
      </div>
    `;
    container.insertBefore(panel, document.querySelector('.history-panel'));

    document.getElementById('offenseSlider').addEventListener('input', (e) => {
      offensiveTendency = +e.target.value;
      document.getElementById('offenseVal').innerText = offensiveTendency;
    });
    document.getElementById('defenseSlider').addEventListener('input', (e) => {
      defensiveTendency = +e.target.value;
      document.getElementById('defenseVal').innerText = defensiveTendency;
    });
  }

  // ========== å†å²æ•°æ®ç»Ÿè®¡ ==========
  function renderHistoryStats(history) {
    const totalGoalsHome = history.reduce((acc, s) => acc + parseInt(s.split(':')[0]), 0);
    const totalGoalsAway = history.reduce((acc, s) => acc + parseInt(s.split(':')[1]), 0);
    const homeWins = history.filter(s => parseInt(s.split(':')[0]) > parseInt(s.split(':')[1])).length;
    const awayWins = history.filter(s => parseInt(s.split(':')[0]) < parseInt(s.split(':')[1])).length;
    const draws = 5 - homeWins - awayWins;

    const panel = document.createElement('div');
    panel.className = 'stats-panel';
    panel.innerHTML = `
      <h3><i class="fas fa-chart-bar"></i> å†å²äº¤é”‹ç»Ÿè®¡ï¼ˆè¿‘5åœºï¼‰</h3>
      <div class="stats-bar">
        <span class="stats-label">ä¸»èƒœ</span>
        <div class="stats-bar-container"><div class="stats-fill" style="width:${homeWins * 20}%"></div></div>
        <span>${homeWins}åœº</span>
      </div>
      <div class="stats-bar">
        <span class="stats-label">å¹³å±€</span>
        <div class="stats-bar-container"><div class="stats-fill" style="width:${draws * 20}%"></div></div>
        <span>${draws}åœº</span>
      </div>
      <div class="stats-bar">
        <span class="stats-label">å®¢èƒœ</span>
        <div class="stats-bar-container"><div class="stats-fill" style="width:${awayWins * 20}%"></div></div>
        <span>${awayWins}åœº</span>
      </div>
      <div>æ€»è¿›çƒ: ${totalGoalsHome}:${totalGoalsAway}</div>
    `;
    document.querySelector('.card').insertBefore(panel, document.querySelector('.ai-analysis'));
  }

  // ========== æˆå°±å‹‹ç«  ==========
  let achievements = JSON.parse(localStorage.getItem('achievements')) || {
    predictions: 0,
    correctPredictions: 0,
    betWins: 0
  };

  function updateAchievements(correct) {
    achievements.predictions++;
    if (correct) achievements.correctPredictions++;
    localStorage.setItem('achievements', JSON.stringify(achievements));
    renderAchievements();
  }

  function renderAchievements() {
    const medals = [
      { name: 'åˆå‡ºèŒ…åº', condition: () => achievements.predictions >= 1, icon: 'ğŸ¥‰' },
      { name: 'é¢„æµ‹ä¸“å®¶', condition: () => achievements.predictions >= 10, icon: 'ğŸ¥ˆ' },
      { name: 'ç™¾åœºå¤§å…³', condition: () => achievements.predictions >= 100, icon: 'ğŸ¥‡' },
      { name: 'åè¿èƒœ', condition: () => achievements.correctPredictions >= 10, icon: 'ğŸ†' },
      { name: 'å†·é—¨ä¹‹ç‹', condition: () => achievements.betWins >= 5, icon: 'âš¡' }
    ];
    let html = '<div class="achievements-panel"><h3><i class="fas fa-medal"></i> æˆå°±å‹‹ç« </h3>';
    medals.forEach(m => {
      const unlocked = m.condition();
      html += `<div class="achievement ${unlocked ? '' : 'locked'}">
        ${m.icon} ${m.name} ${unlocked ? 'âœ…' : 'ğŸ”’'}
      </div>`;
    });
    html += '</div>';
    const rankPanel = document.querySelector('.rank-panel');
    if (rankPanel) {
      rankPanel.insertAdjacentHTML('beforebegin', html);
    }
  }

  // ========== å¤šè”èµ›åˆ‡æ¢ ==========
  const leagues = [
    { name: 'è‹±è¶…', icon: 'ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿', teams: ['æ›¼åŸ', 'åˆ©ç‰©æµ¦', 'æ›¼è”', 'é˜¿æ£®çº³', 'åˆ‡å°”è¥¿', 'çƒ­åˆº'] },
    { name: 'è¥¿ç”²', icon: 'ğŸ‡ªğŸ‡¸', teams: ['çš‡é©¬', 'å·´è¨', 'é©¬ç«', 'å¡ç»´åˆ©äºš', 'æ¯”åˆ©äºšé›·äºšå°”'] },
    { name: 'å¾·ç”²', icon: 'ğŸ‡©ğŸ‡ª', teams: ['æ‹œä»', 'å¤šç‰¹', 'å‹’æ²ƒåº“æ£®', 'è±æ¯”é”¡'] },
    { name: 'æ„ç”²', icon: 'ğŸ‡®ğŸ‡¹', teams: ['å°¤æ–‡', 'ACç±³å…°', 'å›½ç±³', 'ç½—é©¬', 'æ‹‰é½å¥¥', 'é‚£ä¸å‹’æ–¯'] },
    { name: 'æ³•ç”²', icon: 'ğŸ‡«ğŸ‡·', teams: ['å·´é»', 'é©¬èµ›', 'é‡Œæ˜‚', 'æ‘©çº³å“¥'] }
  ];
  let currentLeague = 0;

  function renderLeagueTabs() {
    let tabs = '<div class="league-tabs">';
    leagues.forEach((l, idx) => {
      tabs += `<span class="league-tab ${idx === currentLeague ? 'active' : ''}" data-league="${idx}">${l.icon} ${l.name}</span>`;
    });
    tabs += '</div>';
    const card = document.querySelector('.card');
    if (card) {
      card.insertAdjacentHTML('afterbegin', tabs);
    }

    document.querySelectorAll('.league-tab').forEach(tab => {
      tab.addEventListener('click', (e) => {
        currentLeague = +tab.dataset.league;
        document.querySelectorAll('.league-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        // å¯æ‰©å±•æ›´æ–°ç§¯åˆ†æ¦œç­‰
      });
    });
  }

  // ========== PWA ==========
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(console.log);
  }

  // ========== æ¦‚ç‡æ ¡å‡† ==========
  let modelWeights = { dnn: 0.4, rf: 0.3, bayes: 0.3 };
  let historyAccuracy = [];

  function calibrateModels(actualResult, predictedProbs) {
    const correct = (actualResult === 'home' && predictedProbs.home === Math.max(predictedProbs.home, predictedProbs.draw, predictedProbs.away)) ||
      (actualResult === 'draw' && predictedProbs.draw === Math.max(...Object.values(predictedProbs))) ||
      (actualResult === 'away' && predictedProbs.away === Math.max(...Object.values(predictedProbs)));
    if (correct) {
      historyAccuracy.push(1);
    } else {
      historyAccuracy.push(0);
    }
    if (historyAccuracy.length > 20) historyAccuracy.shift();
    const acc = historyAccuracy.reduce((a, b) => a + b, 0) / historyAccuracy.length;
    if (acc > 0.7) {
      modelWeights.dnn = Math.min(0.5, modelWeights.dnn + 0.01);
      modelWeights.rf = Math.max(0.2, modelWeights.rf - 0.005);
    } else if (acc < 0.5) {
      modelWeights.dnn = Math.max(0.3, modelWeights.dnn - 0.01);
      modelWeights.rf = Math.min(0.4, modelWeights.rf + 0.005);
    }
    document.getElementById('calibrationInfo').innerText = `æ ¡å‡†ä¸­... æœ€è¿‘å‡†ç¡®ç‡ ${Math.round(acc * 100)}%`;
  }

  function renderCalibration() {
    const panel = document.createElement('div');
    panel.className = 'calibration-panel';
    panel.innerHTML = `<span id="calibrationInfo">âš™ï¸ æ¨¡å‹è‡ªå­¦ä¹ ä¸­...</span>`;
    document.querySelector('.card').appendChild(panel);
  }

  // ========== æ›´å¤šéšæœºäº‹ä»¶ï¼ˆç”¨äºç›´æ’­ï¼‰==========
  function injectLiveEvent() {
    const events = [
      'ğŸ”´ çº¢ç‰Œï¼ä¸»é˜Ÿè¢«ç½šä¸‹ä¸€äºº', 'âšª ç‚¹çƒï¼å®¢é˜Ÿè·å¾—ç‚¹çƒæœºä¼š', 'ğŸ“º VARä»‹å…¥ï¼Œè¿›çƒè¢«å–æ¶ˆ',
      'ğŸ”„ ä¸»é˜Ÿæ¢äººï¼ŒåŠ å¼ºè¿›æ”»', 'ğŸŸ¡ å®¢é˜Ÿé»„ç‰Œè­¦å‘Š', 'âš½ è¿›çƒæ— æ•ˆï¼Œè¶Šä½åœ¨å…ˆ'
    ];
    return events[Math.floor(Math.random() * events.length)];
  }

  // ========== å¤šç”¨æˆ·å¯¹æˆ˜ ==========
  let opponents = [
    { name: 'AIå…ˆçŸ¥', credits: 9850, strategy: 'random' },
    { name: 'è¶³çƒä¹‹ç¥', credits: 9720, strategy: 'aggressive' },
    { name: 'å…ƒå®‡å®™æ•™çˆ¶', credits: 9610, strategy: 'defensive' },
    { name: 'YOU', credits: 1000, strategy: 'player' }
  ];

  function renderOpponents() {
    let html = '<div class="rank-panel"><h3><i class="fas fa-users"></i> å¯¹æ‰‹å¤§å…</h3>';
    opponents.forEach((opp, i) => {
      html += `<div class="rank-row">
        <span>${i + 1}. ${opp.name}</span>
        <span>ğŸ† ${opp.credits}</span>
        <button class="btn" style="padding:0.2rem 0.8rem;" data-opp="${i}">æŒ‘æˆ˜</button>
      </div>`;
    });
    html += '</div>';
    const rankPanel = document.querySelector('.rank-panel');
    if (rankPanel) {
      rankPanel.insertAdjacentHTML('afterend', html);
    }

    document.querySelectorAll('[data-opp]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.dataset.opp;
        alert(`æŒ‘æˆ˜ ${opponents[idx].name}ï¼è‹¥è·èƒœå¯å¾—200ç§¯åˆ†ï¼ˆæ¨¡æ‹Ÿï¼‰`);
        if (Math.random() > 0.5) {
          credits += 200;
          document.getElementById('userCredits').innerText = credits;
          alert('èƒœåˆ©ï¼è·å¾—200ç§¯åˆ†');
        } else {
          alert('æƒœè´¥ï¼Œä¸‹æ¬¡å†æˆ˜');
        }
      });
    });
  }

  // ========== æ•°æ®å¯¼å‡º/å¯¼å…¥ ==========
  function exportData() {
    const data = {
      teams: TEAM_DB_FULL,
      favorites: favoriteMatches,
      achievements,
      credits
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'football_predict_data.json';
    a.click();
    URL.revokeObjectURL(url);
  }

  function importData(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        TEAM_DB_FULL = data.teams || TEAM_DB_FULL;
        favoriteMatches = data.favorites || [];
        achievements = data.achievements || achievements;
        credits = data.credits || 1000;
        localStorage.setItem('favorites', JSON.stringify(favoriteMatches));
        localStorage.setItem('achievements', JSON.stringify(achievements));
        localStorage.setItem('credits', credits);
        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
        refreshWithAI();
      } catch (ex) {
        alert('å¯¼å…¥å¤±è´¥ï¼š' + ex);
      }
    };
    reader.readAsText(file);
  }

  function renderExportImport() {
    const panel = document.createElement('div');
    panel.className = 'export-import';
    panel.innerHTML = `
      <button id="exportBtn" class="btn"><i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®</button>
      <input type="file" id="importFile" accept=".json" style="display:none;">
      <button id="importBtn" class="btn"><i class="fas fa-upload"></i> å¯¼å…¥æ•°æ®</button>
    `;
    document.querySelector('.card').appendChild(panel);

    document.getElementById('exportBtn').addEventListener('click', exportData);
    document.getElementById('importBtn').addEventListener('click', () => {
      document.getElementById('importFile').click();
    });
    document.getElementById('importFile').addEventListener('change', (e) => {
      if (e.target.files[0]) importData(e.target.files[0]);
    });
  }

  // ========== èµ›å­£ç§¯åˆ†æ¦œ ==========
  function generateStandings() {
    const teams = Object.keys(TEAM_ICONS).slice(0, 20);
    const standings = teams.map(name => {
      const data = getTeamData(name);
      const played = 38;
      const wins = Math.floor(data.attack / 3 + Math.random() * 10);
      const draws = Math.floor(20 - Math.random() * 10);
      const losses = played - wins - draws;
      const pts = wins * 3 + draws;
      const gf = Math.floor(data.attack * 0.5 + Math.random() * 20);
      const ga = Math.floor(data.defense * 0.4 + Math.random() * 15);
      return { name, pts, gf, ga, wins, draws, losses };
    }).sort((a, b) => b.pts - a.pts);
    return standings;
  }

  function renderStandings() {
    const standings = generateStandings();
    const container = document.getElementById('standingsGrid');
    if (!container) return;
    container.innerHTML = standings.map((t, i) => `
      <div style="display:flex; justify-content:space-between; background:#0a1a12; padding:0.3rem 0.8rem; border-radius:40px;">
        <span>${i + 1}. ${t.name}</span>
        <span style="color:#7cfc00;">${t.pts}åˆ†</span>
      </div>
    `).join('');
  }

  // ========== ä»Šæ—¥æ¯”èµ›æ¨¡å—ï¼ˆçœŸå®APIé›†æˆï¼‰==========
  let todaysMatches = [];
  let filterFavorites = false;

  async function fetchTodaysMatches() {
    const today = new Date().toISOString().split('T')[0];
    try {
      const response = await fetch(`${API_BASE}/matches?dateFrom=${today}&dateTo=${today}`, {
        headers: { 'X-Auth-Token': FOOTBALL_API_KEY }
      });
      if (!response.ok) throw new Error(`APIå“åº”å¤±è´¥: ${response.status}`);
      const data = await response.json();
      return data.matches.map(m => ({
        id: m.id,
        home: m.homeTeam.name,
        away: m.awayTeam.name,
        time: m.utcDate.substring(11, 16),
        status: m.status,
        homeScore: m.score.fullTime.home,
        awayScore: m.score.fullTime.away,
        competition: m.competition.name
      }));
    } catch (error) {
      console.warn('è·å–çœŸå®èµ›ç¨‹å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', error);
      return generateMockTodaysMatches();
    }
  }

  function generateMockTodaysMatches() {
    const teams = Object.keys(TEAM_ICONS);
    const matches = [];
    const competitions = ['è‹±è¶…', 'è¥¿ç”²', 'å¾·ç”²', 'æ„ç”²', 'æ³•ç”²'];
    for (let i = 0; i < 8; i++) {
      const home = teams[Math.floor(Math.random() * teams.length)];
      let away;
      do { away = teams[Math.floor(Math.random() * teams.length)]; } while (away === home);
      const status = Math.random() > 0.6 ? 'FINISHED' : 'SCHEDULED';
      matches.push({
        id: `mock_${i}`,
        home, away,
        time: `${Math.floor(Math.random() * 12 + 8).toString().padStart(2, '0')}:00`,
        status,
        homeScore: status === 'FINISHED' ? randInt(0, 3) : null,
        awayScore: status === 'FINISHED' ? randInt(0, 3) : null,
        competition: competitions[Math.floor(Math.random() * competitions.length)]
      });
    }
    return matches.sort((a, b) => a.time.localeCompare(b.time));
  }

  function renderTodaysMatches() {
    const card = document.querySelector('.card');
    if (!card) return;
    const panel = document.createElement('div');
    panel.className = 'todays-matches-panel';
    panel.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; flex-wrap:wrap; gap:0.5rem;">
        <h3 style="display:flex; align-items:center; gap:0.5rem;">
          <i class="fas fa-calendar-day" style="color:#7cfc00;"></i> ä»Šæ—¥æ¯”èµ›
        </h3>
        <div style="display:flex; gap:0.5rem;">
          <button id="filterFavBtn" class="btn" style="padding:0.3rem 1rem;">
            <i class="fas fa-star"></i> åªçœ‹å…³æ³¨
          </button>
          <button id="refreshMatchesBtn" class="btn" style="padding:0.3rem 1rem;">
            <i class="fas fa-sync-alt"></i> åˆ·æ–°
          </button>
        </div>
      </div>
      <div id="matchesList" class="matches-list">
        <div style="text-align:center; padding:2rem;">â³ åŠ è½½èµ›ç¨‹ä¸­...</div>
      </div>
    `;
    const liveStream = document.querySelector('.live-stream');
    if (liveStream) {
      card.insertBefore(panel, liveStream);
    } else {
      card.appendChild(panel);
    }

    document.getElementById('filterFavBtn').addEventListener('click', () => {
      filterFavorites = !filterFavorites;
      document.getElementById('filterFavBtn').classList.toggle('active', filterFavorites);
      refreshMatchesDisplay();
    });

    document.getElementById('refreshMatchesBtn').addEventListener('click', async () => {
      document.getElementById('matchesList').innerHTML = '<div style="text-align:center; padding:2rem;">â³ åˆ·æ–°ä¸­...</div>';
      todaysMatches = await fetchTodaysMatches();
      refreshMatchesDisplay();
    });

    fetchTodaysMatches().then(matches => {
      todaysMatches = matches;
      refreshMatchesDisplay();
    });
  }

  function refreshMatchesDisplay() {
    const listEl = document.getElementById('matchesList');
    if (!listEl) return;

    const matchesToShow = filterFavorites
      ? todaysMatches.filter(m => favoriteMatches.some(f => f.id === m.id))
      : todaysMatches;

    if (matchesToShow.length === 0) {
      listEl.innerHTML = '<div style="text-align:center; padding:2rem;">æš‚æ— æ¯”èµ›</div>';
      return;
    }

    listEl.innerHTML = matchesToShow.map(m => {
      const isFav = favoriteMatches.some(f => f.id === m.id);
      let scoreDisplay = '';
      if (m.status === 'FINISHED') {
        scoreDisplay = `${m.homeScore !== null ? m.homeScore : '?'}:${m.awayScore !== null ? m.awayScore : '?'}`;
      } else if (m.status === 'LIVE') {
        scoreDisplay = `${m.homeScore !== null ? m.homeScore : '0'}:${m.awayScore !== null ? m.awayScore : '0'} âš¡`;
      } else {
        scoreDisplay = 'VS';
      }

      return `
        <div class="match-item ${isFav ? 'favorite' : ''}" data-id="${m.id}">
          <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.3rem;">
            <span class="match-time">${m.time}</span>
            <span class="match-competition">${m.competition}</span>
            ${m.status === 'LIVE' ? '<span style="color:#ff6b6b; font-size:0.7rem;">ğŸ”´ ç›´æ’­ä¸­</span>' : ''}
          </div>
          <div style="display:flex; justify-content:space-between; align-items:center; font-size:1.1rem;">
            <span style="font-weight:700;">${m.home}</span>
            <span style="font-weight:800; color:#ffd966;">${scoreDisplay}</span>
            <span style="font-weight:700;">${m.away}</span>
          </div>
          <div style="display:flex; justify-content:flex-end; gap:0.5rem; margin-top:0.5rem;">
            <button class="btn predict-now" data-home="${m.home}" data-away="${m.away}" style="padding:0.2rem 0.8rem; font-size:0.8rem;">
              <i class="fas fa-chart-line"></i> é¢„æµ‹
            </button>
            <button class="btn toggle-fav" data-id="${m.id}" style="padding:0.2rem 0.8rem; font-size:0.8rem;">
              <i class="fas fa-star" style="color:${isFav ? '#f1c40f' : '#aaa'};"></i>
            </button>
          </div>
        </div>
      `;
    }).join('');

    document.querySelectorAll('.predict-now').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('homeTeam').value = btn.dataset.home;
        document.getElementById('awayTeam').value = btn.dataset.away;
        saveTeamsToStorage();
        refreshWithAI();
      });
    });

    document.querySelectorAll('.toggle-fav').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const id = btn.dataset.id;
        const match = todaysMatches.find(m => m.id == id);
        if (!match) return;

        const index = favoriteMatches.findIndex(f => f.id === id);
        if (index >= 0) {
          favoriteMatches.splice(index, 1);
        } else {
          favoriteMatches.push(match);
        }
        localStorage.setItem('favorites', JSON.stringify(favoriteMatches));
        refreshMatchesDisplay();
      });
    });
  }

  // ========== æ ¸å¿ƒåˆ·æ–°å‡½æ•° ==========
  function refreshWithAI() {
    const homeTeam = document.getElementById('homeTeam').value.trim() || 'æ›¼åŸ';
    const awayTeam = document.getElementById('awayTeam').value.trim() || 'åˆ©ç‰©æµ¦';
    saveTeamsToStorage();

    const xg = calculateXGWithTactics(homeTeam, awayTeam);
    const homeForm = generateForm();
    const awayForm = generateForm();
    const history = generateHistory(homeTeam, awayTeam);
    const modelsResult = computeModels(xg.home, xg.away, homeForm, awayForm, homeTeam, awayTeam, history);
    const scores = generateThreeScores(homeTeam, awayTeam, xg.home, xg.away);

    renderAll(homeTeam, awayTeam, xg, modelsResult, homeForm, awayForm, scores, history);
    document.getElementById('dataSourceBadge').innerHTML = 'âš¡ èåˆæ¨¡å‹';
    updateNewsTicker();
    renderHistoryStats(history);
    playClick();
  }

  // ========== çœŸå®APIæ•°æ®è·å– ==========
  async function fetchTeamData(teamName) {
    const TEAM_ID_MAP = {
      'æ›¼åŸ': 65, 'åˆ©ç‰©æµ¦': 64, 'çš‡é©¬': 86, 'å·´è¨': 81, 'æ‹œä»': 5, 'å¤šç‰¹': 4,
      'å·´é»': 524, 'å°¤æ–‡': 109, 'ACç±³å…°': 98, 'æ›¼è”': 66, 'é˜¿æ£®çº³': 57, 'åˆ‡å°”è¥¿': 61,
      'çƒ­åˆº': 73, 'å›½ç±³': 108
    };
    const id = TEAM_ID_MAP[teamName];
    if (!id) return null;
    try {
      const r = await fetch(`${API_BASE}/teams/${id}`, { headers: { 'X-Auth-Token': FOOTBALL_API_KEY } });
      if (!r.ok) return null;
      const d = await r.json();
      return { form: d.runningCompetitions?.[0]?.recentForm || 'WWDLW' };
    } catch (e) { return null; }
  }

  async function fetchRealDataAndRender() {
    const homeTeam = document.getElementById('homeTeam').value.trim() || 'æ›¼åŸ';
    const awayTeam = document.getElementById('awayTeam').value.trim() || 'åˆ©ç‰©æµ¦';
    const badge = document.getElementById('dataSourceBadge');
    badge.innerHTML = 'â³ åŠ è½½çœŸå®æ•°æ®...';
    badge.style.background = '#4a6a8a';

    const [homeData, awayData] = await Promise.all([fetchTeamData(homeTeam), fetchTeamData(awayTeam)]);
    if (homeData && awayData) {
      const homeForm = parseForm(homeData.form);
      const awayForm = parseForm(awayData.form);
      const xg = calculateXGWithTactics(homeTeam, awayTeam);
      const history = generateHistory(homeTeam, awayTeam);
      const modelsResult = computeModels(xg.home, xg.away, homeForm, awayForm, homeTeam, awayTeam, history);
      const scores = generateThreeScores(homeTeam, awayTeam, xg.home, xg.away);
      renderAll(homeTeam, awayTeam, xg, modelsResult, homeForm, awayForm, scores, history);
      badge.innerHTML = 'âœ… çœŸå®æ•°æ®+èåˆ';
      badge.style.background = '#1e8a5a';
    } else {
      badge.innerHTML = 'âš ï¸ å›é€€åˆ°æ¨¡æ‹Ÿ';
      badge.style.background = '#e67e22';
      refreshWithAI();
    }
    playClick();
  }

  // ========== æ¨¡æ‹Ÿç›´æ’­ ==========
  let liveInterval = null;
  function startLiveSimulation() {
    if (liveInterval) clearInterval(liveInterval);
    const liveDiv = document.getElementById('liveStream');
    liveDiv.innerHTML = '';
    let time = 0;
    liveInterval = setInterval(() => {
      time += 1;
      if (time > 10) { clearInterval(liveInterval); liveInterval = null; return; }
      const events = [
        `${time}â€² ${['å°„é—¨åå‡º', 'è§’çƒ', 'ä»»æ„çƒ', 'çŠ¯è§„'][Math.floor(Math.random() * 4)]}`,
        `${time}â€² ${Math.random() > 0.5 ? 'ä¸»é˜Ÿ' : 'å®¢é˜Ÿ'} ${['é»„ç‰Œ', 'è¿›çƒ', 'è¶Šä½', 'æ¢äºº', 'ç‚¹çƒ'][Math.floor(Math.random() * 5)]}`,
        `${time}â€² ${injectLiveEvent()}`
      ];
      const ev = events[Math.floor(Math.random() * events.length)];
      const entry = document.createElement('div');
      entry.className = 'live-entry';
      entry.innerText = ev;
      liveDiv.appendChild(entry);
      liveDiv.scrollTop = liveDiv.scrollHeight;
      playClick();
    }, 2000);
  }

  // ========== ä¸€é”®å¤åˆ¶ ==========
  function copyPrediction() {
    const home = document.getElementById('homeTeam').value.trim() || 'ä¸»é˜Ÿ';
    const away = document.getElementById('awayTeam').value.trim() || 'å®¢é˜Ÿ';
    const ens = document.querySelectorAll('.ensemble-prob');
    if (!ens.length) return;
    const homeProb = ens[0].innerText;
    const drawProb = ens[1].innerText;
    const awayProb = ens[2].innerText;
    const scores = document.querySelectorAll('.score-number');
    const homeScore = scores[0]?.innerText || '?';
    const drawScore = scores[1]?.innerText || '?';
    const awayScore = scores[2]?.innerText || '?';
    const aiText = document.querySelector('.ai-text')?.innerText || '';
    const text = `${home} vs ${away}\n` +
      `ä¸»èƒœ ${homeScore} (${homeProb})  å¹³å±€ ${drawScore} (${drawProb})  å®¢èƒœ ${awayScore} (${awayProb})\n` +
      `AIåˆ†æï¼š${aiText}`;
    navigator.clipboard.writeText(text).then(() => alert('âœ… é¢„æµ‹å·²å¤åˆ¶'));
    playClick();
  }

  // ========== è’™ç‰¹å¡æ´›æŒ‰é’®äº‹ä»¶ ==========
  function runMonteCarlo() {
    const homeTeam = document.getElementById('homeTeam').value.trim() || 'æ›¼åŸ';
    const awayTeam = document.getElementById('awayTeam').value.trim() || 'åˆ©ç‰©æµ¦';
    const xg = calculateXGWithTactics(homeTeam, awayTeam);
    renderMonteCarlo(homeTeam, awayTeam, xg.home, xg.away);
    playClick();
  }

  // ========== æ’è¡Œæ¦œ & ä¸‹æ³¨ ==========
  let credits = 1000;
  const rankNames = ['AIå…ˆçŸ¥', 'è¶³çƒä¹‹ç¥', 'å…ƒå®‡å®™æ•™çˆ¶', 'YOU'];
  function updateRank() {
    let html = '';
    for (let i = 0; i < rankNames.length; i++) {
      html += `<div class="rank-row"><span>${i + 1}. ${rankNames[i]}</span><span>ğŸ† ${Math.floor(Math.random() * 5000 + 8000)}</span></div>`;
    }
    document.getElementById('rankList').innerHTML = html;
  }

  document.getElementById('placeBetBtn').addEventListener('click', () => {
    const amount = parseInt(document.getElementById('betAmount').value);
    if (amount > credits) { alert('ç§¯åˆ†ä¸è¶³'); return; }
    credits -= amount;
    document.getElementById('userCredits').innerText = credits;
    alert(`ä¸‹æ³¨æˆåŠŸï¼å‰©ä½™ç§¯åˆ† ${credits}`);
    playClick();
  });

  // ========== éŸ³æ•ˆå¼€å…³ ==========
  document.getElementById('soundToggle').addEventListener('click', () => {
    soundEnabled = !soundEnabled;
    const icon = document.getElementById('soundIcon');
    icon.className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-off';
    if (soundEnabled) {
      audioCtx.resume().then(() => playClick());
    }
  });

  // ========== åˆå§‹åŒ– ==========
  window.addEventListener('DOMContentLoaded', () => {
    loadTeamsFromStorage();
    renderLeagueTabs();
    renderCalendar();
    renderTactics();
    renderCalibration();
    renderAchievements();
    renderOpponents();
    renderExportImport();
    renderTodaysMatches();  // ä»Šæ—¥æ¯”èµ›é¢æ¿
    refreshWithAI();
    updateRank();
    renderStandings();

    document.getElementById('refreshBtn').addEventListener('click', (e) => { e.preventDefault(); refreshWithAI(); });
    document.getElementById('useRealDataBtn').addEventListener('click', async (e) => { e.preventDefault(); await fetchRealDataAndRender(); });
    document.getElementById('simulateLiveBtn').addEventListener('click', (e) => { e.preventDefault(); startLiveSimulation(); });
    document.getElementById('copyResultBtn').addEventListener('click', (e) => { e.preventDefault(); copyPrediction(); });
    document.getElementById('refreshStandingsBtn').addEventListener('click', (e) => { e.preventDefault(); renderStandings(); playClick(); });
    document.getElementById('monteCarloBtn').addEventListener('click', (e) => { e.preventDefault(); runMonteCarlo(); });

    ['homeTeam', 'awayTeam'].forEach(id => {
      const inp = document.getElementById(id);
      inp.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); refreshWithAI(); } });
      inp.addEventListener('input', saveTeamsToStorage);
    });
  });
</script>
</body>
</html>
