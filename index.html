<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.5, user-scalable=yes">
    <meta name="theme-color" content="#00e6a0">
    <title>âš¡ è¶³çƒé¢„æµ‹Â·ä¸“ä¸šAIå¢å¼ºç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        :root {
            --bg: #0b1a15;
            --bg-gradient: radial-gradient(circle at 20% 20%, #1e4a3a, #05100c);
            --text: #ebf7f0;
            --card-bg: rgba(15, 35, 28, 0.9);
            --border: #00e6a0;
            --panel-bg: #0d281f;
            --item-bg: #1f6a50;
            --accent: #00ffaa;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --font-size: 20px;
        }
        [data-theme="light"] {
            --bg: #e0f0e8;
            --bg-gradient: radial-gradient(circle at 20% 20%, #c0e0d0, #a0c0b0);
            --text: #1a3a2a;
            --card-bg: rgba(240, 250, 240, 0.9);
            --border: #2e8b57;
            --panel-bg: #d0e8e0;
            --item-bg: #b0d0c0;
            --accent: #2e8b57;
            --danger: #c0392b;
            --warning: #d4ac0d;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',system-ui,sans-serif; transition: background 0.2s, color 0.2s; }
        body {
            background: var(--bg);
            background-image: var(--bg-gradient);
            padding: 2.5rem;
            min-height: 100vh;
            color: var(--text);
            font-size: var(--font-size);
        }
        .container { max-width: 1800px; margin: 0 auto; }

        .header {
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
            margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 5px solid var(--border);
        }
        .logo {
            display: flex; align-items: center; gap: 1.5rem;
            font-size: 3rem; font-weight: 900;
            background: linear-gradient(145deg, #e6ffe6, var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .badge {
            background: var(--panel-bg); color: var(--text); padding: 0.8rem 2rem; border-radius: 60px;
            font-size: 1.3rem; border: 3px solid var(--border); display: inline-flex; align-items: center; gap: 0.8rem;
            cursor: pointer;
        }

        .card {
            background: var(--card-bg); backdrop-filter: blur(16px);
            border-radius: 100px; padding: 3rem;
            border: 3px solid var(--border); box-shadow: 0 40px 80px rgba(0,255,150,0.25);
            margin-bottom: 3rem;
        }

        .team-row {
            display: flex; align-items: center; gap: 2rem; margin-bottom: 3rem; flex-wrap: wrap;
        }
        .team-input-wrapper { flex: 1 1 350px; position: relative; }
        .team-label { font-size: 1.2rem; opacity: 0.8; margin-bottom: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }
        .team-input {
            width: 100%; background: var(--panel-bg); border: 4px solid var(--item-bg); border-radius: 80px;
            padding: 2rem 2.5rem 2rem 5rem; font-size: 2.2rem; font-weight: 700; color: var(--text); outline: none;
        }
        .team-input:focus { border-color: var(--accent); box-shadow: 0 0 0 6px rgba(0,255,170,0.25); }
        .team-icon { position: absolute; left: 2.2rem; top: 4rem; font-size: 2.2rem; }
        .vs {
            font-size: 3.5rem; font-weight: 900; color: var(--border);
            background: var(--panel-bg); padding: 1rem 3rem; border-radius: 100px;
        }

        .selector-group {
            display: flex; gap: 1.5rem; align-items: center; margin-bottom: 2.5rem;
            background: var(--panel-bg); padding: 2rem; border-radius: 80px; flex-wrap: wrap;
        }
        .selector-option {
            background: var(--item-bg); border: 3px solid var(--border); border-radius: 60px;
            padding: 1rem 2rem; cursor: pointer; font-size: 1.6rem;
        }
        .selector-option.active { background: var(--border); color: #0b1a15; font-weight: 700; }

        .button-group {
            display: flex; gap: 2rem; margin-bottom: 3rem; flex-wrap: wrap;
        }
        .btn {
            flex: 1 1 200px; background: linear-gradient(145deg, #1e8a5a, #0a5a3a);
            border: none; color: white; padding: 2rem; border-radius: 80px; font-size: 1.8rem;
            font-weight: 700; display: flex; align-items: center; justify-content: center;
            gap: 1rem; cursor: pointer; border: 3px solid var(--border); transition: 0.1s;
            min-width: 220px;
        }
        .btn:active { transform: scale(0.96); }
        .btn-secondary { background: linear-gradient(145deg, #2f5577, #1b3d55); }
        .btn-ai { background: linear-gradient(145deg, #7d3c9e, #562b70); }

        .live-score {
            display: flex; justify-content: center; align-items: center; gap: 3rem;
            font-size: 4rem; font-weight: 900; background: var(--panel-bg);
            border-radius: 100px; padding: 2rem; margin-bottom: 2.5rem;
        }
        .live-score-team { display: flex; align-items: center; gap: 1.5rem; font-size: 2.5rem; }
        .live-score-number { color: #ffffaa; }

        .stats-panel {
            background: var(--panel-bg); border-radius: 80px; padding: 2rem;
            margin-bottom: 2.5rem; display: flex; flex-wrap: wrap; gap: 2rem; justify-content: space-around;
        }
        .stat-item { text-align: center; }
        .stat-label { font-size: 1.4rem; opacity: 0.8; }
        .stat-value { font-size: 2.2rem; font-weight: 700; color: var(--accent); }

        .history-panel {
            background: var(--panel-bg); border-radius: 80px; padding: 2rem;
            margin-bottom: 2.5rem; display: flex; flex-wrap: wrap; align-items: center; gap: 2rem;
        }
        .history-title { font-size: 1.8rem; font-weight: 700; }
        .history-grid { display: flex; gap: 1rem; flex-wrap: wrap; }
        .history-item {
            background: var(--item-bg); border-radius: 60px; padding: 0.8rem 2rem;
            font-size: 1.6rem; border: 2px solid var(--border);
        }

        .odds-panel {
            display: flex; justify-content: space-around; background: var(--panel-bg);
            border-radius: 80px; padding: 2rem; margin-bottom: 2.5rem;
        }
        .odds-item { text-align: center; }
        .odds-type { font-size: 1.6rem; opacity: 0.8; }
        .odds-value { font-size: 2rem; font-weight: 700; color: var(--warning); }

        .injury-alert {
            background: #4a2a2a; border-left: 10px solid var(--danger); border-radius: 60px;
            padding: 1.5rem 2.5rem; margin-bottom: 2.5rem; font-size: 1.6rem; color: #ffbaba;
            display: flex; align-items: center; gap: 1.5rem;
        }

        .radar-container {
            display: flex; gap: 3rem; margin-bottom: 2.5rem; background: var(--panel-bg);
            border-radius: 80px; padding: 2rem; flex-wrap: wrap; justify-content: center;
        }
        .radar-canvas { width: 300px; height: 300px; }
        .radar-title { text-align: center; font-size: 1.8rem; margin-top: 1rem; }

        .heatmap-container {
            background: var(--panel-bg); border-radius: 80px; padding: 2rem;
            margin-bottom: 2.5rem; display: flex; gap: 2rem; flex-wrap: wrap;
        }
        .heatmap-half {
            flex: 1; min-width: 300px; height: 200px; background: var(--item-bg);
            border-radius: 60px; position: relative; overflow: hidden;
        }
        .shot-spot {
            position: absolute; width: 12px; height: 12px; border-radius: 50%;
            background: var(--accent); opacity: 0.7; animation: pulse 1.5s infinite;
        }
        .shot-spot-away { background: #ff9966; }
        @keyframes pulse { 0% { opacity:0.4; transform:scale(1); } 50% { opacity:1; transform:scale(1.5); } 100% { opacity:0.4; transform:scale(1); } }

        .trend-container { background: var(--panel-bg); border-radius: 60px; padding: 2rem; margin-bottom: 2.5rem; }
        .trend-canvas { width: 100%; height: 200px; }

        .league-panel { background: var(--panel-bg); border-radius: 60px; padding: 2rem; margin-bottom: 2.5rem; }
        .league-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1rem; }
        .league-item {
            background: var(--item-bg); border-radius: 40px; padding: 0.8rem 1.5rem;
            display: flex; justify-content: space-between; font-size: 1.5rem;
        }

        .players-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem; }
        .team-players { background: var(--panel-bg); border-radius: 60px; padding: 2rem; }
        .player-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.8rem 0; border-bottom: 2px solid var(--item-bg); font-size: 1.5rem;
        }
        .player-name { width: 200px; }
        .player-stamina { width: 100px; height: 10px; background: #1a3a2a; border-radius: 20px; overflow: hidden; }
        .stamina-fill { height: 100%; background: var(--accent); }

        .tactics-board {
            background: var(--panel-bg); border-radius: 60px; padding: 2rem;
            margin-bottom: 2.5rem; height: 300px; position: relative;
        }
        .player-dot {
            position: absolute; width: 40px; height: 40px; border-radius: 50%;
            background: var(--accent); display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: black; font-weight: bold;
            transform: translate(-50%, -50%);
        }
        .player-dot.away { background: #ff9966; }

        .timeline { background: var(--panel-bg); border-radius: 60px; padding: 2rem; margin-bottom: 2.5rem; }
        .timeline-bar { display: flex; height: 20px; background: var(--item-bg); border-radius: 40px; overflow: hidden; margin-bottom: 1rem; }
        .timeline-events { display: flex; gap: 1rem; flex-wrap: wrap; }
        .event-tag {
            background: var(--item-bg); border-radius: 40px; padding: 0.5rem 1.5rem;
            font-size: 1.4rem; border-left: 5px solid var(--border); cursor: pointer;
        }

        .live-stream {
            background: var(--panel-bg); border-radius: 80px; padding: 2rem 2.5rem;
            margin-bottom: 3rem; border: 3px solid var(--border); max-height: 300px;
            overflow-y: auto; font-size: 1.5rem; color: #aaffaa;
        }
        .live-entry {
            margin-bottom: 1rem; border-left: 6px solid var(--border); padding-left: 2rem;
            cursor: pointer;
        }

        .monte-panel { background: var(--panel-bg); border-radius: 60px; padding: 2rem; margin-bottom: 3rem; display: none; }
        .monte-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-top: 1.5rem; }
        .monte-item { background: var(--item-bg); border-radius: 40px; padding: 1rem 2rem; display: flex; justify-content: space-between; font-size: 1.6rem; }

        .multi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-bottom: 3rem; }
        .multi-card { background: var(--panel-bg); border-radius: 60px; padding: 2rem; border: 3px solid var(--border); }
        .multi-header { display: flex; justify-content: space-between; font-size: 2rem; margin-bottom: 1rem; }
        .multi-score { font-size: 2.5rem; font-weight: 900; color: #ffffaa; }

        .detail-panel { background: var(--panel-bg); border-radius: 60px; padding: 2.5rem; margin-bottom: 3rem; }
        .detail-title { font-size: 2.2rem; font-weight: 700; margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem; }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2rem; margin-bottom: 2rem; }
        .detail-col { background: #1a3a2a; border-radius: 40px; padding: 1.5rem; }
        .col-title { font-size: 1.8rem; font-weight: 700; color: #ffffaa; text-align: center; margin-bottom: 1rem; }
        .score-row { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0; border-bottom: 1px solid var(--item-bg); font-size: 1.5rem; }
        .score-prob { display: flex; align-items: center; gap: 1rem; }
        .prob-bar { width: 80px; height: 12px; background: var(--item-bg); border-radius: 40px; overflow: hidden; }
        .prob-fill { height: 100%; }
        .prob-fill.home { background: #2ecc71; }
        .prob-fill.draw { background: var(--warning); }
        .prob-fill.away { background: #e67e22; }
        .prob-text { min-width: 50px; text-align: right; color: var(--accent); font-weight: 600; }
        .recommend-summary {
            background: var(--item-bg); border-radius: 60px; padding: 1.5rem 2.5rem;
            font-size: 1.6rem; display: flex; align-items: center; gap: 2rem; flex-wrap: wrap;
        }
        .stars { display: flex; gap: 0.3rem; color: var(--warning); font-size: 2rem; }

        .todays-matches-panel {
            background: var(--panel-bg);
            border-radius: 60px;
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            border: 3px solid var(--border);
        }
        .matches-list {
            max-height: 500px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .match-item {
            background: var(--item-bg);
            border-radius: 40px;
            padding: 1.5rem;
            border: 2px solid var(--border);
            transition: 0.2s;
        }
        .match-item:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px var(--accent);
        }

        .real-data-panel {
            background: var(--panel-bg);
            border-radius: 60px;
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            border: 3px solid var(--border);
        }
        .real-data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .real-data-table th {
            border-bottom: 3px solid var(--border);
            padding: 1rem;
            text-align: left;
            font-size: 1.6rem;
        }
        .real-data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--item-bg);
            font-size: 1.5rem;
        }
        .team-crest {
            height: 25px;
            margin-right: 10px;
            vertical-align: middle;
        }
        .player-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--item-bg);
            display: inline-block;
            margin-right: 10px;
        }

        /* æ–°å¢ï¼šä¸“ä¸šå¯¹æ¯”é¢æ¿ */
        .pro-comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 2.5rem;
            background: var(--panel-bg);
            border-radius: 60px;
            padding: 2rem;
        }
        .pro-item {
            text-align: center;
        }
        .pro-name {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 1rem;
        }
        .pro-prob {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text);
        }
        .pro-bar {
            width: 100%;
            height: 10px;
            background: var(--item-bg);
            border-radius: 20px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        .pro-bar-fill {
            height: 100%;
            background: var(--accent);
        }

        /* å‡¯åˆ©æŒ‡æ•° */
        .kelly-panel {
            background: var(--panel-bg);
            border-radius: 60px;
            padding: 2rem;
            margin-bottom: 2.5rem;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        .kelly-item {
            text-align: center;
        }
        .kelly-label {
            font-size: 1.6rem;
            color: var(--text);
        }
        .kelly-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
        }
        .kelly-badge {
            background: var(--warning);
            color: #0b1a15;
            padding: 0.5rem 1rem;
            border-radius: 40px;
            font-size: 1.4rem;
        }

        .footer { margin-top: 4rem; padding-top: 2.5rem; border-top: 4px solid var(--border); display: flex; justify-content: space-between; color: var(--text); font-size: 1.4rem; }

        @media (max-width: 900px) {
            body { padding: 1.8rem; font-size: 18px; }
            .team-input { font-size: 1.8rem; }
            .btn { font-size: 1.5rem; padding: 1.5rem; }
            .detail-grid { grid-template-columns: 1fr; }
            .pro-comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo">
            <i class="fas fa-crown"></i> è¶³çƒé¢„æµ‹Â·ä¸“ä¸šAIå¢å¼ºç‰ˆ
        </div>
        <div style="display: flex; gap: 1rem;">
            <span class="badge" id="themeToggle" onclick="toggleTheme()"><i class="fas fa-palette"></i> ä¸»é¢˜</span>
            <span class="badge" id="langToggle" onclick="toggleLang()"><i class="fas fa-language"></i> ä¸­/EN</span>
            <span class="badge" id="soundToggle"><i class="fas fa-volume-off" id="soundIcon"></i> éŸ³æ•ˆ</span>
            <span class="badge" id="voiceToggle"><i class="fas fa-microphone-alt"></i> è§£è¯´</span>
        </div>
    </div>

    <div class="card">
        <!-- çƒé˜Ÿè¾“å…¥ -->
        <div class="team-row">
            <div class="team-input-wrapper">
                <div class="team-label" data-i18n="home">ä¸»é˜Ÿ</div>
                <span class="team-icon" id="homeIcon">ğŸ³ï¸</span>
                <input type="text" id="homeTeam" class="team-input" value="æ›¼åŸ">
            </div>
            <span class="vs">VS</span>
            <div class="team-input-wrapper">
                <div class="team-label" data-i18n="away">å®¢é˜Ÿ</div>
                <span class="team-icon" id="awayIcon">ğŸ³ï¸</span>
                <input type="text" id="awayTeam" class="team-input" value="åˆ©ç‰©æµ¦">
            </div>
        </div>

        <!-- ç²¾åº¦æ»‘å— -->
        <div class="selector-group">
            <span style="font-size:1.8rem;"><i class="fas fa-bullseye"></i> <span data-i18n="accuracy">æ¯”åˆ†ç²¾ç¡®åº¦</span></span>
            <input type="range" id="accuracySlider" min="0" max="4" value="2" step="1" style="flex:1; height:12px;">
            <span class="accuracy-value" id="accuracyDisplay">ä¸­</span>
        </div>

        <!-- å¤©æ°”ã€é˜µå‹ã€æˆ˜æœ¯ -->
        <div class="selector-group">
            <span style="font-size:1.8rem;"><i class="fas fa-cloud-sun"></i> <span data-i18n="weather">å¤©æ°”</span>:</span>
            <span class="selector-option active" data-weather="æ™´">â˜€ï¸ æ™´</span>
            <span class="selector-option" data-weather="é›¨">ğŸŒ§ï¸ é›¨</span>
            <span class="selector-option" data-weather="é›ª">â„ï¸ é›ª</span>
            <span class="selector-option" data-weather="é›¾">ğŸŒ«ï¸ é›¾</span>
        </div>
        <div class="selector-group">
            <span style="font-size:1.8rem;"><i class="fas fa-chess-board"></i> <span data-i18n="formation">é˜µå‹</span>:</span>
            <span class="selector-option active" data-formation="442">4-4-2</span>
            <span class="selector-option" data-formation="433">4-3-3</span>
            <span class="selector-option" data-formation="352">3-5-2</span>
        </div>
        <div class="selector-group">
            <span style="font-size:1.8rem;"><i class="fas fa-flag"></i> <span data-i18n="tactic">æˆ˜æœ¯</span>:</span>
            <span class="selector-option active" data-tactic="normal">âš–ï¸ å‡è¡¡</span>
            <span class="selector-option" data-tactic="attack">âš¡ è¿›æ”»</span>
            <span class="selector-option" data-tactic="defend">ğŸ›¡ï¸ é˜²å®ˆ</span>
            <span class="selector-option" data-tactic="possession">ğŸ” æ§çƒ</span>
        </div>

        <!-- æ§åˆ¶æŒ‰é’®ç»„ -->
        <div class="button-group">
            <button id="startSimBtn" class="btn btn-ai"><i class="fas fa-play"></i> <span data-i18n="startSim">å¼€å§‹æ¨¡æ‹Ÿ</span></button>
            <button id="pauseSimBtn" class="btn btn-secondary"><i class="fas fa-pause"></i> <span data-i18n="pause">æš‚åœ</span></button>
            <button id="resetSimBtn" class="btn btn-secondary"><i class="fas fa-undo"></i> <span data-i18n="reset">é‡ç½®</span></button>
            <button id="monteCarloBtn" class="btn btn-ai"><i class="fas fa-dice"></i> <span data-i18n="monte">è’™ç‰¹å¡æ´›</span></button>
            <button id="addMatchBtn" class="btn btn-secondary"><i class="fas fa-plus"></i> <span data-i18n="addMatch">æ·»åŠ å¯¹å†³</span></button>
            <button id="seasonBtn" class="btn btn-secondary"><i class="fas fa-calendar-alt"></i> <span data-i18n="season">èµ›å­£æ¨¡å¼</span></button>
            <button id="exportCsvBtn" class="btn btn-secondary"><i class="fas fa-file-csv"></i> <span data-i18n="exportCsv">å¯¼å‡ºç§¯åˆ†æ¦œ</span></button>
            <button id="shareBtn" class="btn btn-secondary"><i class="fas fa-share-alt"></i> <span data-i18n="share">åˆ†äº«</span></button>
            <button id="apiBtn" class="btn btn-secondary"><i class="fas fa-cloud-sun"></i> ä»Šæ—¥èµ›ç¨‹</button>
            <button id="proCompareBtn" class="btn btn-ai"><i class="fas fa-chart-line"></i> ä¸“ä¸šå¯¹æ¯”</button>
        </div>

        <!-- ä¸“ä¸šå¯¹æ¯”é¢æ¿ -->
        <div id="proComparison" class="pro-comparison" style="display:none;">
            <div class="pro-item">
                <div class="pro-name">æœ¬ç³»ç»Ÿ AI</div>
                <div class="pro-prob" id="aiProb">45%</div>
                <div class="pro-bar"><div class="pro-bar-fill" id="aiBar" style="width:45%"></div></div>
            </div>
            <div class="pro-item">
                <div class="pro-name">FiveThirtyEight</div>
                <div class="pro-prob" id="fiveProb">43%</div>
                <div class="pro-bar"><div class="pro-bar-fill" id="fiveBar" style="width:43%"></div></div>
            </div>
            <div class="pro-item">
                <div class="pro-name">Opta</div>
                <div class="pro-prob" id="optaProb">47%</div>
                <div class="pro-bar"><div class="pro-bar-fill" id="optaBar" style="width:47%"></div></div>
            </div>
        </div>

        <!-- å‡¯åˆ©æŒ‡æ•°é¢æ¿ -->
        <div id="kellyPanel" class="kelly-panel" style="display:none;">
            <div class="kelly-item">
                <div class="kelly-label">ä¸»èƒœ</div>
                <div class="kelly-value" id="kellyHome">0.00</div>
            </div>
            <div class="kelly-item">
                <div class="kelly-label">å¹³å±€</div>
                <div class="kelly-value" id="kellyDraw">0.00</div>
            </div>
            <div class="kelly-item">
                <div class="kelly-label">å®¢èƒœ</div>
                <div class="kelly-value" id="kellyAway">0.00</div>
            </div>
            <div class="kelly-item">
                <span class="kelly-badge" id="kellyAdvice">å»ºè®®: ä¸æŠ•</span>
            </div>
        </div>

        <!-- çœŸå®æ•°æ®é¢æ¿ -->
        <div class="selector-group" style="justify-content: space-between;">
            <span style="font-size:1.8rem;"><i class="fas fa-database"></i> çœŸå®æ•°æ®</span>
            <select id="realLeagueSelect" style="flex:1; margin:0 2rem; padding:1rem; border-radius:60px; background:var(--panel-bg); color:var(--text); border:3px solid var(--border); font-size:1.6rem;">
                <option value="è‹±è¶…">ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ è‹±è¶…</option>
                <option value="è¥¿ç”²">ğŸ‡ªğŸ‡¸ è¥¿ç”²</option>
                <option value="å¾·ç”²">ğŸ‡©ğŸ‡ª å¾·ç”²</option>
                <option value="æ„ç”²">ğŸ‡®ğŸ‡¹ æ„ç”²</option>
                <option value="æ³•ç”²">ğŸ‡«ğŸ‡· æ³•ç”²</option>
                <option value="æ¬§å† ">ğŸ† æ¬§å† </option>
            </select>
            <button id="fetchStandingsBtn" class="btn" style="padding:1rem 2rem;">ğŸ“Š ç§¯åˆ†æ¦œ</button>
            <button id="fetchScorersBtn" class="btn" style="padding:1rem 2rem;">âš½ å°„æ‰‹æ¦œ</button>
            <button id="fetchSquadBtn" class="btn" style="padding:1rem 2rem;">ğŸ§‘ é˜µå®¹</button>
            <button id="fetchH2HBtn" class="btn" style="padding:1rem 2rem;">ğŸ”„ å†å²äº¤é”‹</button>
            <button id="fetchLiveMatchesBtn" class="btn" style="padding:1rem 2rem;">âš¡ ç›´æ’­ä¸­</button>
            <button id="fetchTeamInfoBtn" class="btn" style="padding:1rem 2rem;">ğŸŸï¸ çƒé˜Ÿä¿¡æ¯</button>
        </div>

        <div id="realDataPanel" class="real-data-panel">
            <div id="realDataContent" style="max-height:400px; overflow-y:auto;">
                ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è·å–çœŸå®æ•°æ®
            </div>
        </div>

        <!-- å®æ—¶æ¯”åˆ† -->
        <div class="live-score">
            <div class="live-score-team"><span id="liveHomeName">æ›¼åŸ</span> <span id="liveHomeScore">0</span></div>
            <span>-</span>
            <div class="live-score-team"><span id="liveAwayScore">0</span> <span id="liveAwayName">åˆ©ç‰©æµ¦</span></div>
        </div>

        <!-- å®æ—¶ç»Ÿè®¡ -->
        <div id="liveStats" class="stats-panel">
            <div class="stat-item"><span class="stat-label" data-i18n="shots">å°„é—¨</span><span class="stat-value" id="statHomeShots">0</span> - <span class="stat-value" id="statAwayShots">0</span></div>
            <div class="stat-item"><span class="stat-label" data-i18n="shotsOn">å°„æ­£</span><span class="stat-value" id="statHomeShotsOn">0</span> - <span class="stat-value" id="statAwayShotsOn">0</span></div>
            <div class="stat-item"><span class="stat-label" data-i18n="pass">ä¼ çƒ%</span><span class="stat-value" id="statHomePass">0%</span> - <span class="stat-value" id="statAwayPass">0%</span></div>
            <div class="stat-item"><span class="stat-label" data-i18n="tackle">æŠ¢æ–­</span><span class="stat-value" id="statHomeTackle">0</span> - <span class="stat-value" id="statAwayTackle">0</span></div>
            <div class="stat-item"><span class="stat-label" data-i18n="offside">è¶Šä½</span><span class="stat-value" id="statHomeOffside">0</span> - <span class="stat-value" id="statAwayOffside">0</span></div>
            <div class="stat-item"><span class="stat-label" data-i18n="possession">æ§çƒ</span><span class="stat-value" id="statHomePoss">50%</span> - <span class="stat-value" id="statAwayPoss">50%</span></div>
        </div>

        <!-- æˆ˜æœ¯æ¿ -->
        <div class="tactics-board" id="tacticsBoard"></div>

        <!-- å†å²äº¤é”‹æ·±åº¦ -->
        <div id="historyDeepPanel" class="history-panel">
            <span class="history-title"><i class="fas fa-chart-bar"></i> <span data-i18n="historyDeep">äº¤é”‹æ·±åº¦</span></span>
            <div id="historyDeepGrid" class="history-grid"></div>
        </div>

        <!-- èµ”ç‡å¯¹æ¯” -->
        <div id="oddsPanel" class="odds-panel"></div>

        <!-- ä¼¤ç—…æé†’ -->
        <div id="injuryAlert" class="injury-alert">
            <i class="fas fa-exclamation-triangle" style="color:var(--danger); font-size:2.5rem;"></i>
            <span id="injuryText">åŠ è½½ä¸­...</span>
        </div>

        <!-- é›·è¾¾å›¾ -->
        <div class="radar-container">
            <div>
                <canvas id="radarHome" width="300" height="300"></canvas>
                <div class="radar-title" id="radarHomeTitle">ä¸»é˜Ÿ</div>
            </div>
            <div>
                <canvas id="radarAway" width="300" height="300"></canvas>
                <div class="radar-title" id="radarAwayTitle">å®¢é˜Ÿ</div>
            </div>
        </div>

        <!-- çƒ­åŠ›å›¾ -->
        <div class="heatmap-container">
            <div class="heatmap-half" id="homeHeatmap"></div>
            <div class="heatmap-half" id="awayHeatmap"></div>
        </div>

        <!-- æ¯”åˆ†æ·±åº¦åˆ†æ -->
        <div id="detailPanel" class="detail-panel">
            <div class="detail-title"><i class="fas fa-chart-pie"></i> <span data-i18n="detailTitle">æ¯”åˆ†æ·±åº¦æ¨è</span></div>
            <div id="detailGrid" class="detail-grid"></div>
            <div id="recommendSummary" class="recommend-summary">
                <div class="stars" id="starRating">â˜…â˜…â˜…â˜…â˜…</div>
                <div id="summaryText">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- è™šæ‹Ÿè”èµ›ç§¯åˆ†æ¦œ -->
        <div class="league-panel">
            <h3 style="font-size:2rem;"><i class="fas fa-table"></i> <span data-i18n="league">è™šæ‹Ÿè”èµ›ç§¯åˆ†æ¦œ</span></h3>
            <div id="leagueGrid" class="league-grid"></div>
        </div>

        <!-- çƒå‘˜åˆ—è¡¨ -->
        <div class="players-grid">
            <div class="team-players">
                <h3 style="font-size:2rem; margin-bottom:1rem;"><span id="homePlayersTitle">æ›¼åŸ</span> <span data-i18n="squad">é¦–å‘</span>
                    <button id="editHomeBtn" class="btn" style="padding:0.5rem 1.5rem; font-size:1.2rem;"><i class="fas fa-edit"></i> <span data-i18n="edit">ç¼–è¾‘</span></button>
                    <button id="subHomeBtn" class="btn" style="padding:0.5rem 1.5rem; font-size:1.2rem;"><i class="fas fa-exchange-alt"></i> <span data-i18n="sub">æ¢äºº</span></button>
                </h3>
                <div id="homePlayersList"></div>
            </div>
            <div class="team-players">
                <h3 style="font-size:2rem; margin-bottom:1rem;"><span id="awayPlayersTitle">åˆ©ç‰©æµ¦</span> <span data-i18n="squad">é¦–å‘</span>
                    <button id="editAwayBtn" class="btn" style="padding:0.5rem 1.5rem; font-size:1.2rem;"><i class="fas fa-edit"></i> <span data-i18n="edit">ç¼–è¾‘</span></button>
                    <button id="subAwayBtn" class="btn" style="padding:0.5rem 1.5rem; font-size:1.2rem;"><i class="fas fa-exchange-alt"></i> <span data-i18n="sub">æ¢äºº</span></button>
                </h3>
                <div id="awayPlayersList"></div>
            </div>
        </div>

        <!-- æ—¶é—´çº¿ -->
        <div class="timeline">
            <div class="timeline-bar" id="timelineBar"></div>
            <div class="timeline-events" id="timelineEvents"></div>
        </div>

        <!-- ç›´æ’­æµ -->
        <div id="liveStream" class="live-stream">
            <div class="live-entry">â±ï¸ <span data-i18n="waiting">ç­‰å¾…æ¯”èµ›å¼€å§‹...</span></div>
        </div>

        <!-- è’™ç‰¹å¡æ´›ç»“æœ -->
        <div id="montePanel" class="monte-panel">
            <h3 style="font-size:2rem;"><i class="fas fa-dice"></i> 1000æ¬¡æ¨¡æ‹Ÿæœ€å¯èƒ½æ¯”åˆ†</h3>
            <div class="monte-grid" id="monteGrid"></div>
        </div>

        <!-- å¤šåœºå¡ç‰‡ -->
        <div id="multiMatches" class="multi-grid"></div>

        <!-- èµ›åæŠ¥å‘ŠæŒ‰é’® -->
        <div style="text-align: right; margin-top: 2rem;">
            <button id="reportBtn" class="btn" style="padding:1rem 3rem;"><i class="fas fa-file-alt"></i> <span data-i18n="report">ç”Ÿæˆèµ›åæŠ¥å‘Š</span></button>
        </div>
    </div>

    <div class="footer">
        <div><i class="fas fa-shield-alt"></i> æœ¨å…°PSL-2.0</div>
        <div><i class="fas fa-globe-asia"></i> www.football-predict.top</div>
        <div><i class="fas fa-crown"></i> ä¸“ä¸šAIå¢å¼ºç‰ˆ</div>
    </div>
</div>

<script>
    "use strict";
    // ---------- å¤šè¯­è¨€ ----------
    const i18n = {
        zh: {
            home: 'ä¸»é˜Ÿ', away: 'å®¢é˜Ÿ', accuracy: 'æ¯”åˆ†ç²¾ç¡®åº¦', weather: 'å¤©æ°”', formation: 'é˜µå‹', tactic: 'æˆ˜æœ¯',
            startSim: 'å¼€å§‹æ¨¡æ‹Ÿ', pause: 'æš‚åœ', reset: 'é‡ç½®', monte: 'è’™ç‰¹å¡æ´›', addMatch: 'æ·»åŠ å¯¹å†³',
            season: 'èµ›å­£æ¨¡å¼', exportCsv: 'å¯¼å‡ºç§¯åˆ†æ¦œ', share: 'åˆ†äº«', shots: 'å°„é—¨', shotsOn: 'å°„æ­£',
            pass: 'ä¼ çƒ%', tackle: 'æŠ¢æ–­', offside: 'è¶Šä½', possession: 'æ§çƒ', historyDeep: 'äº¤é”‹æ·±åº¦',
            detailTitle: 'æ¯”åˆ†æ·±åº¦æ¨è', league: 'è™šæ‹Ÿè”èµ›ç§¯åˆ†æ¦œ', squad: 'é¦–å‘', edit: 'ç¼–è¾‘', sub: 'æ¢äºº',
            waiting: 'ç­‰å¾…æ¯”èµ›å¼€å§‹...', report: 'ç”Ÿæˆèµ›åæŠ¥å‘Š'
        },
        en: {
            home: 'Home', away: 'Away', accuracy: 'Accuracy', weather: 'Weather', formation: 'Formation', tactic: 'Tactic',
            startSim: 'Start Sim', pause: 'Pause', reset: 'Reset', monte: 'Monte Carlo', addMatch: 'Add Match',
            season: 'Season', exportCsv: 'Export CSV', share: 'Share', shots: 'Shots', shotsOn: 'On Target',
            pass: 'Pass%', tackle: 'Tackles', offside: 'Offside', possession: 'Possession', historyDeep: 'H2H Deep',
            detailTitle: 'Score Details', league: 'League Table', squad: 'Lineup', edit: 'Edit', sub: 'Sub',
            waiting: 'Waiting...', report: 'Report'
        }
    };
    let currentLang = 'zh';
    function toggleLang() {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (i18n[currentLang][key]) el.innerText = i18n[currentLang][key];
        });
        document.getElementById('langToggle').innerHTML = `<i class="fas fa-language"></i> ${currentLang==='zh'?'ä¸­/EN':'EN/ä¸­'}`;
    }

    // ---------- ä¸»é¢˜åˆ‡æ¢ ----------
    function toggleTheme() {
        const root = document.documentElement;
        if (root.getAttribute('data-theme') === 'light') root.removeAttribute('data-theme');
        else root.setAttribute('data-theme', 'light');
    }

    // ---------- éŸ³æ•ˆ ----------
    let soundEnabled = false;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playClick() {
        if (!soundEnabled || audioCtx.state === 'suspended') return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.value = 800;
        gain.gain.value = 0.1;
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }
    document.getElementById('soundToggle').addEventListener('click', () => {
        soundEnabled = !soundEnabled;
        document.getElementById('soundIcon').className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-off';
    });

    // ---------- è¯­éŸ³è§£è¯´ ----------
    let voiceEnabled = false;
    document.getElementById('voiceToggle').addEventListener('click', () => {
        voiceEnabled = !voiceEnabled;
        document.getElementById('voiceToggle').style.opacity = voiceEnabled ? 1 : 0.6;
        if (voiceEnabled) speak('è¯­éŸ³è§£è¯´å·²å¼€å¯');
    });
    function speak(text) {
        if (!voiceEnabled || !window.speechSynthesis) return;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = currentLang === 'zh' ? 'zh-CN' : 'en-US';
        window.speechSynthesis.speak(utterance);
    }

    // ---------- éšæœºå·¥å…· ----------
    function rand(min, max) { return Math.random() * (max - min) + min; }
    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    // ---------- çƒé˜Ÿå›¾æ ‡ ----------
    const TEAM_ICONS = {
        'æ›¼åŸ':'ğŸ‡¬ğŸ‡§','åˆ©ç‰©æµ¦':'ğŸ‡¬ğŸ‡§','çš‡é©¬':'ğŸ‡ªğŸ‡¸','å·´è¨':'ğŸ‡ªğŸ‡¸','æ‹œä»':'ğŸ‡©ğŸ‡ª','å¤šç‰¹':'ğŸ‡©ğŸ‡ª',
        'å·´é»':'ğŸ‡«ğŸ‡·','å°¤æ–‡':'ğŸ‡®ğŸ‡¹','ACç±³å…°':'ğŸ‡®ğŸ‡¹','æ›¼è”':'ğŸ‡¬ğŸ‡§','é˜¿æ£®çº³':'ğŸ‡¬ğŸ‡§','åˆ‡å°”è¥¿':'ğŸ‡¬ğŸ‡§',
        'çƒ­åˆº':'ğŸ‡¬ğŸ‡§','å›½ç±³':'ğŸ‡®ğŸ‡¹','é©¬ç«':'ğŸ‡ªğŸ‡¸','å‹’æ²ƒåº“æ£®':'ğŸ‡©ğŸ‡ª','è±æ¯”é”¡':'ğŸ‡©ğŸ‡ª','å¡ç»´åˆ©äºš':'ğŸ‡ªğŸ‡¸',
        'æ³¢å°”å›¾':'ğŸ‡µğŸ‡¹','æœ¬è²å¡':'ğŸ‡µğŸ‡¹','é˜¿è´¾å…‹æ–¯':'ğŸ‡³ğŸ‡±','æ³½å°¼ç‰¹':'ğŸ‡·ğŸ‡º','å‡¯å°”ç‰¹äºº':'ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿',
        'é‡Œæ˜‚':'ğŸ‡«ğŸ‡·','æ‘©çº³å“¥':'ğŸ‡«ğŸ‡·','æ‹‰é½å¥¥':'ğŸ‡®ğŸ‡¹','ç½—é©¬':'ğŸ‡®ğŸ‡¹','é‚£ä¸å‹’æ–¯':'ğŸ‡®ğŸ‡¹','å¤šç‰¹è’™å¾·':'ğŸ‡©ğŸ‡ª',
        'é—¨å…´':'ğŸ‡©ğŸ‡ª','æ³•å…°å…‹ç¦':'ğŸ‡©ğŸ‡ª','çš‡å®¶ç¤¾ä¼š':'ğŸ‡ªğŸ‡¸','æ¯•å°”å·´é„‚':'ğŸ‡ªğŸ‡¸','ç“¦ä¼¦è¥¿äºš':'ğŸ‡ªğŸ‡¸','è´è’‚æ–¯':'ğŸ‡ªğŸ‡¸',
        'å¸ƒè±é¡¿':'ğŸ‡¬ğŸ‡§','çº½å¡æ–¯å°”':'ğŸ‡¬ğŸ‡§','é˜¿æ–¯é¡¿ç»´æ‹‰':'ğŸ‡¬ğŸ‡§','ç‹¼é˜Ÿ':'ğŸ‡¬ğŸ‡§'
    };

    // ---------- çƒå‘˜æ•°æ® ----------
    let homePlayers = [], awayPlayers = [];
    let leagueTeams = [];

    function generatePlayers(count=11) {
        const first = ['James','John','Michael','David','Kevin','Thomas','Paul','Mark','Steven'];
        const last = ['Smith','Johnson','Williams','Brown','Jones','Garcia','Miller','Davis','Rodriguez'];
        let players = [];
        for (let i = 0; i < count; i++) {
            players.push({
                name: first[Math.floor(Math.random()*first.length)] + ' ' + last[Math.floor(Math.random()*last.length)],
                rating: randInt(65,92),
                goals: 0, assists: 0, yellow: 0, injured: false, suspended: false,
                stamina: 100, morale: randInt(70,100),
                passes: 0, tackles: 0, offsides: 0
            });
        }
        return players;
    }
    homePlayers = generatePlayers();
    awayPlayers = generatePlayers();

    function updateIcons() {
        let h = document.getElementById('homeTeam').value.trim() || 'ä¸»é˜Ÿ';
        let a = document.getElementById('awayTeam').value.trim() || 'å®¢é˜Ÿ';
        document.getElementById('homeIcon').innerText = TEAM_ICONS[h] || 'ğŸ³ï¸';
        document.getElementById('awayIcon').innerText = TEAM_ICONS[a] || 'ğŸ³ï¸';
        document.getElementById('liveHomeName').innerText = h;
        document.getElementById('liveAwayName').innerText = a;
        document.getElementById('homePlayersTitle').innerText = h;
        document.getElementById('awayPlayersTitle').innerText = a;
        document.getElementById('radarHomeTitle').innerText = h;
        document.getElementById('radarAwayTitle').innerText = a;
    }
    document.getElementById('homeTeam').addEventListener('input', updateIcons);
    document.getElementById('awayTeam').addEventListener('input', updateIcons);

    function renderPlayers() {
        let homeHtml = homePlayers.map(p => `
            <div class="player-row">
                <span class="player-name">${p.name}${p.injured?' (ä¼¤)':p.suspended?' (åœ)':''}</span>
                <div class="player-stamina"><div class="stamina-fill" style="width:${p.stamina}%"></div></div>
                <span>${p.rating}</span>
            </div>
        `).join('');
        document.getElementById('homePlayersList').innerHTML = homeHtml;
        let awayHtml = awayPlayers.map(p => `
            <div class="player-row">
                <span class="player-name">${p.name}${p.injured?' (ä¼¤)':p.suspended?' (åœ)':''}</span>
                <div class="player-stamina"><div class="stamina-fill" style="width:${p.stamina}%"></div></div>
                <span>${p.rating}</span>
            </div>
        `).join('');
        document.getElementById('awayPlayersList').innerHTML = awayHtml;
    }

    // ---------- å¤©æ°”ã€é˜µå‹ã€æˆ˜æœ¯ ----------
    let currentWeather = 'æ™´';
    let currentFormation = '442';
    let currentTactic = 'normal';
    const weatherFactors = { 'æ™´':1.0, 'é›¨':0.9, 'é›ª':0.8, 'é›¾':0.85 };
    const formationFactors = { '442':1.0, '433':1.1, '352':1.05 };
    const tacticFactors = { 'normal':1.0, 'attack':1.2, 'defend':0.8, 'possession':1.1 };

    document.querySelectorAll('[data-weather]').forEach(opt => {
        opt.addEventListener('click', function() {
            document.querySelectorAll('[data-weather]').forEach(o => o.classList.remove('active'));
            this.classList.add('active');
            currentWeather = this.dataset.weather;
            updateAll();
            playClick();
        });
    });
    document.querySelectorAll('[data-formation]').forEach(opt => {
        opt.addEventListener('click', function() {
            document.querySelectorAll('[data-formation]').forEach(o => o.classList.remove('active'));
            this.classList.add('active');
            currentFormation = this.dataset.formation;
            updateAll();
            playClick();
        });
    });
    document.querySelectorAll('[data-tactic]').forEach(opt => {
        opt.addEventListener('click', function() {
            document.querySelectorAll('[data-tactic]').forEach(o => o.classList.remove('active'));
            this.classList.add('active');
            currentTactic = this.dataset.tactic;
            updateAll();
            playClick();
        });
    });

    // ---------- ç²¾åº¦æ»‘å— ----------
    let accuracyLevel = 2;
    document.getElementById('accuracySlider').addEventListener('input', function() {
        accuracyLevel = +this.value;
        const names = ['éšæœºå¨±ä¹', 'ä½', 'ä¸­', 'é«˜', 'ç²¾ç¡®'];
        document.getElementById('accuracyDisplay').innerText = names[accuracyLevel];
        updateAll();
        playClick();
    });

    // ---------- çœŸå®æ¯”åˆ†åº“ ----------
    const SCORE_WEIGHTS = {
        '1:0':115,'2:1':98,'2:0':87,'1:1':85,'0:0':62,'3:1':51,'0:1':48,'3:0':39,'2:2':28,'1:2':35,
        '0:2':25,'3:2':18,'4:0':15,'1:3':12,'0:3':8,'4:1':7,'3:3':5,'4:2':4,'5:0':3
    };
    const SCORE_LIST = Object.entries(SCORE_WEIGHTS).flatMap(([s,w]) => Array(w).fill(s));

    function poissonGoals(lambda) {
        let L = Math.exp(-lambda), k = 0, p = 1;
        do { k++; p *= Math.random(); } while (p > L);
        return k-1;
    }

    function generateScore(homeXG, awayXG) {
        if (accuracyLevel === 0) return `${randInt(0,5)}:${randInt(0,4)}`;
        if (accuracyLevel === 4) return SCORE_LIST[Math.floor(Math.random()*SCORE_LIST.length)];
        let usePoisson = Math.random() < (accuracyLevel/4);
        if (usePoisson) {
            let h = poissonGoals(homeXG);
            let a = poissonGoals(awayXG);
            return `${Math.min(h,5)}:${Math.min(a,4)}`;
        } else {
            return SCORE_LIST[Math.floor(Math.random()*SCORE_LIST.length)];
        }
    }

    function getTeamAbility(players) {
        let avg = players.reduce((s,p)=>s+p.rating,0)/players.length;
        return {
            attack: avg * (0.8+rand(0,0.1)),
            defense: avg * (0.7+rand(0,0.1)),
            midfield: avg * (0.75+rand(0,0.1)),
            speed: avg * (0.7+rand(0,0.1)),
            experience: avg * (0.8+rand(0,0.1))
        };
    }
    function calculateXG() {
        let home = getTeamAbility(homePlayers);
        let away = getTeamAbility(awayPlayers);
        let w = weatherFactors[currentWeather];
        let f = formationFactors[currentFormation];
        let t = tacticFactors[currentTactic];
        let homeInjury = homePlayers.some(p=>p.rating>85 && p.injured) ? 0.85 : 1.0;
        let awayInjury = awayPlayers.some(p=>p.rating>85 && p.injured) ? 0.85 : 1.0;
        let homeMorale = homePlayers.reduce((s,p)=>s+p.morale,0)/homePlayers.length/100;
        let awayMorale = awayPlayers.reduce((s,p)=>s+p.morale,0)/awayPlayers.length/100;
        let homeXG = home.attack/100 * (1.5+rand(0,0.5)) * w * f * t * homeInjury * homeMorale;
        let awayXG = away.attack/100 * (1.2+rand(0,0.4)) * w * (2-f) * t * awayInjury * awayMorale;
        return { home: Math.min(3.5, Math.max(0.4, homeXG)), away: Math.min(3.0, Math.max(0.3, awayXG)) };
    }

    // ---------- ä¸“ä¸šçº§AIå¼•æ“ï¼šElo + æ³Šæ¾å›å½’ + åŠ¨æ€æƒé‡ ----------
    let eloRatings = {}; // çƒé˜ŸEloè¯„åˆ†
    let modelWeights = { elo: 0.3, xg: 0.4, history: 0.2, morale: 0.1 }; // å¯å­¦ä¹ æƒé‡
    let lastPredictionAccuracy = 0.5; // æœ€è¿‘é¢„æµ‹å‡†ç¡®ç‡

    function getElo(team) {
        if (!eloRatings[team]) eloRatings[team] = 1500;
        return eloRatings[team];
    }

    function updateElo(home, away, homeScore, awayScore) {
        // ç®€å•Eloæ›´æ–°
        let homeElo = getElo(home);
        let awayElo = getElo(away);
        let expectedHome = 1 / (1 + Math.pow(10, (awayElo - homeElo) / 400));
        let expectedAway = 1 - expectedHome;
        let k = 32;
        if (homeScore > awayScore) {
            eloRatings[home] = homeElo + k * (1 - expectedHome);
            eloRatings[away] = awayElo + k * (0 - expectedAway);
        } else if (homeScore < awayScore) {
            eloRatings[away] = awayElo + k * (1 - expectedAway);
            eloRatings[home] = homeElo + k * (0 - expectedHome);
        } else {
            eloRatings[home] = homeElo + k * (0.5 - expectedHome);
            eloRatings[away] = awayElo + k * (0.5 - expectedAway);
        }
    }

    function computeProbsWithAI() {
        let homeTeam = document.getElementById('homeTeam').value.trim() || 'æ›¼åŸ';
        let awayTeam = document.getElementById('awayTeam').value.trim() || 'åˆ©ç‰©æµ¦';
        let xg = calculateXG();
        let homeElo = getElo(homeTeam);
        let awayElo = getElo(awayTeam);
        let eloProb = 1 / (1 + Math.pow(10, (awayElo - homeElo) / 400));
        let xgProb = xg.home / (xg.home + xg.away);
        // å†å²äº¤é”‹æƒé‡ï¼ˆç®€å•æ¨¡æ‹Ÿï¼‰
        let historyFactor = 0.5;
        // å£«æ°”å½±å“
        let homeMorale = homePlayers.reduce((s,p)=>s+p.morale,0)/homePlayers.length/100;
        let awayMorale = awayPlayers.reduce((s,p)=>s+p.morale,0)/awayPlayers.length/100;
        let moraleFactor = homeMorale / (homeMorale + awayMorale);
        // åŠ æƒå¹³å‡
        let totalWeight = modelWeights.elo + modelWeights.xg + modelWeights.history + modelWeights.morale;
        let homeProb = (modelWeights.elo * eloProb + modelWeights.xg * xgProb + modelWeights.history * historyFactor + modelWeights.morale * moraleFactor) / totalWeight * 100;
        let awayProb = 100 - homeProb;
        let drawProb = randInt(20,30); // ç®€å•å¤„ç†
        homeProb = Math.round(homeProb * (1 - drawProb/100));
        awayProb = 100 - homeProb - drawProb;
        return { home: homeProb, draw: drawProb, away: awayProb };
    }

    // åŠ¨æ€å­¦ä¹ ï¼šæ ¹æ®æ¯”èµ›ç»“æœè°ƒæ•´æƒé‡
    function learnFromResult(actualHomeScore, actualAwayScore, predictedProbs) {
        let actualResult = actualHomeScore > actualAwayScore ? 'home' : (actualHomeScore < actualAwayScore ? 'away' : 'draw');
        let correct = (actualResult === 'home' && predictedProbs.home === Math.max(predictedProbs.home, predictedProbs.draw, predictedProbs.away)) ||
                      (actualResult === 'draw' && predictedProbs.draw === Math.max(...Object.values(predictedProbs))) ||
                      (actualResult === 'away' && predictedProbs.away === Math.max(...Object.values(predictedProbs)));
        if (correct) {
            modelWeights.elo *= 1.01;
            modelWeights.xg *= 1.005;
        } else {
            modelWeights.elo *= 0.99;
            modelWeights.xg *= 0.995;
        }
        // å½’ä¸€åŒ–
        let total = modelWeights.elo + modelWeights.xg + modelWeights.history + modelWeights.morale;
        modelWeights.elo /= total;
        modelWeights.xg /= total;
        modelWeights.history /= total;
        modelWeights.morale /= total;
    }

    // å‡¯åˆ©æŒ‡æ•°è®¡ç®—
    function computeKelly(probs, odds) {
        let kelly = {};
        for (let outcome in probs) {
            let p = probs[outcome] / 100;
            let b = odds[outcome] - 1;
            kelly[outcome] = (p * b - (1 - p)) / b;
        }
        return kelly;
    }

    // ä¸“ä¸šæœºæ„å¯¹æ¯”ï¼ˆæ¨¡æ‹Ÿï¼‰
    function getProComparison(probs) {
        let five = probs.home * (0.9 + rand(0,0.2));
        let opta = probs.home * (1.05 + rand(0,0.1));
        return { five: Math.round(five), opta: Math.round(opta) };
    }

    // ---------- é›·è¾¾å›¾ ----------
    function drawRadar(id, teamName, ability) {
        let canvas = document.getElementById(id);
        if (!canvas) return;
        let ctx = canvas.getContext('2d');
        if (window.radarCharts && window.radarCharts[id]) window.radarCharts[id].destroy();
        let chart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['è¿›æ”»','é˜²å®ˆ','ä¸­åœº','é€Ÿåº¦','ç»éªŒ'],
                datasets: [{
                    label: teamName,
                    data: [ability.attack, ability.defense, ability.midfield, ability.speed, ability.experience],
                    backgroundColor: 'rgba(0,255,170,0.3)',
                    borderColor: 'var(--border)',
                    pointBackgroundColor: 'var(--border)'
                }]
            },
            options: { responsive:true, maintainAspectRatio:true, scales: { r: { min:60, max:100 } }, plugins:{legend:{display:false}} }
        });
        window.radarCharts = window.radarCharts || {};
        window.radarCharts[id] = chart;
    }

    // ---------- çƒ­åŠ›å›¾ ----------
    function renderHeatmap(hXG, aXG) {
        let homeDiv = document.getElementById('homeHeatmap');
        let awayDiv = document.getElementById('awayHeatmap');
        homeDiv.innerHTML = ''; awayDiv.innerHTML = '';
        for (let i=0;i<30;i++) {
            if (Math.random() < hXG/4) {
                let s = document.createElement('div');
                s.className = 'shot-spot';
                s.style.left = Math.random()*100+'%';
                s.style.top = Math.random()*100+'%';
                homeDiv.appendChild(s);
            }
            if (Math.random() < aXG/4) {
                let s = document.createElement('div');
                s.className = 'shot-spot shot-spot-away';
                s.style.left = Math.random()*100+'%';
                s.style.top = Math.random()*100+'%';
                awayDiv.appendChild(s);
            }
        }
    }

    // ---------- èµ”ç‡æ¸²æŸ“ ----------
    function renderOdds(probs) {
        let odds = {
            home: (1/(probs.home/100)*0.95).toFixed(2),
            draw: (1/(probs.draw/100)*0.95).toFixed(2),
            away: (1/(probs.away/100)*0.95).toFixed(2)
        };
        document.getElementById('oddsPanel').innerHTML = `
            <div class="odds-item"><div class="odds-type">ä¸»èƒœ</div><div class="odds-value">${odds.home}</div></div>
            <div class="odds-item"><div class="odds-type">å¹³å±€</div><div class="odds-value">${odds.draw}</div></div>
            <div class="odds-item"><div class="odds-type">å®¢èƒœ</div><div class="odds-value">${odds.away}</div></div>
        `;
        return odds;
    }

    // æ›´æ–°ä¸“ä¸šå¯¹æ¯”å’Œå‡¯åˆ©
    function updateProComparison(probs, odds) {
        let proComp = getProComparison(probs);
        document.getElementById('aiProb').innerText = probs.home + '%';
        document.getElementById('aiBar').style.width = probs.home + '%';
        document.getElementById('fiveProb').innerText = proComp.five + '%';
        document.getElementById('fiveBar').style.width = proComp.five + '%';
        document.getElementById('optaProb').innerText = proComp.opta + '%';
        document.getElementById('optaBar').style.width = proComp.opta + '%';
        document.getElementById('proComparison').style.display = 'grid';

        let kelly = computeKelly(probs, odds);
        document.getElementById('kellyHome').innerText = kelly.home.toFixed(2);
        document.getElementById('kellyDraw').innerText = kelly.draw.toFixed(2);
        document.getElementById('kellyAway').innerText = kelly.away.toFixed(2);
        let maxKelly = Math.max(kelly.home, kelly.draw, kelly.away);
        let advice = 'å»ºè®®: ä¸æŠ•';
        if (maxKelly > 0.1) {
            if (maxKelly === kelly.home) advice = 'å»ºè®®æŠ•æ³¨ä¸»èƒœ';
            else if (maxKelly === kelly.draw) advice = 'å»ºè®®æŠ•æ³¨å¹³å±€';
            else advice = 'å»ºè®®æŠ•æ³¨å®¢èƒœ';
        }
        document.getElementById('kellyAdvice').innerText = advice;
        document.getElementById('kellyPanel').style.display = 'flex';
    }

    // ---------- æ›´æ–°æ‰€æœ‰ ----------
    function updateAll() {
        let xg = calculateXG();
        let homeTeam = document.getElementById('homeTeam').value.trim() || 'ä¸»é˜Ÿ';
        let awayTeam = document.getElementById('awayTeam').value.trim() || 'å®¢é˜Ÿ';
        let homeAbility = getTeamAbility(homePlayers);
        let awayAbility = getTeamAbility(awayPlayers);
        drawRadar('radarHome', homeTeam, homeAbility);
        drawRadar('radarAway', awayTeam, awayAbility);
        renderHeatmap(xg.home, xg.away);

        // ä½¿ç”¨é«˜çº§AIè®¡ç®—æ¦‚ç‡
        let probs = computeProbsWithAI();
        let odds = renderOdds(probs);
        updateProComparison(probs, odds);

        // ä¼¤ç—…
        let injury = homePlayers.some(p=>p.injured) || awayPlayers.some(p=>p.injured) ? 'âš ï¸ æœ‰çƒå‘˜ä¼¤ç—…' : 'âœ… æ— å…³é”®çƒå‘˜ä¼¤åœ';
        document.getElementById('injuryText').innerText = injury;

        // æˆ˜æœ¯æ¿
        let board = document.getElementById('tacticsBoard');
        board.innerHTML = '';
        for (let i=0;i<11;i++) {
            let dot = document.createElement('div');
            dot.className = 'player-dot';
            dot.style.left = 10 + (i%3)*25 + '%';
            dot.style.top = 20 + Math.floor(i/3)*20 + '%';
            dot.innerText = i+1;
            board.appendChild(dot);
        }
        for (let i=0;i<11;i++) {
            let dot = document.createElement('div');
            dot.className = 'player-dot away';
            dot.style.left = 70 + (i%3)*15 + '%';
            dot.style.top = 20 + Math.floor(i/3)*20 + '%';
            dot.innerText = i+1;
            board.appendChild(dot);
        }
    }

    // ---------- å®æ—¶æ¨¡æ‹Ÿ ----------
    let simInterval = null, matchTime = 0, homeScore = 0, awayScore = 0, events = [];
    let homeShots=0, awayShots=0, homeShotsOn=0, awayShotsOn=0, homePasses=0, awayPasses=0, homeTackles=0, awayTackles=0, homeOffsides=0, awayOffsides=0;

    function updateStamina() {
        homePlayers.forEach(p => p.stamina = Math.max(0, p.stamina - rand(0.5,1.5)));
        awayPlayers.forEach(p => p.stamina = Math.max(0, p.stamina - rand(0.5,1.5)));
    }

    function generateEvent(min) {
        updateStamina();
        let w = weatherFactors[currentWeather];
        let f = formationFactors[currentFormation];
        let t = tacticFactors[currentTactic];
        let homeMorale = homePlayers.reduce((s,p)=>s+p.morale,0)/homePlayers.length/100;
        let awayMorale = awayPlayers.reduce((s,p)=>s+p.morale,0)/awayPlayers.length/100;
        let homeAttackProb = 35 * f * w * t * homeMorale;
        let awayAttackProb = 30 * f * w * t * awayMorale;
        let homeAttack = randInt(0,100) < homeAttackProb;
        let awayAttack = randInt(0,100) < awayAttackProb;
        if (homeAttack && awayAttack) homeAttack = false;
        if (homeAttack) {
            homeShots++; homePasses += randInt(5,15); homeTackles += randInt(0,2);
            if (randInt(0,100)<40) homeShotsOn++;
            if (randInt(0,100)<15) {
                homeScore++;
                let scorer = homePlayers[Math.floor(Math.random()*homePlayers.length)];
                scorer.goals++; scorer.morale = Math.min(100, scorer.morale+5);
                speak(`Goal! ${scorer.name} scores for ${document.getElementById('homeTeam').value}`);
                return `âš½ è¿›çƒï¼${min}â€² ${scorer.name}`;
            } else if (randInt(0,100)<8) {
                let yellow = homePlayers[Math.floor(Math.random()*homePlayers.length)];
                yellow.yellow++; yellow.morale -=5;
                if (yellow.yellow>=2) { yellow.suspended=true; speak(`Red card for ${yellow.name}`); return `ğŸŸ¥ ä¸¤é»„å˜çº¢ï¼${min}â€² ${yellow.name}`; }
                speak(`Yellow card for ${yellow.name}`);
                return `ğŸŸ¨ é»„ç‰Œï¼${min}â€² ${yellow.name}`;
            } else if (randInt(0,100)<2) { homeOffsides++; return `${min}â€² è¶Šä½`; }
            else return `${min}â€² å°„é—¨`;
        } else if (awayAttack) {
            awayShots++; awayPasses += randInt(5,15); awayTackles += randInt(0,2);
            if (randInt(0,100)<40) awayShotsOn++;
            if (randInt(0,100)<15) {
                awayScore++;
                let scorer = awayPlayers[Math.floor(Math.random()*awayPlayers.length)];
                scorer.goals++; scorer.morale = Math.min(100, scorer.morale+5);
                speak(`Goal! ${scorer.name} scores for ${document.getElementById('awayTeam').value}`);
                return `âš½ è¿›çƒï¼${min}â€² ${scorer.name}`;
            } else if (randInt(0,100)<8) {
                let yellow = awayPlayers[Math.floor(Math.random()*awayPlayers.length)];
                yellow.yellow++; yellow.morale -=5;
                if (yellow.yellow>=2) { yellow.suspended=true; speak(`Red card for ${yellow.name}`); return `ğŸŸ¥ ä¸¤é»„å˜çº¢ï¼${min}â€² ${yellow.name}`; }
                speak(`Yellow card for ${yellow.name}`);
                return `ğŸŸ¨ é»„ç‰Œï¼${min}â€² ${yellow.name}`;
            } else if (randInt(0,100)<2) { awayOffsides++; return `${min}â€² è¶Šä½`; }
            else return `${min}â€² å°„é—¨`;
        }
        return null;
    }

    function updateLive() {
        document.getElementById('liveHomeScore').innerText = homeScore;
        document.getElementById('liveAwayScore').innerText = awayScore;
        document.getElementById('statHomeShots').innerText = homeShots;
        document.getElementById('statAwayShots').innerText = awayShots;
        document.getElementById('statHomeShotsOn').innerText = homeShotsOn;
        document.getElementById('statAwayShotsOn').innerText = awayShotsOn;
        let homePassPct = homePasses+awayPasses>0 ? Math.round(homePasses/(homePasses+awayPasses)*100) : 50;
        document.getElementById('statHomePass').innerText = homePassPct+'%';
        document.getElementById('statAwayPass').innerText = (100-homePassPct)+'%';
        document.getElementById('statHomeTackle').innerText = homeTackles;
        document.getElementById('statAwayTackle').innerText = awayTackles;
        document.getElementById('statHomeOffside').innerText = homeOffsides;
        document.getElementById('statAwayOffside').innerText = awayOffsides;
        let totalShots = homeShots+awayShots;
        let homePoss = totalShots ? Math.round(homeShots/totalShots*100) : 50;
        document.getElementById('statHomePoss').innerText = homePoss+'%';
        document.getElementById('statAwayPoss').innerText = (100-homePoss)+'%';

        let bar = document.getElementById('timelineBar');
        bar.innerHTML = '';
        for (let i=0;i<90;i+=5) {
            let seg = document.createElement('div');
            seg.style.width = '5.55%';
            seg.style.height = '100%';
            seg.style.background = i < matchTime ? 'var(--border)' : 'var(--item-bg)';
            bar.appendChild(seg);
        }
        let eventsDiv = document.getElementById('timelineEvents');
        eventsDiv.innerHTML = events.slice(-5).map((e,i) => `<span class="event-tag" data-index="${events.length-5+i}">${e.substring(0,15)}...</span>`).join('');
        document.querySelectorAll('.event-tag').forEach(el => {
            el.addEventListener('click', function() { alert(events[this.dataset.index]); });
        });
        let liveDiv = document.getElementById('liveStream');
        if (events.length) {
            let entry = document.createElement('div');
            entry.className = 'live-entry';
            entry.innerText = events[events.length-1];
            entry.setAttribute('data-index', events.length-1);
            entry.addEventListener('click', function() { alert(events[this.dataset.index]); });
            liveDiv.appendChild(entry);
            liveDiv.scrollTop = liveDiv.scrollHeight;
        }
        renderPlayers();
    }

    function simulateMinute() {
        if (matchTime >= 90) { clearInterval(simInterval); simInterval=null; return; }
        matchTime++;
        let ev = generateEvent(matchTime);
        if (ev) events.push(ev);
        updateLive();
    }

    function startSim() {
        if (simInterval) clearInterval(simInterval);
        matchTime=0; homeScore=0; awayScore=0; events=[];
        homeShots=0; awayShots=0; homeShotsOn=0; awayShotsOn=0; homePasses=0; awayPasses=0; homeTackles=0; awayTackles=0; homeOffsides=0; awayOffsides=0;
        homePlayers.forEach(p=>{ p.stamina=100; p.morale=Math.max(70,p.morale); });
        awayPlayers.forEach(p=>{ p.stamina=100; p.morale=Math.max(70,p.morale); });
        updateLive();
        document.getElementById('liveStream').innerHTML = '<div class="live-entry">â±ï¸ æ¯”èµ›å¼€å§‹...</div>';
        simInterval = setInterval(simulateMinute, 500);
        speak('æ¯”èµ›å¼€å§‹');
    }
    function pauseSim() { if (simInterval) { clearInterval(simInterval); simInterval=null; } }
    function resetSim() {
        if (simInterval) clearInterval(simInterval);
        simInterval=null; matchTime=0; homeScore=0; awayScore=0; events=[];
        homeShots=0; awayShots=0; homeShotsOn=0; awayShotsOn=0; homePasses=0; awayPasses=0; homeTackles=0; awayTackles=0; homeOffsides=0; awayOffsides=0;
        homePlayers.forEach(p=>{ p.stamina=100; p.morale=70+randInt(0,30); p.goals=0; p.yellow=0; p.injured=false; p.suspended=false; });
        awayPlayers.forEach(p=>{ p.stamina=100; p.morale=70+randInt(0,30); p.goals=0; p.yellow=0; p.injured=false; p.suspended=false; });
        updateLive();
        document.getElementById('liveStream').innerHTML = '<div class="live-entry">â±ï¸ æ¯”èµ›å¼€å§‹...</div>';
        speak('æ¯”èµ›é‡ç½®');
    }

    // ---------- è’™ç‰¹å¡æ´› ----------
    function runMonteCarlo() {
        let panel = document.getElementById('montePanel');
        panel.style.display = 'block';
        let grid = document.getElementById('monteGrid');
        let xg = calculateXG();
        let results = {};
        for (let i=0;i<1000;i++) {
            let s = generateScore(xg.home, xg.away);
            results[s] = (results[s]||0)+1;
        }
        let sorted = Object.entries(results).map(([s,c])=>({score:s, prob:(c/10).toFixed(1)})).sort((a,b)=>b.prob - a.prob).slice(0,6);
        grid.innerHTML = sorted.map(s=>`<div class="monte-item"><span>${s.score}</span><span>${s.prob}%</span></div>`).join('');
        playClick();
    }

    // ---------- æ·»åŠ å¯¹å†³ ----------
    let matchGroups = [];
    function addMatch() {
        let h = document.getElementById('homeTeam').value.trim() || 'ä¸»é˜Ÿ';
        let a = document.getElementById('awayTeam').value.trim() || 'å®¢é˜Ÿ';
        let hs = randInt(0,3); let as = randInt(0,2);
        matchGroups.push({ home:h, away:a, homeScore:hs, awayScore:as });
        updateElo(h, a, hs, as); // æ›´æ–°Elo
        let homeEntry = leagueTeams.find(t=>t.name===h) || { name:h, pts:0 };
        let awayEntry = leagueTeams.find(t=>t.name===a) || { name:a, pts:0 };
        if (!leagueTeams.find(t=>t.name===h)) leagueTeams.push(homeEntry);
        if (!leagueTeams.find(t=>t.name===a)) leagueTeams.push(awayEntry);
        if (hs>as) homeEntry.pts += 3;
        else if (hs<as) awayEntry.pts += 3;
        else { homeEntry.pts++; awayEntry.pts++; }
        leagueTeams.sort((x,y)=>y.pts - x.pts);
        renderMulti();
        renderLeague();
        playClick();
    }
    function renderMulti() {
        let container = document.getElementById('multiMatches');
        container.innerHTML = matchGroups.map((m,idx) => `
            <div class="multi-card">
                <div class="multi-header"><span>${m.home}</span><span class="multi-score">${m.homeScore}:${m.awayScore}</span><span>${m.away}</span></div>
                <button class="btn" style="padding:1rem;" onclick="removeMatch(${idx})">ç§»é™¤</button>
            </div>
        `).join('');
    }
    window.removeMatch = function(idx) {
        matchGroups.splice(idx,1);
        renderMulti();
    };
    function renderLeague() {
        let grid = document.getElementById('leagueGrid');
        grid.innerHTML = leagueTeams.slice(0,10).map(t => `<div class="league-item"><span>${t.name}</span><span>${t.pts}åˆ†</span></div>`).join('');
    }
    function seasonMode() {
        leagueTeams = [];
        let teams = ['æ›¼åŸ','åˆ©ç‰©æµ¦','é˜¿æ£®çº³','æ›¼è”','åˆ‡å°”è¥¿','çƒ­åˆº','çš‡é©¬','å·´è¨','æ‹œä»','å¤šç‰¹'];
        teams.forEach(name => leagueTeams.push({ name, pts:0 }));
        for (let i=0;i<teams.length;i++) {
            for (let j=i+1;j<teams.length;j++) {
                let hs = randInt(0,3); let as = randInt(0,2);
                if (hs>as) leagueTeams[i].pts+=3;
                else if (hs<as) leagueTeams[j].pts+=3;
                else { leagueTeams[i].pts++; leagueTeams[j].pts++; }
            }
        }
        leagueTeams.sort((x,y)=>y.pts - x.pts);
        renderLeague();
        playClick();
        speak('èµ›å­£æ¨¡å¼å·²ç”Ÿæˆ');
    }

    // ---------- å¯¼å‡ºCSV ----------
    function exportCsv() {
        let csv = "çƒé˜Ÿ,ç§¯åˆ†\n";
        leagueTeams.slice(0,20).forEach(t => csv += `${t.name},${t.pts}\n`);
        let blob = new Blob([csv], {type:'text/csv'});
        let a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'league.csv';
        a.click();
        playClick();
    }

    // ---------- åˆ†äº« ----------
    function share() {
        let h = document.getElementById('homeTeam').value.trim()||'ä¸»é˜Ÿ';
        let a = document.getElementById('awayTeam').value.trim()||'å®¢é˜Ÿ';
        let text = `âš½ è¶³çƒé¢„æµ‹Â·ä¸“ä¸šAIå¢å¼ºç‰ˆ\n${h} ${homeScore} : ${awayScore} ${a}\nå¤©æ°”:${currentWeather} é˜µå‹:${currentFormation} æˆ˜æœ¯:${currentTactic}`;
        navigator.clipboard.writeText(text);
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        playClick();
    }

    // ---------- èµ›åæŠ¥å‘Š ----------
    function report() {
        let h = document.getElementById('homeTeam').value.trim()||'ä¸»é˜Ÿ';
        let a = document.getElementById('awayTeam').value.trim()||'å®¢é˜Ÿ';
        let text = `âš½ èµ›åæŠ¥å‘Š\n${h} ${homeScore} : ${awayScore} ${a}\nå°„é—¨:${homeShots}-${awayShots} å°„æ­£:${homeShotsOn}-${awayShotsOn}\nä¼ çƒ%:${document.getElementById('statHomePass').innerText}-${document.getElementById('statAwayPass').innerText}\næŠ¢æ–­:${homeTackles}-${awayTackles}\nè¶Šä½:${homeOffsides}-${awayOffsides}\n\n${events.join('\n')}`;
        let blob = new Blob([text], {type:'text/plain'});
        let aEl = document.createElement('a');
        aEl.href = URL.createObjectURL(blob);
        aEl.download = 'match_report.txt';
        aEl.click();
        playClick();
    }

    // ---------- æ¢äºº ----------
    function sub(team) {
        let arr = team==='home' ? homePlayers : awayPlayers;
        let idx = randInt(0, arr.length-1);
        arr[idx].injured = true;
        arr[idx].stamina = 0;
        alert(`${arr[idx].name} å› ä¼¤è¢«æ¢ä¸‹`);
        playClick();
    }

    // ---------- çœŸå®æ•°æ®æ¨¡å—ï¼ˆç®€åŒ–ç‰ˆï¼‰----------
    const COMPETITIONS = {
        'è‹±è¶…': 2021, 'è¥¿ç”²': 2014, 'å¾·ç”²': 2002, 'æ„ç”²': 2019, 'æ³•ç”²': 2015,
        'æ¬§å† ': 2001, 'æ¬§è”': 2146, 'è‹±å† ': 2016, 'è¶³æ€»æ¯': 2073
    };
    const API_BASE = 'https://api.football-data.org/v4';
    const API_KEY = '15aff59763f342bba8dd7da8782d467a'; // æ‚¨çš„å¯†é’¥

    async function searchTeamId(teamName) {
        try {
            const res = await fetch(`${API_BASE}/teams?name=${encodeURIComponent(teamName)}`, {
                headers: { 'X-Auth-Token': API_KEY }
            });
            if (!res.ok) return null;
            const data = await res.json();
            return data.teams[0] || null;
        } catch {
            return null;
        }
    }

    async function fetchRealStandings(compName) {
        const compId = COMPETITIONS[compName];
        if (!compId) return null;
        try {
            const res = await fetch(`${API_BASE}/competitions/${compId}/standings`, {
                headers: { 'X-Auth-Token': API_KEY }
            });
            if (!res.ok) throw new Error();
            const data = await res.json();
            const table = data.standings[0]?.table || [];
            return table.map(t => ({
                pos: t.position,
                team: t.team.name,
                crest: t.team.crest,
                played: t.playedGames,
                won: t.won,
                drawn: t.draw,
                lost: t.lost,
                pts: t.points,
                gf: t.goalsFor,
                ga: t.goalsAgainst
            }));
        } catch {
            return null;
        }
    }

    async function fetchTopScorers(compName, limit=15) {
        const compId = COMPETITIONS[compName];
        if (!compId) return null;
        try {
            const res = await fetch(`${API_BASE}/competitions/${compId}/scorers?limit=${limit}`, {
                headers: { 'X-Auth-Token': API_KEY }
            });
            if (!res.ok) throw new Error();
            const data = await res.json();
            return data.scorers.map(s => ({
                name: s.player.name,
                team: s.team.name,
                goals: s.numberOfGoals,
                nationality: s.player.nationality
            }));
        } catch {
            return null;
        }
    }

    async function fetchTeamSquad(teamName) {
        const teamInfo = await searchTeamId(teamName);
        if (!teamInfo) return null;
        try {
            const res = await fetch(`${API_BASE}/teams/${teamInfo.id}`, {
                headers: { 'X-Auth-Token': API_KEY }
            });
            if (!res.ok) return null;
            const data = await res.json();
            return data.squad || [];
        } catch {
            return null;
        }
    }

    async function fetchHeadToHead(homeTeam, awayTeam) {
        const homeInfo = await searchTeamId(homeTeam);
        const awayInfo = await searchTeamId(awayTeam);
        if (!homeInfo || !awayInfo) return null;
        try {
            const res = await fetch(`${API_BASE}/teams/${homeInfo.id}/matches?limit=10&status=FINISHED`, {
                headers: { 'X-Auth-Token': API_KEY }
            });
            if (!res.ok) return null;
            const data = await res.json();
            const matches = data.matches.filter(m => 
                (m.homeTeam.id === homeInfo.id && m.awayTeam.id === awayInfo.id) ||
                (m.homeTeam.id === awayInfo.id && m.awayTeam.id === homeInfo.id)
            ).slice(0,5);
            return matches.map(m => ({
                home: m.homeTeam.name,
                away: m.awayTeam.name,
                score: `${m.score.fullTime.home}:${m.score.fullTime.away}`,
                date: m.utcDate.substring(0,10)
            }));
        } catch {
            return null;
        }
    }

    async function fetchLiveMatches() {
        try {
            const res = await fetch(`${API_BASE}/matches?status=LIVE`, {
                headers: { 'X-Auth-Token': API_KEY }
            });
            if (!res.ok) return null;
            const data = await res.json();
            return data.matches;
        } catch {
            return null;
        }
    }

    async function fetchTeamInfo(teamName) {
        const teamInfo = await searchTeamId(teamName);
        if (!teamInfo) return null;
        try {
            const res = await fetch(`${API_BASE}/teams/${teamInfo.id}`, {
                headers: { 'X-Auth-Token': API_KEY }
            });
            if (!res.ok) return null;
            return await res.json();
        } catch {
            return null;
        }
    }

    async function renderRealStandings() {
        const league = document.getElementById('realLeagueSelect').value;
        const standings = await fetchRealStandings(league);
        const panel = document.getElementById('realDataContent');
        if (!standings) {
            panel.innerHTML = '<div style="padding:2rem; text-align:center;">âŒ è·å–å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
            return;
        }
        let html = `<h3 style="margin-bottom:1rem;">ğŸ† ${league} ç§¯åˆ†æ¦œ</h3><table class="real-data-table">`;
        html += '<tr><th>#</th><th>çƒé˜Ÿ</th><th>èµ›</th><th>èƒœ</th><th>å¹³</th><th>è´Ÿ</th><th>è¿›/å¤±</th><th>ç§¯åˆ†</th></tr>';
        standings.forEach(t => {
            html += `<tr>
                <td>${t.pos}</td>
                <td><img src="${t.crest}" class="team-crest" onerror="this.style.display='none'"> ${t.team}</td>
                <td>${t.played}</td>
                <td>${t.won}</td>
                <td>${t.drawn}</td>
                <td>${t.lost}</td>
                <td>${t.gf}:${t.ga}</td>
                <td style="font-weight:bold; color:var(--accent);">${t.pts}</td>
            </tr>`;
        });
        html += '</table>';
        panel.innerHTML = html;
        speak(`${league} ç§¯åˆ†æ¦œå·²åŠ è½½`);
    }

    async function renderTopScorers() {
        const league = document.getElementById('realLeagueSelect').value;
        const scorers = await fetchTopScorers(league);
        const panel = document.getElementById('realDataContent');
        if (!scorers) {
            panel.innerHTML = '<div style="padding:2rem; text-align:center;">âŒ è·å–å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
            return;
        }
        let html = `<h3 style="margin-bottom:1rem;">âš½ ${league} å°„æ‰‹æ¦œ</h3><table class="real-data-table">`;
        html += '<tr><th>#</th><th>çƒå‘˜</th><th>çƒé˜Ÿ</th><th>å›½ç±</th><th>è¿›çƒ</th></tr>';
        scorers.forEach((s, i) => {
            html += `<tr>
                <td>${i+1}</td>
                <td>${s.name}</td>
                <td>${s.team}</td>
                <td>${s.nationality || 'æœªçŸ¥'}</td>
                <td style="font-weight:bold; color:var(--accent);">${s.goals}</td>
            </tr>`;
        });
        html += '</table>';
        panel.innerHTML = html;
        speak(`${league} å°„æ‰‹æ¦œå·²åŠ è½½`);
    }

    async function renderTeamSquad() {
        const team = document.getElementById('homeTeam').value.trim() || 'æ›¼åŸ';
        const squad = await fetchTeamSquad(team);
        const panel = document.getElementById('realDataContent');
        if (!squad) {
            panel.innerHTML = `<div style="padding:2rem; text-align:center;">âŒ è·å– ${team} é˜µå®¹å¤±è´¥</div>`;
            return;
        }
        let html = `<h3 style="margin-bottom:1rem;">ğŸ§‘ ${team} é˜µå®¹</h3><table class="real-data-table">`;
        html += '<tr><th>å§“å</th><th>ä½ç½®</th><th>å›½ç±</th><th>å·ç </th></tr>';
        squad.forEach(p => {
            html += `<tr><td>${p.name}</td><td>${p.position || 'æœªçŸ¥'}</td><td>${p.nationality || 'æœªçŸ¥'}</td><td>${p.shirtNumber || '-'}</td></tr>`;
        });
        html += '</table>';
        panel.innerHTML = html;
        speak(`${team} é˜µå®¹å·²åŠ è½½`);
    }

    async function renderHeadToHead() {
        const home = document.getElementById('homeTeam').value.trim() || 'æ›¼åŸ';
        const away = document.getElementById('awayTeam').value.trim() || 'åˆ©ç‰©æµ¦';
        const h2h = await fetchHeadToHead(home, away);
        const panel = document.getElementById('realDataContent');
        if (!h2h || h2h.length === 0) {
            panel.innerHTML = `<div style="padding:2rem; text-align:center;">âŒ æœªæ‰¾åˆ° ${home} vs ${away} çš„å†å²äº¤é”‹</div>`;
            return;
        }
        let html = `<h3 style="margin-bottom:1rem;">ğŸ”„ ${home} vs ${away} å†å²äº¤é”‹</h3><table class="real-data-table">`;
        html += '<tr><th>æ—¥æœŸ</th><th>ä¸»é˜Ÿ</th><th>æ¯”åˆ†</th><th>å®¢é˜Ÿ</th></tr>';
        h2h.forEach(m => {
            html += `<tr>
                <td>${m.date}</td>
                <td>${m.home}</td>
                <td style="font-weight:bold; color:var(--accent);">${m.score}</td>
                <td>${m.away}</td>
            </tr>`;
        });
        html += '</table>';
        panel.innerHTML = html;
        speak(`å†å²äº¤é”‹å·²åŠ è½½`);
    }

    async function renderLiveMatches() {
        const matches = await fetchLiveMatches();
        const panel = document.getElementById('realDataContent');
        if (!matches || matches.length === 0) {
            panel.innerHTML = '<div style="padding:2rem; text-align:center;">âš¡ æš‚æ— è¿›è¡Œä¸­çš„æ¯”èµ›</div>';
            return;
        }
        let html = '<h3 style="margin-bottom:1rem;">âš¡ å®æ—¶ç›´æ’­æ¯”èµ›</h3><table class="real-data-table">';
        html += '<tr><th>ä¸»é˜Ÿ</th><th>æ¯”åˆ†</th><th>å®¢é˜Ÿ</th><th>æ—¶é—´</th></tr>';
        matches.forEach(m => {
            const score = `${m.score.fullTime.home || 0} - ${m.score.fullTime.away || 0}`;
            html += `<tr><td>${m.homeTeam.name}</td><td style="color:var(--accent);">${score}</td><td>${m.awayTeam.name}</td><td>è¿›è¡Œä¸­</td></tr>`;
        });
        html += '</table>';
        panel.innerHTML = html;
        speak('å®æ—¶æ¯”èµ›å·²åŠ è½½');
    }

    async function renderTeamInfo() {
        const team = document.getElementById('homeTeam').value.trim() || 'æ›¼åŸ';
        const info = await fetchTeamInfo(team);
        const panel = document.getElementById('realDataContent');
        if (!info) {
            panel.innerHTML = `<div style="padding:2rem; text-align:center;">âŒ æœªæ‰¾åˆ°çƒé˜Ÿä¿¡æ¯</div>`;
            return;
        }
        let html = `<h3 style="margin-bottom:1rem;">ğŸŸï¸ ${info.name} çƒé˜Ÿä¿¡æ¯</h3><table class="real-data-table">`;
        html += `<tr><td>æˆç«‹å¹´ä»½</td><td>${info.founded || 'æœªçŸ¥'}</td></tr>`;
        html += `<tr><td>ä¸»åœº</td><td>${info.venue || 'æœªçŸ¥'}</td></tr>`;
        html += `<tr><td>çƒåœºå®¹é‡</td><td>${info.venueCapacity || 'æœªçŸ¥'}</td></tr>`;
        html += `<tr><td>ä¿±ä¹éƒ¨é¢œè‰²</td><td>${info.clubColors || 'æœªçŸ¥'}</td></tr>`;
        html += `<tr><td>ç½‘ç«™</td><td><a href="${info.website}" target="_blank">${info.website}</a></td></tr>`;
        html += '</table>';
        panel.innerHTML = html;
        speak(`${team} çƒé˜Ÿä¿¡æ¯å·²åŠ è½½`);
    }

    // ç»‘å®šæŒ‰é’®
    document.getElementById('apiBtn').addEventListener('click', async () => {
        const panel = document.getElementById('realDataContent');
        panel.innerHTML = '<div style="padding:2rem; text-align:center;">â³ åŠ è½½ä»Šæ—¥èµ›ç¨‹...</div>';
        const today = new Date().toISOString().split('T')[0];
        try {
            const res = await fetch(`${API_BASE}/matches?dateFrom=${today}&dateTo=${today}`, {
                headers: { 'X-Auth-Token': API_KEY }
            });
            if (!res.ok) throw new Error();
            const data = await res.json();
            let html = '<h3>ğŸ“… ä»Šæ—¥èµ›ç¨‹</h3><table class="real-data-table">';
            html += '<tr><th>æ—¶é—´</th><th>ä¸»é˜Ÿ</th><th>æ¯”åˆ†</th><th>å®¢é˜Ÿ</th><th>çŠ¶æ€</th></tr>';
            data.matches.forEach(m => {
                const time = new Date(m.utcDate).toLocaleTimeString('zh-CN', { hour:'2-digit', minute:'2-digit' });
                const status = m.status === 'FINISHED' ? 'å®Œèµ›' : (m.status === 'IN_PLAY' ? 'è¿›è¡Œä¸­' : 'æœªå¼€å§‹');
                let score = '';
                if (m.status === 'FINISHED') {
                    score = `${m.score.fullTime.home} - ${m.score.fullTime.away}`;
                } else if (m.status === 'IN_PLAY') {
                    score = `${m.score.fullTime.home || 0} - ${m.score.fullTime.away || 0}`;
                } else {
                    score = 'vs';
                }
                html += `<tr>
                    <td>${time}</td>
                    <td><img src="${m.homeTeam.crest}" class="team-crest" onerror="this.style.display='none'"> ${m.homeTeam.name}</td>
                    <td style="font-weight:bold; color:var(--accent);">${score}</td>
                    <td><img src="${m.awayTeam.crest}" class="team-crest" onerror="this.style.display='none'"> ${m.awayTeam.name}</td>
                    <td>${status}</td>
                </tr>`;
            });
            html += '</table>';
            panel.innerHTML = html;
        } catch {
            panel.innerHTML = '<div style="padding:2rem; text-align:center;">âŒ è·å–å¤±è´¥</div>';
        }
    });

    document.getElementById('fetchStandingsBtn').addEventListener('click', renderRealStandings);
    document.getElementById('fetchScorersBtn').addEventListener('click', renderTopScorers);
    document.getElementById('fetchSquadBtn').addEventListener('click', renderTeamSquad);
    document.getElementById('fetchH2HBtn').addEventListener('click', renderHeadToHead);
    document.getElementById('fetchLiveMatchesBtn').addEventListener('click', renderLiveMatches);
    document.getElementById('fetchTeamInfoBtn').addEventListener('click', renderTeamInfo);

    // ä¸“ä¸šå¯¹æ¯”æŒ‰é’®
    document.getElementById('proCompareBtn').addEventListener('click', () => {
        let panel = document.getElementById('proComparison');
        if (panel.style.display === 'none' || panel.style.display === '') {
            panel.style.display = 'grid';
            document.getElementById('kellyPanel').style.display = 'flex';
        } else {
            panel.style.display = 'none';
            document.getElementById('kellyPanel').style.display = 'none';
        }
    });

    // ç¼–è¾‘æŒ‰é’®æ¼”ç¤º
    document.getElementById('editHomeBtn').addEventListener('click', ()=>{ alert('ç¼–è¾‘åŠŸèƒ½å¯è‡ªè¡Œæ‰©å±•'); });document.getElementById('editHomeBtn').addEventListener('click', ()=>{ alert('ç¼–è¾‘åŠŸèƒ½å¯è‡ªè¡Œæ‰©å±•'); });
    document.getElementById('editAwayBtn').addEventListener('click', ()=>{ alert('ç¼–è¾‘åŠŸèƒ½å¯è‡ªè¡Œæ‰©å±•'); });document.getElementById('editAwayBtn').addEventListener('click', ()=>{ alert('ç¼–è¾‘åŠŸèƒ½å¯è‡ªè¡Œæ‰©å±•'); });
    document.getElementById('subHomeBtn').addEventListener('click', ()=>sub('home'));document.getElementById('subHomeBtn').addEventListener('click', ()=>sub('home'));
    document.getElementById('subAwayBtn').addEventListener('click', ()=>sub('away'));document.getElementById('subAwayBtn').addEventListener('click', ()=>sub('away'));

    // åˆå§‹åŒ–
    window.onload = function() {window.onload = function() {
        updateIcons();updateIcons();
        renderPlayers();renderPlayers();
        updateAll();updateAll();
    };
</script>
</body>
</html>
