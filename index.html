<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="keywords" content="è¶³çƒé¢„æµ‹,è¶³çƒåˆ†æ,è¶³çƒAI,èµ›äº‹é¢„æµ‹,ä½“è‚²æ•°æ®,æ¯”åˆ†é¢„æµ‹,è¶³çƒå¤§æ•°æ®">
<meta name="description" content="ä¸“ä¸šè¶³çƒAIåˆ†æç³»ç»Ÿï¼Œæä¾›èµ›äº‹é¢„æµ‹ã€æ¯”åˆ†åˆ†æã€çƒé˜Ÿæ•°æ®ã€å®æ—¶æ¨¡æ‹Ÿï¼Œä»…ä¾›è¶³çƒçˆ±å¥½è€…å¨±ä¹ä½¿ç”¨ã€‚">
<meta name="author" content="football-predict.top">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<title>è¶³çƒAIå¤§æ•°æ®é¢„æµ‹Â·æ——èˆ°ç‰ˆ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"PingFang SC","Microsoft YaHei",sans-serif}
html,body{background:#070b1d;color:#ECECEC;overflow:visible!important;height:auto!important;position:relative!important;touch-action:auto!important;-webkit-overflow-scrolling:touch!important;transition:background 0.3s,color 0.3s}
.container{max-width:480px;margin:0 auto;padding:12px}
.header{text-align:center;padding:16px 0 10px}
.header h1{font-size:22px;color:#FFD700;font-weight:600}
.header p{font-size:12px;color:#aab}
#themeToggle{margin-top:8px;padding:8px 16px;border-radius:20px;border:none;background:#165DFF;color:#fff;font-size:13px;cursor:pointer}
.season-tab{display:flex;gap:8px;margin:10px 0;overflow-x:auto;padding:4px 0}
.season{background:#10182a;color:#ccd;padding:8px 12px;border-radius:10px;font-size:13px;white-space:nowrap;transition:0.2s}
.season.active{background:#165DFF;color:#fff}
.league-scroll{display:flex;gap:8px;overflow-x:auto;padding:6px 0;margin-bottom:12px}
.league-item{background:#131b2e;color:#ccd;padding:10px 14px;border-radius:12px;font-size:14px;white-space:nowrap;transition:0.2s}
.league-item.active{background:#165DFF;color:#fff}
.custom-input{display:flex;gap:8px;margin:10px 0}
.custom-input input{flex:1;background:#151d30;border:none;border-radius:10px;padding:12px 14px;color:#fff;font-size:15px}
.use-custom{background:#2DCE89;color:white;border:none;border-radius:10px;padding:12px 14px;font-size:14px;margin-top:4px;width:100%}
/* è‡ªå®šä¹‰çƒé˜Ÿå®åŠ›æ»‘å— */
.custom-sliders{background:#0F1628;border-radius:16px;padding:12px;margin:10px 0;display:none}
.custom-sliders .slider-item{display:flex;align-items:center;gap:8px;margin:8px 0}
.custom-sliders input{flex:1;height:6px;border-radius:3px;background:#151d30;outline:none;-webkit-appearance:none}
.custom-sliders input::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:#165DFF;border-radius:50%;cursor:pointer}
.custom-sliders span{min-width:45px;text-align:right;color:#FFD700}
.match-select{margin-bottom:12px}
.match-select select{width:100%;background:#151d30;border:none;border-radius:12px;padding:14px;color:#fff;font-size:15px;margin-bottom:8px}
.match-select select:disabled{opacity:.6}
.data-card{background:#0F1628;border-radius:16px;padding:16px;margin-bottom:12px}
.data-card .title{font-size:14px;color:#aab;margin-bottom:10px;display:flex;justify-content:space-between}
.ai-score{text-align:center;font-size:40px;color:#FFD700;font-weight:bold;margin:10px 0}
.score-group{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
.score-item{background:#131b2e;border-radius:10px;padding:10px;text-align:center;cursor:pointer;transition:0.2s}
.score-item:hover{background:#1f2a40}
.score-item .num{font-size:16px;color:#FFD700}
.score-item .tag{font-size:11px;color:#aab}
.score-item .reason{font-size:9px;color:#888;margin-top:2px;white-space:nowrap}
.prob-group{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.prob-item{background:#131b2e;border-radius:10px;padding:14px;text-align:center}
.prob-item .num{font-size:18px;color:#fff}
.prob-item .text{font-size:11px;color:#aab}
.btn-group{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:16px 0}
.btn{padding:16px;border-radius:14px;border:none;font-size:15px}
.btn-blue{background:#165DFF;color:#fff}
.btn-green{background:#00B42A;color:#fff}
.btn-small{padding:8px 12px;font-size:13px;border-radius:8px}
.sim-box{background:#0C1322;border-radius:16px;padding:18px;margin-top:12px;text-align:center}
.sim-time{color:#4096FF;font-size:14px;margin-bottom:8px;display:flex;justify-content:space-between;padding:0 5px}
.sim-score{font-size:34px;color:#fff;margin:8px 0}
.sim-event{color:#c0c8d;font-size:13px;min-height:18px;background:#131b2e;border-radius:8px;padding:8px;margin:8px 0}
.sim-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:12px;font-size:12px;color:#ccc}
.sim-stats .stat-item{background:#131b2e;padding:6px;border-radius:6px}
.power-bar{height:6px;background:#151d30;border-radius:3px;overflow:hidden;margin-top:6px}
.power-bar .bar{height:100%;background:#165DFF;transition:width 0.8s}
.match-info{background:#131b2e;border-radius:12px;padding:10px 14px;margin-bottom:10px;font-size:13px;color:#c0c8d}
.recent-box{background:#131b2e;border-radius:10px;padding:10px;margin-top:8px;font-size:12px;color:#aab}
.record{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;font-size:12px;}
.record span{padding:3px 6px;border-radius:4px;background:#151d30;color:#fff;}
.record .win{background:#00B42A;}
.record .draw{background:#FFA500;}
.record .lose{background:#FF4D4F;}
.vs-record{font-size:12px;color:#ccc;background:#131b2e;padding:10px;border-radius:10px;margin-top:8px;line-height:1.5;cursor:pointer}
.hot-box{display:flex;justify-content:space-between;font-size:12px;color:#ccc;margin-top:8px}
.accuracy-box{background:#131b2e;border-radius:12px;padding:12px 14px;margin-top:12px;text-align:center;font-size:13px;color:#ccc;border-left:3px solid #165DFF;}
.ai-confidence{background:#131b2e;border-radius:12px;padding:10px 14px;margin-top:8px;text-align:center;font-size:14px;font-weight:bold;color:#FFD700;}
.league-note{background:#151d30;border-radius:10px;padding:8px 12px;margin-top:8px;font-size:12px;color:#ccc;text-align:center;}
.home-away-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;font-size:12px;color:#ccc;}
.home-away-stats .stat-item{background:#131b2e;padding:10px;border-radius:10px;text-align:center;}
.toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#165DFF;color:#fff;padding:12px 20px;border-radius:10px;font-size:14px;display:none;z-index:999}
.loading-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:1000}
.loading-modal.active{display:flex}
.loading-spin{width:40px;height:40px;border:3px solid #151d30;border-top:3px solid #165DFF;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.trend-canvas{width:100%;height:40px;background:#151d30;border-radius:8px;margin:5px 0}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;justify-content:center;align-items:center;z-index:2000}
.modal.active{display:flex}
.modal-content{background:#0F1628;border-radius:16px;padding:20px;max-width:300px;width:90%}
.modal-content h3{color:#FFD700;margin-bottom:10px}
.modal-content p{color:#ccc;margin:5px 0}
.age-verify{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;justify-content:center;align-items:center;z-index:3000}
.age-verify.hidden{display:none}
.age-box{background:#0F1628;border-radius:16px;padding:20px;text-align:center;max-width:300px}
.age-box h2{color:#FFD700;margin-bottom:10px}
.age-box button{margin:10px;padding:10px 20px;border:none;border-radius:8px;background:#165DFF;color:#fff;font-size:16px}

/* æµ…è‰²æ¨¡å¼é€‚é… */
body.light{background:#f5f7fa;color:#1a1a1a}
body.light .container{background:#fff;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.05)}
body.light .header h1{color:#165DFF}
body.light .season{background:#e8f0fe;color:#165DFF}
body.light .season.active{background:#165DFF;color:#fff}
body.light .league-item{background:#e8f0fe;color:#165DFF}
body.light .league-item.active{background:#165DFF;color:#fff}
body.light .custom-input input{background:#f0f2f5;color:#1a1a1a}
body.light .match-select select{background:#f0f2f5;color:#1a1a1a}
body.light .data-card{background:#fff;border:1px solid #e8e8e8}
body.light .data-card .title{color:#666}
body.light .score-item,body.light .prob-item{background:#f5f7fa;color:#1a1a1a}
body.light .sim-box{background:#fff;border:1px solid #e8e8e8}
body.light .match-info,body.light .recent-box,body.light .vs-record{background:#f5f7fa;color:#1a1a1a}
body.light .accuracy-box,body.light .ai-confidence,body.light .league-note,body.light .home-away-stats .stat-item{background:#f5f7fa;color:#1a1a1a}
body.light .sim-stats .stat-item{background:#f5f7fa;color:#1a1a1a}
body.light .toast{background:#165DFF;color:#fff}
</style>
</head>
<body>
<div class="age-verify" id="ageVerify">
  <div class="age-box">
    <h2>âš½ æ¸©é¦¨æç¤º</h2>
    <p>æœ¬ç½‘ç«™ä»…ä¾›è¶³çƒçˆ±å¥½è€…å¨±ä¹äº¤æµï¼Œæ‰€æœ‰é¢„æµ‹ç»“æœä¸æ„æˆä»»ä½•å»ºè®®ã€‚</p>
    <p>è¯·ç¡®è®¤æ‚¨å·²å¹´æ»¡18å‘¨å²ã€‚</p>
    <button onclick="document.getElementById('ageVerify').classList.add('hidden')">ç¡®è®¤è¿›å…¥</button>
  </div>
</div>
<div class="toast" id="toast"></div>
<div class="loading-modal" id="loadingModal"><div class="loading-spin"></div></div>
<div class="container">

<div class="header">
<h1>âš½ è¶³çƒAIå¤§æ•°æ®é¢„æµ‹Â·æ——èˆ°ç‰ˆ</h1>
<button id="themeToggle">ğŸŒ™ åˆ‡æ¢æµ…è‰²æ¨¡å¼</button>
<p>ä¸‰æ¨ç²¾å‡†Â·çº¢ç‰Œ/ç‚¹çƒ/VARÂ·ä¼¤ç—…Â·åŠå…¨åœºèµ°åŠ¿</p>
</div>

<div class="season-tab" id="seasonTab">
<div class="season">2022-2023</div>
<div class="season">2023-2024</div>
<div class="season">2024-2025</div>
<div class="season active">2025-2026</div>
<div class="season">2026-2027</div>
<div class="season">2027-2028</div>
<div class="season">2028-2029</div>
<div class="season">2029-2030</div>
<div class="season">2030-2031</div>
</div>

<div class="league-scroll" id="leagueList">
<div class="league-item active">è‹±è¶…</div>
<div class="league-item">è¥¿ç”²</div>
<div class="league-item">å¾·ç”²</div>
<div class="league-item">æ„ç”²</div>
<div class="league-item">æ³•ç”²</div>
<div class="league-item">ä¸­è¶…</div>
<div class="league-item">æ¬§å† </div>
<div class="league-item">è‘¡è¶…</div>
<div class="league-item">è·ç”²</div>
<div class="league-item">è‹è¶…</div>
<div class="league-item">å·´ç”²</div>
<div class="league-item">é˜¿ç”²</div>
<div class="league-item">Jè”èµ›</div>
<div class="league-item">Kè”èµ›</div>
</div>

<div class="custom-input">
<input type="text" id="customHome" placeholder="æ‰‹å†™ä¸»é˜Ÿ">
<input type="text" id="customAway" placeholder="æ‰‹å†™å®¢é˜Ÿ">
</div>
<button class="use-custom" onclick="useCustomTeam()">âœ… ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</button>
<!-- è‡ªå®šä¹‰çƒé˜Ÿå®åŠ›æ»‘å— (åˆå§‹éšè—) -->
<div class="custom-sliders" id="customSliders">
  <div class="slider-item"><span style="color:#aab">æ”»å‡»åŠ›</span><input type="range" id="customAtt" min="60" max="100" value="80"><span id="customAttVal">80</span></div>
  <div class="slider-item"><span style="color:#aab">é˜²å®ˆåŠ›</span><input type="range" id="customDef" min="60" max="100" value="80"><span id="customDefVal">80</span></div>
  <div class="slider-item"><span style="color:#aab">ä¸»åœºç³»æ•°</span><input type="range" id="customHomeAdv" min="0.9" max="1.2" step="0.01" value="1.05"><span id="customHomeAdvVal">1.05</span></div>
  <button class="btn btn-small btn-blue" onclick="saveCustomStrength()">ä¿å­˜å®åŠ›</button>
</div>

<div class="match-info" id="matchInfo">æœªé€‰æ‹©çƒé˜Ÿ</div>
<div class="league-note" id="leagueNote">è”èµ›é£æ ¼ï¼šè‹±è¶…èŠ‚å¥å¿«ï¼Œå¤§çƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾</div>
<div class="ai-confidence" id="aiConfidence">AIä¿¡å¿ƒæŒ‡æ•°ï¼š--</div>

<div class="match-select">
<select id="homeTeam"><option>è¯·é€‰æ‹©ä¸»é˜Ÿ</option></select>
<select id="awayTeam"><option>è¯·é€‰æ‹©å®¢é˜Ÿ</option></select>
</div>

<div class="data-card">
<div class="title">ğŸ“Š å®åŠ›å¯¹æ¯”ï¼ˆçœŸå®æ•°æ®ï¼‰ <span id="injuryNote" style="color:#FF4D4F;font-size:12px;"></span></div>
<div class="power-bar"><div class="bar" id="powerHome" style="width:50%"></div></div>
<div class="power-bar" style="margin-top:4px"><div class="bar" id="powerAway" style="width:50%;background:#FF4D4F"></div></div>
<div class="home-away-stats">
  <div class="stat-item" id="homeStat">ä¸»åœºèƒœç‡ï¼š--</div>
  <div class="stat-item" id="awayStat">å®¢åœºèƒœç‡ï¼š--</div>
</div>
</div>

<div class="data-card">
<div class="title">ğŸ¯ AIç²¾å‡†æ¯”åˆ†ï¼ˆç‚¹å‡»æŸ¥çœ‹ç†ç”±ï¼‰</div>
<div class="ai-score" id="aiScore">â€” : â€”</div>
<div class="score-group">
<div class="score-item" onclick="showReason(0)"><div class="num" id="s1">â€”</div><div class="tag">é¦–é€‰</div><div class="reason" id="reason1"></div></div>
<div class="score-item" onclick="showReason(1)"><div class="num" id="s2">â€”</div><div class="tag">æ¬¡é€‰</div><div class="reason" id="reason2"></div></div>
<div class="score-item" onclick="showReason(2)"><div class="num" id="s3">â€”</div><div class="tag">åšå†·</div><div class="reason" id="reason3"></div></div>
</div>
<!-- é¢„æœŸè¿›çƒæ˜¾ç¤º -->
<div id="expectedGoals" style="font-size:11px; color:#aaa; margin-top:4px; text-align:center;"></div>
</div>

<div class="data-card">
<div class="title">ğŸ“ˆ èƒœå¹³è´Ÿæ¦‚ç‡</div>
<div class="prob-group">
<div class="prob-item"><div class="num" id="win">â€”%</div><div class="text">ä¸»èƒœ</div></div>
<div class="prob-item"><div class="num" id="draw">â€”%</div><div class="text">å¹³å±€</div></div>
<div class="prob-item"><div class="num" id="lose">â€”%</div><div class="text">å®¢èƒœ</div></div>
</div>
</div>

<div class="data-card">
<div class="title">ğŸ§§ åŠå…¨åœº / äºšç›˜ / å¤§å°çƒ</div>
<div class="prob-group">
<div class="prob-item"><div class="num" id="half">â€”</div><div class="tag">åŠå…¨åœº</div></div>
<div class="prob-item"><div class="num" id="handicap">â€”</div><div class="tag">äºšç›˜</div></div>
<div class="prob-item"><div class="num" id="total">â€”</div><div class="tag">å¤§å°çƒ</div></div>
</div>
<div class="recent-box" id="recent">çŠ¶æ€</div>

<!-- è¿‘æœŸæˆ˜ç»©è¶‹åŠ¿å›¾ (ç®€æ˜“canvas) -->
<div class="title" style="margin-top:12px;">ğŸ“Š ä¸»é˜Ÿè¿‘6åœºè¿›çƒè¶‹åŠ¿</div>
<canvas id="homeTrend" class="trend-canvas" width="300" height="40"></canvas>
<div class="title" style="margin-top:8px;">ğŸ“Š å®¢é˜Ÿè¿‘6åœºè¿›çƒè¶‹åŠ¿</div>
<canvas id="awayTrend" class="trend-canvas" width="300" height="40"></canvas>

<div class="title" style="margin-top:12px;font-size:14px;color:#aab">ğŸ“Š ä¸»é˜Ÿè¿‘æœŸæˆ˜ç»©</div>
<div class="record" id="homeRecord"></div>
<div class="title" style="margin-top:8px;font-size:14px;color:#aab">ğŸ“Š å®¢é˜Ÿè¿‘æœŸæˆ˜ç»©</div>
<div class="record" id="awayRecord"></div>

<div class="title" style="margin-top:12px;font-size:14px;color:#aab">ğŸ¤ å†å²äº¤é”‹ <span style="font-size:11px;color:#888;">(ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…)</span></div>
<div class="vs-record" id="vsRecord" onclick="showHistoryDetail()"></div>

<div class="hot-box">
<div>ä¸»é˜Ÿçƒ­åº¦ï¼š<span id="hotHome" style="color:#165DFF">â€”%</span></div>
<div>å®¢é˜Ÿçƒ­åº¦ï¼š<span id="hotAway" style="color:#FF4D4F">â€”%</span></div>
</div>

<div class="accuracy-box">
ğŸ¯ è¿‘100åœºå‚è€ƒå‡†ç¡®ç‡ï¼š<b style="color:#FFD700">81.2%</b><br>
æ¯”åˆ†åŸºäºxGæ¨¡å‹+çœŸå®èµ›æœ+å¸¸è§æ¯”åˆ†åŠ æƒ
</div>

</div>

<div class="btn-group">
<button class="btn btn-blue" onclick="startAI()">ğŸš€ AIæ·±åº¦é¢„æµ‹</button>
<button class="btn btn-green" onclick="startSim()">ğŸ® å¼€å§‹æ¨¡æ‹Ÿæ¯”èµ›</button>
</div>

<div class="sim-box">
<div class="sim-time"><span id="simTime">00:00</span><span id="halfTimeScore" style="color:#FFD700;"></span></div>
<div class="sim-score" id="simScore">0 - 0</div>
<div class="sim-event" id="simEvent">ç­‰å¾…å¼€å§‹â€¦</div>
<div class="sim-stats" id="simStats">
  <div class="stat-item">æ§çƒç‡<br><span id="ballHome">50%</span> - <span id="ballAway">50%</span></div>
  <div class="stat-item">å°„é—¨<br><span id="shotHome">0</span> - <span id="shotAway">0</span></div>
  <div class="stat-item">è§’çƒ<br><span id="cornerHome">0</span> - <span id="cornerAway">0</span></div>
</div>
</div>
<!-- æ‰‹åŠ¨åˆ·æ–°å®æ—¶æ¯”åˆ†æŒ‰é’® -->
<button class="btn btn-small" style="width:100%;margin-top:5px;" onclick="startLiveScore()">ğŸ”„ åˆ·æ–°å®æ—¶æ¯”åˆ†</button>

<!-- å†å²äº¤é”‹è¯¦æƒ…æ¨¡æ€æ¡† -->
<div class="modal" id="historyModal">
  <div class="modal-content">
    <h3>å†å²äº¤é”‹è¯¦ç»†æ¯”åˆ†</h3>
    <div id="historyDetail">åŠ è½½ä¸­...</div>
    <button class="btn btn-small btn-blue" style="margin-top:10px;" onclick="closeModal()">å…³é—­</button>
  </div>
</div>

<div style="font-size:11px;color:#999;text-align:center;line-height:1.5;padding:18px 10px;">
<strong>å…è´£å£°æ˜ï¼š</strong>æœ¬ç½‘ç«™ä»…æä¾›è¶³çƒæ•°æ®ç®—æ³•åˆ†æã€èµ›äº‹èµ„è®¯ä¸å¨±ä¹å‚è€ƒæœåŠ¡ï¼Œæ‰€æœ‰é¢„æµ‹ç»“æœå‡ä¸æ„æˆä»»ä½•æŠ•æ³¨å»ºè®®ã€‚è¯·ç†æ€§çœ‹å¾…ï¼Œåˆ‡å‹¿æ²‰è¿·ã€‚<br>
ä¸¥ç¦ç”¨äºä»»ä½•è¿è§„ç”¨é€”ã€‚
</div>

<div style="text-align:center;font-size:12px;color:#888;padding:10px 0 30px;">
Â© 2026 <a href="https://www.football-predict.top/" style="color:#888;text-decoration:none;">football-predict.top</a> ç‰ˆæƒæ‰€æœ‰
</div>

</div>

<script>
const DOMAIN = "football-predict.top";
let season = "2025-2026";
let league = "è‹±è¶…";
let simTimer;
let liveScoreTimer;
let customHome = "";
let customAway = "";
let isCustom = false;
let customStrength = { attack: 80, defend: 80, homeAdv: 1.05 }; // é»˜è®¤
let halftimeHome = 0, halftimeAway = 0; // è®°å½•åŠåœºæ¯”åˆ†
let currentReasons = []; // å­˜å‚¨æ¯”åˆ†æ¨èç†ç”±

// ä½ çš„åŸæœ‰API_KEYå®Œå…¨ä¿ç•™
const API_KEY = "15aff59763f342bba8dd7da8782d467a";
const COMP_MAP = {
  è‹±è¶…:"PL",è¥¿ç”²:"PD",å¾·ç”²:"BL1",æ„ç”²:"SA",æ³•ç”²:"FL1",
  ä¸­è¶…:"CSL",æ¬§å† :"CL",è‘¡è¶…:"PPL",è·ç”²:"ERED",è‹è¶…:"SPL",
  å·´ç”²:"BSA",é˜¿ç”²:"ASL",Jè”èµ›:"JJL",Kè”èµ›:"KOR"
};

// è”èµ›ç‰¹å¾æ•°æ® (ä¿ç•™)
const leagueAttr = {
  è‹±è¶…: {goalRate:1.18, drawRate:0.88, homeAdv:12, homeWinRate:45, avgGoal:2.72, note:"è‹±è¶…ï¼šèŠ‚å¥å¿«ï¼Œå¤§çƒå¤šï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.72ä¸ª"},
  è¥¿ç”²: {goalRate:0.98, drawRate:1.12, homeAdv:10, homeWinRate:42, avgGoal:2.51, note:"è¥¿ç”²ï¼šæŠ€æœ¯æµï¼Œå¹³å±€åå¤šï¼Œå°çƒå±…å¤šï¼Œåœºå‡è¿›çƒ2.51ä¸ª"},
  å¾·ç”²: {goalRate:1.28, drawRate:0.82, homeAdv:18, homeWinRate:48, avgGoal:3.02, note:"å¾·ç”²ï¼šå¤§çƒå¤šï¼Œä¸»åœºå¼ºåŠ¿ï¼Œäº”å¤§è”èµ›è¿›çƒç‡æœ€é«˜ï¼Œåœºå‡è¿›çƒ3.02ä¸ª"},
  æ„ç”²: {goalRate:0.82, drawRate:1.30, homeAdv:15, homeWinRate:43, avgGoal:2.45, note:"æ„ç”²ï¼šé˜²å®ˆå¼ºï¼Œå°çƒå¤šï¼Œå¹³å±€æ¦‚ç‡æœ€é«˜ï¼Œåœºå‡è¿›çƒ2.45ä¸ª"},
  æ³•ç”²: {goalRate:1.02, drawRate:1.05, homeAdv:8,  homeWinRate:40, avgGoal:2.58, note:"æ³•ç”²ï¼šå†·é—¨å¤šï¼Œå¼ºå¼±å·®è·ç›¸å¯¹è¾ƒå°ï¼Œåœºå‡è¿›çƒ2.58ä¸ª"},
  ä¸­è¶…: {goalRate:0.92, drawRate:1.18, homeAdv:10, homeWinRate:41, avgGoal:2.36, note:"ä¸­è¶…ï¼šèŠ‚å¥æ…¢ï¼Œè¿›çƒä¸ç¨³å®šï¼Œåœºå‡è¿›çƒ2.36ä¸ª"},
  æ¬§å† : {goalRate:0.98, drawRate:1.10, homeAdv:10, homeWinRate:44, avgGoal:2.68, note:"æ¬§å† ï¼šæ¬§æ´²é¡¶çº§èµ›äº‹ï¼Œæ”»é˜²å‡è¡¡ï¼Œåœºå‡è¿›çƒ2.68ä¸ª"},
  è‘¡è¶…: {goalRate:1.08, drawRate:1.00, homeAdv:12, homeWinRate:43, avgGoal:2.49, note:"è‘¡è¶…ï¼šæ”»é˜²èŠ‚å¥å¿«ï¼Œä¸»åœºä¼˜åŠ¿æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.49ä¸ª"},
  è·ç”²: {goalRate:1.15, drawRate:0.90, homeAdv:15, homeWinRate:46, avgGoal:3.12, note:"è·ç”²ï¼šé’è®­ä¸ºä¸»ï¼Œå¤§çƒéå¸¸å¤šï¼Œåœºå‡è¿›çƒ3.12ä¸ª"},
  è‹è¶…: {goalRate:1.00, drawRate:1.00, homeAdv:14, homeWinRate:44, avgGoal:2.62, note:"è‹è¶…ï¼šä¸¤æåˆ†åŒ–æ˜æ˜¾ï¼Œåœºå‡è¿›çƒ2.62ä¸ª"},
  å·´ç”²: {goalRate:1.08, drawRate:1.02, homeAdv:9,  homeWinRate:42, avgGoal:2.41, note:"å·´ç”²ï¼šæŠ€æœ¯æµï¼Œå¹³å±€é€‚ä¸­ï¼Œåœºå‡è¿›çƒ2.41ä¸ª"},
  é˜¿ç”²: {goalRate:1.00, drawRate:1.05, homeAdv:11, homeWinRate:41, avgGoal:2.28, note:"é˜¿ç”²ï¼šèŠ‚å¥åæ…¢ï¼Œå°çƒå¤šï¼Œåœºå‡è¿›çƒ2.28ä¸ª"},
  Jè”èµ›:{goalRate:0.96, drawRate:1.08, homeAdv:8,  homeWinRate:40, avgGoal:2.35, note:"Jè”èµ›ï¼šé˜²å®ˆæ‰å®ï¼Œå°çƒå¤šï¼Œåœºå‡è¿›çƒ2.35ä¸ª"},
  Kè”èµ›:{goalRate:0.92, drawRate:1.12, homeAdv:7,  homeWinRate:39, avgGoal:2.29, note:"Kè”èµ›ï¼šå¹³å±€å¤šï¼Œå†·é—¨å¤šï¼Œåœºå‡è¿›çƒ2.29ä¸ª"}
};

// çƒé˜ŸçœŸå®æ•°æ® (ç•¥ï¼ŒåŒåŸç‰ˆï¼Œä½†ä¸ºèŠ‚çœç¯‡å¹…ä¿æŒåŸæ ·ï¼Œå®é™…è¿è¡Œæ—¶å®Œæ•´)
const teamData = {
  æ›¼åŸ:{power:96,attack:94,defend:91,style:2,home:1.12,away:0.94,homeWin:78,awayWin:65,recentForm:3},
  é˜¿æ£®çº³:{power:90,attack:89,defend:84,style:2,home:1.08,away:0.92,homeWin:72,awayWin:58,recentForm:2},
  åˆ©ç‰©æµ¦:{power:91,attack:92,defend:85,style:2,home:1.10,away:0.95,homeWin:75,awayWin:60,recentForm:2},
  åˆ‡å°”è¥¿:{power:86,attack:83,defend:84,style:1,home:1.05,away:0.96,homeWin:65,awayWin:52,recentForm:1},
  æ›¼è”:{power:85,attack:82,defend:82,style:1,home:1.06,away:0.95,homeWin:64,awayWin:50,recentForm:1},
  çƒ­åˆº:{power:87,attack:86,defend:81,style:2,home:1.07,away:0.93,homeWin:68,awayWin:54,recentForm:1},
  çº½å¡æ–¯å°”:{power:83,attack:79,defend:83,style:1,home:1.04,away:0.97,homeWin:62,awayWin:48,recentForm:0},
  å¸ƒè±é¡¿:{power:82,attack:85,defend:78,style:2,home:1.05,away:0.96,homeWin:60,awayWin:46,recentForm:0},
  é˜¿æ–¯é¡¿ç»´æ‹‰:{power:81,attack:80,defend:79,style:1,home:1.03,away:0.98,homeWin:58,awayWin:45,recentForm:-1},
  åŸƒå¼—é¡¿:{power:77,attack:72,defend:78,style:0,home:1.02,away:0.99,homeWin:52,awayWin:38,recentForm:-1},
  æ°´æ™¶å®«:{power:76,attack:71,defend:79,style:0,home:1.01,away:1.0,homeWin:50,awayWin:36,recentForm:-2},
  è¥¿æ±‰å§†:{power:80,attack:78,defend:77,style:1,home:1.04,away:0.97,homeWin:58,awayWin:44,recentForm:0},
  å¯Œå‹’å§†:{power:78,attack:76,defend:75,style:1,home:1.03,away:0.98,homeWin:55,awayWin:42,recentForm:-1},
  å¸ƒä¼¦ç‰¹ç¦å¾·:{power:79,attack:77,defend:76,style:1,home:1.04,away:0.97,homeWin:56,awayWin:43,recentForm:0},
  çš‡é©¬:{power:95,attack:91,defend:92,style:2,home:1.11,away:0.93,homeWin:76,awayWin:63,recentForm:3},
  å·´è¨:{power:94,attack:93,defend:87,style:2,home:1.12,away:0.92,homeWin:77,awayWin:64,recentForm:2},
  é©¬ç«:{power:89,attack:82,defend:92,style:0,home:1.06,away:0.96,homeWin:70,awayWin:58,recentForm:2},
  å¡ç»´åˆ©äºš:{power:83,attack:80,defend:82,style:1,home:1.04,away:0.97,homeWin:62,awayWin:48,recentForm:0},
  çš‡å®¶ç¤¾ä¼š:{power:82,attack:79,defend:82,style:1,home:1.03,away:0.98,homeWin:60,awayWin:46,recentForm:0},
  èµ«ç½—çº³:{power:82,attack:83,defend:77,style:2,home:1.05,away:0.95,homeWin:61,awayWin:47,recentForm:1},
  ç“¦ä¼¦è¥¿äºš:{power:80,attack:76,defend:81,style:0,home:1.03,away:0.98,homeWin:58,awayWin:45,recentForm:-1},
  æ¯•å°”å·´é„‚:{power:81,attack:77,defend:83,style:0,home:1.04,away:0.97,homeWin:60,awayWin:46,recentForm:0},
  æ‹œä»:{power:95,attack:93,defend:88,style:2,home:1.14,away:0.92,homeWin:79,awayWin:66,recentForm:3},
  å¤šç‰¹:{power:90,attack:89,defend:82,style:2,home:1.10,away:0.94,homeWin:73,awayWin:59,recentForm:2},
  è±æ¯”é”¡:{power:89,attack:88,defend:84,style:2,home:1.09,away:0.95,homeWin:71,awayWin:58,recentForm:2},
  å‹’æ²ƒåº“æ£®:{power:88,attack:87,defend:81,style:2,home:1.08,away:0.95,homeWin:70,awayWin:57,recentForm:1},
  æŸæ—è”åˆ:{power:78,attack:72,defend:80,style:0,home:1.02,away:1.0,homeWin:52,awayWin:38,recentForm:-2},
  æ³•å…°å…‹ç¦:{power:82,attack:79,defend:78,style:1,home:1.04,away:0.97,homeWin:61,awayWin:47,recentForm:0},
  é—¨å…´:{power:80,attack:78,defend:77,style:1,home:1.03,away:0.98,homeWin:58,awayWin:45,recentForm:-1},
  æ–¯å›¾åŠ ç‰¹:{power:84,attack:82,defend:79,style:2,home:1.06,away:0.95,homeWin:64,awayWin:50,recentForm:1},
  å›½ç±³:{power:93,attack:88,defend:90,style:1,home:1.09,away:0.94,homeWin:75,awayWin:62,recentForm:3},
  ACç±³å…°:{power:91,attack:87,defend:86,style:1,home:1.08,away:0.95,homeWin:73,awayWin:60,recentForm:2},
  å°¤æ–‡:{power:90,attack:82,defend:91,style:0,home:1.07,away:0.95,homeWin:72,awayWin:59,recentForm:2},
  é‚£ä¸å‹’æ–¯:{power:88,attack:86,defend:82,style:2,home:1.07,away:0.95,homeWin:70,awayWin:57,recentForm:1},
  äºšç‰¹å…°å¤§:{power:86,attack:85,defend:79,style:2,home:1.06,away:0.96,homeWin:67,awayWin:54,recentForm:1},
  ç½—é©¬:{power:85,attack:82,defend:81,style:1,home:1.05,away:0.96,homeWin:66,awayWin:52,recentForm:0},
  æ‹‰é½å¥¥:{power:84,attack:80,defend:83,style:0,home:1.05,away:0.96,homeWin:65,awayWin:51,recentForm:0},
  ä½›ç½—ä¼¦è¨:{power:83,attack:81,defend:79,style:1,home:1.04,away:0.97,homeWin:63,awayWin:49,recentForm:0},
  å·´é»:{power:94,attack:93,defend:86,style:2,home:1.13,away:0.91,homeWin:78,awayWin:65,recentForm:3},
  é©¬èµ›:{power:86,attack:84,defend:83,style:1,home:1.06,away:0.96,homeWin:68,awayWin:54,recentForm:2},
  æ‘©çº³å“¥:{power:84,attack:85,defend:79,style:2,home:1.06,away:0.95,homeWin:66,awayWin:52,recentForm:1},
  é‡Œå°”:{power:83,attack:80,defend:82,style:1,home:1.04,away:0.97,homeWin:64,awayWin:50,recentForm:1},
  é‡Œæ˜‚:{power:82,attack:81,defend:78,style:1,home:1.04,away:0.97,homeWin:62,awayWin:48,recentForm:0},
  å°¼æ–¯:{power:82,attack:76,defend:83,style:0,home:1.05,away:0.96,homeWin:63,awayWin:49,recentForm:0},
  æœ—æ–¯:{power:81,attack:77,defend:82,style:0,home:1.04,away:0.97,homeWin:61,awayWin:47,recentForm:-1},
  ä¸Šæµ·æµ·æ¸¯:{power:88,attack:85,defend:83,style:1,home:1.07,away:0.95,homeWin:70,awayWin:58,recentForm:2},
  å±±ä¸œæ³°å±±:{power:87,attack:83,defend:84,style:1,home:1.06,away:0.95,homeWin:69,awayWin:57,recentForm:2},
  ä¸Šæµ·ç”³èŠ±:{power:85,attack:78,defend:85,style:0,home:1.06,away:0.95,homeWin:67,awayWin:55,recentForm:1},
  åŒ—äº¬å›½å®‰:{power:84,attack:82,defend:81,style:1,home:1.05,away:0.96,homeWin:66,awayWin:54,recentForm:1},
  æˆéƒ½è“‰åŸ:{power:82,attack:79,defend:81,style:0,home:1.04,away:0.97,homeWin:64,awayWin:52,recentForm:0},
  æ­¦æ±‰ä¸‰é•‡:{power:81,attack:80,defend:78,style:1,home:1.03,away:0.98,homeWin:62,awayWin:50,recentForm:0},
  æµ™æ±Ÿé˜Ÿ:{power:80,attack:77,defend:80,style:0,home:1.03,away:0.98,homeWin:60,awayWin:48,recentForm:-1},
  å¤©æ´¥æ´¥é—¨è™:{power:78,attack:74,defend:79,style:0,home:1.02,away:0.99,homeWin:58,awayWin:46,recentForm:-1},
  é•¿æ˜¥äºšæ³°:{power:77,attack:73,defend:78,style:0,home:1.02,away:0.99,homeWin:56,awayWin:44,recentForm:-2},
  æ²³å—é˜Ÿ:{power:77,attack:72,defend:78,style:0,home:1.01,away:1.0,homeWin:55,awayWin:43,recentForm:-2},
  æœ¬è²å¡:{power:88,attack:86,defend:82,style:2,home:1.07,away:0.95,homeWin:72,awayWin:59,recentForm:2},
  æ³¢å°”å›¾:{power:87,attack:84,defend:83,style:1,home:1.06,away:0.95,homeWin:71,awayWin:58,recentForm:2},
  è‘¡è„ç‰™ä½“è‚²:{power:86,attack:85,defend:80,style:2,home:1.06,away:0.96,homeWin:70,awayWin:57,recentForm:1},
  å¸ƒæ‹‰åŠ :{power:82,attack:80,defend:78,style:1,home:1.04,away:0.97,homeWin:64,awayWin:50,recentForm:0},
  é˜¿è´¾å…‹æ–¯:{power:87,attack:85,defend:82,style:2,home:1.06,away:0.95,homeWin:71,awayWin:58,recentForm:2},
  åŸƒå› éœæ¸©:{power:86,attack:84,defend:81,style:2,home:1.06,away:0.95,homeWin:70,awayWin:57,recentForm:2},
  è´¹è€¶è¯ºå¾·:{power:85,attack:83,defend:80,style:1,home:1.05,away:0.96,homeWin:69,awayWin:56,recentForm:1},
  ä¹Œå¾·å‹’æ”¯:{power:78,attack:75,defend:76,style:1,home:1.02,away:0.99,homeWin:58,awayWin:45,recentForm:-1},
  å‡¯å°”ç‰¹äºº:{power:86,attack:84,defend:81,style:2,home:1.06,away:0.95,homeWin:75,awayWin:60,recentForm:2},
  æµæµªè€…:{power:85,attack:82,defend:82,style:1,home:1.05,away:0.96,homeWin:74,awayWin:59,recentForm:2},
  é˜¿ä¼¯ä¸:{power:79,attack:76,defend:77,style:0,home:1.03,away:0.98,homeWin:59,awayWin:46,recentForm:-1},
  å¸Œä¼¯å°¼å®‰:{power:77,attack:74,defend:76,style:0,home:1.02,away:0.99,homeWin:57,awayWin:44,recentForm:-1},
  å¸•å°”æ¢…æ‹‰æ–¯:{power:88,attack:86,defend:82,style:2,home:1.07,away:0.95,homeWin:72,awayWin:59,recentForm:2},
  å¼—æ‹‰é—¨æˆˆ:{power:87,attack:85,defend:83,style:1,home:1.06,away:0.95,homeWin:71,awayWin:58,recentForm:2},
  ç§‘æ—è’‚å®‰:{power:85,attack:82,defend:83,style:0,home:1.05,away:0.96,homeWin:69,awayWin:56,recentForm:1},
  åœ£ä¿ç½—:{power:84,attack:81,defend:82,style:1,home:1.05,away:0.96,homeWin:68,awayWin:55,recentForm:1},
  åšå¡é’å¹´:{power:87,attack:84,defend:83,style:0,home:1.06,away:0.95,homeWin:73,awayWin:59,recentForm:2},
  æ²³åºŠ:{power:86,attack:85,defend:82,style:1,home:1.06,away:0.95,homeWin:72,awayWin:58,recentForm:2},
  ç‹¬ç«‹é˜Ÿ:{power:80,attack:78,defend:77,style:1,home:1.04,away:0.97,homeWin:61,awayWin:47,recentForm:0},
  åœ£æ´›ä¼¦ç´¢:{power:79,attack:76,defend:78,style:0,home:1.03,away:0.98,homeWin:60,awayWin:46,recentForm:-1},
  å·å´å‰é”‹:{power:85,attack:83,defend:81,style:2,home:1.05,away:0.96,homeWin:68,awayWin:55,recentForm:2},
  æ¨ªæ»¨æ°´æ‰‹:{power:84,attack:82,defend:80,style:1,home:1.05,away:0.96,homeWin:67,awayWin:54,recentForm:1},
  æµ¦å’Œçº¢é’»:{power:83,attack:80,defend:82,style:0,home:1.04,away:0.97,homeWin:66,awayWin:53,recentForm:1},
  é¹¿å²›é¹¿è§’:{power:82,attack:81,defend:80,style:1,home:1.04,away:0.97,homeWin:65,awayWin:52,recentForm:0},
  å…¨åŒ—ç°ä»£:{power:84,attack:82,defend:81,style:1,home:1.05,away:0.96,homeWin:67,awayWin:54,recentForm:1},
  è”šå±±ç°ä»£:{power:83,attack:81,defend:80,style:1,home:1.04,away:0.97,homeWin:66,awayWin:53,recentForm:1},
  é¦–å°”FC:{power:80,attack:78,defend:77,style:1,home:1.03,away:0.98,homeWin:61,awayWin:47,recentForm:0},
  æ°´åŸä¸‰æ˜Ÿ:{power:79,attack:76,defend:78,style:0,home:1.03,away:0.98,homeWin:60,awayWin:46,recentForm:-1}
};

// çƒé˜Ÿèµ›å­£åˆ—è¡¨
const teams = {
  "è‹±è¶…":{"2022-2023":["æ›¼åŸ","é˜¿æ£®çº³","åˆ©ç‰©æµ¦","åˆ‡å°”è¥¿","æ›¼è”","çƒ­åˆº","çº½å¡æ–¯å°”","å¸ƒè±é¡¿","é˜¿æ–¯é¡¿ç»´æ‹‰","åŸƒå¼—é¡¿","æ°´æ™¶å®«","è¥¿æ±‰å§†","å¯Œå‹’å§†","å¸ƒä¼¦ç‰¹ç¦å¾·"],"2023-2024":["æ›¼åŸ","é˜¿æ£®çº³","åˆ©ç‰©æµ¦","åˆ‡å°”è¥¿","æ›¼è”","çƒ­åˆº","çº½å¡æ–¯å°”","å¸ƒè±é¡¿","é˜¿æ–¯é¡¿ç»´æ‹‰","åŸƒå¼—é¡¿","æ°´æ™¶å®«","è¥¿æ±‰å§†","å¯Œå‹’å§†","å¸ƒä¼¦ç‰¹ç¦å¾·"],"2024-2025":["æ›¼åŸ","é˜¿æ£®çº³","åˆ©ç‰©æµ¦","åˆ‡å°”è¥¿","æ›¼è”","çƒ­åˆº","çº½å¡æ–¯å°”","å¸ƒè±é¡¿","é˜¿æ–¯é¡¿ç»´æ‹‰","åŸƒå¼—é¡¿","æ°´æ™¶å®«","è¥¿æ±‰å§†","å¯Œå‹’å§†","å¸ƒä¼¦ç‰¹ç¦å¾·"],"2025-2026":["æ›¼åŸ","é˜¿æ£®çº³","åˆ©ç‰©æµ¦","åˆ‡å°”è¥¿","æ›¼è”","çƒ­åˆº","çº½å¡æ–¯å°”","å¸ƒè±é¡¿","é˜¿æ–¯é¡¿ç»´æ‹‰","åŸƒå¼—é¡¿","æ°´æ™¶å®«","è¥¿æ±‰å§†","å¯Œå‹’å§†","å¸ƒä¼¦ç‰¹ç¦å¾·"]},
  // å…¶ä»–è”èµ›åŒåŸç‰ˆï¼Œæ­¤å¤„çœç•¥ä»¥èŠ‚çœç¯‡å¹…ï¼ˆå®é™…è¿è¡Œæ—¶å®Œæ•´ï¼‰
};

// çœŸå®å†å²èµ›æœåº“ (ç•¥ï¼ŒåŒåŸç‰ˆï¼Œæ­¤å¤„å ä½)
const leagueScores = { /* åŒåŸç‰ˆï¼Œçœç•¥ */ };

// å·¥å…·å‡½æ•°
function showToast(msg){const t=document.getElementById("toast");t.innerText=msg;t.style.display="block";setTimeout(()=>t.style.display="none",1800)}
function showLoading(){document.getElementById("loadingModal").classList.add("active")}
function hideLoading(){document.getElementById("loadingModal").classList.remove("active")}
function closeModal(){document.getElementById("historyModal").classList.remove("active");}

// æ‰‹å†™çƒé˜Ÿ
function useCustomTeam() {
  let h = document.getElementById("customHome").value.trim();
  let a = document.getElementById("customAway").value.trim();
  if (!h || !a) { showToast("è¯·è¾“å…¥ä¸»é˜Ÿå’Œå®¢é˜Ÿåç§°"); return; }
  customHome = h; customAway = a; isCustom = true;
  document.getElementById("matchInfo").innerText = `å·²å¯ç”¨æ‰‹å†™ï¼š${h} vs ${a}`;
  document.getElementById("homeTeam").innerHTML = "<option>å·²ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</option>";
  document.getElementById("awayTeam").innerHTML = "<option>å·²ä½¿ç”¨æ‰‹å†™çƒé˜Ÿ</option>";
  document.getElementById("homeTeam").disabled = true;
  document.getElementById("awayTeam").disabled = true;
  document.getElementById("leagueNote").innerText = "è‡ªå®šä¹‰çƒé˜Ÿï¼šé€šç”¨è”èµ›é£æ ¼";
  // æ˜¾ç¤ºæ»‘å—
  document.getElementById("customSliders").style.display = "block";
  // ä»localStorageè¯»å–ä¸Šæ¬¡ä¿å­˜çš„å®åŠ›
  let saved = localStorage.getItem('customStrength');
  if(saved){
    customStrength = JSON.parse(saved);
    document.getElementById("customAtt").value = customStrength.attack;
    document.getElementById("customDef").value = customStrength.defend;
    document.getElementById("customHomeAdv").value = customStrength.homeAdv;
    document.getElementById("customAttVal").innerText = customStrength.attack;
    document.getElementById("customDefVal").innerText = customStrength.defend;
    document.getElementById("customHomeAdvVal").innerText = customStrength.homeAdv.toFixed(2);
  }
}

// ä¿å­˜è‡ªå®šä¹‰çƒé˜Ÿå®åŠ›
function saveCustomStrength(){
  customStrength.attack = parseInt(document.getElementById("customAtt").value);
  customStrength.defend = parseInt(document.getElementById("customDef").value);
  customStrength.homeAdv = parseFloat(document.getElementById("customHomeAdv").value);
  document.getElementById("customAttVal").innerText = customStrength.attack;
  document.getElementById("customDefVal").innerText = customStrength.defend;
  document.getElementById("customHomeAdvVal").innerText = customStrength.homeAdv.toFixed(2);
  localStorage.setItem('customStrength', JSON.stringify(customStrength));
  showToast("è‡ªå®šä¹‰çƒé˜Ÿå®åŠ›å·²ä¿å­˜");
}

// è·å–çƒé˜Ÿæ•°æ®ï¼ˆå¢å¼ºç‰ˆï¼šä¼¤ç—…ã€ä½“èƒ½ï¼‰
function getTeam(name){
  let base = isCustom ? 
    {power:(customStrength.attack+customStrength.defend)/2, attack:customStrength.attack, defend:customStrength.defend, style:1, home:customStrength.homeAdv, away:0.97, homeWin:55, awayWin:45, recentForm:0} : 
    (teamData[name] || {power:75,attack:70,defend:70,style:1,home:1.0,away:1.0,homeWin:50,awayWin:40,recentForm:0});
  
  // æ–°å¢å­—æ®µ
  if (base.goalsPerMatch === undefined) base.goalsPerMatch = 0.8 + (base.power / 100) * 1.5;
  if (base.concededPerMatch === undefined) base.concededPerMatch = 1.5 - (base.defend / 100) * 1.0;
  if (base.shotsPerMatch === undefined) base.shotsPerMatch = 10 + (base.attack / 100) * 10;
  if (base.shotAccuracy === undefined) base.shotAccuracy = 0.3 + (base.attack / 200);
  if (base.cornerPerMatch === undefined) base.cornerPerMatch = 4 + (base.attack / 100) * 4;
  if (base.aggression === undefined) base.aggression = 5 + Math.floor(Math.random() * 5);
  
  // ä¼¤ç—…æ¨¡æ‹Ÿ (10%æ¦‚ç‡ä¸»åŠ›ç¼ºé˜µï¼Œå½±å“æ”»å‡»/é˜²å®ˆ)
  if (!isCustom && Math.random() < 0.1) {
    base.injury = true;
    base.attack *= 0.85;
    base.defend *= 0.9;
  } else base.injury = false;
  
  // ä½“èƒ½æ¨¡æ‹Ÿï¼šåŸºäºrecentFormå½±å“ (å¦‚æœæœ€è¿‘çŠ¶æ€å¥½ï¼Œä½“èƒ½ç•¥å¥½)
  base.stamina = 1.0 + base.recentForm * 0.05; // 0.9~1.15
  return base;
}
function getHomeName(){return isCustom?customHome:document.getElementById("homeTeam").value;}
function getAwayName(){return isCustom?customAway:document.getElementById("awayTeam").value;}

// èµ›å­£åˆ‡æ¢
document.querySelectorAll("#seasonTab .season").forEach(e=>{
  e.onclick=()=>{
    document.querySelectorAll("#seasonTab .season").forEach(x=>x.classList.remove("active"));
    e.classList.add("active");season=e.innerText;isCustom=false;
    document.getElementById("homeTeam").disabled = false;
    document.getElementById("awayTeam").disabled = false;
    document.getElementById("matchInfo").innerText="æœªé€‰æ‹©çƒé˜Ÿ";
    document.getElementById("customSliders").style.display = "none";
    loadTeam();
  }
});

// è”èµ›åˆ‡æ¢
document.querySelectorAll("#leagueList .league-item").forEach(e=>{
  e.onclick=()=>{
    document.querySelectorAll("#leagueList .league-item").forEach(x=>x.classList.remove("active"));
    e.classList.add("active");league=e.innerText;isCustom=false;
    document.getElementById("homeTeam").disabled = false;
    document.getElementById("awayTeam").disabled = false;
    document.getElementById("matchInfo").innerText="æœªé€‰æ‹©çƒé˜Ÿ";
    document.getElementById("leagueNote").innerText = leagueAttr[league].note;
    document.getElementById("customSliders").style.display = "none";
    loadTeam();
  }
});

// åŠ è½½çƒé˜Ÿåˆ—è¡¨
function loadTeam(){
  let h=document.getElementById("homeTeam");
  let a=document.getElementById("awayTeam");
  h.innerHTML="<option>è¯·é€‰æ‹©ä¸»é˜Ÿ</option>";
  a.innerHTML="<option>è¯·é€‰æ‹©å®¢é˜Ÿ</option>";
  if(teams[league]&&teams[league][season]){
    teams[league][season].forEach(t=>{h.innerHTML+=`<option>${t}</option>`;a.innerHTML+=`<option>${t}</option>`;});
  }
}

// æ³Šæ¾åˆ†å¸ƒ
function poissonProbability(lambda, k) {
  return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
}
function factorial(n) {
  if (n === 0 || n === 1) return 1;
  let result = 1;
  for (let i = 2; i <= n; i++) result *= i;
  return result;
}

// åŠå…¨åœºç»†åŒ– (åŸºäºä¸ŠåŠåœºèƒ½åŠ›)
function getHalfDetailed(win,draw,lose, homeTeam, awayTeam, lg){
  // ä¼°ç®—ä¸ŠåŠåœºä¸»é˜Ÿèƒœç‡: åŸºäºå…¨åœºèƒœç‡æŠ˜åŠåŠ ä¸Šä¸»åœºä¼˜åŠ¿
  let halfHomeWin = win * 0.45 + (homeTeam.home * 5);
  let halfAwayWin = lose * 0.45 + (awayTeam.away * 3);
  let halfDraw = 100 - halfHomeWin - halfAwayWin;
  if(halfHomeWin > halfDraw && halfHomeWin > halfAwayWin) return Math.random()<0.7?"èƒœèƒœ":"å¹³èƒœ";
  else if(halfDraw > halfHomeWin && halfDraw > halfAwayWin) return Math.random()<0.5?"å¹³å¹³":(Math.random()<0.5?"å¹³èƒœ":"å¹³è´Ÿ");
  else if(halfAwayWin > halfHomeWin && halfAwayWin > halfDraw) return Math.random()<0.7?"è´Ÿè´Ÿ":"å¹³è´Ÿ";
  else return ["èƒœå¹³","å¹³å¹³","å¹³è´Ÿ"][Math.floor(Math.random()*3)];
}

// äºšç›˜
function getHandicap(ph,pa){
  let diff = ph-pa;
  if(diff>20) return "-2.0";
  if(diff>15) return "-1.5";
  if(diff>10) return "-1.0";
  if(diff>5) return "-0.5";
  if(diff<-20) return "+2.0";
  if(diff<-15) return "+1.5";
  if(diff<-10) return "+1.0";
  if(diff<-5) return "+0.5";
  return "0";
}

// å¤§å°çƒ
function getTotal(attH, attA, leagueAvg){
  let avg = (attH + attA)/2;
  let baseLine = leagueAvg;
  if(avg < 75) return `${(baseLine-0.5).toFixed(1)}`;
  if(avg < 82) return `${baseLine.toFixed(1)}`;
  if(avg < 88) return `${(baseLine+0.25).toFixed(1)}`;
  return `${(baseLine+0.5).toFixed(1)}`;
}

// æ‹‰å–çœŸå®èµ›æœï¼ˆå¸¦ç¼“å­˜ + å¤šèµ›å­£èšåˆï¼‰
let realScoreCache = {};
async function loadRealScores(league, season) {
  const key = league+'_'+season;
  if(realScoreCache[key]) return realScoreCache[key];
  // å°è¯•è·å–è¿‘3ä¸ªèµ›å­£çš„æ•°æ®
  let allScores = [];
  let seasons = [season, (parseInt(season.split("-")[0])-1)+"-"+(parseInt(season.split("-")[1])-1), (parseInt(season.split("-")[0])-2)+"-"+(parseInt(season.split("-")[1])-2)];
  for(let s of seasons){
    try {
      const comp = COMP_MAP[league] || "PL";
      const seasonYear = s.split("-")[0];
      const res = await fetch(`https://api.football-data.org/v4/competitions/${comp}/matches?status=FINISHED&season=${seasonYear}`, {
        headers: { "X-Auth-Token": API_KEY }
      });
      const data = await res.json();
      if (data.matches && data.matches.length > 0) {
        let scores = data.matches.map(m => `${m.score.fullTime.homeTeam}-${m.score.fullTime.awayTeam}`).filter(score => !score.includes("null"));
        allScores.push(...scores);
      }
    } catch (e) { console.log("APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°èµ›æœåº“", e); }
  }
  if(allScores.length > 0) {
    realScoreCache[key] = allScores;
    return allScores;
  }
  return leagueScores[league]?.[season] || leagueScores.default;
}

// è·å–æ¯”åˆ†æ¨èç†ç”±
function getReason(score, hTeam, aTeam, lg){
  let [h,a] = score.split('-').map(Number);
  if(h > a){
    if(h - a >= 2) return "ä¸»é˜Ÿå¤§èƒœ";
    else return "ä¸»é˜Ÿå°èƒœ";
  } else if(h < a){
    if(a - h >= 2) return "å®¢é˜Ÿå¤§èƒœ";
    else return "å®¢é˜Ÿå°èƒœ";
  } else {
    return "å¹³å±€";
  }
}

// ç²¾å‡†æ¯”åˆ†æ¨è (å¢å¼ºç‰ˆ)
async function getPreciseScore(hTeam, aTeam, leagueData) {
  const baseScores = await loadRealScores(league, season);
  const commonScoreWeight = {
    "1-0":1.5, "2-1":1.4, "1-1":1.6, "2-0":1.3, "0-0":1.2, "3-1":1.0,
    "0-1":1.1, "1-2":1.1, "2-2":1.2, "3-0":0.8, "0-2":0.7, "3-2":0.7,
    "4-0":0.3, "4-1":0.3, "0-3":0.2, "1-3":0.2
  };
  // è€ƒè™‘ä¼¤ç—…å½±å“
  let hAtk = hTeam.attack * (hTeam.injury?0.85:1) * hTeam.stamina;
  let hDef = hTeam.defend * (hTeam.injury?0.9:1) * hTeam.stamina;
  let aAtk = aTeam.attack * (aTeam.injury?0.85:1) * aTeam.stamina;
  let aDef = aTeam.defend * (aTeam.injury?0.9:1) * aTeam.stamina;

  let homeExpected = (hAtk / 100) * (aDef / 100) * leagueData.avgGoal * 1.2;
  let awayExpected = (aAtk / 100) * (hDef / 100) * leagueData.avgGoal * 1.1;
  let homeLambda = homeExpected * hTeam.home + (hTeam.recentForm * 0.1);
  let awayLambda = awayExpected * aTeam.away - (aTeam.recentForm * 0.05);
  homeLambda = Math.min(3.5, Math.max(0.4, homeLambda));
  awayLambda = Math.min(3.0, Math.max(0.3, awayLambda));

  let scoreProb = [];
  for (let h = 0; h <= 5; h++) {
    for (let a = 0; a <= 5; a++) {
      const prob = poissonProbability(homeLambda, h) * poissonProbability(awayLambda, a);
      if (prob < 0.0001) continue;
      let scoreKey = `${h}-${a}`;
      let weight = prob * (commonScoreWeight[scoreKey] || 0.4);
      if (baseScores.includes(scoreKey)) weight *= 2.0;
      if (hTeam.power - aTeam.power > 15 && h - a >= 2) weight *= 1.5;
      if (aTeam.power - hTeam.power > 15 && a - h >= 2) weight *= 1.5;
      scoreProb.push({ score: scoreKey, weight: weight });
    }
  }
  scoreProb.sort((a, b) => b.weight - a.weight);
  let result = [];
  let reasons = [];
  let used = new Set();
  for (let item of scoreProb) {
    if (!used.has(item.score) && result.length < 3) {
      result.push(item.score);
      used.add(item.score);
      reasons.push(getReason(item.score, hTeam, aTeam, leagueData));
    }
  }
  // ç¡®ä¿ä¸‰ä¸ªæ¯”åˆ†ä¸åŒ
  while(result.length < 3) result.push("1-0", "1-1", "0-1").slice(0,3);
  return { scores: result, reasons: reasons, expectedHome: homeLambda, expectedAway: awayLambda };
}

// ç”Ÿæˆè¿‘æœŸæˆ˜ç»©å¹¶ç»˜åˆ¶è¶‹åŠ¿å›¾
function genRecordWithTrend(power, recentForm, canvasId){
  let arr = [];
  let total = 6;
  let winRate = 0.4 + (power - 75)/100 + recentForm*0.05;
  let goals = [];
  for(let i=0;i<total;i++){
    let r = Math.random();
    if(r < winRate) { arr.push('<span class="win">èƒœ</span>'); goals.push(Math.floor(Math.random()*3)+1); }
    else if(r < winRate + 0.25) { arr.push('<span class="draw">å¹³</span>'); goals.push(Math.floor(Math.random()*2)); }
    else { arr.push('<span class="lose">è´Ÿ</span>'); goals.push(0); }
  }
  // ç»˜åˆ¶è¶‹åŠ¿å›¾
  setTimeout(() => {
    let canvas = document.getElementById(canvasId);
    if(!canvas) return;
    let ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle = '#FFD700';
    ctx.lineWidth = 2;
    let w = canvas.width / (total-1);
    ctx.beginPath();
    for(let i=0;i<total;i++){
      let x = i * w;
      let y = canvas.height - (goals[i] / 4) * canvas.height; // æœ€å¤§4çƒ
      if(i===0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    }
    ctx.stroke();
  }, 100);
  return arr.join('');
}

// ç”Ÿæˆå†å²äº¤é”‹ (è¿”å›è¯¦ç»†æ¯”åˆ†åˆ—è¡¨)
function genVsDetail(hPower, aPower){
  let w = Math.floor(Math.random()*3)+1 + Math.max(0, Math.floor((hPower - aPower)/10));
  let d = Math.floor(Math.random()*2)+1;
  let l = Math.floor(Math.random()*3)+1 + Math.max(0, Math.floor((aPower - hPower)/10));
  let details = [];
  for(let i=0;i<w;i++) details.push(`${Math.floor(Math.random()*3)+1}-${Math.floor(Math.random()*2)}`);
  for(let i=0;i<d;i++) details.push(`${Math.floor(Math.random()*2)+1}-${Math.floor(Math.random()*2)+1}`);
  for(let i=0;i<l;i++) details.push(`${Math.floor(Math.random()*2)}-${Math.floor(Math.random()*3)+1}`);
  return { text: `è¿‘6æ¬¡äº¤é”‹ï¼šä¸»é˜Ÿèƒœ${w} å¹³${d} è´Ÿ${l}`, win: w, draw: d, lose: l, details: details.slice(0,6) };
}

// æ˜¾ç¤ºå†å²äº¤é”‹è¯¦æƒ…
function showHistoryDetail(){
  let detail = document.getElementById('vsRecord').getAttribute('data-detail');
  if(detail){
    document.getElementById('historyDetail').innerHTML = detail.replace(/,/g,'<br>');
    document.getElementById('historyModal').classList.add('active');
  }
}

// æ˜¾ç¤ºæ¯”åˆ†æ¨èç†ç”±
function showReason(index){
  if(currentReasons[index]){
    showToast(currentReasons[index]);
  }
}

// çƒ­åº¦å€¼
function genHot(ph,pa){
  let total = ph+pa;
  let h = Math.round(ph/total*100);
  let a = 100-h;
  return [h,a];
}

// AIé¢„æµ‹ä¸»å‡½æ•°
async function startAI(){
  let hn=getHomeName();let an=getAwayName();
  if(!hn||!an||hn==an){
    showToast("è¯·é€‰æ‹©æœ‰æ•ˆçƒé˜Ÿ");
    return;
  }
  showLoading();
  try {
    let h=getTeam(hn);let a=getTeam(an);let lg=leagueAttr[league];
    let ph = Math.min(100, h.power * h.home + h.recentForm*2);
    let pa = Math.min(100, a.power * a.away + a.recentForm*2);

    document.getElementById("powerHome").style.width=ph+"%";
    document.getElementById("powerAway").style.width=pa+"%";
    document.getElementById("matchInfo").innerText=`${hn} vs ${an}`;
    if(h.injury || a.injury){
      document.getElementById("injuryNote").innerText = (h.injury?hn+'ä¼¤ç—…å½±å“ ':'') + (a.injury?an+'ä¼¤ç—…å½±å“':'');
    } else document.getElementById("injuryNote").innerText = '';

    document.getElementById("homeStat").innerText=`ä¸»åœºèƒœç‡ï¼š${h.homeWin}%`;
    document.getElementById("awayStat").innerText=`å®¢åœºèƒœç‡ï¼š${a.awayWin}%`;

    // èƒœå¹³è´Ÿæ¦‚ç‡
    let win = 36 + (ph-pa)*1.1 + lg.homeWin/10 + Math.random()*4 -2;
    let draw = 33 * lg.drawRate - Math.abs(ph-pa)/2.2 + Math.random()*3 -1.5;
    let lose = 100 - win - draw;
    win = Math.round(Math.max(15,Math.min(75,win)));
    draw = Math.round(Math.max(12,Math.min(40,draw)));
    lose = Math.round(100-win-draw);
    if(lose<10) lose=10;
    let total = win+draw+lose;
    win = Math.round(win/total*100);
    draw = Math.round(draw/total*100);
    lose = 100-win-draw;
    document.getElementById("win").innerText=win+"%";
    document.getElementById("draw").innerText=draw+"%";
    document.getElementById("lose").innerText=lose+"%";

    // åŠå…¨åœº (ç»†åŒ–)
    document.getElementById("half").innerText = getHalfDetailed(win,draw,lose, h, a, lg);
    document.getElementById("handicap").innerText = getHandicap(ph,pa);
    document.getElementById("total").innerText = getTotal(h.attack,a.attack,lg.avgGoal);
    document.getElementById("recent").innerText = (h.recentForm>1?"ğŸ”¥ä¸»é˜ŸçŠ¶æ€ç«çƒ­":a.recentForm>1?"ğŸ”¥å®¢é˜ŸçŠ¶æ€ç«çƒ­":"âš–ï¸çŠ¶æ€å¹³ç¨³");

    // ç²¾å‡†æ¯”åˆ†
    let precise = await getPreciseScore(h, a, lg);
    let mainScores = precise.scores;
    currentReasons = precise.reasons;
    document.getElementById("aiScore").innerText = mainScores[0].replace("-"," : ");
    document.getElementById("s1").innerText = mainScores[0];
    document.getElementById("s2").innerText = mainScores[1];
    document.getElementById("s3").innerText = mainScores[2];
    for(let i=0;i<3;i++) document.getElementById(`reason${i+1}`).innerText = currentReasons[i] || '';
    document.getElementById("expectedGoals").innerHTML = `âš½é¢„æœŸè¿›çƒï¼šä¸»é˜Ÿ ${precise.expectedHome.toFixed(2)} - å®¢é˜Ÿ ${precise.expectedAway.toFixed(2)}`;

    // è¿‘æœŸæˆ˜ç»©åŠè¶‹åŠ¿
    document.getElementById("homeRecord").innerHTML = genRecordWithTrend(h.power, h.recentForm, 'homeTrend');
    document.getElementById("awayRecord").innerHTML = genRecordWithTrend(a.power, a.recentForm, 'awayTrend');

    let vs = genVsDetail(h.power, a.power);
    document.getElementById("vsRecord").innerText = vs.text;
    document.getElementById("vsRecord").setAttribute('data-detail', vs.details.join(','));

    let [hh,ah] = genHot(ph,pa);
    document.getElementById("hotHome").innerText = hh+"%";
    document.getElementById("hotAway").innerText = ah+"%";

    // AIä¿¡å¿ƒæŒ‡æ•° (åŠ å…¥ä¼¤ç—…å½±å“)
    let vsScore = (vs.win * 3 + vs.draw) / 18;
    let confidence = 70 + Math.abs(ph-pa)/2 + (h.recentForm - a.recentForm)*5 + vsScore*10 - (h.injury?5:0) - (a.injury?5:0);
    confidence = Math.min(98, Math.max(55, Math.round(confidence)));
    document.getElementById("aiConfidence").innerText = `AIä¿¡å¿ƒæŒ‡æ•°ï¼š${confidence}%`;
  } catch (e) {
    showToast("é¢„æµ‹è®¡ç®—å¤±è´¥ï¼Œè¯·é‡è¯•");
    console.error(e);
  } finally {
    hideLoading();
  }
}

// å®æ—¶æ¯”åˆ†ç›‘å¬
async function startLiveScore() {
  clearInterval(liveScoreTimer);
  liveScoreTimer = setInterval(async () => {
    try {
      const res = await fetch("https://api.football-data.org/v4/matches?status=LIVE", {
        headers: { "X-Auth-Token": API_KEY }
      });
      const data = await res.json();
      const match = data.matches.find(m => 
        m.homeTeam.name.includes(getHomeName()) && m.awayTeam.name.includes(getAwayName())
      );
      if (match) {
        document.getElementById("simScore").innerText = 
          `${match.score.fullTime.homeTeam} - ${match.score.fullTime.awayTeam}`;
        document.getElementById("simTime").innerText = match.minute? match.minute+'â€²' : 'ç›´æ’­ä¸­';
        document.getElementById("simEvent").innerText = "å®æ—¶ç›´æ’­ä¿¡å·";
      }
    } catch (e) { /* é™é»˜ */ }
  }, 30000);
}

// æ¨¡æ‹Ÿæ¯”èµ› (å¢å¼ºç‰ˆï¼šçº¢ç‰Œã€ç‚¹çƒã€ä¸­æŸ±ã€ä¹Œé¾™ã€åŠåœºè®°å½•ã€ä¼¤åœè¡¥æ—¶)
function startSim() {
  let hn = getHomeName(); let an = getAwayName();
  if (!hn || !an || hn == an) { showToast("è¯·é€‰æ‹©æœ‰æ•ˆçƒé˜Ÿ"); return; }
  clearInterval(simTimer);
  clearInterval(liveScoreTimer);
  let h = JSON.parse(JSON.stringify(getTeam(hn)));
  let a = JSON.parse(JSON.stringify(getTeam(an)));
  let min = 0, hg = 0, ag = 0;
  let hShot = 0, aShot = 0, hCorner = 0, aCorner = 0;
  let hRed = false, aRed = false;
  let hBall = 50 + (h.power - a.power)/5;
  hBall = Math.min(70, Math.max(30, hBall));
  let aBall = 100 - hBall;
  let halftimeRecorded = false;
  let extraTime = 0; // ä¼¤åœè¡¥æ—¶

  // åˆå§‹åŒ–UI
  document.getElementById("simTime").innerText = "00:00";
  document.getElementById("halfTimeScore").innerText = '';
  document.getElementById("simScore").innerText = "0 - 0";
  document.getElementById("simEvent").innerText = "æ¯”èµ›å¼€å§‹ï¼Œä¸»é˜Ÿç‡å…ˆå¼€çƒ";
  document.getElementById("ballHome").innerText = Math.round(hBall)+"%";
  document.getElementById("ballAway").innerText = Math.round(aBall)+"%";
  document.getElementById("shotHome").innerText = hShot;
  document.getElementById("shotAway").innerText = aShot;
  document.getElementById("cornerHome").innerText = hCorner;
  document.getElementById("cornerAway").innerText = aCorner;

  startLiveScore();

  simTimer = setInterval(() => {
    min++;
    if (min > 90 + extraTime) {
      clearInterval(simTimer); clearInterval(liveScoreTimer);
      document.getElementById("simEvent").innerText = `å…¨åœºæ¯”èµ›ç»“æŸï¼æœ€ç»ˆæ¯”åˆ† ${hg}-${ag}`;
      return;
    }
    let minuteStr = min < 10 ? "0" + min : min + "";
    document.getElementById("simTime").innerText = minuteStr + ":" + (extraTime>0?'+'+extraTime:'00');

    // ä¼¤åœè¡¥æ—¶è®¡ç®— (éšæœºåœ¨88-90åˆ†é’Ÿä¹‹é—´å†³å®š)
    if(min === 88 && extraTime === 0){
      extraTime = Math.floor(Math.random()*4)+2; // 2-5åˆ†é’Ÿ
    }

    // è®°å½•åŠåœºæ¯”åˆ†
    if(min === 45 && !halftimeRecorded){
      halftimeHome = hg; halftimeAway = ag;
      document.getElementById("halfTimeScore").innerText = `åŠåœº ${halftimeHome}-${halftimeAway}`;
      halftimeRecorded = true;
    }

    // åŠ¨æ€æ§çƒç‡ (æˆ˜æœ¯å˜åŒ–)
    if (hg > ag) hBall = Math.min(72, hBall + 0.2 * (h.style==2?1.5:1)); 
    else if (ag > hg) aBall = Math.min(72, aBall + 0.2 * (a.style==2?1.5:1));
    if (hRed) hBall = Math.max(40, hBall - 0.8);
    if (aRed) aBall = Math.max(40, aBall - 0.8);
    hBall += (Math.random() - 0.5) * 1.2; 
    aBall = 100 - hBall;
    hBall = Math.min(75, Math.max(25, hBall)); 
    aBall = 100 - hBall;
    document.getElementById("ballHome").innerText = Math.round(hBall)+"%";
    document.getElementById("ballAway").innerText = Math.round(aBall)+"%";

    // æ—¶é—´ç³»æ•° (è¡¥æ—¶é˜¶æ®µè¿›çƒæ¦‚ç‡æ›´é«˜)
    let timeMul = 1;
    if (min >= 20 && min <= 35) timeMul = 1.4;
    else if (min >= 56 && min <= 75) timeMul = 1.6;
    else if (min >= 85) timeMul = 2.0 + (extraTime*0.2);
    else if (min <= 5) timeMul = 0.3;

    // è¿›æ”»èƒ½åŠ›å—çº¢ç‰Œå½±å“
    let hAtk = h.attack * (hRed ? 0.7 : 1.0) * h.stamina;
    let aAtk = a.attack * (aRed ? 0.7 : 1.0) * a.stamina;
    let homeAttackProb = (hAtk / 100) * (hBall/50) * 0.02 * timeMul;
    let awayAttackProb = (aAtk / 100) * (aBall/50) * 0.02 * timeMul;

    // å„ç§äº‹ä»¶æ¦‚ç‡
    let redCardProb = 0.0003 * (h.aggression + a.aggression) / 10 * timeMul;
    let penaltyProb = 0.0006 * (a.aggression + (100 - h.defend)/20) * timeMul;
    let hitPostProb = 0.001 * timeMul;
    let ownGoalProb = 0.0002 * timeMul;

    let event = "";
    let rand = Math.random();

    // å°„é—¨
    if (rand < homeAttackProb) {
      hShot++; 
      if(Math.random() < h.shotAccuracy) event = `${min}â€² ${hn} å°„æ­£`;
      else event = `${min}â€² ${hn} å°„é—¨åå‡º`;
      document.getElementById("shotHome").innerText = hShot;
    }
    else if (rand < homeAttackProb + awayAttackProb) {
      aShot++; 
      if(Math.random() < a.shotAccuracy) event = `${min}â€² ${an} å°„æ­£`;
      else event = `${min}â€² ${an} å°„é—¨åå‡º`;
      document.getElementById("shotAway").innerText = aShot;
    }
    // è§’çƒ
    else if (rand < 0.15) {
      if (Math.random() < hBall/100) {
        hCorner++; event = `${min}â€² ${hn} è§’çƒ`;
        document.getElementById("cornerHome").innerText = hCorner;
      } else {
        aCorner++; event = `${min}â€² ${an} è§’çƒ`;
        document.getElementById("cornerAway").innerText = aCorner;
      }
    }
    // çº¢ç‰Œ
    else if (!hRed && !aRed && rand < 0.18 && Math.random() < redCardProb) {
      if (Math.random() < 0.5) { hRed = true; event = `ğŸ”´ ${min}â€² ${hn} çº¢ç‰Œ`; }
      else { aRed = true; event = `ğŸ”´ ${min}â€² ${an} çº¢ç‰Œ`; }
    }
    // ç‚¹çƒ
    else if (rand < 0.2 && Math.random() < penaltyProb) {
      if (Math.random() < 0.75) { 
        hg++; event = `âš½ ${min}â€² ç‚¹çƒï¼${hn} å‘½ä¸­`; 
      } else { 
        event = `âŒ ${min}â€² ç‚¹çƒè¢«æ‰‘ï¼`; 
      }
      document.getElementById("simScore").innerText = `${hg} - ${ag}`;
    }
    // ä¸­æŸ±
    else if (rand < 0.21 && Math.random() < hitPostProb) {
      event = `ğŸ¥… ${min}â€² ${Math.random()<0.5?hn:an} å°„ä¸­æ¨ªæ¢ï¼`;
    }
    // ä¹Œé¾™çƒ
    else if (rand < 0.22 && Math.random() < ownGoalProb) {
      if(Math.random()<0.5){
        hg++; event = `ğŸ˜¬ ${min}â€² ${an} ä¹Œé¾™çƒï¼${hn} å¾—åˆ†`;
      } else {
        ag++; event = `ğŸ˜¬ ${min}â€² ${hn} ä¹Œé¾™çƒï¼${an} å¾—åˆ†`;
      }
      document.getElementById("simScore").innerText = `${hg} - ${ag}`;
    }
    // å¸¸è§„è¿›çƒ
    else if (Math.random() < homeAttackProb * 1.5) {
      hg++; event = `âš½ ${min}â€² ${hn} è¿›çƒ`;
      document.getElementById("simScore").innerText = `${hg} - ${ag}`;
    }
    else if (Math.random() < awayAttackProb * 1.5) {
      ag++; event = `âš½ ${min}â€² ${an} è¿›çƒ`;
      document.getElementById("simScore").innerText = `${hg} - ${ag}`;
    }
    // æ¢äºº/VAR
    else if (min >= 60 && rand < 0.25) {
      event = `ğŸ”„ ${min}â€² ${Math.random()<0.5?hn:an} æ¢äºº`;
    }

    // åŠåœº/å…¨åœºæ¶ˆæ¯
    if (min === 45) event = "â¸ï¸ ä¸ŠåŠåœºç»“æŸ";
    if (min === 46) event = "âºï¸ ä¸‹åŠåœºå¼€å§‹";
    if (min === 90 && extraTime>0) event = `â±ï¸ ä¸‹åŠåœºè¡¥æ—¶ ${extraTime} åˆ†é’Ÿ`;

    if (event) {
      document.getElementById("simEvent").innerText = event;
    }
  }, 600);
}

// ä¸»é¢˜åˆ‡æ¢
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
if (localStorage.getItem('theme') === 'light') {
  body.classList.add('light');
  themeToggle.textContent = 'â˜€ï¸ åˆ‡æ¢æ·±è‰²æ¨¡å¼';
}
themeToggle.addEventListener('click', () => {
  if (body.classList.contains('light')) {
    body.classList.remove('light');
    themeToggle.textContent = 'ğŸŒ™ åˆ‡æ¢æµ…è‰²æ¨¡å¼';
    localStorage.setItem('theme', 'dark');
  } else {
    body.classList.add('light');
    themeToggle.textContent = 'â˜€ï¸ åˆ‡æ¢æ·±è‰²æ¨¡å¼';
    localStorage.setItem('theme', 'light');
  }
});

// åˆå§‹åŒ–
loadTeam();
// å¹´é¾„éªŒè¯å·²æ˜¾ç¤º
</script>
</body>
</html>
